<!DOCTYPE html>
<html>
    <head>
        <title>RouterOS : DHCP</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">RouterOS</a></span>
                            </li>
                                                    <li>
                                <span><a href="RouterOS_328059.html">RouterOS</a></span>
                            </li>
                                                    <li>
                                <span><a href="Network-Management_119144613.html">Network Management</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            RouterOS : DHCP
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> Guntis G.</span>, last updated by <span class='editor'> Edgars P.</span> on May 16, 2025
    
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><style type='text/css'>/*<![CDATA[*/
div.rbtoc1747742030602 {padding: 0px;}
div.rbtoc1747742030602 ul {margin-left: 0px;}
div.rbtoc1747742030602 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1747742030602'>
<ul class='toc-indentation'>
<li><a href='#DHCP-DHCPClient'>DHCP Client</a>
<ul class='toc-indentation'>
<li><a href='#DHCP-Summary'>Summary</a></li>
<li><a href='#DHCP-DHCPOptions'>DHCP Options</a></li>
<li><a href='#DHCP-Properties'>Properties</a></li>
<li><a href='#DHCP-ConfigurationExamples'>Configuration Examples</a>
<ul class='toc-indentation'>
<li><a href='#DHCP-SimpleDHCPclient'>Simple DHCP client</a></li>
<li><a href='#DHCP-LeaseScriptExampleLeasescriptexample'>Lease script example</a></li>
<li><a href='#DHCP-UsingreceivedOption43tosettheACSURL'>Using received Option 43 to set the ACS URL</a></li>
<li><a href='#DHCP-Resolvedefaultgatewaywhen&#39;router&#39;(option3)isfromadifferentsubnet'>Resolve default gateway when &#39;router&#39; (option3) is from a different subnet</a></li>
</ul>
</li>
</ul>
</li>
<li><a href='#DHCP-DHCPv6Client'>DHCPv6 Client</a>
<ul class='toc-indentation'>
<li><a href='#DHCP-Summary.1'>Summary</a></li>
<li><a href='#DHCP-Properties.1'>Properties</a></li>
<li><a href='#DHCP-Script'>Script</a></li>
<li><a href='#DHCP-IAID'>IAID</a></li>
<li><a href='#DHCP-ConfigurationExamples.1'>Configuration Examples</a>
<ul class='toc-indentation'>
<li><a href='#DHCP-SimpleDHCPv6client'>Simple DHCPv6 client</a></li>
<li><a href='#DHCP-UsereceivedprefixforlocalRA'>Use received prefix for local RA</a></li>
</ul>
</li>
</ul>
</li>
<li><a href='#DHCP-DHCPServer'>DHCP Server</a>
<ul class='toc-indentation'>
<li><a href='#DHCP-Summary.2'>Summary</a></li>
<li><a href='#DHCP-DHCPServerProperties'>DHCP Server Properties</a></li>
<li><a href='#DHCP-Leases'>Leases</a>
<ul class='toc-indentation'>
<li><a href='#DHCP-Menuspecificcommands'>Menu specific commands</a></li>
<li><a href='#DHCP-StoreConfiguration'>Store Configuration</a></li>
<li><a href='#DHCP-Ratelimiting'>Rate limiting</a></li>
</ul>
</li>
<li><a href='#DHCP-Network'>Network</a></li>
<li><a href='#DHCP-RADIUSSupport'>RADIUS Support</a></li>
<li><a href='#DHCP-Alerts'>Alerts</a></li>
<li><a href='#DHCP-DHCPOptions.1'>DHCP Options</a>
<ul class='toc-indentation'>
<li><a href='#DHCP-DHCPOptionSets'>DHCP Option Sets</a></li>
<li><a href='#DHCP-Example'>Example</a></li>
</ul>
</li>
<li><a href='#DHCP-Optionmatcher'>Option matcher</a>
<ul class='toc-indentation'>
<li><a href='#DHCP-Properties.2'>Properties</a></li>
<li><a href='#DHCP-Optionmatcherexamples'>Option matcher examples</a></li>
</ul>
</li>
<li><a href='#DHCP-ConfigurationExamples.2'>Configuration Examples</a>
<ul class='toc-indentation'>
<li><a href='#DHCP-Setup'>Setup</a></li>
<li><a href='#DHCP-Manualconfiguration'>Manual configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href='#DHCP-DHCPv6Server'>DHCPv6 Server</a>
<ul class='toc-indentation'>
<li><a href='#DHCP-Summary.3'>Summary</a></li>
<li><a href='#DHCP-General'>General</a></li>
<li><a href='#DHCP-DHCPv6ServerProperties'>DHCPv6 Server Properties</a></li>
<li><a href='#DHCP-Bindings'>Bindings</a>
<ul class='toc-indentation'>
<li><a href='#DHCP-Ratelimiting.1'>Rate limiting</a></li>
</ul>
</li>
<li><a href='#DHCP-RADIUSSupport.1'>RADIUS Support</a></li>
<li><a href='#DHCP-ConfigurationExample'>Configuration Example</a>
<ul class='toc-indentation'>
<li><a href='#DHCP-EnablingIPv6Prefixdelegation'>Enabling IPv6 Prefix delegation</a></li>
<li><a href='#DHCP-EnablingIPv6Addressdelegation'>Enabling IPv6 Address delegation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href='#DHCP-DHCPRelay'>DHCP Relay</a>
<ul class='toc-indentation'>
<li><a href='#DHCP-Summary.4'>Summary</a></li>
<li><a href='#DHCP-Properties.3'>Properties</a></li>
<li><a href='#DHCP-ConfigurationExample.1'>Configuration Example</a></li>
<li><a href='#DHCP-DHCPRelaywithVRF(introducedin7.15)'>DHCP Relay with VRF (introduced in 7.15)</a></li>
</ul>
</li>
</ul>
</div></p><h1 id="DHCP-DHCPClient">DHCP Client</h1><h2 id="DHCP-Summary">Summary</h2><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip dhcp-client</pre>
</div></div><p><span style="color:var(--ds-text,#333333);">The DHCP (Dynamic Host Configuration Protocol) is used for the easy distribution of IP addresses in a network. The MikroTik RouterOS implementation includes both server and client parts and is compliant with RFC 2131.</span></p><p>The MikroTik RouterOS DHCP client may be enabled on any Ethernet-like interface at a time. The client will accept an address, netmask, default gateway, and two DNS server addresses. The received IP address will be added to the interface with the respective netmask. The default gateway will be added to the routing table as a dynamic entry. Should the DHCP client be disabled or not renew an address, the dynamic default route will be removed. If there is already a default route installed prior to the DHCP client obtaining one, the route obtained by the DHCP client would be shown as invalid.</p><p>RouterOS DHCP client asks for the following options:</p><ul><li>option 1 - Subnet Mask,</li><li>option 3 - Gateway Addresses,</li><li>option 6 - DNS Server Addresses,</li><li>option 33 - Static Routes,</li><li>option 42 - NTP Server Addresses,</li><li>option 43 - Vendor Specific Information,</li><li>option 121 - Classless Static Routes,</li><li>option 138 - CAPWAP Access Controller Addresses.</li></ul><h2 id="DHCP-DHCPOptions">DHCP Options</h2><p>DHCP client has the possibility to set up options that are sent to the DHCP server. For example, hostname and MAC address. The syntax is the same as for DHCP server options.</p><p>Currently, there are three variables that can be used in options:</p><ul><li>HOSTNAME;</li><li>CLIENT_MAC - client interface MAC address;</li><li>CLIENT_DUID - client DIUD of the router, same as used for the DHCPv6 client. In conformance with RFC4361</li></ul><p>DHCP client default options include these default Options:</p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col style="width: 100.0px;"/><col style="width: 53.0px;"/><col style="width: 146.0px;"/></colgroup><tbody><tr><th class="confluenceTh">Name</th><th class="confluenceTh">code</th><th class="confluenceTh">value</th></tr><tr><td class="confluenceTd">clientid_duid</td><td class="confluenceTd">61</td><td class="confluenceTd">0xff$(CLIENT_DUID)</td></tr><tr><td class="confluenceTd">clientid</td><td class="confluenceTd">61</td><td class="confluenceTd">0x01$(CLIENT_MAC)</td></tr><tr><td class="confluenceTd">hostname</td><td class="confluenceTd">12</td><td class="confluenceTd">$(HOSTNAME)</td></tr></tbody></table></div><h2 id="DHCP-Properties"><span class="mw-headline">Properties</span></h2><div class="table-wrap"><table class="wrapped relative-table confluenceTable" style="width: 70.2115%;"><colgroup><col style="width: 19.6278%;"/><col style="width: 80.3722%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>add-default-route</strong> (<em>yes | no | special-classless</em>; Default: <strong>yes</strong>)</td><td class="confluenceTd">Whether to install default route in routing table received from DHCP server. By default, the RouterOS client complies with RFC and ignores option 3 if classless option 121 is received. To force the client not to ignore option 3 set <em>special-classless</em>. This parameter is available in v6rc12+<ul><li><strong>yes</strong> - adds classless route if received, if not then add default route (old behavior)</li><li><strong>special-classless</strong> - adds both classless routes if received and a default route (MS style)</li></ul></td></tr><tr><td class="confluenceTd"><strong>client-id</strong> (<em>string</em>; Default: )</td><td class="confluenceTd">Corresponds to the settings suggested by the network administrator or ISP. If not specified, the client's MAC address will be sent</td></tr><tr><td class="confluenceTd"><strong>comment</strong> (<em>string</em>; Default: )</td><td class="confluenceTd">Short description of the client</td></tr><tr><td class="confluenceTd"><strong>default-route-tables</strong> (<em>table:distance</em>; Default: main)</td><td class="confluenceTd">List of routing tables to which default route must be added. Table name can be proceeded with &quot;:x&quot; where x would be the distance for the route to be installed with.</td></tr><tr><td class="confluenceTd"><strong>default-route-distance </strong>(<em>integer:0..255</em>; Default: )</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd"><strong>disabled</strong> (<em>yes | no</em>; Default: <strong>yes</strong>)</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd"><strong>host-name</strong> (<em>string</em>; Default: )</td><td class="confluenceTd">The hostname of the client is sent to a DHCP server. If not specified, the client's system identity will be used.</td></tr><tr><td class="confluenceTd"><strong>interface</strong> (<em>string</em>; Default: )</td><td class="confluenceTd">The interface on which the DHCP client will be running.</td></tr><tr><td class="confluenceTd"><strong>script</strong> (<em>script</em>; Default: )</td><td class="confluenceTd"><span style="color:var(--ds-text,#172b4d);">Execute script when DHCP client obtains a new lease or loses an existing one, received gateway address or DNS server list is changed.</span><br style="text-align: left;"/><span style="color:var(--ds-text,#172b4d);">Variables that are accessible for the event script:</span><ul style="text-align: left;"><li>bound - 1 - lease is added/changed; 0 - lease is removed</li><li>server-address - server address</li><li>lease-address - lease address provided by a server</li><li>interface - name of the interface on which the client is configured</li><li>gateway-address - gateway address provided by a server</li><li>vendor-specific - stores value of option 43 received from DHCP server</li><li>lease-options - an array of received options</li></ul><a href="#DHCP-LeaseScriptExample"> <code>Example &gt;&gt;</code></a></td></tr><tr><td class="confluenceTd"><strong>use-peer-dns</strong> (<em>yes | no</em>; Default: <strong>yes</strong>)</td><td class="confluenceTd">Whether to accept the <a href="https://help.mikrotik.com/docs/display/ROS/DNS" rel="nofollow"> DNS </a> settings advertised by <a href="https://help.mikrotik.com/docs/display/ROS/DHCP#DHCP-DHCPServer" rel="nofollow"> DHCP Server</a>. (Will override the settings put in the <code>/ip dns</code> submenu.</td></tr><tr><td class="confluenceTd"><strong>use-peer-ntp</strong> (<em>yes | no</em>; Default: <strong>yes</strong>)</td><td class="confluenceTd">Whether to accept the <a class="external-link" href="https://wiki.mikrotik.com/wiki/Manual:System/Time#NTP_client_and_server" rel="nofollow" title="Manual:System/Time"> NTP</a> settings advertised by <a href="https://help.mikrotik.com/docs/display/ROS/DHCP#DHCP-DHCPServer" rel="nofollow"> DHCP Server</a>. (Will override the settings put in the <code>/system ntp client</code> submenu)</td></tr><tr><td class="confluenceTd"><strong>vlan-priority </strong>(<em>integer:0..7</em>; Default: <strong>0</strong>)</td><td class="confluenceTd">If the DHCP client is running on a <a href="https://help.mikrotik.com/docs/spaces/ROS/pages/88014957/VLAN" rel="nofollow">VLAN interface</a> (/interface/vlan), you can specify the Priority Code Point (PCP) value. PCP is a 3-bit field in the VLAN header used to mark the priority of packets within a VLAN, allowing traffic to be prioritized accordingly. This setting applies only to VLAN interfaces and affects the priority of outgoing DHCP client packets.</td></tr></tbody></table></div><p><strong>Read-only properties</strong></p><div class="table-wrap"><table class="wrapped relative-table confluenceTable" style="width: 70.2115%;"><colgroup><col style="width: 19.7282%;"/><col style="width: 80.2718%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>address</strong> (<em>IP/Netmask</em>)</td><td class="confluenceTd">IP address and netmask, which is assigned to DHCP Client from the Server</td></tr><tr><td class="confluenceTd"><strong>dhcp-server</strong> (<em>IP</em>)</td><td class="confluenceTd">The IP address of the DHCP server.</td></tr><tr><td class="confluenceTd"><strong>expires-after</strong> (<em>time</em>)</td><td class="confluenceTd">A time when the lease expires (specified by the DHCP server).</td></tr><tr><td class="confluenceTd"><strong>gateway</strong> (<em>IP</em>)</td><td class="confluenceTd">The IP address of the gateway which is assigned by the DHCP server</td></tr><tr><td class="confluenceTd"><strong>invalid</strong> (<em>yes | no</em>)</td><td class="confluenceTd">Shows whether a configuration is invalid.</td></tr><tr><td class="confluenceTd"><strong>netmask</strong> (<em>IP</em>)</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd"><strong>primary-dns</strong> (<em>IP</em>)</td><td class="confluenceTd">The IP address of the first DNS resolver, which was assigned by the DHCP server</td></tr><tr><td class="confluenceTd"><strong>primary-ntp</strong> (<em>IP</em>)</td><td class="confluenceTd">The IP address of the primary NTP server, assigned by the DHCP server</td></tr><tr><td class="confluenceTd"><strong>secondary-dns</strong> (<em>IP</em>)</td><td class="confluenceTd">The IP address of the second DNS resolver, assigned by the DHCP server</td></tr><tr><td class="confluenceTd"><strong>secondary-ntp</strong> (<em>IP</em>)</td><td class="confluenceTd">The IP address of the secondary NTP server, assigned by the DHCP server</td></tr><tr><td class="confluenceTd"><strong>status</strong> (<em>bound | error | rebinding... | requesting... | searching... | stopped</em>)</td><td class="confluenceTd">Shows the status of the DHCP Client</td></tr></tbody></table></div><p><strong><span class="mw-headline">Menu specific commands</span></strong></p><div class="table-wrap"><table class="wrapped relative-table confluenceTable" style="width: 70.2115%;"><colgroup><col style="width: 19.7625%;"/><col style="width: 80.2375%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>release</strong> (<em>numbers</em>)</td><td class="confluenceTd">Release current binding and restart the DHCP client</td></tr><tr><td class="confluenceTd"><strong>renew</strong> (<em>numbers</em>)</td><td class="confluenceTd">Renew current leases. If the renewal operation was not successful, the client tries to reinitialize the lease (i.e. it starts the lease request procedure (rebind) as if it had not received an IP address yet)</td></tr></tbody></table></div><h2 id="DHCP-ConfigurationExamples">Configuration Examples</h2><h3 id="DHCP-SimpleDHCPclient">Simple DHCP client</h3><p>Add a DHCP client on the ether1 interface:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip dhcp-client add interface=ether1 disabled=no</pre>
</div></div><p>After the interface is added, you can use the &quot;print&quot; or &quot;print detail&quot; command to see what parameters the DHCP client acquired:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] ip dhcp-client&gt; print detail
Flags: X - disabled, I - invalid 
 0   interface=ether1 add-default-route=yes use-peer-dns=yes use-peer-ntp=yes
     status=bound address=192.168.0.65/24 gateway=192.168.0.1
     dhcp-server=192.168.0.1 primary-dns=192.168.0.1 primary-ntp=192.168.0.1
     expires-after=9m44s 
[admin@MikroTik] ip dhcp-client&gt;</pre>
</div></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>If the interface used by the DHCP client is part of the VRF configuration, then the default route and other received routes from the DHCP server will be added to the VRF routing table.</p></div></div><p>DHCP client status can be checked with:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip dhcp-client print detail </pre>
</div></div><h3 id="DHCP-LeaseScriptExampleLeasescriptexample"><span class="confluence-anchor-link" id="DHCP-LeaseScriptExample"></span>Lease script example</h3><p>It is possible to execute a script when a DHCP client obtains a new lease or loses an existing one. This is an example script that automatically adds a default route with routing-table=WAN1 and removes it when the lease expires or is removed.</p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Be aware that some variables might be reserved in specific menus and cannot be used there. More info find <a href="https://help.mikrotik.com/docs/spaces/ROS/pages/47579229/Scripting#Scripting-Reservedvariablenames" rel="nofollow">here</a>.</p></div></div><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip dhcp-client
add add-default-route=no dhcp-options=hostname,clientid disabled=no interface=ether2 script=&quot;{\r\
    \n    :local rmark \&quot;WAN1\&quot;\r\
    \n    :local count [/ip route print count-only where comment=\&quot;WAN1\&quot;]\r\
    \n    :if (\$bound=1) do={\r\
    \n        :if (\$count = 0) do={\r\
    \n            /ip route add gateway=\$\&quot;gateway-address\&quot; comment=\&quot;WAN1\&quot; routing-table=\$rmark\r\
    \n        } else={\r\
    \n            :if (\$count = 1) do={\r\
    \n                :local test [/ip route find where comment=\&quot;WAN1\&quot;]\r\
    \n                :if ([/ip route get \$test gateway] != \$\&quot;gateway-address\&quot;) do={\r\
    \n                    /ip route set \$test gateway=\$\&quot;gateway-address\&quot;\r\
    \n                }\r\
    \n            } else={\r\
    \n                :error \&quot;Multiple routes found\&quot;\r\
    \n            }\r\
    \n        }\r\
    \n    } else={\r\
    \n        /ip route remove [find comment=\&quot;WAN1\&quot;]\r\
    \n    }\r\
    \n}\r\
    \n&quot;</pre>
</div></div><h3 id="DHCP-UsingreceivedOption43tosettheACSURL">Using received Option 43 to set the ACS URL</h3><p>It is possible to set <em>Automatic Configuration Server (ACS) </em>URL in the TR069 client settings, when a DHCP client lease is bound, if the option sent from the DHCP server is configured to send it. Here's an example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">:if ($bound=1) do={
/tr069-client/set acs-url=$&quot;vendor-specific&quot;
}</pre>
</div></div><h3 id="DHCP-Resolvedefaultgatewaywhen&#39;router&#39;(option3)isfromadifferentsubnet">Resolve default <span class="mw-headline">gateway when 'router' (option3) is from a different subnet</span></h3><p>In some cases, administrators tend to set the 'router' option which cannot be resolved with offered IP's subnet. For example, the DHCP server offers 192.168.88.100/24 to the client, and option 3 is set to 172.16.1.1. This will result in an unresolved default route:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false"> #      DST-ADDRESS        PREF-SRC        GATEWAY            DISTANCE
 0  DS  0.0.0.0/0                          172.16.1.1              1
 1 ADC  192.168.88.0/24    192.168.88.100  ether1 </pre>
</div></div><p><span style="letter-spacing: 0.0px;">To fix this we need to add /32 route to resolve the gateway over ether1, which can be done by the running script below each time the DHCP client gets an address</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/system script add name=&quot;dhcpL&quot; source={ /ip address add address=($&quot;lease-address&quot; . &quot;/32&quot;) network=$&quot;gateway-address&quot; interface=$interface }</pre>
</div></div><p><span style="letter-spacing: 0.0px;">Now we can further extend the script, to check if the address already exists, and remove the old one if changes are needed</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/system script add name=&quot;dhcpL&quot; source={ 
  /ip address {
    :local ipId [find where comment=&quot;dhcpL address&quot;]
    :if ($ipId != &quot;&quot;) do={
      :if (!([get $ipId address] = ($&quot;lease-address&quot; . &quot;/32&quot;) &amp;&amp; [get $ipId network]=$&quot;gateway-address&quot; )) do={
        remove $ipId;
        add address=($&quot;lease-address&quot; . &quot;/32&quot;) network=$&quot;gateway-address&quot; \
          interface=$interface comment=&quot;dhcpL address&quot;
      }
    } else={
      add address=($&quot;lease-address&quot; . &quot;/32&quot;) network=$&quot;gateway-address&quot; \
        interface=$interface comment=&quot;dhcpL address&quot;
    }
  }
}</pre>
</div></div><h1 id="DHCP-DHCPv6Client">DHCPv6 Client</h1><h2 id="DHCP-Summary.1"><span class="mw-headline">Summary</span></h2><p><strong>Sub-menu:</strong><span> </span><code>/ipv6 dhcp-client</code></p><p>DHCP-client in RouterOS is capable of being a DHCPv6-client and DHCP-PD client. So it is able to get a prefix from the DHCP-PD server as well as the DHCPv6 stateful address from the DHCPv6 server.</p><h2 id="DHCP-Properties.1"><span class="mw-headline">Properties</span></h2><div class="table-wrap"><table class="wrapped relative-table confluenceTable" style="margin-left: 14.4318px;width: 60.8761%;"><colgroup><col style="width: 28.23713%;"/><col style="width: 71.45086%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>add-default-route</strong><span> </span>(<em>yes | no</em>; Default:<span> </span><strong>no</strong>)</td><td class="confluenceTd">Whether to add default IPv6 route after a client connects.</td></tr><tr><td class="confluenceTd"><strong>default-route-tables</strong> (<em>table:distance</em>; Default: main)</td><td class="confluenceTd">List of routing tables to which default route must be added. Table name can be proceeded with &quot;:x&quot; where x would be the distance for the route to be installed with.</td></tr><tr><td class="confluenceTd"><strong>comment</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">Short description of the client</td></tr><tr><td class="confluenceTd"><strong>disabled</strong><span> </span>(<em>yes | no</em>; Default:<span> </span><strong>no</strong>)</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd"><strong>interface</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">The interface on which the DHCPv6 client will be running.</td></tr><tr><td class="confluenceTd"><strong>pool-name</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">Name of the<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/IP+Pools#IPPools-IPv6Pool" rel="nofollow">IPv6 pool</a><span> </span>in which received IPv6 prefix will be added</td></tr><tr><td class="confluenceTd"><strong>pool-prefix-length</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">Prefix length parameter that will be set for<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/IP+Pools#IPPools-IPv6Pool" rel="nofollow">IPv6 pool</a><span> </span>in which received IPv6 prefix is added. <span style="text-decoration: none;color:var(--ds-text-accent-purple-bolder,#352c63);">Prefix length must be greater or equal as the length of received prefix</span>, otherwise, prefix-length will be set to received prefix length + 8 bits.</td></tr><tr><td class="confluenceTd"><strong>prefix-address-lists<span> </span></strong>(<em>string</em>; Default: )</td><td class="confluenceTd">Names of the firewall address lists to which received prefix will be added.</td></tr><tr><td class="confluenceTd"><strong>prefix-hint</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">Include a preferred prefix length.</td></tr><tr><td class="confluenceTd"><strong>request</strong><span> </span>(<em>prefix, address</em>; Default: )</td><td class="confluenceTd">to choose if the DHCPv6 request will ask for the address or the IPv6 prefix, or both.</td></tr><tr><td class="confluenceTd"><strong>script</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">Run this script on the DHCP-client status change. Available variables:<ul><li>pd-valid<span> </span>- if the prefix is acquired by the client;</li><li>pd-prefix<span> </span>- the prefix acquired by the client if any;</li><li>na-valid<span> </span>- if the address is acquired by the client;</li><li>na-address<span> </span>- the address acquired by the client if any.</li><li>options<span> </span>- array of received options (only ROSv7)</li></ul></td></tr><tr><td class="confluenceTd"><strong>use-peer-dns</strong><span> </span>(<em>yes | no</em>; Default:<span> </span><strong>yes</strong>)</td><td class="confluenceTd">Whether to accept the DNS settings advertised by the IPv6 DHCP Server.</td></tr><tr><td class="confluenceTd"><strong>custom-duid</strong><span> </span>(<em>hex string</em>; Default: )</td><td class="confluenceTd">Allow to specify custom DUID.</td></tr><tr><td class="confluenceTd"><strong>use-interface-duid<span> </span></strong>(<em>yes | no</em>; Default:<span> </span><strong>no</strong>)</td><td class="confluenceTd">According to RFC DHCPv6 client generate DUID based on the router first interface MAC address, not the interface on which client is configured. With this option enabled you will override this requirement and MAC address from &quot;interface&quot; specified on client will be used.</td></tr><tr><td class="confluenceTd"><strong><strong>validate-server-duid</strong></strong> (<em>yes | no</em>; Default: <strong>yes</strong>)</td><td class="confluenceTd">Allow to ignore incorrectly formed DUID provided by DHCPv6 server. Still checks that minimal DUID length is correct.</td></tr></tbody></table></div><p><strong><span class="mw-headline">Read-only properties</span></strong></p><div class="table-wrap"><table class="wrapped relative-table confluenceTable" style="margin-left: 14.4318px;width: 60.8459%;"><colgroup><col style="width: 28.2233%;"/><col style="width: 71.7767%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>duid</strong><span> </span>(<em>string</em>)</td><td class="confluenceTd">Auto-generated DUID that is sent to the server. DUID is generated using one of the MAC addresses available on the router.</td></tr><tr><td class="confluenceTd"><strong>request</strong><span> </span>(<em>list</em>)</td><td class="confluenceTd">specifies what was requested - prefix, address, or both.</td></tr><tr><td class="confluenceTd"><strong>dynamic</strong><span> </span>(<em>yes | no</em>)</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd"><strong>expires-after</strong><span> </span>(<em>time</em>)</td><td class="confluenceTd">A time when the IPv6 prefix expires (specified by the DHCPv6 server).</td></tr><tr><td class="confluenceTd"><strong>invalid</strong><span> </span>(<em>yes | no</em>)</td><td class="confluenceTd">Shows whether a configuration is invalid.</td></tr><tr><td class="confluenceTd"><strong>prefix</strong><span> </span>(<em>IPv6 prefix</em>)</td><td class="confluenceTd">Shows received IPv6 prefix from DHCPv6-PD server</td></tr><tr><td class="confluenceTd"><strong>status</strong><span> </span>(<em>stopped | searching | requesting... | bound | renewing | rebinding | error | stopping</em>)</td><td class="confluenceTd">Shows the status of DHCPv6 Client:<ul><li><strong>stopped</strong><span> </span>- dhcpv6 client is stopped</li><li><strong>searching</strong><span> </span>- sending &quot;solicit&quot; and trying to get &quot;advertise&quot;</li><li><strong>requesting</strong><span> </span>- sent &quot;request&quot; waiting for &quot;reply&quot;</li><li><strong>bound</strong><span> </span>- received &quot;reply&quot;. Prefix assigned.</li><li><strong>renewing</strong><span> </span>- sent &quot;renew&quot;, waiting for &quot;reply&quot;</li><li><strong>rebinding</strong><span> </span>- sent &quot;rebind&quot;, waiting for &quot;reply&quot;</li><li><strong>error</strong><span> </span>- reply was not received in time or some other error occurred.</li><li><strong>stopping</strong><span> </span>- sent &quot;release&quot;</li></ul></td></tr></tbody></table></div><p><strong><span class="mw-headline">Menu specific commands</span></strong></p><div class="table-wrap"><table class="wrapped relative-table confluenceTable" style="margin-left: 14.4318px;width: 60.8761%;"><colgroup><col style="width: 28.3537%;"/><col style="width: 71.6463%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>release</strong><span> </span>(<em>numbers</em>)</td><td class="confluenceTd">Release current binding and restart DHCPv6 client</td></tr><tr><td class="confluenceTd"><strong>renew</strong><span> </span>(<em>numbers</em>)</td><td class="confluenceTd">Renew current leases. If the renewal operation was not successful, the client tries to reinitialize the lease (i.e. it starts the lease request procedure (rebind) as if it had not received an IP address yet)</td></tr></tbody></table></div><h2 id="DHCP-Script"><span class="mw-headline">Script</span></h2><p>It is possible to add a script that will be executed when a prefix or an address is acquired and applied or expires and is removed using the DHCP client. There are separated sets of variables that will have the value set by the client depending on prefix or address status change as the client can acquire both and each of them can have a different effect on the router configuration.</p><p>Available variables for dhcp-client</p><ul><li>pd-valid<span> </span>- value - 1 or 0 - if prefix is acquired and it is applied or not</li><li>pd-prefix<span> </span>- value ipv6/num (ipv6 prefix with mask) - the prefix inself</li><li>na-valid<span> </span>- value - 1 or 0 - if address is acquired and it is applied or not</li><li>na-address<span> </span>- value - ipv6 address - the address</li></ul><h2 id="DHCP-IAID">IAID</h2><p>To determine what IAID will be used, convert the internal ID of an interface on which the DHCP client is running from hex to decimal.</p><p>For example, the DHCP client is running on interface PPPoE-out1. To get internal ID use the following command:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@t36] /interface&gt; :put [find name=&quot;pppoe-out1&quot;] 
*15</pre>
</div></div><p><br/></p><p>Now convert hex value 15 to decimal and you get IAID=21</p><h2 id="DHCP-ConfigurationExamples.1"><span class="mw-headline">Configuration Examples</span></h2><h3 id="DHCP-SimpleDHCPv6client">Simple DHCPv6 client</h3><p>This simple example demonstrates how to enable dhcp client to receive IPv6 prefix and add it to the pool.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ipv6 dhcp-client add request=prefix pool-name=test-ipv6 pool-prefix-length=64 interface=ether13 

</pre>
</div></div><p><br/></p><p>Detailed print should show status of the client and we can verify if prefix is received</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@x86-test] /ipv6 dhcp-client&gt; print detail 
Flags: D - dynamic, X - disabled, I - invalid
 0 interface=bypass pool-name=&quot;test-ipv6&quot; pool-prefix-length=64 status=bound 
prefix=2001:db8:7501:ff04::/62 expires-after=2d23h11m53s request=prefix</pre>
</div></div><p><br/></p><p>Notice that server gave us prefix 2a02:610:7501:ff04::/62 . And it should be also added to ipv6 pools</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] /ipv6 pool&gt; print 
Flags: D - dynamic 
# NAME PREFIX REQUEST PREFIX-LENGTH
0 D test-ipv6 2001:db8:7501:ff04::/62 prefix 64

</pre>
</div></div><p><span>It works! Now you can use this pool, for example, for pppoe clients.</span></p><h3 id="DHCP-UsereceivedprefixforlocalRA"><span class="mw-headline">Use received prefix for local RA</span></h3><p>Consider following setup:</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" draggable="false" src="attachments/24805500/135856337.jpg" data-image-src="attachments/24805500/135856337.jpg" data-unresolved-comment-count="0" data-linked-resource-id="135856337" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Dhcpv6-pd-example.jpg" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="24805500" data-linked-resource-container-version="76" tabindex="0" alt=""></span></p><ul><li>ISP is routing prefix 2001:DB8::/62 to the router R1</li><li>Router R1 runs DHCPv6 server to delegate /64 prefixes to the customer routers CE1 CE2</li><li>DHCP client on routers CE1 and CE2 receives delegated /64 prefix from the DHCP server (R1).</li><li>Client routers uses received prefix to set up RA on the local interface</li></ul><p><br/></p><p><strong>Configuration</strong></p><p><br/><strong>R1</strong></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ipv6 route 
add gateway=fe80::1:1%to-ISP 

/ipv6 pool 
add name=myPool prefix=2001:db8::/62 prefix-length=64 

/ipv6 dhcp-server
 add prefix-pool=myPool disabled=no interface=to-CE-routers lease-time=3m name=server1</pre>
</div></div><p style="margin-left: 20.0px;"><br/></p><p><br/><strong>CE1</strong></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ipv6 dhcp-client
add interface=to-R1 request=prefix pool-name=my-ipv6

/ipv6 address
add address=::1/64 from-pool=my-ipv6 interface=to-clients advertise=yes

</pre>
</div></div><p style="margin-left: 20.0px;"><br/></p><p><strong>CE2</strong></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ipv6 dhcp-client
 add interface=to-R1 request=prefix pool-name=my-ipv6 
/ipv6 address add address=::1/64 from-pool=my-ipv6 interface=to-clients advertise=yes</pre>
</div></div><p style="margin-left: 20.0px;"><br/></p><p><br/><strong>Check the status</strong></p><p>After configuration is complete we can verify that each CE router received its own prefix</p><p>On server:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@R1] /ipv6 dhcp-server binding&gt; print
 Flags: X - disabled, D - dynamic 
# ADDRESS DUID IAID SERVER STATUS
 1 D 2001:db8:1::/64 0019d1393536 566 server1 bound 
2 D 2001:db8:2::/64 0019d1393535 565 server1 bound</pre>
</div></div><p style="margin-left: 20.0px;"><br/></p><p>On client:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@CE1] /ipv6 dhcp-client&gt; print 
Flags: D - dynamic, X - disabled, I - invalid 
# INTERFACE STATUS REQUEST PREFIX 
0 to-R1 bound prefix 2001:db8:1::/64 

[admin@CE1] /ipv6 dhcp-client&gt; /ipv6 pool print 
Flags: D - dynamic 
# NAME PREFIX PREFIX-LENGTH
0 D my-ipv6 2001:db8:1::/64 64</pre>
</div></div><p style="margin-left: 20.0px;"><br/></p><p>We can also see that IPv6 address was automatically added from the prefix pool:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@CE1] /ipv6 address&gt; print 
Flags: X - disabled, I - invalid, D - dynamic, G - global, L - link-local 
# ADDRESS FROM-POOL INTERFACE ADVERTISE 0 G 2001:db8:1::1/64 to-clients yes 
..</pre>
</div></div><p style="margin-left: 20.0px;"><br/></p><p>And pool usage shows that 'Address' is allocating the pool</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@CE1] /ipv6 pool used&gt; print
 POOL PREFIX OWNER INFO 
my-ipv6 2001:db8:1::/64 Address to-clients</pre>
</div></div><h1 id="DHCP-DHCPServer"><span style="font-size: 24.0px;letter-spacing: -0.01em;">DHCP Server</span></h1><h2 id="DHCP-Summary.2"><span style="font-size: 24.0px;letter-spacing: -0.01em;">Summary</span></h2><p>The DHCP (Dynamic Host Configuration Protocol) is used for the easy distribution of IP addresses in a network. The MikroTik RouterOS implementation includes both server and client parts and is compliant with RFC 2131.</p><p>The router supports an individual server for each Ethernet-like interface. The MikroTik RouterOS DHCP server supports the basic functions of giving each requesting client an IP address/netmask lease, default gateway, domain name, DNS-server(s) and WINS-server(s) (for Windows clients) information (set up in the DHCP networks submenu)</p><p>In order for the DHCP server to work, IP pools must also be configured (do not include the DHCP server's own IP address into the pool range) and the DHCP networks.</p><p>It is also possible to hand out leases for DHCP clients using the RADIUS server; the supported parameters for a RADIUS server are as follows:</p><p><br/>Access-Request:</p><ul class="bullets"><li>NAS-Identifier - router identity</li><li>NAS-IP-Address - IP address of the router itself</li><li>NAS-Port - the ID of the interface where the DHCP server is configured. This value is the same as the IF-MIB::ifIndex</li><li>NAS-Port-Id - the name of the interface where the DHCP server is configured</li><li>NAS-Port-Type - Ethernet</li><li>Calling-Station-Id - client identifier (active-client-id)</li><li>Framed-IP-Address - IP address of the client (active-address)</li><li>Called-Station-Id - the name of DHCP server</li><li>User-Name - MAC address of the client (active-mac-address)</li><li>Password - &quot; &quot;</li></ul><p>Access-Accept:</p><ul class="bullets"><li>Framed-IP-Address - IP address that will be assigned to a client</li><li>Framed-Pool - IP pool from which to assign an IP address to a client</li><li>Rate-Limit - Datarate limitation for DHCP clients. Format is: rx-rate[/tx-rate] [rx-burst-rate[/tx-burst-rate] [rx-burst-threshold[/tx-burst-threshold] [rx-burst-time[/tx-burst-time][priority] [rx-rate-min[/tx-rate-min]]]]. All rates should be numbers with optional 'k' (1,000s) or 'M' (1,000,000s). If tx-rate is not specified, rx-rate is as tx-rate too. Same goes for tx-burst-rate and tx-burst-threshold and tx-burst-time. If both rx-burst-threshold and tx-burst-threshold are not specified (but burst-rate is specified), rx-rate and tx-rate are used as burst thresholds. If both rx-burst-time and tx-burst-time are not specified, 1s is used as default. Priority takes values 1..8, where 1 implies the highest priority, but 8 - the lowest. If rx-rate-min and tx-rate-min are not specified rx-rate and tx-rate values are used. The rx-rate-min and tx-rate-min values can not exceed rx-rate and tx-rate values.</li><li>Ascend-Data-Rate - TX/RX data rate limitation if multiple attributes are provided, first limits tx data rate, second - RX data rate. If used together with Ascend-Xmit-Rate, specifies RX rate. 0 if unlimited</li><li>Ascend-Xmit-Rate - tx data rate limitation. It may be used to specify the TX limit only instead of sending two sequential Ascend-Data-Rate attributes (in that case Ascend-Data-Rate will specify the receive rate). 0 if unlimited</li><li>Session-Timeout - max lease time (lease-time)</li></ul><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p><span style="color:var(--ds-text,#333333);">DHCP server requires a real interface to receive raw ethernet packets. If the interface is a Bridge interface, then the Bridge must have a real interface attached as a port to that bridge which will receive the raw ethernet packets. It cannot function correctly on a dummy (empty bridge) interface.</span></p></div></div><h2 id="DHCP-DHCPServerProperties"><span>DHCP Server P</span><span class="mw-headline">roperties</span></h2><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 98.4977%;"><colgroup><col style="width: 27.3701%;"/><col style="width: 72.5886%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>add-arp</strong><span> </span>(<em>yes | no</em>; Default:<span> </span><strong>no</strong>)</td><td class="confluenceTd">Whether to add dynamic ARP entry. If set to <strong>no</strong> either<span> </span>ARP mode<span> </span>should be enabled on that interface or static<span> </span>ARP<span> </span>entries should be administratively defined in<span> </span><em>/ip arp</em><span> </span>submenu.</td></tr><tr><td class="confluenceTd"><strong>address-pool</strong><span> </span>(<em>string | static-only</em>; Default:<span> </span><strong>static-only</strong>)</td><td class="confluenceTd">IP pool, from which to take IP addresses for the clients. If set to<span> </span><strong>static-only</strong>, then only the clients that have a static lease (added in<span> the </span>lease<span> </span>submenu) will be allowed.</td></tr><tr><td class="confluenceTd"><strong>allow-dual-stack-queue</strong><span> </span>(<em>yes | no</em>; Default:<span> </span><strong>yes</strong>)</td><td class="confluenceTd">Creates a single simple queue entry for both IPv4 and IPv6 addresses, and uses the MAC address and DUID for identification. Requires<span> </span>IPv6 DHCP Server<span> </span>to have this option enabled as well to work properly.</td></tr><tr><td class="confluenceTd"><strong>always-broadcast</strong><span> </span>(<em>yes | no</em>; Default:<span> </span><strong>no</strong>)</td><td class="confluenceTd"><p>Changes whether to force broadcast DHCP replies:</p><ul><li>no - replies are sent based on the client's broadcast flag. If the server sends three consecutive offers, the third and forth offer will be sent as a broadcast;</li><li>yes - replies are always broadcasted even when the client has not specified the broadcast flag.</li></ul></td></tr><tr><td class="confluenceTd"><strong>authoritative</strong><span> </span>(<em>after-10sec-delay | after-2sec-delay | yes | no</em>; Default:<span> </span><strong>yes</strong>)</td><td class="confluenceTd">Option changes the way how a server responds to DHCP requests:<ul><li>yes<span> </span>- replies to clients' requests for an address that is not available from this server, DHCP server will send a negative acknowledgment (DHCPNAK);</li><li>no<span> </span>- DHCP server ignores clients' requests for addresses that are not available from this server;</li></ul><ul><li>after-10sec-delay<span> </span>- requests with &quot;secs &lt; 10&quot; will be processed as in &quot;no&quot; setting case and requests with &quot;secs &gt;= 10&quot; will be processed as in &quot;yes&quot; case;</li></ul><ul><li>after-2sec-delay<span> </span>- requests with &quot;secs &lt; 2&quot; will be processed as in &quot;no&quot; setting case and requests with &quot;secs &gt;= 2&quot; will be processed as in &quot;yes&quot; case;</li></ul><p><br/></p>If all requests with &quot;secs &lt; x&quot; should be ignored, then<span> </span><strong>delay-threshold=x</strong><span> </span>setting should be used.</td></tr><tr><td class="confluenceTd"><strong>bootp-lease-time</strong><span> </span>(<em>forever | lease-time | time</em>; Default:<span> <strong>forever</strong></span>)</td><td class="confluenceTd">Accepts two predefined options or time value:<ul><li>forever<span> </span>- lease never expires</li><li>lease-time<span> </span>- use time from lease-time parameter</li></ul></td></tr><tr><td class="confluenceTd"><strong>bootp-support</strong><span> </span>(<em>none | static | dynamic</em>; Default:<span> </span><strong>static</strong>)</td><td class="confluenceTd">Support for BOOTP clients:<ul><li>none<span> </span>- do not respond to BOOTP requests</li><li>static<span> </span>- offer only static leases to BOOTP clients</li><li>dynamic<span> </span>- offer static and dynamic leases for BOOTP clients</li></ul></td></tr><tr><td class="confluenceTd"><strong>client-mac-limit</strong><span> </span>(<em>integer | unlimited</em>; Default:<span> </span><strong>unlimited</strong>)</td><td class="confluenceTd">Specifies whether to limit a specific number of clients per single MAC address or leave<span> </span>unlimited. Note that this setting should not be used in relay setups.</td></tr><tr><td class="confluenceTd"><strong>conflict-detection</strong><span> </span>(<em>yes | no</em>; Default:<span> <strong>yes</strong></span>)</td><td class="confluenceTd">Allows disabling/enabling conflict detection. If the option is enabled, then whenever the server tries to assign a lease it will send ICMP and ARP messages to detect whether such an address in the network already exists. If any of the above get a reply address is considered already used. </td></tr><tr><td class="confluenceTd"><strong>delay-threshold</strong><span> </span>(<em>time | none</em>; Default:<span> </span><strong>none</strong>)</td><td class="confluenceTd">If the sec's field in the DHCP packet is smaller than the delay threshold, then this packet is ignored. If set to<span> </span><strong>none</strong><span> </span>- there is no threshold (all DHCP packets are processed)</td></tr><tr><td class="confluenceTd"><strong>dhcp-option-set</strong><span> </span>(<em>name | none</em>; Default:<span> <strong>none</strong></span>)</td><td class="confluenceTd">Use a custom set of DHCP options defined in the option sets menu.</td></tr><tr><td class="confluenceTd"><strong>insert-queue-before</strong><span> </span>(<em>bottom | first | name</em>; Default:<span> <strong>first</strong></span>)</td><td class="confluenceTd">Specify where to place dynamic simple queue entries for static DHCP leases with<span> a </span>rate-limit<span> </span>parameter set.</td></tr><tr><td class="confluenceTd"><strong>interface</strong><span> </span>(<em>string</em>; Default:<span> </span>)</td><td class="confluenceTd">The interface on which the DHCP server will be running.</td></tr><tr><td class="confluenceTd"><strong>lease-script</strong><span> </span>(<em>string</em>; Default:<span> </span><strong>&quot;&quot;</strong>)</td><td class="confluenceTd">A script that will be executed after a lease is assigned or de-assigned. Internal &quot;global&quot; variables that can be used in the script:<ul><li>leaseBound<span> </span>- set to &quot;1&quot; if bound, otherwise set to &quot;0&quot;</li><li>leaseServerName<span> </span>- DHCP server name</li><li>leaseActMAC<span> </span>- active mac address</li><li>leaseActIP<span> </span>- active IP address</li><li>lease-hostname<span> </span>- client hostname</li><li>lease-options<span> </span>- an array of received options</li></ul></td></tr><tr><td class="confluenceTd"><strong>lease-time</strong><span> </span>(<em>time</em>; Default:<span> <strong>3</strong></span><strong>0m</strong>)</td><td class="confluenceTd">The time that a client may use the assigned address. The client will try to renew this address after half of this time and will request a new address after the time limit expires.</td></tr><tr><td class="confluenceTd"><strong>name</strong><span> </span>(<em>string</em>; Default:<span> </span>)</td><td class="confluenceTd">Reference name</td></tr><tr><td class="confluenceTd"><span style="color:var(--ds-text,#333333);"><strong>parent-queue</strong> (<em>string | none</em>; Default: <strong>none</strong>)</span></td><td class="confluenceTd">A dynamically created queue for this lease will be configured as a child queue of the specified parent queue.</td></tr><tr><td class="confluenceTd"><strong>relay</strong><span> </span>(<em>IP</em>; Default:<span> </span><strong>0.0.0.0</strong>)</td><td class="confluenceTd">The IP address of the relay this DHCP server should process requests from:<ul><li>0.0.0.0<span> </span>- the DHCP server will be used only for direct requests from clients (no DHCP relay allowed)</li><li>255.255.255.255<span> </span>- the DHCP server should be used for any incoming request from a DHCP relay except for those, which are processed by another DHCP server that exists in the<span> </span><code>/ip dhcp-server</code><span> </span>submenu.</li></ul></td></tr><tr><td class="confluenceTd"><span style="color:var(--ds-text,#333333);"><strong>server-address</strong> (<em>IP</em>; Default: <strong>0.0.0.0</strong>)</span></td><td class="confluenceTd"><span style="color:var(--ds-text,#333333);">The IP address of the server to use in the next step of the client's bootstrap process (For example, to assign a specific server address in case several addresses are assigned to the interface)</span></td></tr><tr><td class="confluenceTd"><strong>use-framed-as-classless</strong><span> </span>(<em>yes | no</em>; Default:<span> </span><strong>yes</strong>)</td><td class="confluenceTd">Forward RADIUS Framed-Route as a DHCP Classless-Static-Route to DHCP-client. Whenever both Framed-Route and Classless-Static-Route are received Classless-Static-Route is preferred.</td></tr><tr><td class="confluenceTd"><strong>use-radius</strong><span> </span>(<em>yes | no | accounting</em>; Default:<span> </span><strong>no</strong>)</td><td class="confluenceTd">Whether to use RADIUS server:<ul><li>no<span> </span>- do not use RADIUS;</li><li>yes<span> </span>- use RADIUS for accounting and lease;</li><li>accounting<span> </span>- use RADIUS for accounting only.</li></ul></td></tr></tbody></table></div><h2 id="DHCP-Leases"><span style="color:var(--ds-text,#333333);">Leases</span></h2><p><strong>Sub-menu:</strong> <code>/ip dhcp-server lease</code></p><p>DHCP server lease submenu is used to monitor and manage server leases. The issued leases are shown here as dynamic entries. You can also add static leases to issue a specific IP address to a particular client (identified by MAC address).</p><p>Generally, the DHCP lease is allocated as follows:</p><ul class="bullets"><li>an unused lease is in the &quot;waiting&quot; state</li><li>if a client asks for an IP address, the server chooses one</li><li>if the client receives a statically assigned address, the lease becomes offered, and then bound with the respective lease time</li><li>if the client receives a dynamic address (taken from an IP address pool), the router sends a ping packet and waits for an answer for 0.5 seconds. During this time, the lease is marked testing</li><li>in the case where the address does not respond, the lease becomes offered and then bound with the respective lease time</li><li>in other cases, the lease becomes busy for the lease time (there is a command to retest all busy addresses), and the client's request remains unanswered (the client will try again shortly)</li></ul><p>A client may free the leased address. The dynamic lease is removed, and the allocated address is returned to the address pool. But the static lease becomes busy until the client reacquires the address.</p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p><span style="color:var(--ds-text,#333333);">IP addresses assigned statically are not probed!</span></p></div></div><p><br/></p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="margin-left: 21.0px;width: 98.4977%;"><colgroup><col style="width: 27.3816%;"/><col style="width: 72.619%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>address</strong><span> </span>(<em>IP</em>; Default:<span> <strong>0.0.0.0</strong></span>)</td><td class="confluenceTd">Specify IP address (or ip pool) for static lease. If set to<span> </span><strong>0.0.0.0</strong><span> </span>- a pool from the DHCP server will be used</td></tr><tr><td class="confluenceTd"><strong>address-list</strong><span> </span>(<em>string</em>; Default:<span> <strong>none</strong></span>)</td><td class="confluenceTd">Address list to which address will be added if the lease is bound.</td></tr><tr><td class="confluenceTd"><strong>allow-dual-stack-queue</strong><span> </span>(<em>yes | no</em>; Default:<span> </span><strong>yes</strong>)</td><td class="confluenceTd">Creates a single simple queue entry for both IPv4 and IPv6 addresses, and uses the MAC address and DUID for identification. Requires<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/DHCP#DHCP-DHCPv6Server" rel="nofollow">IPv6 DHCP Server</a><span> </span>to have this option enabled as well to work properly.</td></tr><tr><td class="confluenceTd"><strong>always-broadcast</strong><span> </span>(<em>yes | no</em>; Default: <strong>no</strong>)</td><td class="confluenceTd"><p>Changes whether to force broadcast DHCP replies:</p><ul><li>no - replies are sent based on the client's broadcast flag. If the server sends three consecutive offers, the third and forth offer will be sent as a broadcast;</li><li>yes - replies are always broadcasted even when the client has not specified the broadcast flag.</li></ul></td></tr><tr><td class="confluenceTd"><strong>block-access</strong><span> </span>(<em>yes | no</em>; Default:<span> </span><strong>no</strong>)</td><td class="confluenceTd">Block access for this client</td></tr><tr><td class="confluenceTd"><strong>client-id</strong><span> </span>(<em>string</em>; Default:<span> <strong>none</strong></span>)</td><td class="confluenceTd">If specified, must match the DHCP 'client identifier' option of the request</td></tr><tr><td class="confluenceTd"><strong>dhcp-option</strong><span> </span>(<em>string</em>; Default:<span> <strong>none</strong></span>)</td><td class="confluenceTd">Add additional DHCP options from<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/DHCP#DHCP-DHCPOptions.1" rel="nofollow">option list</a>.</td></tr><tr><td class="confluenceTd"><strong>dhcp-option-set</strong><span> </span>(<em>string</em>; Default:<span> <strong>none</strong></span>)</td><td class="confluenceTd">Add an additional set of DHCP options.</td></tr><tr><td class="confluenceTd"><strong>insert-queue-before</strong><span> </span>(<em>bottom | first | name</em>; Default:<span> <strong>first</strong></span>)</td><td class="confluenceTd">Specify where to place dynamic simple queue entries for static DHCP leases with<span> </span>rate-limit<span> </span>parameter set.</td></tr><tr><td class="confluenceTd"><strong>lease-time</strong><span> </span>(<em>time</em>; Default:<span> </span><strong>0s</strong>)</td><td class="confluenceTd">Time that the client may use the address. If set to<span> </span><strong>0s</strong><span> </span>lease will never expire.</td></tr><tr><td class="confluenceTd"><strong>mac-address</strong><span> </span>(<em>MAC</em>; Default:<span> </span><strong>00:00:00:00:00:00</strong>)</td><td class="confluenceTd">If specified, must match the MAC address of the client</td></tr><tr><td class="confluenceTd"><span style="color:var(--ds-text,#333333);"><strong>parent-queue</strong> (<em>string | none</em>; Default: <strong>none</strong>)</span></td><td class="confluenceTd">A dynamically created queue for this lease will be configured as a child queue of the specified parent queue.</td></tr><tr><td class="confluenceTd"><span style="color:var(--ds-text,#333333);"><strong>queue-type</strong> (<em>default, ethernet-default, multi-queue-ethernet-default, pcq-download-default, synchronous-default, default-small, hotspot-default, only-hardware-queue, pcq-upload-default, wireless-default</em>)</span></td><td class="confluenceTd"><span style="color:var(--ds-text,#333333);">Queue type that can be assigned to the specific lease</span></td></tr><tr><td class="confluenceTd"><span style="color:var(--ds-text-accent-blue-bolder,#09326c);"><strong>rate-limit</strong> (<em>integer[/integer] [integer[/integer] [integer[/integer] [integer[/integer]]]];</em>; Default: )</span></td><td class="confluenceTd">Adds a dynamic simple queue to limit IP's bandwidth to a specified rate. Requires the lease to be static. Format is: rx-rate[/tx-rate] [rx-burst-rate[/tx-burst-rate] [rx-burst-threshold[/tx-burst-threshold] [rx-burst-time[/tx-burst-time]]]]. All rates should be numbers with optional 'k' (1,000s) or 'M' (1,000,000s). If tx-rate is not specified, rx-rate is as tx-rate too. Same goes for tx-burst-rate and tx-burst-threshold and tx-burst-time. If both rx-burst-threshold and tx-burst-threshold are not specified (but burst-rate is specified), rx-rate and tx-rate is used as burst thresholds. If both rx-burst-time and tx-burst-time are not specified, 1s is used as default.</td></tr><tr><td class="confluenceTd"><span style="color:var(--ds-text,#333333);"><em><strong>routes</strong></em> ([dst-address/mask] [gateway] [distance]; Default: <em><strong>none</strong></em>)</span></td><td class="confluenceTd"><p><span style="color:var(--ds-text,#333333);">Routes that appear on the server when the client is connected. It is possible to specify multiple routes separated by commas. This setting will be ignored for OpenVPN.</span></p></td></tr><tr><td class="confluenceTd"><strong>server</strong><span> </span>(<em>string</em>)</td><td class="confluenceTd">Server name which serves this client</td></tr><tr><td class="confluenceTd"><strong>use-src-mac<span> </span>(<em>yes | no</em>; Default:<span> </span>no)</strong></td><td class="confluenceTd">When this option is set server uses the source MAC address instead of the received CHADDR to assign the address.</td></tr></tbody></table></div><h3 id="DHCP-Menuspecificcommands"><span class="mw-headline">Menu specific commands</span></h3><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 77.8319%;"><colgroup><col style="width: 7.68242%;"/><col style="width: 92.3176%;"/></colgroup><tbody><tr><td class="confluenceTd"><strong>check-status</strong><span> </span>(<em>id</em>)</td><td class="confluenceTd">Check the status of a given busy (status is conflict or declined) dynamic lease, and free it in case of no response</td></tr><tr><td class="confluenceTd"><strong>make-static</strong><span> </span>(<em>id</em>)</td><td class="confluenceTd">Convert a dynamic lease to a static one</td></tr></tbody></table></div><h3 id="DHCP-StoreConfiguration"><span class="mw-headline">Store Configuration</span></h3><p><strong>Sub-menu:</strong> <code>/ip dhcp-server config</code></p><p><strong>Store Leases On Disk:</strong> The configuration of how often the DHCP leases will be stored on disk. If they would be saved on a disk on every lease change, a lot of disk writes would happen which is very bad for Compact Flash (especially, if lease times are very short). To minimize writes on disk, all changes are saved on disk every store-leases-disk seconds. Additionally, leases are always stored on disk on graceful shutdown and reboot.</p><p><span style="color:var(--ds-text,#333333);">Manual changes to leases - addition/removal of a static lease, removal of a dynamic lease will cause changes to be pushed for this lease to storage.</span></p><p><strong>Accounting:</strong> The accounting parameter in the DHCP server configuration enables or disables accounting for DHCP leases. When accounting is enabled, the DHCP server logs information about IP address assignments and lease renewals. This information can be useful for tracking and monitoring network usage, analyzing traffic patterns, or generating reports on IP address allocations.</p><p><strong>Interim-update:</strong> The interim-update parameter determines whether the DHCP server sends periodic updates to the accounting server during a lease. These updates provide information about the lease duration, usage, and other relevant details. Enabling interim updates allows for more accurate tracking of lease activity.</p><p><strong>Radius-password:</strong> The radius-password parameter is used to set the password for the RADIUS (Remote Authentication Dial-In User Service) server. RADIUS is a networking protocol commonly used for providing centralized authentication, authorization, and accounting for network access. When configuring the DHCP server to communicate with a RADIUS server for authentication or accounting purposes, you need to specify the correct password to establish a secure connection. This parameter ensures that the DHCP server can authenticate with the RADIUS server using the specified password.</p><h3 id="DHCP-Ratelimiting"><span style="letter-spacing: -0.006em;">Rate limiting</span></h3><p>It is possible to set the bandwidth to a specific IPv4 address by using DHCPv4 leases. This can be done by setting a rate limit on the DHCPv4 lease itself, by doing this a dynamic simple queue rule will be added for the IPv4 address that corresponds to the DHCPv4 lease. By using the<em> rate-limit</em> parameter you can conveniently limit a user's bandwidth.</p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>For any queues to work properly, the traffic must not be FastTracked, make sure your Firewall does not FastTrack traffic that you want to limit.</p></div></div><p><br/>First, make the DHCPv4 lease static, otherwise, it will not be possible to set a rate limit to a DHCPv4 lease:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] &gt; /ip dhcp-server lease print 
Flags: X - disabled, R - radius, D - dynamic, B - blocked 
 #   ADDRESS               MAC-ADDRESS       HOST-NAME               SERVER               RATE-LIMIT               STATUS 
 0 D 192.168.88.254        6C:3B:6B:7C:41:3E MikroTik                DHCPv4_Server                                 bound 

[admin@MikroTik] &gt; /ip dhcp-server lease make-static 0

[admin@MikroTik] &gt; /ip dhcp-server lease print 
Flags: X - disabled, R - radius, D - dynamic, B - blocked 
 #   ADDRESS               MAC-ADDRESS       HOST-NAME               SERVER               RATE-LIMIT               STATUS 
 0   192.168.88.254        6C:3B:6B:7C:41:3E MikroTik                DHCPv4_Server                                 bound</pre>
</div></div><p><br/>Then you can set a rate to a DHCPv4 lease that will create a new dynamic simple queue entry:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] &gt; /ip dhcp-server lease set 0 rate-limit=10M/10M

[admin@MikroTik] &gt; /queue simple print 
Flags: X - disabled, I - invalid, D - dynamic 
 0  D name=&quot;dhcp-ds&lt;6C:3B:6B:7C:41:3E&gt;&quot; target=192.168.88.254/32 parent=none packet-marks=&quot;&quot; priority=8/8 queue=default-small/default-small limit-at=10M/10M max-limit=10M/10M burst-limit=0/0 burst-threshold=0/0 burst-time=0s/0s 
      bucket-size=0.1/0.1</pre>
</div></div><p><br/></p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>By default allow-dual-stack-queue is enabled, this will add a single dynamic simple queue entry for both DHCPv6 binding and DHCPv4 lease, without this option enabled separate dynamic simple queue entries will be added for IPv6 and IPv4.</p></div></div><p>If<em> allow-dual-stack-queue</em> is enabled, then a single dynamic simple queue entry will be created containing both IPv4 and IPv6 addresses:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] &gt; /queue simple print 
Flags: X - disabled, I - invalid, D - dynamic 
 0  D name=&quot;dhcp-ds&lt;6C:3B:6B:7C:41:3E&gt;&quot; target=192.168.88.254/32,fdb4:4de7:a3f8:418c::/66 parent=none packet-marks=&quot;&quot; priority=8/8 queue=default-small/default-small limit-at=10M/10M max-limit=10M/10M burst-limit=0/0 burst-threshold=0/0 
      burst-time=0s/0s bucket-size=0.1/0.1 </pre>
</div></div><h2 id="DHCP-Network">Network</h2><p><strong>Sub-menu:</strong> <code>/ip dhcp-server network</code></p><p><strong><span class="mw-headline">Properties</span></strong></p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="margin-left: 18.0781px;width: 98.4729%;"><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>address</strong><span> </span>(<em>IP/netmask</em>; Default: )</td><td class="confluenceTd">the network DHCP server(s) will lease addresses from</td></tr><tr><td class="confluenceTd"><strong>boot-file-name</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">Boot filename</td></tr><tr><td class="confluenceTd"><strong>caps-manager</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">A comma-separated list of IP addresses for one or more CAPsMAN system managers. DHCP Option 138 (capwap) will be used.</td></tr><tr><td class="confluenceTd"><strong>dhcp-option</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">Add additional DHCP options from<span> the </span>option list.</td></tr><tr><td class="confluenceTd"><strong>dhcp-option-set</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">Add an additional set of DHCP options.</td></tr><tr><td class="confluenceTd"><strong>dns-none</strong><span> </span>(<em>yes | no</em>; Default:<span> </span><strong>no</strong>)</td><td class="confluenceTd"><p>If set, then DHCP Server will not pass DNS servers configured on the router to the DHCP clients.</p></td></tr><tr><td class="confluenceTd"><strong>dns-server</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd"><p>DNS servers that will be passed to DHCP clients. Two comma-separated DNS servers can be specified to be used by the DHCP client as primary and secondary DNS servers</p><p>By default, if there are no DNS servers configured, then the router dynamic DNS Servers from IP&gt;DNS will be passed to DHCP clients, if there are no dynamic DNS server configured, the router static DNS servers from IP&gt;DNS will be passed to DHCP clients.</p></td></tr><tr><td class="confluenceTd"><strong>domain</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">The DHCP client will use this as the 'DNS domain' setting for the network adapter.</td></tr><tr><td class="confluenceTd"><strong>gateway</strong><span> </span>(<em>IP</em>; Default:<span> </span><strong>0.0.0.0</strong>)</td><td class="confluenceTd">The default gateway to be used by<span> </span>DHCP Client.</td></tr><tr><td class="confluenceTd"><strong>netmask</strong><span> </span>(<em>integer: 0..32</em>; Default:<span> </span><strong>0</strong>)</td><td class="confluenceTd">The actual network mask is to be used by the DHCP client. If set to '0' - netmask from network address will be used.</td></tr><tr><td class="confluenceTd"><strong>next-server</strong><span> </span>(<em>IP</em>; Default: )</td><td class="confluenceTd">The IP address of the next server to use in bootstrap.</td></tr><tr><td class="confluenceTd"><strong>ntp-server</strong><span> </span>(<em>IP</em>; Default: )</td><td class="confluenceTd">the DHCP client will use these as the default NTP servers. Two comma-separated NTP servers can be specified to be used by the DHCP client as primary and secondary NTP servers</td></tr><tr><td class="confluenceTd"><strong>wins-server</strong><span> </span>(<em>IP</em>; Default: )</td><td class="confluenceTd">The Windows DHCP client will use these as the default WINS servers. Two comma-separated WINS servers can be specified to be used by the DHCP client as primary and secondary WINS servers</td></tr></tbody></table></div><h2 id="DHCP-RADIUSSupport">RADIUS Support</h2><p><span style="color:var(--ds-text,#333333);">Since RouterOS v6.43 it is possible to use RADIUS to assign a rate limit per lease, to do so you need to pass the<span> </span></span>Mikrotik-Rate-Limit<span style="color:var(--ds-text,#333333);"><span> </span>attribute from your RADIUS Server for your lease. To achieve this you first need to set your DHCPv4 Server to use RADIUS for assigning leases. Below is an example of how to set it up:</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/radius
add address=10.0.0.1 secret=VERYsecret123 service=dhcp
/ip dhcp-server
set dhcp1 use-radius=yes</pre>
</div></div><p><span class="auto-cursor-target" style="color:var(--ds-text,#333333);"><span style="color:var(--ds-text,#333333);">After that, you need to tell your RADIUS Server to pass the<span> </span></span>Mikrotik-Rate-Limit<span style="color:var(--ds-text,#333333);"><span> </span>attribute. In case you are using FreeRADIUS with MySQL, then you need to add appropriate entries into<span> </span></span><strong>radcheck</strong><span style="color:var(--ds-text,#333333);"><span> </span>and<span> </span></span><strong>radreply</strong><span style="color:var(--ds-text,#333333);"><span> </span>tables for a MAC address, that is being used for your DHCPv4 Client. Below is an example for table entries:</span></span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: routeros; gutter: false">INSERT INTO `radcheck` (`username`, `attribute`, `op`, `value`) VALUES
(&#39;00:0C:42:00:D4:64&#39;, &#39;Auth-Type&#39;, &#39;:=&#39;, &#39;Accept&#39;),

INSERT INTO `radreply` (`username`, `attribute`, `op`, `value`) VALUES
(&#39;00:0C:42:00:D4:64&#39;, &#39;Framed-IP-Address&#39;, &#39;=&#39;, &#39;192.168.88.254&#39;),
(&#39;00:0C:42:00:D4:64&#39;, &#39;Mikrotik-Rate-Limit&#39;, &#39;=&#39;, &#39;10M&#39;),</pre>
</div></div><h2 id="DHCP-Alerts"><span class="auto-cursor-target" style="color:var(--ds-text,#333333);"><span class="auto-cursor-target" style="color:var(--ds-text,#333333);">Alerts</span></span></h2><p>To find any rogue DHCP servers as soon as they appear in your network, the DHCP Alert tool can be used. It will monitor the interface for all DHCP replies and check if this reply comes from a valid DHCP server. If a reply from an unknown DHCP server is detected, an alert gets triggered:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] ip dhcp-server alert&gt;/log print
00:34:23 dhcp,critical,error,warning,info,debug dhcp alert on Public:
    discovered unknown dhcp server, mac 00:02:29:60:36:E7, ip 10.5.8.236
[admin@MikroTik] ip dhcp-server alert&gt;</pre>
</div></div><p>When the system alerts about a rogue DHCP server, it can execute a custom script.</p><p>As DHCP replies can be unicast, the rogue DHCP detector may not receive any offer to other DHCP clients at all. To deal with this, the rogue DHCP detector acts as a DHCP client as well - it sends out DHCP discover requests once a minute.</p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>The DHCP alert is not recommended on devices that are configured as DHCP clients. Since the alert itself generates DHCP discovery packets, it can affect the operation of the DHCP client itself. Use this feature only on devices that are DHCP servers or using a static IP address.</p></div></div><p><strong><span class="mw-headline">Sub-menu: </span></strong><span class="mw-headline"><code>/ip dhcp-server alert</code></span></p><p><strong><span class="mw-headline">Properties</span></strong></p><div class="table-wrap"><table class="wrapped confluenceTable" style="margin-left: 16.7969px;"><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>alert-timeout </strong>(none | time; Default: 1h)</td><td class="confluenceTd">Time after which the alert will be forgotten. If after that time the same server is detected, a new alert will be generated. If set to<span> </span><strong>none</strong><span> </span>timeout will never expire.</td></tr><tr><td class="confluenceTd"><strong>interface</strong><span> </span>(<em>string</em>; Default:<span> </span>)</td><td class="confluenceTd">Interface, on which to run rogue DHCP server finder.</td></tr><tr><td class="confluenceTd"><strong>on-alert</strong><span> </span>(<em>string</em>; Default:<span> </span>)</td><td class="confluenceTd">Script to run, when an unknown DHCP server is detected.</td></tr><tr><td class="confluenceTd"><strong>valid-server </strong>(<em>string</em>; Default:<span> </span>)</td><td class="confluenceTd">List of MAC addresses of valid DHCP servers.</td></tr></tbody></table></div><p><strong><span class="mw-headline">Read-only properties</span></strong></p><div class="table-wrap"><table class="wrapped confluenceTable" style="margin-left: 16.7969px;"><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>unknown-server </strong>(<em>string</em>)</td><td class="confluenceTd">List of MAC addresses of detected unknown DHCP servers. The server is removed from this list after alert-timeout</td></tr></tbody></table></div><p><strong><span class="mw-headline">Menu specific commands</span></strong></p><div class="table-wrap"><table class="wrapped confluenceTable" style="margin-left: 16.7969px;"><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>reset-alert </strong>(<em>id</em>)</td><td class="confluenceTd">Clear all alerts on an interface</td></tr></tbody></table></div><h2 id="DHCP-DHCPOptions.1">DHCP Options</h2><p><strong>Sub-menu:</strong> <code>/ip dhcp-server option</code></p><p>With the help of the DHCP Option list, it is possible to define additional custom options for DHCP Server to advertise. Option precedence is as follows:</p><ul><li>radius,</li><li>lease,</li><li>server,</li><li>network.</li></ul><p><span style="color:var(--ds-text,#333333);">This is the order in which the client option request will be filled in.</span></p><p>According to the DHCP protocol, a parameter is returned to the DHCP client only if it requests this parameter, specifying the respective code in the DHCP request Parameter-List (code 55) attribute. If the code is not included in the Parameter-List attribute, the DHCP server will not send it to the DHCP client, but<strong> since RouterOS v7.1rc5 it is possible to force the DHCP option</strong> from the server-side even if the DHCP-client does not request such parameter:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">ip/dhcp-server/option/set force=yes</pre>
</div></div><p><strong><span class="mw-headline">Properties</span></strong></p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="margin-left: 23.1719px;width: 102.071%;"><colgroup><col style="width: 10.899%;"/><col style="width: 89.0612%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>code</strong><span> </span>(<em>integer:1..254</em>; Default:<span> </span>)</td><td class="confluenceTd">dhcp option code. All codes are available at<span> </span><a class="external-link" href="http://www.iana.org/assignments/bootp-dhcp-parameters" rel="nofollow" style="text-decoration: none;">http://www.iana.org/assignments/bootp-dhcp-parameters</a></td></tr><tr><td class="confluenceTd"><strong>name</strong><span> </span>(<em>string</em>; Default:<span> </span>)</td><td class="confluenceTd">Descriptive name of the option</td></tr><tr><td class="confluenceTd"><strong>value</strong><span> </span>(<em>string</em>; Default:<span> </span>)</td><td class="confluenceTd">Parameter's value. Available data types for options are:<ul><li style="list-style-type: none;"><ul><li>'test' -&gt; ASCII to Hex 0x74657374</li><li>'10.10.10.10' -&gt; Unicode IP to Hex 0x0a0a0a0a</li><li>s'10.10.10.10' -&gt; ASCII to hex 0x31302e31302e31302e3130</li><li>s'160' -&gt; ASCII to hex 0x313630</li><li>'10' -&gt; Decimal to Hex 0x0a</li><li>0x0a0a -&gt; No conversion</li><li>$(VARIABLE) -&gt; hardcoded values</li></ul></li></ul><p>RouterOS has predefined variables that can be used:</p><ul><li>HOSTNAME - client hostname</li><li>RADIUS_MT_STR1 - from radius MT attr nr. 24</li><li>RADIUS_MT_STR2 - from radius MT attr nr. 25</li><li>REMOTE_ID - agent remote-id</li><li>NETWORK_GATEWAY - the first gateway from '<em>/ip dhcp-server network</em>', note that this option won't work if used from lease</li></ul><p><br/>Now it is also possible to combine data types into one, for example: &quot;0x01'vards'$(HOSTNAME)&quot;</p><p>For example if HOSTNAME is 'kvm', then raw value will be 0x0176617264736b766d.</p></td></tr><tr><td class="confluenceTd"><strong>raw-value</strong><span> </span>(<em>HEX string</em><span> </span>)</td><td class="confluenceTd">Read-only field which shows raw DHCP option value (the format actually sent out)</td></tr></tbody></table></div><h3 id="DHCP-DHCPOptionSets">DHCP Option Sets</h3><p><strong>Sub-menu:</strong> <code>/ip dhcp-server option sets</code></p><p><span style="color:var(--ds-text,#333333);">This menu allows combining multiple options in option sets, which later can be used to override the default DHCP server option set.</span></p><h3 id="DHCP-Example">Example</h3><p><strong>Classless Route</strong></p><p>A classless route adds a specified route in the clients routing table. In our example, it will add</p><ul><li>dst-address=160.0.0.0/24 gateway=10.1.101.1</li><li>dst-address=0.0.0.0/0 gateway=10.1.101.1</li></ul><p><br/>According to RFC 3442: The first part is the netmask (&quot;18&quot; = netmask /24). Second part is significant part of destination network (&quot;A00000&quot; = 160.0.0). Third part is IP address of gateway (&quot;0A016501&quot; = 10.1.101.1). Then There are parts of the default route, destination netmask (0x00 = 0.0.0.0/0) followed by default route (0x0A016501 = 10.1.101.1)</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip dhcp-server option
add code=121 name=classless value=0x18A000000A016501000A016501
/ip dhcp-server network
set 0 dhcp-option=classless</pre>
</div></div><p>Result:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] /ip route&gt; print
Flags: X - disabled, A - active, D - dynamic, C - connect, S - static, r - rip, b - bgp, o - ospf,
m - mme, B - blackhole, U - unreachable, P - prohibit
 #      DST-ADDRESS        PREF-SRC        GATEWAY            DISTANCE
 0 ADS  0.0.0.0/0                          10.1.101.1         0
 1 ADS  160.0.0.0/24                       10.1.101.1         0</pre>
</div></div><p><br/></p><p><span style="color:var(--ds-text,#333333);">A much more robust way would be to use built-in variables</span><span style="color:var(--ds-text,#333333);">, the previous example can be rewritten as:</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip dhcp-server option 
add name=classless code=121 value=&quot;0x18A00000\$(NETWORK_GATEWAY)0x00\$(NETWORK_GATEWAY)&quot;</pre>
</div></div><p><br/></p><p><strong>Auto proxy config</strong></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip dhcp-server option 
  add code=252 name=auto-proxy-config value=&quot;&#39;https://autoconfig.something.lv/wpad.dat&#39;&quot;</pre>
</div></div><h2 id="DHCP-Optionmatcher">Option matcher</h2><p><span style="color:var(--ds-text,#333333);">The Option matcher allows to identify DHCP clients by any of DHCP options and assign IP address from specific IP pool.</span></p><p>It is possible to perform <code><span style="color:var(--ds-background-accent-green-bolder,#1f845a);">exact</span></code> (provided <em>value </em>should match exactly ) or  <code><span style="color:var(--ds-background-accent-green-bolder,#1f845a);">substring</span></code> matching (will look for <em>value </em>match anywhere in the option string — it can match values at the start, middle, or end).</p><p>Substring matching is useful in cases where value can change depending on the end device, for example, if the class-identifier sent by the device contains not only vendor information, but also exact MAC or other additional information.</p><div role="region" aria-label="Info" class="confluence-information-macro  confluence-information-macro-information" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-info-filled confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>It's possible to define two substring matches for the same option, for example, one that matches &quot;ABC&quot; and another one that matches &quot;ABCDE&quot;, if there is a DHCP option with the value of &quot;ABCDEF&quot;, both entries would match it, but the matcher that will get applied will be selected randomly.</p></div></div><p><br/></p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Clients with a static lease will continue to receive their static address, even when matched by the option matcher.</p></div></div><p><br/></p><h3 id="DHCP-Properties.2"><strong><span class="mw-headline">Properties</span></strong></h3><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 102.071%;"><colgroup class=""><col class="" style="width: 10.8821%;"/><col class="" style="width: 89.1189%;"/></colgroup><tbody class=""><tr class=""><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr class=""><td style="text-align: left;vertical-align: top;" class="confluenceTd"><strong>address-pool</strong><span> </span>(<em>string | static-only</em>; Default:<span> </span><strong>static-only</strong>)</td><td style="text-align: left;vertical-align: top;" class="confluenceTd">IP pool, from which to take IP addresses for the clients. If set to<span> </span><strong>static-only</strong>, then only clients that have a static lease (added in<span><span> </span>the </span>lease<span> </span>submenu) will be allowed.</td></tr><tr><td style="text-align: left;vertical-align: top;" class="confluenceTd"><strong>code</strong><span> </span>(<em>integer:1..254</em>; Default:<span> </span>)</td><td style="text-align: left;vertical-align: top;" class="confluenceTd">DHCP option code. All codes are available at<span> </span><a class="external-link" href="http://www.iana.org/assignments/bootp-dhcp-parameters" rel="nofollow" style="text-decoration: none;">http://www.iana.org/assignments/bootp-dhcp-parameters</a></td></tr><tr><td style="text-align: left;vertical-align: top;" class="confluenceTd"><strong>comment</strong><span> </span>(<em>string</em>; Default: )</td><td style="text-align: left;vertical-align: top;" class="confluenceTd">Short description of option matcher.</td></tr><tr><td style="text-align: left;vertical-align: top;" class="confluenceTd"><strong>disabled</strong><span> </span>(<em>yes | no</em>; Default:<span> </span><strong>no</strong>)</td><td style="text-align: left;vertical-align: top;" class="confluenceTd">Whether an item is disabled</td></tr><tr><td style="text-align: left;vertical-align: top;" class="confluenceTd"><strong>matching-type</strong><span> </span>(<em>exact | substring</em>; Default: )</td><td style="text-align: left;vertical-align: top;" class="confluenceTd"><p>Matching method:</p><ul><li data-uuid="00d2e3fd-f6c1-4ff4-b459-fbe2379c682d"><em>exact </em>- option should match exactly to <em>value;</em></li><li data-uuid="7f92681f-d1d3-4c2f-a4b0-58aaf6f3ba31"><em>substring </em>- <em>value </em>can match anywhere in the option string — at the start, middle, or end.</li></ul></td></tr><tr><td style="text-align: left;vertical-align: top;" class="confluenceTd"><strong>name</strong><span> </span>(<em>string</em>; Default: )</td><td style="text-align: left;vertical-align: top;" class="confluenceTd">Descriptive name for option matcher.</td></tr><tr><td style="text-align: left;vertical-align: top;" class="confluenceTd"><strong>option-set</strong><span> </span>(<em>name | none</em>; Default:<span><span> </span><strong>none</strong></span>)</td><td style="text-align: left;vertical-align: top;" class="confluenceTd">A custom set of DHCP options defined in the Option Sets menu.</td></tr><tr><td style="text-align: left;vertical-align: top;" class="confluenceTd"><strong>server</strong> (<em>string </em>| <em>all</em>; Default: )</td><td style="text-align: left;vertical-align: top;" class="confluenceTd">Server name which serves option matcher.</td></tr><tr><td style="text-align: left;vertical-align: top;" class="confluenceTd"><strong>value</strong><span> </span>(<em>string</em>; Default:<span> </span>)</td><td style="text-align: left;vertical-align: top;" class="confluenceTd"><p>A value that will be searched for in option.</p><p>Available data types for value are:</p><ul><li data-uuid="70c0adc9-6853-47e4-9813-89546f9b83f6">string;</li><li data-uuid="adec7104-f242-49a7-9fbc-4a764203c7b4">HEX.</li></ul></td></tr></tbody></table></div><h3 id="DHCP-Optionmatcherexamples"><span style="color:var(--ds-text,#333333);">Option matcher examples</span></h3><p>Match <em>dhcp1</em> server clients by <em>exact </em>Vendor class identifier (DHCP option 60) and assign address from the <em>pool1</em>:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip dhcp-server matcher
add address-pool=pool1 code=60 matching-type=exact name=test1 server=dhcp1 value=android-dhcp-11</pre>
</div></div><p class="auto-cursor-target">Match clients on all DHCP servers by <em>exact </em>Client Id (DHCP option 61) configured as hex value and assign address from the <em>pool2</em>:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip dhcp-server matcher
add address-pool=pool2 code=61 matching-type=exact name=test2 server=all value=0x016c3b6bed8364</pre>
</div></div><p class="auto-cursor-target">Match <em>dhcp2</em> server clients <em>partially </em>by Hostname (DHCP option 12) and assign address from the <em>pool3</em>:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip dhcp-server matcher
add address-pool=pool3 code=12 matching-type=substring name=test3 server=dhcp2 value=MikroTik</pre>
</div></div><p><br/></p><h2 id="DHCP-ConfigurationExamples.2">Configuration Examples</h2><h3 id="DHCP-Setup">Setup</h3><p>To simply configure DHCP server you can use a<span> </span><code>setup</code><span> </span>command.</p><p>First, you configure an IP address on the interface:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] &gt; /ip address add address=192.168.88.1/24 interface=ether3 disabled=no</pre>
</div></div><p>Then you use<span> </span><code>setup</code><span> a </span>command which will automatically ask necessary parameters:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] &gt; /ip dhcp-server setup 
Select interface to run DHCP server on 

dhcp server interface: ether3
Select network for DHCP addresses 

dhcp address space: 192.168.88.0/24
Select gateway for given network 

gateway for dhcp network: 192.168.88.1
Select pool of ip addresses given out by DHCP server 

addresses to give out: 192.168.88.2-192.168.88.254
Select DNS servers 

dns servers: 10.155.126.1,10.155.0.1,                               
Select lease time 

lease time: 10m</pre>
</div></div><p style="margin-left: 20.0px;"><br/></p><p>That is all. You have configured an active DHCP server.</p><h3 id="DHCP-Manualconfiguration">Manual configuration</h3><p>To configure the DHCP server manually to respond to local requests you have to configure the following:</p><ul><li>An <strong>IP pool</strong> for addresses to be given out, make sure that your gateway/DHCP server address is not part of the pool.</li></ul><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip pool add name=dhcp_pool0 ranges=192.168.88.2-192.168.88.254</pre>
</div></div><ul><li><span style="letter-spacing: 0.0px;">A</span><strong style="letter-spacing: 0.0px;"> network </strong><span style="letter-spacing: 0.0px;">indicating subnets that DHCP-server will lease addresses from, among other information, like a gateway, DNS-server, NTP-server, DHCP options, etc.</span></li></ul><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip dhcp-server network add address=192.168.88.0/24 dns-server=192.168.88.1 gateway=192.168.88.1</pre>
</div></div><ul><li><span style="letter-spacing: 0.0px;">In our case, the device itself is serving as the gateway, so we'll add the </span><strong style="letter-spacing: 0.0px;">address</strong><span style="letter-spacing: 0.0px;"> to the bridge interface:</span></li></ul><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip address add address=192.168.88.1/24 interface=bridge1 network=192.168.88.0</pre>
</div></div><ul><li><span style="letter-spacing: 0.0px;">And finally, add </span><strong style="letter-spacing: 0.0px;">DHCP Server</strong><span style="letter-spacing: 0.0px;">, here we will add the previously created address</span><strong style="letter-spacing: 0.0px;"> pool</strong><span style="letter-spacing: 0.0px;">, and specify on which </span><strong style="letter-spacing: 0.0px;">interface</strong><span style="letter-spacing: 0.0px;"> the DHCP server should work on</span></li></ul><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip dhcp-server add address-pool=dhcp_pool0 disabled=no interface=bridge1 name=dhcp1</pre>
</div></div><h1 id="DHCP-DHCPv6Server"><span style="font-size: 24.0px;letter-spacing: -0.01em;">DHCPv6 Server</span></h1><h2 id="DHCP-Summary.3"><span class="mw-headline">Summary</span></h2><p><strong>Standards:</strong><span> </span><code>RFC 3315, RFC 3633</code></p><p>Single DUID is used for client and server identification, only IAID will vary between clients corresponding to their assigned interface.</p><p>Client binding creates a dynamic pool with a timeout set to binding's expiration time (note that now dynamic pools can have a timeout), which will be updated every time binding gets renewed.</p><p>When a client is bound to a prefix, the DHCP server adds routing information to know how to reach the assigned prefix.</p><h2 id="DHCP-General"><span class="mw-headline">General</span></h2><p><strong>Sub-menu:</strong><span> </span><code>/ipv6 dhcp-server</code></p><p>This sub-menu lists and allows to configure DHCP-PD servers.</p><h2 id="DHCP-DHCPv6ServerProperties">DHCPv6 Server Properties</h2><div class="table-wrap"><table class="wrapped relative-table confluenceTable" style="width: 103.776%;"><colgroup><col style="width: 20.896603%;"/><col style="width: 79.03109%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>address-pool</strong><span> </span>(<em>enum | static-only</em>; Default:<span> </span><strong>static-only</strong>)</td><td class="confluenceTd"><a href="https://help.mikrotik.com/docs/display/ROS/IP+Pools#IPPools-IPv6Pool" rel="nofollow">IPv6 pool</a>, from which to take IPv6 address for the clients, pool prefix-length must be specified as /128.</td></tr><tr><td class="confluenceTd"><strong>prefix-pool<span> </span>(<em>enum | static-only</em>; Default:<span> </span>static-only)</strong></td><td class="confluenceTd"><a href="https://help.mikrotik.com/docs/display/ROS/IP+Pools#IPPools-IPv6Pool" rel="nofollow">IPv6 pool</a>, from which to take IPv6 prefxies for the clients.</td></tr><tr><td class="confluenceTd"><strong><strong style="text-align: left;">allow-dual-stack-queue</strong><span style="color:var(--ds-text,#172b4d);"> </span></strong><span style="color:var(--ds-text,#172b4d);">(</span><em style="text-align: left;">yes | no</em><span style="color:var(--ds-text,#172b4d);">; Default:</span><strong><span style="color:var(--ds-text,#172b4d);"> </span><strong style="text-align: left;">yes</strong></strong><span style="color:var(--ds-text,#172b4d);">)</span></td><td class="confluenceTd"><span style="color:var(--ds-text,#172b4d);">Creates a single simple queue entry for both IPv4 and IPv6 addresses, and uses the MAC address and DUID for identification. Requires</span><span style="color:var(--ds-text,#172b4d);"> </span><span style="color:var(--ds-text,#172b4d);">IPv6 DHCP Server</span><span style="color:var(--ds-text,#172b4d);"> </span><span style="color:var(--ds-text,#172b4d);">to have this option enabled as well to work properly.</span></td></tr><tr><td class="confluenceTd"><strong>address-lists</strong><span> </span>(<em>string</em>; Default:)</td><td class="confluenceTd">Comma seperated list of address-lists. Address or prefix issued by the server will be added to these lists.</td></tr><tr><td class="confluenceTd"><strong>binding-script</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">A script that will be executed after binding is assigned or de-assigned. Internal &quot;global&quot; variables that can be used in the script:<ul><li>bindingBound<span> </span>- set to &quot;1&quot; if bound, otherwise set to &quot;0&quot;</li><li>bindingServerName<span> </span>- dhcp server name</li><li>bindingDUID<span> </span>- DUID</li><li>bindingAddress<span> </span>- active address</li><li>bindingPrefix<span> </span>- active prefix</li></ul></td></tr><tr><td class="confluenceTd"><strong style="text-align: left;">dhcp-option</strong><span style="color:var(--ds-text,#172b4d);"> </span><span style="color:var(--ds-text,#172b4d);">(</span><em style="text-align: left;">string</em><span style="color:var(--ds-text,#172b4d);">; Default:</span><span style="color:var(--ds-text,#172b4d);"><span> </span><strong>none</strong></span><span style="color:var(--ds-text,#172b4d);">)</span></td><td class="confluenceTd"><span style="color:var(--ds-text,#172b4d);">Add additional DHCP options from</span><span style="color:var(--ds-text,#172b4d);"> </span><a href="https://help.mikrotik.com/docs/display/ROS/DHCP#DHCP-DHCPOptions.1" rel="nofollow" style="text-align: left;">option list</a><span style="color:var(--ds-text,#172b4d);">.</span></td></tr><tr><td class="confluenceTd"><strong>insert-queue-before</strong><span> </span>(<em>bottom | first | name</em>; Default:<span> <strong>first</strong></span>)</td><td class="confluenceTd">Specify where to place dynamic simple queue entries for static DHCP leases with<span> a </span>rate-limit<span> </span>parameter set.</td></tr><tr><td class="confluenceTd"><span style="color:var(--ds-text,#333333);"><strong>parent-queue</strong> (<em>string | none</em>; Default: <strong>none</strong>)</span></td><td class="confluenceTd">A dynamically created queue for this lease will be configured as a child queue of the specified parent queue.</td></tr><tr><td class="confluenceTd"><strong>preference</strong><span> </span>(<em>integer [0..255]</em>; Default: 255)</td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text,#333333);">Defines server priority level in client selection when multiple servers respond.</span></td></tr><tr><td class="confluenceTd"><strong>disabled</strong><span> </span>(<em>yes | no</em>; Default:<span> </span><strong>no</strong>)</td><td class="confluenceTd">Whether DHCP-PD server participates in the prefix assignment process.</td></tr><tr><td class="confluenceTd"><strong>interface</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">The interface on which server will be running.</td></tr><tr><td class="confluenceTd"><strong>lease-time</strong><span> </span>(<em>time</em>; Default:<span> </span><strong>3d</strong>)</td><td class="confluenceTd">The time that a client may use the assigned address. The client will try to renew this address after half of this time and will request a new address after the time limit expires.</td></tr><tr><td class="confluenceTd"><p><strong>rapid-commit (</strong>yes | no; Default:<strong> yes)</strong></p></td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text,#333333);">Enables a two-message exchange (Solicit and Reply) for quicker client configuration by skipping the standard four-message process.</span></td></tr><tr><td class="confluenceTd"><p><strong><strong>route-distance<span> </span></strong></strong>(<em>integer [0..255]</em>; Default:1)</p></td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text,#333333);">Specify distance to set for dynamically installed routes towards DHCPv6 clients.</span></td></tr><tr><td class="confluenceTd"><p><strong><strong>use-reconifugre<span> </span></strong></strong>(<em>yes | no</em>; Default: no)</p></td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text,#333333);">Allow the server to send Reconfigure messages to clients, prompting them to renew or update their configuration without waiting for their lease to expire.</span></td></tr><tr><td class="confluenceTd"><strong>name</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">Reference name</td></tr><tr><td class="confluenceTd"><strong>address-list<span> </span></strong>(<em>string</em>; Default:<span> none</span>)</td><td style="text-align: left;vertical-align: top;" class="confluenceTd">Address list to which address will be added if the lease is bound.</td></tr></tbody></table></div><p><strong>Read-only Properties</strong></p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 95.7369%;"><colgroup><col style="width: 22.6562%;"/><col style="width: 77.3438%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>dynamic</strong><span> </span>(<em>yes | no</em>)</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd"><strong>invalid</strong><span> </span>(<em>yes | no</em>)</td><td class="confluenceTd"><br/></td></tr></tbody></table></div><h2 id="DHCP-Bindings"><span class="mw-headline">Bindings</span></h2><p><strong>Sub-menu:</strong><span> </span><code>/ipv6 dhcp-server binding</code></p><p>DUID is used only for dynamic bindings, so if it changes then the client will receive a different prefix than previously.</p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 95.4933%;"><colgroup><col style="width: 22.544%;"/><col style="width: 77.456%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>address</strong><span> </span>(<em>IPv6 prefix</em>; Default: )</td><td class="confluenceTd">IPv6 prefix that will be assigned to the client</td></tr><tr><td class="confluenceTd"><strong>allow-dual-stack-queue</strong><span> </span>(<em>yes | no</em>; Default:<span> </span><strong>yes</strong>)</td><td class="confluenceTd">Creates a single simple queue entry for both IPv4 and IPv6 addresses, uses the MAC address and DUID for identification. Requires<span> </span>IPv4 DHCP Server<span> </span>to have this option enabled as well to work properly.</td></tr><tr><td class="confluenceTd"><strong>comment</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">Short description of an item.</td></tr><tr><td class="confluenceTd"><strong>disabled</strong><span> </span>(<em>yes | no</em>; Default:<span> </span><strong>no</strong>)</td><td class="confluenceTd">Whether an item is disabled</td></tr><tr><td class="confluenceTd"><strong>dhcp-option</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">Add additional DHCP options from<span> the </span>option list.</td></tr><tr><td class="confluenceTd"><strong>dhcp-option-set</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">Add an additional set of DHCP options.</td></tr><tr><td class="confluenceTd"><strong>life-time</strong><span> </span>(<em>time</em>; Default:<span> </span><strong>3d</strong>)</td><td class="confluenceTd">The time period after which binding expires.</td></tr><tr><td class="confluenceTd"><strong>duid</strong><span> </span>(<em>hex string</em>; Default: )</td><td class="confluenceTd">DUID value. Should be specified only in hexadecimal format.</td></tr><tr><td class="confluenceTd"><strong>iaid</strong><span> </span>(<em>integer [0..4294967295]</em>; Default: )</td><td class="confluenceTd">Identity Association Identifier, part of the Client ID.</td></tr><tr><td class="confluenceTd"><strong>prefix-pool</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">Prefix pool that is being advertised to the DHCPv6 Client.</td></tr><tr><td class="confluenceTd"><strong>rate-limit</strong><span> </span>(<em>integer[/integer] [integer[/integer] [integer[/integer] [integer[/integer]]]]</em>; Default: )</td><td class="confluenceTd">Adds a dynamic simple queue to limit IP's bandwidth to a specified rate. Requires the lease to be static. Format is: rx-rate[/tx-rate] [rx-burst-rate[/tx-burst-rate] [rx-burst-threshold[/tx-burst-threshold] [rx-burst-time[/tx-burst-time]]]]. All rates should be numbers with optional 'k' (1,000s) or 'M' (1,000,000s). If tx-rate is not specified, rx-rate is as tx-rate too. Same goes for tx-burst-rate and tx-burst-threshold and tx-burst-time. If both rx-burst-threshold and tx-burst-threshold are not specified (but burst-rate is specified), rx-rate and tx-rate is used as burst thresholds. If both rx-burst-time and tx-burst-time are not specified, 1s is used as default.</td></tr><tr><td class="confluenceTd"><strong>server</strong><span> </span>(<em>string | all</em>; Default:<span> </span><strong>all</strong>)</td><td class="confluenceTd">Name of the server. If set to<span> </span><strong>all</strong>, then binding applies to all created DHCP-PD servers.</td></tr></tbody></table></div><p><strong>Read-only properties</strong></p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 95.6151%;"><colgroup><col style="width: 22.7276%;"/><col style="width: 77.2724%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>dynamic</strong><span> </span>(<em>yes | no</em>)</td><td class="confluenceTd">Whether an item is dynamically created.</td></tr><tr><td class="confluenceTd"><strong>expires-after</strong><span> </span>(<em>time</em>)</td><td class="confluenceTd">The time period after which binding expires.</td></tr><tr><td class="confluenceTd"><strong>last-seen</strong><span> </span>(<em>time</em>)</td><td class="confluenceTd">Time period since the client was last seen.</td></tr><tr><td class="confluenceTd"><strong>status</strong><span> </span>(<em>waiting | offered | bound</em>)</td><td class="confluenceTd">Three status values are possible:<ul><li><strong>waiting</strong><span> </span>- Shown for static bindings if it is not used. For dynamic bindings this status is shown if it was used previously, the server will wait 10 minutes to allow an old client to get this binding, otherwise binding will be cleared and prefix will be offered to other clients.</li><li><strong>offered</strong><span> </span>- if<span> </span><strong>solicit</strong><span> </span>message was received, and the server responded with<span> </span><strong>advertise</strong><span> a </span>message, but<span> the </span><strong>request</strong><span> </span>was not received. During this state client have 2 minutes to get this binding, otherwise, it is freed or changed status to<span> </span><strong>waiting</strong><span> </span>for static bindings.</li><li><strong>bound</strong><span> </span>- currently bound.</li></ul></td></tr></tbody></table></div><p>For example, dynamically assigned /62 prefix</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@RB493G] /ipv6 dhcp-server binding&gt; print detail
 Flags: X - disabled, D - dynamic 
0 D address=2a02:610:7501:ff00::/62 duid=&quot;1605fcb400241d1781f7&quot; iaid=0
 server=local-dhcp life-time=3d status=bound expires-after=2d23h40m10s 
last-seen=19m50s 
1 D address=2a02:610:7501:ff04::/62 duid=&quot;0019d1393535&quot; iaid=2 
server=local-dhcp life-time=3d status=bound expires-after=2d23h43m47s 
last-seen=16m13s</pre>
</div></div><p><strong><span class="mw-headline">Menu specific commands</span></strong></p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 96.5895%;"><colgroup><col style="width: 23.9277%;"/><col style="width: 76.0723%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>make-static</strong><span> </span>()</td><td class="confluenceTd">Set dynamic binding as static.</td></tr></tbody></table></div><h3 id="DHCP-Ratelimiting.1"><span class="mw-headline">Rate limiting</span></h3><p>It is possible to set the bandwidth to a specific IPv6 address by using DHCPv6 bindings. This can be done by setting a rate limit on the DHCPv6 binding itself, by doing this a dynamic simple queue rule will be added for the IPv6 address that corresponds to the DHCPv6 binding. By using the<span> </span><code>rate-limit</code><span> the </span>parameter you can conveniently limit a user's bandwidth.</p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>For any queues to work properly, the traffic must not be FastTracked, make sure your Firewall does not FastTrack traffic that you want to limit.</p></div></div><p class="auto-cursor-target"><span>First, make the DHCPv6 binding static, otherwise, it will not be possible to set a rate limit to a DHCPv6 binding:</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] &gt; /ipv6 dhcp-server binding print 
Flags: X - disabled, D - dynamic 
# ADDRESS DUID SERVER STATUS 
0 D fdb4:4de7:a3f8:418c::/66 0x6c3b6b7c413e DHCPv6_Server bound

[admin@MikroTik] &gt; /ipv6 dhcp-server binding make-static 0

[admin@MikroTik] &gt; /ipv6 dhcp-server binding print
Flags: X - disabled, D - dynamic 
# ADDRESS DUID SERVER STATUS 
0 fdb4:4de7:a3f8:418c::/66 0x6c3b6b7c413e DHCPv6_Server bound 

</pre>
</div></div><p><span>Then you need can set a rate to a DHCPv6 binding that will create a new dynamic simple queue entry:</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] &gt; /ipv6 dhcp-server binding set 0 rate-limit=10M/10 
[admin@MikroTik] &gt; /queue simple print 
Flags: X - disabled, I - invalid, D - dynamic 
0 D name=&quot;dhcp&lt;6c3b6b7c413e fdb4:4de7:a3f8:418c::/66&gt;&quot; target=fdb4:4de7:a3f8:418c::/66 parent=none packet-marks=&quot;&quot; priority=8/8 queue=default
-small/default-small limit-at=10M/10M max-limit=10M/10M burst-limit=0/0 
burst-threshold=0/0 burst-time=0s/0s bucket-size=0.1/0.1</pre>
</div></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>By default <code>allow-dual-stack-queue</code> is enabled, this will add a single dynamic simple queue entry for both DHCPv6 binding and DHCPv4 lease, without this option enabled separate dynamic simple queue entries will be added for IPv6 and IPv4.</p></div></div><p>If<span> </span><code>allow-dual-stack-queue</code><span> </span>is enabled, then a single dynamic simple queue entry will be created containing both IPv4 and IPv6 addresses:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] &gt; /queue simple print 
Flags: X - disabled, I - invalid, D - dynamic
 0 D name=&quot;dhcp-ds&lt;6C:3B:6B:7C:41:3E&gt;&quot; target=192.168.1.200/32,fdb4:4de7:a3f8:418c::/66 parent=none packet-marks=&quot;&quot; priority=8/8 queue=default
-small/default-small limit-at=10M/10M max-limit=10M/10M 
burst-limit=0/0 burst-threshold=0/0 burst-time=0s/0s bucket-size=0.1/0.1</pre>
</div></div><h2 id="DHCP-RADIUSSupport.1"><span class="mw-headline">RADIUS Support</span></h2><p>Since RouterOS v6.43 it is possible to use RADIUS to assign a rate-limit per DHCPv6 binding, to do so you need to pass the<span> </span>Mikrotik-Rate-Limit<span> </span>attribute from your RADIUS Server for your DHCPv6 binding. To achieve this you first need to set your DHCPv6 Server to use RADIUS for assigning bindings. Below is an example of how to set it up:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/radius 
add address=10.0.0.1 secret=VERYsecret123 service=dhcp 
/ipv6 dhcp-server 
set dhcp1 use-radius=yes</pre>
</div></div><p>After that, you need to tell your RADIUS Server to pass the<span> </span>Mikrotik-Rate-Limit<span> </span>attribute. In case you are using FreeRADIUS with MySQL, then you need to add appropriate entries into<span> </span><strong>radcheck</strong><span> </span>and<span> </span><strong>radreply</strong><span> </span>tables for a MAC address, that is being used for your DHCPv6 Client. Below is an example for table entries:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">INSERT INTO `radcheck` (`username`, `attribute`, `op`, `value`) VALUES 
(&#39;000c4200d464&#39;, &#39;Auth-Type&#39;, &#39;:=&#39;, &#39;Accept&#39;),
 INSERT INTO `radreply` (`username`, `attribute`, `op`, `value`) VALUES 
(&#39;000c4200d464&#39;, &#39;Delegated-IPv6-Prefix&#39;, &#39;=&#39;, &#39;fdb4:4de7:a3f8:418c::/66&#39;), 
(&#39;000c4200d464&#39;, &#39;Mikrotik-Rate-Limit&#39;, &#39;=&#39;, &#39;10M&#39;);</pre>
</div></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>By default<span> </span>allow-dual-stack-queue<span> </span>is enabled and will add a single dynamic queue entry if the MAC address from the IPv4 lease (or DUID, if the DHCPv4 Client supports<span> </span><code>Node-specific Client Identifiers</code><span> </span>from RFC4361), but DUID from DHCPv6 Client is not always based on the MAC address from the interface on which the DHCPv6 client is running on, DUID is generated on a per-device basis. For this reason, a single dynamic queue entry might not be created, separate dynamic queue entries might be created instead.</p></div></div><h2 id="DHCP-ConfigurationExample"><span class="mw-headline">Configuration Example</span></h2><h3 id="DHCP-EnablingIPv6Prefixdelegation"><span class="mw-headline">Enabling IPv6 Prefix delegation</span></h3><p>Let's consider that we already have a running DHCP server.</p><p>To enable IPv6 prefix delegation, first, we need to create an address pool:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ipv6 pool add name=myPool prefix=2001:db8:7501::/60 prefix-length=62

</pre>
</div></div><p><span>Notice that prefix-length is 62 bits, which means that clients will receive /62 prefixes from the /60 pool.</span></p><p>The next step is to enable DHCP-PD:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ipv6 dhcp-server add name=myServer prefix-pool=myPool interface=local</pre>
</div></div><p>To test our server we will set up wide-dhcpv6 on an ubuntu machine:</p><ul><li>install wide-dhcpv6-client</li><li>edit &quot;/etc/wide-dhcpv6/dhcp6c.conf&quot; as above</li></ul><div role="region" aria-label="Tip" class="confluence-information-macro  confluence-information-macro-tip" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>You can use also RouterOS as a DHCP-PD client.</p></div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">interface eth2{
send ia-pd 0;
};

id-assoc pd {
prefix-interface eth3{
sla-id 1;
sla-len 2;
};
};</pre>
</div></div><ul><li>Run DHCP-PD client:</li></ul><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">sudo dhcp6c -d -D -f eth2</pre>
</div></div><ul><li>Verify that prefix was added to the:</li></ul><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">mrz@bumba:/media/aaa$ ip -6 addr
 .. 
2: eth3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qlen 1000
 inet6 2001:db8:7501:1:200:ff:fe00:0/64 scope global
 valid_lft forever preferred_lft forever
 inet6 fe80::224:1dff:fe17:81f7/64 scope link
 valid_lft forever preferred_lft forever</pre>
</div></div><ul><li>You can make binding to specific client static so that it always receives the same prefix:</li></ul><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@RB493G] /ipv6 dhcp-server binding&gt; print 
Flags: X - disabled, D - dynamic 
# ADDRESS DU IAID SER.. STATUS 0 D 2001:db8:7501:1::/62 16 0 loc.. bound 
[admin@RB493G] /ipv6 dhcp-server binding&gt; make-static 0</pre>
</div></div><ul><li>DHCP-PD also installs a route to assigned prefix into IPv6 routing table:</li></ul><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@RB493G] /ipv6 route&gt; print
 Flags: X - disabled, A - active, D - dynamic, C - connect, S - static, r - rip, o - ospf, b - bgp, U - unreachable
 # DST-ADDRESS GATEWAY DISTANCE 
... 
2 ADS 2001:db8:7501:1::/62 fe80::224:1dff:fe17:8... 1</pre>
</div></div><h3 id="DHCP-EnablingIPv6Addressdelegation"><span class="mw-headline">Enabling IPv6 Address delegation</span></h3><p><span class="mw-headline">Address delegation on DHCPv6 server side works almost in the exact same way as when you configure prefix server. Only difference is that you must specify in configuration address-pool instead of prefix-pool and the pool used for this server must be defined to use /128 prefix-length. Of course, you can create server which only assigns static addresses and skip using the pool.</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] &gt; ipv6/pool/print detail 
Flags: D - dynamic 
 0   name=&quot;myAddressPool&quot; prefix=2001:db8:7501::/120 prefix-length=128 
[admin@MikroTik] &gt; /ipv6/dhcp-server/print detail                                 
Flags: D - dynamic; X - disabled, I - invalid 
 0    name=&quot;myDHCP&quot; interface=ether2 prefix-pool=static-only 
      address-pool=myAddressPool lease-time=3d rapid-commit=yes use-radius=no 
      preference=255 dhcp-option=&quot;&quot; route-distance=1 use-reconfigure=no 
      address-lists=&quot;&quot; duid=&quot;0x00030001b813f4840556&quot; </pre>
</div></div><p>This configuration is already enough to work with DHCPv6 clients such as, for example, RouterOS client.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] &gt; ipv6/dhcp-client/print detail 
Flags: D - dynamic; X - disabled, I - invalid 
 0    interface=ether2 status=bound duid=&quot;0x00030001b123f48407f0&quot; 
      dhcp-server-v6=fe80::ba69:f4af:fe14:558 request=address 
      add-default-route=no use-peer-dns=yes allow-reconfigure=no 
      dhcp-options=&quot;&quot; pool-name=&quot;&quot; pool-prefix-length=64 prefix-hint=::/0 
      prefix-address-lists=&quot;&quot; dhcp-options=&quot;&quot; 
      address=2001:db8:7501::, 2d23h59m51s</pre>
</div></div><p>However, usually end-devices as computers do not know if their network is managed by DHCP server or not. That is why DHCPv6 server configuration is combined with SLAAC functionality. You can even avoid using SLAAC in order to advertise prefix for local network device, all you need to do is advertise &quot;managed-address-configuration&quot; option to your network devices.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] &gt; ipv6/nd/print detail 
Flags: X - disabled, I - invalid; * - default 
 0    interface=ether2 ra-interval=3m20s-10m ra-delay=3s mtu=unspecified 
      reachable-time=unspecified retransmit-interval=unspecified 
      ra-lifetime=30m ra-preference=medium hop-limit=unspecified 
      advertise-mac-address=yes advertise-dns=yes 
      managed-address-configuration=yes other-configuration=no
[admin@MikroTik] &gt; ipv6/nd/prefix/print detail 
Flags: X - disabled, I - invalid; D - dynamic 
 0    prefix=::/64 6to4-interface=none interface=ether2 on-link=yes 
      autonomous=yes valid-lifetime=4w2d preferred-lifetime=1w </pre>
</div></div><p>Now, for example, your computer which will be connected to router ether2 interface will receive advertisement message from RouterOS ND configuration stating that this network is using &quot;managed-address-configuration&quot; which normally on end user devices will enable DHCPv6 client requesting IPv6 address.</p><p>Full configuration backup from the server with several comments is provided here.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">#Address pool to be used for &#39;bridge&#39;, must have prefix-length 128
/ipv6 pool
add name=myLocalLan prefix=2001:db8::/100 prefix-length=128
#DHCPv6 server with spcified &#39;address&#39; pool
/ipv6 dhcp-server
add address-pool=myLocalLan interface=bridge name=myLocalServer prefix-pool=&quot;&quot;
#We must &#39;advertise&#39; that this is managed network so LAN devices use DHCPv6 clients
#RFC 4861, RFC 4862, RFC 8415 &#39;M - Managed address configuration&#39;
/ipv6 nd
add interface=bridge managed-address-configuration=yes
#We must enable advertising on our &#39;bridge&#39; interface
#We can even add interface without specified prefix, because we here need only
#to advertise &#39;option&#39; that tells this is managed network
/ipv6 nd prefix
add interface=bridge</pre>
</div></div><h1 id="DHCP-DHCPRelay"><span style="font-size: 24.0px;letter-spacing: -0.01em;">DHCP Relay</span></h1><h2 id="DHCP-Summary.4">Summary</h2><p><strong>Sub-menu:</strong><span> </span><code>/ip dhcp-relay</code></p><p><span style="color:var(--ds-text,#333333);">The purpose of the DHCP relay is to act as a proxy between DHCP clients and the DHCP server. It is useful in networks where the DHCP server is not on the same broadcast domain as the DHCP client.</span></p><p><span style="color:var(--ds-text,#333333);">DHCP relay does not choose the particular DHCP server in the DHCP-server list, it just sends the incoming request to all the listed servers.</span></p><h2 id="DHCP-Properties.3"><span class="mw-headline">Properties</span></h2><div class="table-wrap"><table class="wrapped confluenceTable"><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>add-relay-info</strong> (<em>yes | no</em>; Default: <strong>no</strong>)</td><td class="confluenceTd">Adds DHCP relay agent information if enabled according to RFC 3046. Agent Circuit ID Sub-option contains mac address of an interface, Agent Remote ID Sub-option contains MAC address of the client from which request was received.</td></tr><tr><td class="confluenceTd"><strong>delay-threshold</strong> (<em>time | none</em>; Default: <strong>none</strong>)</td><td class="confluenceTd">If secs field in DHCP packet is smaller than delay-threshold, then this packet is ignored</td></tr><tr><td class="confluenceTd"><strong>dhcp-server</strong> (<em>string</em>; Default: )</td><td class="confluenceTd">List of DHCP servers' IP addresses which should the DHCP requests be forwarded to</td></tr><tr><td class="confluenceTd"><strong>interface</strong> (<em>string</em>; Default: )</td><td class="confluenceTd">Interface name the DHCP relay will be working on.</td></tr><tr><td class="confluenceTd"><strong>local-address</strong> (<em>IP</em>; Default: <strong>0.0.0.0</strong>)</td><td class="confluenceTd">The unique IP address of this DHCP relay needed for DHCP server to distinguish relays. If set to <strong>0.0.0.0</strong> - the IP address will be chosen automatically from addresses that are assigned to an interface a relay is running</td></tr><tr><td class="confluenceTd"><strong>relay-info-remote-id</strong> (<em>string</em>; Default: )</td><td class="confluenceTd">specified string will be used to construct Option 82 instead of client's MAC address. Option 82 consist of: interface from which packets was received + client mac address or <strong>relay-info-remote-id</strong></td></tr><tr><td class="confluenceTd"><strong>name</strong> (<em>string</em>; Default: )</td><td class="confluenceTd">Descriptive name for the relay</td></tr><tr><td class="confluenceTd"><p><strong>local-address-as-src-ip(</strong>yes | no; Default:<strong> no)</strong></p></td><td class="confluenceTd"><span style="color:var(--ds-text,#333333);">Use local address as source address for Discover/Request packets sent to the DHCP server</span></td></tr></tbody></table></div><h2 id="DHCP-ConfigurationExample.1"><span style="color:var(--ds-text,#333333);">Configuration Example<br/></span></h2><p>Let us consider that you have several IP networks 'behind' other routers, but you want to keep all DHCP servers on a single router. To do this, you need a DHCP relay on your network which will relay DHCP requests from clients to the DHCP server.</p><p>This example will show you how to configure a DHCP server and a DHCP relay that serves 2 IP networks - 192.168.1.0/24 and 192.168.2.0/24 that are behind a router DHCP-Relay.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" draggable="false" src="attachments/24805500/24805513.png" data-image-src="attachments/24805500/24805513.png" data-unresolved-comment-count="0" data-linked-resource-id="24805513" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="DHCPrelay.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="24805500" data-linked-resource-container-version="76" tabindex="0" alt=""></span></p><p><strong>IP Address Configuration</strong></p><p>IP addresses of DHCP-Server:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@DHCP-Server] ip address&gt; print
Flags: X - disabled, I - invalid, D - dynamic
 #   ADDRESS            NETWORK         BROADCAST       INTERFACE
 0   192.168.0.1/24     192.168.0.0     192.168.0.255   To-DHCP-Relay
 1   10.1.0.2/24	10.1.0.0	10.1.0.255	Public
[admin@DHCP-Server] ip address&gt;</pre>
</div></div><p><span style="letter-spacing: 0.0px;">IP addresses of DHCP-Relay:</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@DHCP-Relay] ip address&gt; print
Flags: X - disabled, I - invalid, D - dynamic
 #   ADDRESS            NETWORK         BROADCAST       INTERFACE
 0   192.168.0.2/24     192.168.0.0     192.168.0.255   To-DHCP-Server
 1   192.168.1.1/24     192.168.1.0     192.168.1.255   Local1
 2   192.168.2.1/24     192.168.2.0     192.168.2.255   Local2
[admin@DHCP-Relay] ip address&gt;</pre>
</div></div><p><br/></p><p><strong>DHCP Server Setup</strong></p><p>To setup 2 DHCP Servers on the DHCP-Server router add 2 pools. For networks 192.168.1.0/24 and 192.168.2.0:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip pool add name=Local1-Pool ranges=192.168.1.11-192.168.1.100
/ip pool add name=Local2-Pool ranges=192.168.2.11-192.168.2.100
[admin@DHCP-Server] ip pool&gt; print
 # NAME                                         RANGES
 0 Local1-Pool                                  192.168.1.11-192.168.1.100
 1 Local2-Pool                                  192.168.2.11-192.168.2.100
[admin@DHCP-Server] ip pool&gt;</pre>
</div></div><p><br/></p><p>Create DHCP Servers:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip dhcp-server add interface=To-DHCP-Relay relay=192.168.1.1 \
   address-pool=Local1-Pool name=DHCP-1 disabled=no
/ip dhcp-server add interface=To-DHCP-Relay relay=192.168.2.1 \
   address-pool=Local2-Pool name=DHCP-2 disabled=no
[admin@DHCP-Server] ip dhcp-server&gt; print
Flags: X - disabled, I - invalid
 #   NAME         INTERFACE     RELAY           ADDRESS-POOL LEASE-TIME ADD-ARP
 0   DHCP-1       To-DHCP-Relay 192.168.1.1     Local1-Pool  3d00:00:00
 1   DHCP-2       To-DHCP-Relay 192.168.2.1     Local2-Pool  3d00:00:00
[admin@DHCP-Server] ip dhcp-server&gt;</pre>
</div></div><p style="margin-left: 20.0px;"><br/></p><p>Configure respective networks:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip dhcp-server network add address=192.168.1.0/24 gateway=192.168.1.1 \
   dns-server=159.148.60.20
/ip dhcp-server network add address=192.168.2.0/24 gateway=192.168.2.1 \
   dns-server 159.148.60.20
[admin@DHCP-Server] ip dhcp-server network&gt; print
 # ADDRESS            GATEWAY         DNS-SERVER      WINS-SERVER     DOMAIN
 0 192.168.1.0/24     192.168.1.1     159.148.60.20
 1 192.168.2.0/24     192.168.2.1     159.148.60.20
[admin@DHCP-Server] ip dhcp-server network&gt;</pre>
</div></div><p style="margin-left: 20.0px;"><br/></p><p><strong>DHCP Relay Config</strong></p><p>Configuration of DHCP-Server is done. Now let's configure DHCP-Relay:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip dhcp-relay add name=Local1-Relay interface=Local1 \
   dhcp-server=192.168.0.1 local-address=192.168.1.1 disabled=no
/ip dhcp-relay add name=Local2-Relay interface=Local2 \
   dhcp-server=192.168.0.1 local-address=192.168.2.1 disabled=no
[admin@DHCP-Relay] ip dhcp-relay&gt; print
Flags: X - disabled, I - invalid
 #   NAME                        INTERFACE      DHCP-SERVER     LOCAL-ADDRESS
 0   Local1-Relay                Local1         192.168.0.1     192.168.1.1
 1   Local2-Relay                Local2         192.168.0.1     192.168.2.1
[admin@DHCP-Relay] ip dhcp-relay&gt;</pre>
</div></div><h2 id="DHCP-DHCPRelaywithVRF(introducedin7.15)">DHCP Relay with VRF (introduced in 7.15)</h2><p class="auto-cursor-target">Let's take the previous setup but we'll consider that the interface to the DHCP server and interfaces to DHCP clients are added in VRF:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip vrf
add interfaces=To-DHCP-Server name=vrf_server
add interfaces=Local2 name=vrf2
add interfaces=Local1 name=vrf1</pre>
</div></div><p class="auto-cursor-target">In the DHCP-relay configuration dhcp-server-vrf should be added:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip dhcp-relay/set dhcp-server-vrf=vrf_server numbers=0,1</pre>
</div></div><p class="auto-cursor-target">Due to VRF configuration there are several routing-tables - we should add additional routes:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip route
add disabled=no distance=1 dst-address=192.168.0.0/24 gateway=To-DHCP-Server@vrf_server pref-src=&quot;&quot; routing-table=vrf1 scope=10 suppress-hw-offload=no \
    target-scope=10
add disabled=no distance=1 dst-address=192.168.0.0/24 gateway=To-DHCP-Server@vrf_server pref-src=&quot;&quot; routing-table=vrf2 scope=10 suppress-hw-offload=no \
    target-scope=10
add disabled=no dst-address=192.168.1.0/24 gateway=Local1@vrf1 routing-table=vrf_server suppress-hw-offload=no
add disabled=no distance=1 dst-address=192.168.2.0/24 gateway=Local2@vrf2 pref-src=&quot;&quot; routing-table=vrf_server scope=30 suppress-hw-offload=no \
    target-scope=10</pre>
</div></div><p class="auto-cursor-target">To achieve successful DHCP-server - DHCP-relay communication we should add NAT rules:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip firewall nat
add action=dst-nat chain=dstnat dst-address=192.168.2.1 dst-port=67 in-interface=To-DHCP-Server protocol=udp src-address=192.168.0.1 to-addresses=\
    192.168.0.2
add action=dst-nat chain=dstnat dst-address=192.168.1.1 dst-port=67 in-interface=To-DHCP-Server protocol=udp src-address=192.168.0.1 to-addresses=\
    192.168.0.2</pre>
</div></div>
                    </div>

                                                            <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/24805500/24805513.png">DHCPrelay.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/24805500/132349999.png">Dhcpv6-pd-example.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/24805500/135856337.jpg">Dhcpv6-pd-example.jpg</a> (image/jpeg)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on May 20, 2025 14:53</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
