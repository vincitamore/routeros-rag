<!DOCTYPE html>
<html>
    <head>
        <title>RouterOS : Layer2 misconfiguration</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">RouterOS</a></span>
                            </li>
                                                    <li>
                                <span><a href="RouterOS_328059.html">RouterOS</a></span>
                            </li>
                                                    <li>
                                <span><a href="Bridging-and-Switching_328068.html">Bridging and Switching</a></span>
                            </li>
                                                    <li>
                                <span><a href="Bridging-and-Switching-Case-Studies_119144611.html">Bridging and Switching Case Studies</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            RouterOS : Layer2 misconfiguration
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> Edgars P.</span>, last updated on Nov 21, 2024
    
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><span class="mw-headline"><style type='text/css'>/*<![CDATA[*/
div.rbtoc1747742025599 {padding: 0px;}
div.rbtoc1747742025599 ul {margin-left: 0px;}
div.rbtoc1747742025599 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1747742025599'>
<ul class='toc-indentation'>
<li><a href='#Layer2misconfiguration-Introduction'>Introduction</a></li>
<li><a href='#Layer2misconfiguration-Bridgesonasingleswitchchip'>Bridges on a single switch chip</a>
<ul class='toc-indentation'>
<li><a href='#Layer2misconfiguration-Configuration'>Configuration</a></li>
<li><a href='#Layer2misconfiguration-Problem'>Problem</a></li>
<li><a href='#Layer2misconfiguration-Symptoms'>Symptoms</a></li>
<li><a href='#Layer2misconfiguration-Solution'>Solution</a></li>
</ul>
</li>
<li><a href='#Layer2misconfiguration-PacketflowwithhardwareoffloadingandMAClearning'>Packet flow with hardware offloading and MAC learning</a>
<ul class='toc-indentation'>
<li><a href='#Layer2misconfiguration-Configuration.1'>Configuration</a></li>
<li><a href='#Layer2misconfiguration-Problem.1'>Problem</a></li>
<li><a href='#Layer2misconfiguration-Symptoms.1'>Symptoms</a></li>
<li><a href='#Layer2misconfiguration-Solution.1'>Solution</a></li>
</ul>
</li>
<li><a href='#Layer2misconfiguration-LAGinterfacesandloadbalancing'>LAG interfaces and load balancing</a>
<ul class='toc-indentation'>
<li><a href='#Layer2misconfiguration-Configuration.2'>Configuration</a></li>
<li><a href='#Layer2misconfiguration-Problem.2'>Problem</a></li>
<li><a href='#Layer2misconfiguration-Symptoms.2'>Symptoms</a></li>
<li><a href='#Layer2misconfiguration-Solution.2'>Solution</a></li>
</ul>
</li>
<li><a href='#Layer2misconfiguration-VLANinterfaceonaslaveinterface'>VLAN interface on a slave interface</a>
<ul class='toc-indentation'>
<li><a href='#Layer2misconfiguration-Configuration.3'>Configuration</a></li>
<li><a href='#Layer2misconfiguration-Problem.3'>Problem</a></li>
<li><a href='#Layer2misconfiguration-Symptoms.3'>Symptoms</a></li>
<li><a href='#Layer2misconfiguration-Solution.3'>Solution</a></li>
</ul>
</li>
<li><a href='#Layer2misconfiguration-VLANonabridgeinabridge'>VLAN on a bridge in a bridge</a>
<ul class='toc-indentation'>
<li><a href='#Layer2misconfiguration-Configuration.4'>Configuration</a></li>
<li><a href='#Layer2misconfiguration-Problem.4'>Problem</a></li>
<li><a href='#Layer2misconfiguration-Symptoms.4'>Symptoms</a></li>
<li><a href='#Layer2misconfiguration-Solution.4'>Solution</a></li>
</ul>
</li>
<li><a href='#Layer2misconfiguration-VLANinabridgewithaphysicalinterface'>VLAN in a bridge with a physical interface</a>
<ul class='toc-indentation'>
<li><a href='#Layer2misconfiguration-Configuration.5'>Configuration</a></li>
<li><a href='#Layer2misconfiguration-Problem.5'>Problem</a></li>
<li><a href='#Layer2misconfiguration-Symptoms.5'>Symptoms</a></li>
<li><a href='#Layer2misconfiguration-Solution.5'>Solution</a></li>
</ul>
</li>
<li><a href='#Layer2misconfiguration-BridgedVLANonphysicalinterfaces'>Bridged VLAN on physical interfaces</a>
<ul class='toc-indentation'>
<li><a href='#Layer2misconfiguration-Configuration.6'>Configuration</a></li>
<li><a href='#Layer2misconfiguration-Problem.6'>Problem</a></li>
<li><a href='#Layer2misconfiguration-Symptoms.6'>Symptoms</a></li>
<li><a href='#Layer2misconfiguration-Solution.6'>Solution</a></li>
</ul>
</li>
<li><a href='#Layer2misconfiguration-BridgedVLAN'>Bridged VLAN</a>
<ul class='toc-indentation'>
<li><a href='#Layer2misconfiguration-Configuration.7'>Configuration</a></li>
<li><a href='#Layer2misconfiguration-Symptoms.7'>Symptoms</a></li>
<li><a href='#Layer2misconfiguration-Solution.7'>Solution</a></li>
</ul>
</li>
<li><a href='#Layer2misconfiguration-BridgeVLANfilteringonnon-CRS3xx'>Bridge VLAN filtering on non-CRS3xx</a>
<ul class='toc-indentation'>
<li><a href='#Layer2misconfiguration-Configuration.8'>Configuration</a></li>
<li><a href='#Layer2misconfiguration-Problem.7'>Problem</a></li>
<li><a href='#Layer2misconfiguration-Symptoms.8'>Symptoms</a></li>
<li><a href='#Layer2misconfiguration-Solution.8'>Solution</a></li>
</ul>
</li>
<li><a href='#Layer2misconfiguration-VLANfilteringwithmultipleswitchchips'>VLAN filtering with multiple switch chips</a>
<ul class='toc-indentation'>
<li><a href='#Layer2misconfiguration-Configuration.9'>Configuration</a></li>
<li><a href='#Layer2misconfiguration-Problem.8'>Problem</a></li>
<li><a href='#Layer2misconfiguration-Symptoms.9'>Symptoms</a></li>
<li><a href='#Layer2misconfiguration-Solution.9'>Solution</a></li>
</ul>
</li>
<li><a href='#Layer2misconfiguration-VLANfilteringwithsimplifiedbridgeVLANtable'>VLAN filtering with simplified bridge VLAN table</a>
<ul class='toc-indentation'>
<li><a href='#Layer2misconfiguration-Configuration.10'>Configuration</a></li>
<li><a href='#Layer2misconfiguration-Problem.9'>Problem</a></li>
<li><a href='#Layer2misconfiguration-Symptoms.10'>Symptoms</a></li>
<li><a href='#Layer2misconfiguration-Solution.10'>Solution</a></li>
</ul>
</li>
<li><a href='#Layer2misconfiguration-MTUonthemasterinterface'>MTU on the master interface</a>
<ul class='toc-indentation'>
<li><a href='#Layer2misconfiguration-Configuration.11'>Configuration</a></li>
<li><a href='#Layer2misconfiguration-Problem.10'>Problem</a></li>
<li><a href='#Layer2misconfiguration-Symptoms.11'>Symptoms</a></li>
<li><a href='#Layer2misconfiguration-Solution.11'>Solution</a></li>
</ul>
</li>
<li><a href='#Layer2misconfiguration-MTUinconsistency'>MTU inconsistency</a>
<ul class='toc-indentation'>
<li><a href='#Layer2misconfiguration-Configuration.12'>Configuration</a></li>
<li><a href='#Layer2misconfiguration-Problem.11'>Problem</a></li>
<li><a href='#Layer2misconfiguration-Symptoms.12'>Symptoms</a></li>
<li><a href='#Layer2misconfiguration-Solution.12'>Solution</a></li>
</ul>
</li>
<li><a href='#Layer2misconfiguration-BridgeandreservedMACaddresses'>Bridge and reserved MAC addresses</a>
<ul class='toc-indentation'>
<li><a href='#Layer2misconfiguration-Configuration.13'>Configuration</a></li>
<li><a href='#Layer2misconfiguration-Problem.12'>Problem</a></li>
<li><a href='#Layer2misconfiguration-Symptoms.13'>Symptoms</a></li>
<li><a href='#Layer2misconfiguration-Solution.13'>Solution</a></li>
</ul>
</li>
<li><a href='#Layer2misconfiguration-BondingbetweenWirelesslinks'>Bonding between Wireless links</a>
<ul class='toc-indentation'>
<li><a href='#Layer2misconfiguration-Configuration.14'>Configuration</a></li>
<li><a href='#Layer2misconfiguration-Problem.13'>Problem</a></li>
<li><a href='#Layer2misconfiguration-Symptoms.14'>Symptoms</a></li>
<li><a href='#Layer2misconfiguration-Solution.14'>Solution</a></li>
</ul>
</li>
<li><a href='#Layer2misconfiguration-Bandwidthtesting'>Bandwidth testing</a>
<ul class='toc-indentation'>
<li><a href='#Layer2misconfiguration-Problem.14'>Problem</a></li>
<li><a href='#Layer2misconfiguration-Symptoms.15'>Symptoms</a></li>
<li><a href='#Layer2misconfiguration-Solution.15'>Solution</a></li>
</ul>
</li>
<li><a href='#Layer2misconfiguration-Bridgesplit-horizonusage'>Bridge split-horizon usage</a>
<ul class='toc-indentation'>
<li><a href='#Layer2misconfiguration-Configuration.15'>Configuration</a></li>
<li><a href='#Layer2misconfiguration-Problem.15'>Problem</a></li>
<li><a href='#Layer2misconfiguration-Symptoms.16'>Symptoms</a></li>
<li><a href='#Layer2misconfiguration-Solution.16'>Solution</a></li>
</ul>
</li>
<li><a href='#Layer2misconfiguration-UnsupportedSFPmodules'>Unsupported SFP modules</a>
<ul class='toc-indentation'>
<li><a href='#Layer2misconfiguration-Problem.16'>Problem</a></li>
<li><a href='#Layer2misconfiguration-Symptoms.17'>Symptoms</a></li>
<li><a href='#Layer2misconfiguration-Solution.17'>Solution</a></li>
</ul>
</li>
</ul>
</div></span></p><h1 id="Layer2misconfiguration-Introduction"><span class="mw-headline">Introduction</span></h1><hr/><p>There are certain configurations that are known to have major flaws by design and should be avoided by all means possible. Misconfigured Layer2 can sometimes cause hard to detect network errors, random performance drops, certain segments of a network to be unreachable, certain networking services to be malfunctioning, or a complete network failure. This page will contain some common and not so very common configurations that will cause issues in your network.</p><h1 id="Layer2misconfiguration-Bridgesonasingleswitchchip"><span class="mw-headline">Bridges on a single switch chip</span></h1><hr/><p>Consider the following scenario, you have a device with a built-in switch chip and you need to isolate certain ports from each other, for this reason, you have created multiple bridges and enabled hardware offloading on them. Since each bridge is located on a different Layer2 domain, then Layer2 frames will not be forwarded between these bridges, as a result, ports in each bridge are isolated from other ports on a different bridge.</p><h2 id="Layer2misconfiguration-Configuration"><span class="mw-headline">Configuration</span></h2><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge
add name=bridge1
add name=bridge2
/interface bridge port
add bridge=bridge1 interface=ether1
add bridge=bridge1 interface=ether2
add bridge=bridge2 interface=ether3
add bridge=bridge2 interface=ether4</pre>
</div></div><h2 id="Layer2misconfiguration-Problem"><span style="font-size: 20.0px;letter-spacing: -0.008em;">Problem</span></h2><p>After a simple performance test, you might notice that one bridge is capable of forwarding traffic at wire speed while the second, third, etc. bridge is not able to forward as much data as the first bridge. Another symptom might be that there exists a huge latency for packets that need to be routed. After a quick inspection, you might notice that the CPU is always at full load, this is because hardware offloading is not available on all bridges, but is available only on one bridge. By checking the hardware offloading status you will notice that only one bridge has it active:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] &gt; /interface bridge port print
Flags: X - disabled, I - inactive, D - dynamic, H - hw-offload 
 #     INTERFACE                                 BRIDGE                                 HW
 0   H ether1                                    bridge1                                yes
 1   H ether2                                    bridge1                                yes
 2     ether3                                    bridge2                                yes
 3     ether4                                    bridge2                                yes</pre>
</div></div><p>The reason why only one bridge has the hardware offloading flag available is that the device does not support port isolation. If port isolation is not supported, then only one bridge will be able to offload the traffic to the switch chip.</p><h2 id="Layer2misconfiguration-Symptoms"><span class="mw-headline">Symptoms</span></h2><p>Below is a list of possible symptoms that might be a result of this kind of misconfiguration:</p><ul><li>Missing &quot;H&quot; flag to bridge ports</li><li>Low throughput</li><li>High CPU usage</li></ul><h2 id="Layer2misconfiguration-Solution"><span class="mw-headline">Solution</span></h2><p>Not all device devices support port isolation, currently only CRS1xx/CRS2xx series devices support it and only 7 isolated and hardware offloaded bridges are supported at the same time, other devices will have to use the CPU to forward the packets on other bridges. This is usually a hardware limitation and a different device might be required. Bridge <span style="color:var(--ds-icon-success,#22A06B);">split-horizon</span> parameter is a software feature that disables hardware offloading and when using bridge filter rules you need to enable forward all packets to the CPU, which requires the hardware offloading to be disabled. You can control which bridge will be hardware offloaded with the<span> </span><span style="color:var(--ds-icon-success,#22A06B);"><code>hw=yes</code></span><span> </span>flag and by setting<span> </span><span style="color:var(--ds-icon-success,#22A06B);"><code>hw=no</code></span><span> </span>to other bridges, for example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge port set [find where bridge=bridge1] hw=no
/interface bridge port set [find where bridge=bridge2] hw=yes</pre>
</div></div><p>Sometimes it is possible to restructure a network topology to use VLANs, which is the proper way to isolate Layer2 networks.</p><h1 id="Layer2misconfiguration-PacketflowwithhardwareoffloadingandMAClearning"><span class="mw-headline">Packet flow with hardware offloading and MAC learning</span></h1><hr/><p>Consider the following scenario, you set up a bridge and have enabled hardware offloading in order to maximize the throughput for your device, as a result, your device is working as a switch, but you want to use<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/Packet+Sniffer" rel="nofollow">Sniffer</a><span> </span>or<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/Torch" rel="nofollow">Torch</a><span> </span>tools for debugging purposes, or maybe you want to implement packet logging.</p><h2 id="Layer2misconfiguration-Configuration.1"><span class="mw-headline">Configuration</span></h2><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge
add name=bridge1
/interface bridge port
add bridge=bridge1 hw=yes interface=ether1 learn=yes
add bridge=bridge1 hw=yes interface=ether2 learn=yes</pre>
</div></div><h2 id="Layer2misconfiguration-Problem.1"><span class="mw-headline">Problem</span></h2><p>When running<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/Packet+Sniffer" rel="nofollow">Sniffer</a><span> </span>or<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/Torch" rel="nofollow">Torch</a><span> </span>tools to capture packets you might notice that barely any packets are visible, only some unicast packets, but mostly broadcast/multicast packets are captured, while the interfaces report that much larger traffic is flowing through certain interfaces than the traffic that was captured. If you add two or more Ethernet interfaces to a bridge and enable<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/Bridging+and+Switching#BridgingandSwitching-BridgeHardwareOffloading" rel="nofollow">Hardware Offloading</a>, then the switch chip will be used to forward packets between ports. To understand why only some packets are captured, we must first examine how the switch chip is interconnected with the CPU, in this example, we can use a block diagram from a generic 5-Port Ethernet router:</p><p style="text-align: left;"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/19136718/19136719.png" data-image-src="attachments/19136718/19136719.png" data-unresolved-comment-count="0" data-linked-resource-id="19136719" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="Switch_chip_block_diagram.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="19136718" data-linked-resource-container-version="27" tabindex="0" alt=""></span></p><p style="text-align: left;">For this device, each Ethernet port is connected to the switch chip and the switch chip is connected to the CPU using the CPU port (sometimes called the<span> </span><strong>switch-cpu</strong><span> </span>port). For packets to be visible in<span> </span>Sniffer or Torch<span> </span>tools, the packet must be sent from an Ethernet port to the CPU port, this means that the packet must be destined to the CPU port (destination MAC address of the packet matches the bridge's MAC address) or the packet's MAC address has not be learnt (packet is flooded to all ports), this behavior is because of<span> </span><strong>MAC learning</strong>·</p><p style="text-align: left;">The switch chip keeps a list of MAC addresses and ports called the<span> </span><strong>Host table</strong>· Whenever a packet needs to be forwarded, the switch chip checks the packet's destination MAC address against the hosts table to find which port should it use to forward the packet. If the switch chip cannot find the destination MAC address, then the packet is flooded to all ports (including the CPU port). In situations where a packet is supposed to be forwarded from, for example, ether1 to ether2 and the MAC address for the device behind ether2 is in the host table, then the packet is never sent to the CPU and therefore will not be visible to<span> </span>Sniffer<span> </span>or<span> </span>Torch<span> </span>tool.</p><h2 style="text-align: left;" id="Layer2misconfiguration-Symptoms.1"><span class="mw-headline">Symptoms</span></h2><p style="text-align: left;">Below is a list of possible symptoms that might be a result of this kind of misconfiguration:</p><ul style="text-align: left;"><li>Packets not visible by<span> </span>Sniffer<span> </span>or<span> </span>Torch<span> </span>tool</li><li>Filter rules not working</li></ul><h2 style="text-align: left;" id="Layer2misconfiguration-Solution.1"><span class="mw-headline">Solution</span></h2><p style="text-align: left;">Packets with a destination MAC address that has been learned will not be sent to the CPU since the packets are not being flooded to all ports. If you do need to send certain packets to the CPU for a packet analyzer or a firewall, then it is possible to copy or redirect the packet to the CPU by using ACL rules. Below is an example of how to send a copy of packets that are meant for<span> </span><strong>4C:5E:0C:4D:12:4B</strong>:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface ethernet switch rule
add copy-to-cpu=yes dst-mac-address=4C:5E:0C:4D:12:4B/FF:FF:FF:FF:FF:FF ports=ether1 switch=switch1</pre>
</div></div><p><br/></p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>If the packet is sent to the CPU, then the packet must be processed by the CPU, this increases the CPU load.</p></div></div><h1 style="text-align: left;" id="Layer2misconfiguration-LAGinterfacesandloadbalancing"><span style="font-size: 24.0px;letter-spacing: -0.01em;">LAG interfaces and load balancing</span></h1><hr/><p style="text-align: left;">Consider the following scenario, you have created a LAG interface to increase total bandwidth between 2 network nodes, usually, these are switches. For testing purposes to make sure that the LAG interface is working properly you have attached two servers that transfer data, most commonly the well-known network performance measurement tool<span> </span><a class="external-link" href="https://en.wikipedia.org/wiki/Iperf" rel="nofollow" style="text-decoration: none;">https://en.wikipedia.org/wiki/Iperf</a><span> </span>is used to test such setups. For example, you might have made a LAG interface out of two Gigabit Ethernet ports, which gives you a<span style="color:var(--ds-text,#333333);"> virtual interface that can load balance traffic over both interfaces and theoretically reach 2Gbps throughput,</span> while the servers are connected using a 10Gbps interface, for example, SFP+.</p><p style="text-align: left;"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/19136718/19136722.png" data-image-src="attachments/19136718/19136722.png" data-unresolved-comment-count="0" data-linked-resource-id="19136722" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="Lacp.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="19136718" data-linked-resource-container-version="27" tabindex="0" alt=""></span></p><h2 style="text-align: left;" id="Layer2misconfiguration-Configuration.2"><span class="mw-headline">Configuration</span></h2><p style="text-align: left;">The following configuration is relevant to<span> </span><strong>SW1</strong><span> </span>and<span> </span><strong>SW2</strong>:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bonding
add mode=802.3ad name=bond1 slaves=ether1,ether2
/interface bridge
add name=bridge1
/interface bridge port
add bridge=bridge1 interface=bond1
add bridge=bridge1 interface=sfp-sfpplus1</pre>
</div></div><h2 style="text-align: left;" id="Layer2misconfiguration-Problem.2"><span class="mw-headline">Problem</span></h2><p style="text-align: left;">After initial tests, you immediately notice that your network throughput never exceeds the 1Gbps limit even though the CPU load on the servers is low as well as on the network nodes (switches in this case), but the throughput is still limited to only 1Gbps. The reason behind this is because LACP (802.ad) uses transmit hash policy in order to determine if traffic can be balanced over multiple LAG members, in this case, a LAG interface does not create a 2Gbps interface, but rather an interface that can balance traffic over multiple slave interface whenever it is possible. For each packet a transmit hash is generated, this determines through which LAG member will the packet be sent, this is needed in order to avoid packets being out of order, there is an option to select the transmit hash policy, usually, there is an option to choose between Layer2 (MAC), Layer3 (IP) and Layer4 (Port), in RouterOS, this can be selected by using the<span> </span><span style="color:var(--ds-icon-success,#22A06B);"><code>transmit-hash-policy</code></span><span> </span>parameter. In this case, the transmit hash is the same since you are sending packets to the same destination MAC address, as well as the same IP address and Iperf uses the same port as well, this generates the same transmit hash for all packets and load balancing between LAG members is not possible. Note that not always packets will get balanced over LAG members even though the destination is different, this is because the standardized transmit hash policy can generate the same transmit hash for different destinations, for example, 192.168.0.1/192.168.0.2 will get balanced, but 192.168.0.2/192.168.0.4 will<span> </span><strong>NOT</strong><span> </span>get balanced in case<span> </span><span style="color:var(--ds-icon-success,#22A06B);"><code>layer2-and-3</code></span><span> </span>transmit hash policy is used and the destination MAC address is the same.</p><h2 style="text-align: left;" id="Layer2misconfiguration-Symptoms.2"><span class="mw-headline">Symptoms</span></h2><p style="text-align: left;">Below is a list of possible symptoms that might be a result of this kind of misconfiguration:</p><ul style="text-align: left;"><li>Traffic going through only one LAG member</li></ul><h2 style="text-align: left;" id="Layer2misconfiguration-Solution.2"><span class="mw-headline">Solution</span></h2><p style="text-align: left;">Choose the proper transmit hash policy and test your network's throughput properly. The simplest way to test such setups is to use multiple destinations, for example, instead of sending data to just one server, rather send data to multiple servers, this will generate a different transmit hash for each packet and will make load balancing across LAG members possible. For some setups, you might want to change the bonding interface mode to increase the total throughput, for UDP traffic<span> </span><code>balance-rr</code><span> </span>mode might be sufficient, but can cause issues for TCP traffic, you can read more about selecting the right mode for your setup<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/Bonding#Bonding-Bondingmodes" rel="nofollow">here</a>.</p><h1 style="text-align: left;" id="Layer2misconfiguration-VLANinterfaceonaslaveinterface"><span class="mw-headline">VLAN interface on a slave interface</span></h1><hr/><p style="text-align: left;">Consider the following scenario, you have created a bridge and you want a DHCP Server to give out IP addresses only to a certain tagged VLAN traffic, for this reason, you have created a VLAN interface, specified a VLAN ID and created a DHCP Server on it, but for some reason, it is not working properly.</p><h2 style="text-align: left;" id="Layer2misconfiguration-Configuration.3"><span class="mw-headline">Configuration</span></h2><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge
add name=bridge1
/interface bridge port
add interface=ether1 bridge=bridge1
add interface=ether2 bridge=bridge1
/interface vlan
add name=VLAN99 interface=ether1 vlan-id=99
/ip pool
add name=VLAN99_POOL range=192.168.99.100-192.168.99.200
/ip address add address=192.168.99.1/24 interface=VLAN99
/ip dhcp-server
add interface=VLAN99 address-pool=VLAN99_POOL disabled=no
/ip dhcp-server network
add address=192.168.99.0/24 gateway=192.168.99.1 dns-server=192.168.99.1</pre>
</div></div><h2 style="text-align: left;" id="Layer2misconfiguration-Problem.3"><span class="mw-headline">Problem</span></h2><p style="text-align: left;">When you add an interface to a bridge, the bridge becomes the master interface and all bridge ports become slave ports, this means that all traffic that is received on a bridge port is captured by the bridge interface and all traffic is forwarded to the CPU using the bridge interface instead of the physical interface. As a result VLAN interface that is created on a slave interface will never capture any traffic at all since it is immediately forwarded to the master interface before any packet processing is being done. The usual side effect is that some DHCP clients receive IP addresses and some don't.</p><h2 style="text-align: left;" id="Layer2misconfiguration-Symptoms.3"><span class="mw-headline">Symptoms</span></h2><p style="text-align: left;">Below is a list of possible symptoms that might be a result of this kind of misconfiguration:</p><ul style="text-align: left;"><li>DHCP Client/Server not working properly;</li><li>Device is unreachable;</li><li>The device behind a bridge is unreachable with tagged traffic;</li></ul><h2 style="text-align: left;" id="Layer2misconfiguration-Solution.3"><span class="mw-headline">Solution</span></h2><p style="text-align: left;">Change the interface on which the VLAN interface will be listening for traffic, change it to the master interface:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface vlan set VLAN99 interface=bridge1</pre>
</div></div><h1 style="text-align: left;" id="Layer2misconfiguration-VLANonabridgeinabridge"><span class="mw-headline">VLAN on a bridge in a bridge</span></h1><hr/><p style="text-align: left;">Consider the following scenario, you have a set of interfaces (don't have to be physical interfaces) and you want all of them to be in the same Layer2 segment, the solution is to add them to a single bridge, but you require that traffic from one port tags all traffic into a certain VLAN. This can be done by creating a VLAN interface on top of the bridge interface and by creating a separate bridge that contains this newly created VLAN interface and an interface, which is supposed to add a VLAN tag to all received traffic. A network diagram can be found below:</p><p style="text-align: left;"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/19136718/19136759.png" data-image-src="attachments/19136718/19136759.png" data-unresolved-comment-count="0" data-linked-resource-id="19136759" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="Vlan_on_bridge_in_bridge.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="19136718" data-linked-resource-container-version="27" tabindex="0" alt=""></span></p><h2 style="text-align: left;" id="Layer2misconfiguration-Configuration.4"><span class="mw-headline">Configuration</span></h2><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge
add name=bridge1
add name=bridge2
/interface vlan
add interface=bridge1 name=VLAN vlan-id=99
/interface bridge port
add bridge=bridge1 interface=ether1
add bridge=bridge1 interface=ether2
add bridge=bridge2 interface=VLAN
add bridge=bridge2 interface=ether3</pre>
</div></div><h2 id="Layer2misconfiguration-Problem.4"><span style="font-size: 20.0px;letter-spacing: -0.008em;">Problem</span></h2><p style="text-align: left;">To better understand the underlying problems, let's first look at the bridge host table.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@switch] /interface bridge host print where !local 
Flags: X - disabled, I - invalid, D - dynamic, L - local, E - external 
 #       MAC-ADDRESS        VID ON-INTERFACE    BRIDGE
 0   D   CC:2D:E0:E4:B3:A1      ether1          bridge1
 1   D   CC:2D:E0:E4:B3:A2      ether2          bridge1
 2   D   CC:2D:E0:E4:B3:A1      VLAN            bridge2
 3   D   CC:2D:E0:E4:B3:A2      VLAN            bridge2
 4   D   CC:2D:E0:E4:B3:A3      ether3          bridge2</pre>
</div></div><p style="text-align: left;">Devices on<span> </span><strong>ether1</strong><span> </span>and<span> </span><strong>ether2</strong><span> </span>need to send tagged packets with VLAN-ID 99 in order to reach the host on<span> </span><strong>ether3</strong><span> </span>(other packets do not get passed towards VLAN interface and further bridged with ether3). We can see in the host table that<span> </span><strong>bridge2</strong><span> </span>has learned these hosts. Packets coming from<span> </span><strong>ether3</strong><span> </span>to<span> </span><strong>ether1</strong><span> </span>will be correctly sent out tagged and traffic will not be flooded in<span> </span><strong>bridge1</strong>. But since MAC learning is only possible between bridge ports and not on interfaces that are created on top of the bridge interface, packets sent from<span> </span><strong>ether2</strong><span> </span>to<span> </span><strong>ether3</strong><span> </span>will be flooded in<span> </span><strong>bridge1</strong>.</p><p style="text-align: left;">Also if a device behind<span> </span><strong>ether3</strong><span> </span>is using (R)STP, then<span> </span><strong>ether1</strong><span> </span>and<span> </span><strong>ether2</strong><span> </span>will send out tagged BPDUs which violates the IEEE 802.1W standard. Because of the broken MAC learning functionality and broken (R)STP this setup and configuration must be avoided. It is also known that in some setups this kind of configuration can prevent you from connecting to the device by using MAC telnet.</p><h2 style="text-align: left;" id="Layer2misconfiguration-Symptoms.4"><span class="mw-headline">Symptoms</span></h2><p style="text-align: left;">Below is a list of possible symptoms that might be a result of this kind of misconfiguration:</p><ul style="text-align: left;"><li>Port blocked by RSTP</li><li>Loops in network</li><li>Port flapping</li><li>Traffic is flooded to all ports</li><li>MAC telnet is unable to connect</li><li>Device inaccessible</li></ul><h2 style="text-align: left;" id="Layer2misconfiguration-Solution.4"><span class="mw-headline">Solution</span></h2><p style="text-align: left;">Use bridge VLAN filtering. The proper way to tag traffic is to assign a VLAN ID whenever traffic enters a bridge, this behavior can easily be achieved by specifying<span> </span><strong>PVID</strong><span> </span>value for a bridge port and specifying which ports are<span> </span><strong>tagged</strong><span> </span>(trunk) ports and which are<span> </span><strong>untagged</strong><span> </span>(access) ports. Below is an example of how such a setup should have been configured:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge
add name=bridge1 vlan-filtering=yes
/interface bridge port
add bridge=bridge1 interface=ether1
add bridge=bridge1 interface=ether2
add bridge=bridge1 interface=ether3 pvid=99
/interface bridge vlan
add bridge=bridge1 tagged=ether1,ether2 untagged=ether3 vlan-ids=99</pre>
</div></div><p><br/></p><div role="region" aria-label="Warning" class="confluence-information-macro  confluence-information-macro-warning" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>By enabling<span> </span><span style="color:var(--ds-icon-success,#22A06B);"><code>vlan-filtering</code></span><span> </span>you will be filtering out traffic destined to the CPU, before enabling VLAN filtering you should make sure that you set up a<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/Bridging+and+Switching#BridgingandSwitching-Managementaccessconfiguration" rel="nofollow">Management port</a>.</p></div></div><h1 style="text-align: left;" id="Layer2misconfiguration-VLANinabridgewithaphysicalinterface"><span class="mw-headline">VLAN in a bridge with a physical interface</span></h1><hr/><p style="text-align: left;">Very similar case to<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/Layer2+misconfiguration#Layer2misconfiguration-VLANonabridgeinabridge" rel="nofollow">VLAN on a bridge in a bridge</a>. The most popular use case is when you want to bridge a physical interface with a VLAN (simplified trunk/access port setup). In such setup you might want to send out tagged traffic on one side and untagged on the other side. To acomplish this, you create a VLAN interface on the trunk port (the tagged side), then create a bridge and add both the VLAN interface and the physical interface (the untagged side) as bridge ports.</p><h2 style="text-align: left;" id="Layer2misconfiguration-Configuration.5"><span class="mw-headline">Configuration</span></h2><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface vlan
add interface=ether1 name=VLAN99 vlan-id=99
/interface bridge
add name=bridge1
/interface bridge port
add interface=ether2 bridge=bridge1
add interface=VLAN99 bridge=bridge1</pre>
</div></div><h2 style="text-align: left;" id="Layer2misconfiguration-Problem.5"><span class="mw-headline">Problem</span></h2><p style="text-align: left;">This setup and configuration will work in most cases, but it violates the IEEE 802.1W standard when (R/M)STP is used. If this is the only device in your Layer2 domain, then this should not cause problems, but problems can arise when there are other vendor switches. The reason for this is that RSTP on a bridge interface is enabled by default, allowing Bridge Protocol Data Units (BPDUs) to be sent from each bridge port. While <strong>ether2</strong> transmits BPDUs correctly without tagging, <strong>VLAN99</strong> interface, being a bridge port, sends tagged BPDUs over ether1. Not all switches can understand tagged BPDUs.  Precautions should be made with this configuration in a more complex network where there are multiple network topologies for certain (group of) VLANs, this is relevant to MSTP and PVSTP(+) with mixed vendor devices. In a ring-like topology with multiple network topologies for certain VLANs, one port from the switch will be blocked, but in MSTP and PVSTP(+) a path can be opened for a certain VLAN, in such a situation it is possible that devices that don't support PVSTP(+) will untag the BPDUs and forward the BPDU, as a result, the switch will receive its own packet, trigger a loop detection and block a port, this can happen to other protocols as well, but (R)STP is the most common case. If a switch is using a BPDU guard function, then this type of configuration can trigger it and cause a port to be blocked by STP. It has been reported that this type of configuration can prevent traffic from being forwarded over certain bridge ports over time when using 6.41 or later. This type of configuration does not only break (R/M)STP, but it can cause loop warnings, this can be caused by MNDP packets or any other packets that are directly sent out from an interface.</p><h2 style="text-align: left;" id="Layer2misconfiguration-Symptoms.5"><span class="mw-headline">Symptoms</span></h2><p style="text-align: left;">Below is a list of possible symptoms that might be a result of this kind of misconfiguration:</p><ul style="text-align: left;"><li>Port blocked by RSTP</li><li>Loops in network</li><li>Port flapping</li><li>Traffic stops forwarding over time</li><li>BPDUs ignored by other RSTP enabled devices</li></ul><h2 style="text-align: left;" id="Layer2misconfiguration-Solution.5"><span class="mw-headline">Solution</span></h2><p style="text-align: left;">To avoid compatibility issues you should use bridge VLAN filtering. Below you can find an example of how the same traffic tagging effect can be achieved with a bridge VLAN filtering configuration:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge
add name=bridge1 vlan-filtering=yes
/interface bridge port
add bridge=bridge1 interface=ether1
add bridge=bridge1 interface=ether2 pvid=99
/interface bridge vlan
add bridge=bridge1 tagged=ether1 untagged=ether2 vlan-ids=99</pre>
</div></div><p><br/></p><div role="region" aria-label="Warning" class="confluence-information-macro  confluence-information-macro-warning" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>By enabling <span style="color:var(--ds-icon-success,#22A06B);"><code>vlan-filtering</code></span> you will be filtering out traffic destined to the CPU, before enabling VLAN filtering you should make sure that you set up a <a href="https://help.mikrotik.com/docs/display/ROS/Bridging+and+Switching#BridgingandSwitching-Managementaccessconfiguration" rel="nofollow">Management port</a>.</p></div></div><h1 style="text-align: left;" id="Layer2misconfiguration-BridgedVLANonphysicalinterfaces"><span class="mw-headline">Bridged VLAN on physical interfaces</span></h1><hr/><p style="text-align: left;">A very similar case to<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/Layer2+misconfiguration#Layer2misconfiguration-VLANonabridgeinabridge" rel="nofollow">VLAN on a bridge in a bridge</a>, consider the following scenario, you have a couple of switches in your network and you are using VLANs to isolate certain Layer2 domains and connect these switches to a router that assigns addresses and routes the traffic to the world. For redundancy, you connect all switches directly to the router and have enabled RSTP, but to be able to setup DHCP Server you decide that you can create a VLAN interface for each VLAN on each physical interface that is connected to a switch and add these VLAN interfaces in a bridge. A network diagram can be found below:</p><p style="text-align: left;"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/19136718/19136766.png" data-image-src="attachments/19136718/19136766.png" data-unresolved-comment-count="0" data-linked-resource-id="19136766" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="Bridged_vlans.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="19136718" data-linked-resource-container-version="27" tabindex="0" alt=""></span></p><h2 style="text-align: left;" id="Layer2misconfiguration-Configuration.6"><span class="mw-headline">Configuration</span></h2><p style="text-align: left;">Only the router part is relevant to this case, switch configuration doesn't really matter as long as ports are switched. Router configuration can be found below:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge
add name=bridge10
add name=bridge20
/interface vlan
add interface=ether1 name=ether1_v10 vlan-id=10
add interface=ether1 name=ether1_v20 vlan-id=20
add interface=ether2 name=ether2_v10 vlan-id=10
add interface=ether2 name=ether2_v20 vlan-id=20
/interface bridge port
add bridge=bridge10 interface=ether1_v10
add bridge=bridge10 interface=ether2_v10
add bridge=bridge20 interface=ether1_v20
add bridge=bridge20 interface=ether2_v20</pre>
</div></div><h2 id="Layer2misconfiguration-Problem.6"><span class="mw-headline">Problem</span></h2><p style="text-align: left;">You might notice that the network is having some weird delays or even the network is unresponsive, you might notice that there is a loop detected (packet received with own MAC address) and some traffic is being generated out of nowhere. The problem occurs because a broadcast packet that is coming from either one of the VLAN interface created on the<span> </span><strong>Router</strong><span> </span>will be sent out the physical interface, packet will be forwarded through the physical interface, through a switch and will be received back on a different physical interface, in this case, broadcast packets sent out<span> </span><strong>ether1_v10</strong><span> </span>will be received on<span> </span><strong>ether2</strong>, packet will be captured by<span> </span><strong>ether2_v10</strong>, which is bridged with<span> </span><strong>ether1_v10</strong><span> </span>and will get forwarded again the same path (loop). (R)STP might not always detect this loop since (R)STP is not aware of any VLANs, a loop does not exist with untagged traffic, but exists with tagged traffic. In this scenario, it is quite obvious to spot the loop, but in more complex setups it is not always easy to detect the network design flaw. Sometimes this network design flaw might get unnoticed for a very long time if your network does not use broadcast traffic, usually,<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/Neighbor+discovery" rel="nofollow">Neighbor Discovery Protocol</a><span> </span>is broadcasting packets from the VLAN interface and will usually trigger a loop detection in such a setup. Sometimes it is useful to capture the packet that triggered a loop detection, this can by using sniffer and analyzing the packet capture file:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/tool sniffer
set filter-mac-address=4C:5E:0C:4D:12:44/FF:FF:FF:FF:FF:FF \
filter-interface=ether1 filter-direction=rx file-name=loop_packet.pcap</pre>
</div></div><p><span style="letter-spacing: 0.0px;">Or a more convenient way using logging:</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge filter
add action=log chain=forward src-mac-address=4C:5E:0C:4D:12:44/FF:FF:FF:FF:FF:FF
add action=log chain=input src-mac-address=4C:5E:0C:4D:12:44/FF:FF:FF:FF:FF:FF</pre>
</div></div><h2 id="Layer2misconfiguration-Symptoms.6"><span class="mw-headline">Symptoms</span></h2><p style="text-align: left;">Below is a list of possible symptoms that might be a result of this kind of misconfiguration:</p><ul style="text-align: left;"><li>Port blocked by (R)STP;</li><li>Loops in network;</li><li>Low throughput;</li><li>Port flapping;</li><li>Network inaccessible;</li></ul><h2 style="text-align: left;" id="Layer2misconfiguration-Solution.6"><span class="mw-headline">Solution</span></h2><p style="text-align: left;">A solution is to use bridge VLAN filtering in order to make all bridges compatible with IEEE 802.1W and IEEE 802.1Q.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge
add name=bridge vlan-filtering=yes
/interface bridge port
add bridge=bridge interface=ether1
add bridge=bridge interface=ether2
/interface bridge vlan
add bridge=bridge tagged=ether1,ether2,bridge vlan-ids=10
add bridge=bridge tagged=ether1,ether2,bridge vlan-ids=20
/interface vlan
add name=vlan10 interface=bridge vlan-id=10
add name=vlan20 interface=bridge vlan-id=20</pre>
</div></div><p style="text-align: left;"><br/></p><div role="region" aria-label="Warning" class="confluence-information-macro  confluence-information-macro-warning" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>By enabling <span style="color:var(--ds-icon-success,#22A06B);"><code>vlan-filtering</code></span> you will be filtering out traffic destined to the CPU, before enabling VLAN filtering you should make sure that you set up a <a href="https://help.mikrotik.com/docs/display/ROS/Bridging+and+Switching#BridgingandSwitching-Managementaccessconfiguration" rel="nofollow">Management port</a>.</p></div></div><h1 style="text-align: left;" id="Layer2misconfiguration-BridgedVLAN"><span class="mw-headline">Bridged VLAN</span></h1><hr/><p style="text-align: left;">A more simplified scenario of<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/Layer2+misconfiguration#Layer2misconfiguration-BridgedVLANonphysicalinterfaces" rel="nofollow">Bridged VLAN on physical interfaces</a>, but in this case, you simply want to bridge two or more VLANs together that are created on different physical interfaces. This is a very common type of setup that deserves a separate article since misconfiguring this type of setup has caused multiple network failures. This type of setup is also used for VLAN translation.</p><h2 style="text-align: left;" id="Layer2misconfiguration-Configuration.7"><span class="mw-headline">Configuration</span></h2><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface vlan
add interface=ether1 name=ether1_v10 vlan-id=10
add interface=ether2 name=ether2_v10 vlan-id=10
/interface bridge
add name=bridge1
/interface bridge port
add bridge=bridge1 interface=ether1_v10
add bridge=bridge1 interface=ether2_v10</pre>
</div></div><p><span style="font-size: 20.0px;letter-spacing: -0.008em;">Problem</span></p><p style="text-align: left;">You may notice that certain parts of the network are not accessible and/or certain links keep flapping. This is due to (R)STP, this type of configuration forces the device to send out tagged BPDUs, that might not be supported by other devices, including RouterOS. Since a device receives a malformed packet (tagged BPDUs should not exist in your network when running (R)STP, this violates IEEE 802.1W and IEEE 802.1Q), the device will not interpret the packet correctly and can have unexpected behavior.</p><h2 style="text-align: left;" id="Layer2misconfiguration-Symptoms.7"><span class="mw-headline">Symptoms</span></h2><p style="text-align: left;">Below is a list of possible symptoms that might be a result of this kind of misconfiguration:</p><ul style="text-align: left;"><li>Port blocked by (R)STP;</li><li>Port flapping;</li><li>Network inaccessible;</li></ul><h2 style="text-align: left;" id="Layer2misconfiguration-Solution.7"><span class="mw-headline">Solution</span></h2><p style="text-align: left;">The easiest solution is to simply disable (R)STP on the bridge:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge
set bridge1 protocol-mode=none</pre>
</div></div><p><br/></p><p style="text-align: left;">though it is still recommended to rewrite your configuration to use bridge VLAN filtering:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge
add name=bridge1 vlan-filtering=yes
/interface bridge port
add bridge=bridge1 interface=ether1
add bridge=bridge1 interface=ether2
/interface bridge vlan
add bridge=bridge1 tagged=ether1,ether2 vlan-ids=10</pre>
</div></div><p><br/></p><div role="region" aria-label="Warning" class="confluence-information-macro  confluence-information-macro-warning" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>By enabling<span> </span><span style="color:var(--ds-icon-success,#22A06B);"><code>vlan-filtering</code></span><span> </span>you will be filtering out traffic destined to the CPU, before enabling VLAN filtering you should make sure that you set up a<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/Bridging+and+Switching#BridgingandSwitching-Managementaccessconfiguration" rel="nofollow">Management port</a>.</p></div></div><h1 style="text-align: left;" id="Layer2misconfiguration-BridgeVLANfilteringonnon-CRS3xx"><span class="mw-headline">Bridge VLAN filtering on non-CRS3xx</span></h1><hr/><p style="text-align: left;">Consider the following scenario, you found out the new bridge VLAN filtering feature and you decided to change the configuration on your device, you have a very simple trunk/access port setup and you like the concept of bridge VLAN filtering.</p><h2 style="text-align: left;" id="Layer2misconfiguration-Configuration.8"><span class="mw-headline">Configuration</span></h2><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge
add name=bridge1 vlan-filtering=yes
/interface bridge port
add bridge=bridge1 interface=ether1
add bridge=bridge1 interface=ether2 pvid=20
add bridge=bridge1 interface=ether3 pvid=30
add bridge=bridge1 interface=ether4 pvid=40
/interface bridge vlan
add bridge=bridge1 tagged=ether1 untagged=ether2 vlan-ids=20
add bridge=bridge1 tagged=ether1 untagged=ether3 vlan-ids=30
add bridge=bridge1 tagged=ether1 untagged=ether4 vlan-ids=40</pre>
</div></div><h2 style="text-align: left;" id="Layer2misconfiguration-Problem.7"><span class="mw-headline">Problem</span></h2><p style="text-align: left;">For example, you use this configuration on a CRS1xx/CRS2xx series device and you started to notice that the CPU usage is very high and when running a performance test to check the network's throughput you notice that the total throughput is only a fraction of the wire-speed performance that it should easily reach. The cause of the problem is that not all devices support bridge VLAN filtering on a hardware level. All devices are able to be configured with bridge VLAN filtering, but only a few of them will be able to offload the traffic to the switch chip. If an improper configuration method is used on a device with a built-in switch chip, then the CPU will be used to forward the traffic.</p><h2 style="text-align: left;" id="Layer2misconfiguration-Symptoms.8"><span class="mw-headline">Symptoms</span></h2><p style="text-align: left;">Below is a list of possible symptoms that might be a result of this kind of misconfiguration:</p><ul style="text-align: left;"><li>Missing &quot;H&quot; flag on bridge ports</li><li>Low throughput</li><li>High CPU usage</li></ul><h2 style="text-align: left;" id="Layer2misconfiguration-Solution.8"><span class="mw-headline">Solution</span></h2><p style="text-align: left;">Before using bridge VLAN filtering check if your device supports it at the hardware level, a table with compatibility can be found at the<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/Bridging+and+Switching#BridgingandSwitching-BridgeHardwareOffloading" rel="nofollow">Bridge Hardware Offloading</a><span> </span>section. Each type of device currently requires a different configuration method, below is a list of which configuration should be used on a device in order to use the benefits of hardware offloading:</p><ul style="text-align: left;"><li><a href="https://help.mikrotik.com/docs/display/ROS/Bridging+and+Switching#BridgingandSwitching-BridgeVLANFiltering" rel="nofollow">CRS3xx series devices</a></li><li><a href="https://help.mikrotik.com/docs/pages/viewpage.action?pageId=103841836#CRS1xx/2xxseriesswitchesexamples-VLAN" rel="nofollow">CRS1xx/CRS2xx series devices</a></li><li><a href="https://help.mikrotik.com/docs/display/ROS/Switch+Chip+Features#SwitchChipFeatures-SetupExamples" rel="nofollow">Other devices with a switch chip</a></li></ul><h1 style="text-align: left;" id="Layer2misconfiguration-VLANfilteringwithmultipleswitchchips"><span class="mw-headline">VLAN filtering with multiple switch chips</span></h1><hr/><p style="text-align: left;">Consider the following scenario, you have a device with two or more switch chips and you have decided to use a single bridge and set up VLAN filtering (by using the<span> </span><code>/interface ethernet switch</code><span> </span>menu) on a hardware level to be able to reach wire-speed performance on your network. This is very relevant for RB2011 and RB3011 series devices. In this example, let's assume that you want to have a single trunk port and all other ports are access ports, for example,<span> </span><strong>ether10</strong><span> </span>is our trunk port and<span> </span><strong>ether1-ether9</strong><span> </span>are our access ports.</p><h2 style="text-align: left;" id="Layer2misconfiguration-Configuration.9"><span class="mw-headline">Configuration</span></h2><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge
add name=bridge1
/interface bridge port
add bridge=bridge1 interface=ether1
add bridge=bridge1 interface=ether2
add bridge=bridge1 interface=ether3
add bridge=bridge1 interface=ether4
add bridge=bridge1 interface=ether5
add bridge=bridge1 interface=ether6
add bridge=bridge1 interface=ether7
add bridge=bridge1 interface=ether8
add bridge=bridge1 interface=ether9
add bridge=bridge1 interface=ether10
/interface vlan
add interface=bridge1 name=VLAN10 vlan-id=10
/interface ethernet switch port
set ether1,ether2,ether3,ether4,ether5,ether6,ether7,ether8,ether9 default-vlan-id=10 vlan-header=always-strip vlan-mode=secure
set ether10 vlan-header=add-if-missing vlan-mode=secure
set switch1-cpu,switch2-cpu vlan-mode=secure
/interface ethernet switch vlan
add ports=ether1,ether2,ether3,ether4,ether5,switch1-cpu switch=switch1 vlan-id=10
add ports=ether6,ether7,ether8,ether9,ether10,switch2-cpu switch=switch2 vlan-id=10</pre>
</div></div><h2 style="text-align: left;" id="Layer2misconfiguration-Problem.8"><span class="mw-headline">Problem</span></h2><p style="text-align: left;">After running a few tests you might notice that packets from<span> </span><strong>ether6-ether10</strong><span> </span>are forwarded as expected, but packets from<span> </span><strong>ether1-ether5</strong><span> </span>are not always forwarded correctly (especially through the trunk port). The most noticeable issue would be that packets from<span> </span><strong>ether1-ether5</strong><span> </span>through<span> </span><strong>ether10</strong><span> </span>are simply dropped, this is because these ports are located on different switch chip, this means that VLAN filtering is not possible on a hardware level since the switch chip is not aware of the VLAN table's contents on a different switch chip. Packets that are being forwarded between ports that are located on different switch chips are also processed by the CPU, which means you won't be able to achieve wire-speed performance.</p><h2 style="text-align: left;" id="Layer2misconfiguration-Symptoms.9"><span class="mw-headline">Symptoms</span></h2><p style="text-align: left;">Below is a list of possible symptoms that might be a result of this kind of misconfiguration:</p><ul style="text-align: left;"><li>Packets being dropped;</li><li>Low throughput;</li></ul><h2 style="text-align: left;" id="Layer2misconfiguration-Solution.9"><span class="mw-headline">Solution</span></h2><p style="text-align: left;">The proper solution is to take into account this hardware design and plan your network topology accordingly. To solve this issue you must create two separate bridges and configure VLAN filtering on each switch chip, this limits the possibility to forward packets between switch chip, though it is possible to configure routing between both bridges (if devices that are connected on each switch chip are using different network subnets).</p><p style="text-align: left;">There is a way to configure the device to have all ports switch together and yet be able to use VLAN filtering on a hardware level, though this solution has some caveats. The idea is to sacrifice a single Ethernet port on each switch chip that will act as a trunk port to forward packets between switch chip, this can be done by plugging an Ethernet cable between both switch chip, for example, lets plug in an Ethernet cable between<span> </span><strong>ether5</strong><span> </span>and<span> </span><strong>ether6</strong><span> </span>then reconfigure your device assuming that these ports are trunk ports:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge port
add bridge=bridge1 interface=ether1
add bridge=bridge1 interface=ether2
add bridge=bridge1 interface=ether3
add bridge=bridge1 interface=ether4
add bridge=bridge1 interface=ether5
add bridge=bridge2 interface=ether6
add bridge=bridge2 interface=ether7
add bridge=bridge2 interface=ether8
add bridge=bridge2 interface=ether9
add bridge=bridge2 interface=ether10
/interface ethernet switch port
set ether1,ether2,ether3,ether4,ether7,ether8,ether9 default-vlan-id=10 vlan-header=always-strip vlan-mode=secure
set ether5,ether6,ether10 vlan-header=add-if-missing vlan-mode=secure default-vlan-id=auto
set switch1-cpu,switch2-cpu vlan-mode=secure
/interface ethernet switch vlan
add ports=ether1,ether2,ether3,ether4,ether5,switch1-cpu switch=switch1 vlan-id=10
add ports=ether6,ether7,ether8,ether9,ether10,switch2-cpu switch=switch2 vlan-id=10</pre>
</div></div><p><br/></p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>For 100Mbps switch chips, use<span> </span><span style="color:var(--ds-icon-success,#22A06B);"><code>default-vlan-id=0</code></span><span> </span>instead of<span> </span><span style="color:var(--ds-icon-success,#22A06B);"><code>default-vlan-id=auto</code></span></p></div></div><h1 style="text-align: left;" id="Layer2misconfiguration-VLANfilteringwithsimplifiedbridgeVLANtable"><span class="mw-headline">VLAN filtering with simplified bridge VLAN table</span></h1><hr/><div role="region" aria-label="Info" class="confluence-information-macro  confluence-information-macro-information" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-info-filled confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>This issue has been resolved since <strong>RouterOS v7.15</strong>. Dynamic VLANs are now always created as separate entries and no longer merge with statically configured ones.</p></div></div><p><span class="mw-headline" style="letter-spacing: 0.0px;">You need to create a network setup where multiple clients are connected to separate access ports and isolated by different VLANs, this traffic should be tagged and sent to the appropriate trunk port. Access ports are configured using a pvid property. As the trunk port is used on both VLANs, you </span><span style="letter-spacing: 0.0px;">decided to simplify configuration by adding a single bridge VLAN table entry and separate VLANs by a comma. This is especially useful when tagged trunk ports are used across large numbers of VLANs or even certain VLAN ranges (e.g. vlan-id=100-200). See a network diagram and configuration below.</span></p><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/19136718/19136803.png" data-image-src="attachments/19136718/19136803.png" data-unresolved-comment-count="0" data-linked-resource-id="19136803" data-linked-resource-version="4" data-linked-resource-type="attachment" data-linked-resource-default-alias="Switch_multiple_untagged.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="19136718" data-linked-resource-container-version="27" tabindex="0" alt=""></span></p><h2 id="Layer2misconfiguration-Configuration.10"><span class="mw-headline">Configuration</span></h2><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge
add name=bridge1 vlan-filtering=yes
/interface bridge port
add bridge=bridge1 interface=ether2
add bridge=bridge1 interface=ether3 pvid=10
add bridge=bridge1 interface=ether4 pvid=20
/interface bridge vlan
add bridge=bridge1 tagged=ether2 vlan-ids=10,20</pre>
</div></div><h2 id="Layer2misconfiguration-Problem.9"><span class="mw-headline">Problem</span></h2><p><span class="mw-headline">Traffic is correctly forwarded and tagged from access ports to trunk port, but you might notice that some broadcast or multicast packets are actually flooded between both untagged access ports, although they should be on different VLANs. Furthermore, broadcast and multicast traffic from the tagged port is also flooded to both access ports. This might raise some security concerns as traffic from different networks can be sniffed. When you look at the bridge VLAN table, you notice that a single entry has been created for VLANs 10 and 20, and both untagged ports are part of the same VLAN group.</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@SW1] /interface bridge vlan print where tagged=ether2
Columns: BRIDGE, VLAN-IDS, CURRENT-TAGGED, CURRENT-UNTAGGED
# BRIDGE   VLAN-IDS  CURRENT-TAGGED  CURRENT-UNTAGGED
;;; port with pvid added to untagged group which might cause problems, consider adding a separate VLAN entry
0 bridge1        10  ether2          ether3          
                 20                  ether4     </pre>
</div></div><h2 id="Layer2misconfiguration-Symptoms.10"><span class="mw-headline">Symptoms</span></h2><ul><li><span class="mw-headline">Traffic is flooded between different VLANs</span></li><li><span class="mw-headline">Red warning: <span style="color:var(--ds-background-accent-red-bolder,#C9372C);"><code>port with pvid added to untagged group which might cause problems, consider adding a separate VLAN entry</code></span></span></li></ul><h2 id="Layer2misconfiguration-Solution.10"><span class="mw-headline">Solution</span><span class="mw-headline"> </span></h2><p><span class="mw-headline">When access ports have been configured using the pvid property, they get dynamically added to the appropriate VLAN entry. After creating a static VLAN entry with multiple VLANs or VLAN range, the untagged access port with a matching pvid also gets included in the same VLAN group or range. It might be useful to define a large number of VLANs using a single configuration line, but extra caution should be taken when access ports are configured. For this example, separate VLAN entries should be created:</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge vlan
add bridge=bridge1 tagged=ether2 untagged=ether3 vlan-ids=10
add bridge=bridge1 tagged=ether2 untagged=ether4 vlan-ids=20</pre>
</div></div><h1 style="text-align: left;" id="Layer2misconfiguration-MTUonthemasterinterface"><span class="mw-headline">MTU on the master interface</span></h1><hr/><p style="text-align: left;">Consider the following scenario, you have created a bridge, added a few interfaces to it and have created a VLAN interface on top of the bridge interface, but you need to increase the MTU size on the VLAN interface in order to receive larger packets.</p><h2 style="text-align: left;" id="Layer2misconfiguration-Configuration.11"><span class="mw-headline">Configuration</span></h2><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge
add name=bridge1
/interface bridge port
add bridge=bridge1 interface=ether1
add bridge=bridge1 interface=ether2
/interface vlan
add interface=bridge1 name=VLAN99 vlan-id=99</pre>
</div></div><h2 style="text-align: left;" id="Layer2misconfiguration-Problem.10"><span class="mw-headline">Problem</span></h2><p style="text-align: left;">As soon as you try to increase the MTU size on the VLAN interface, you receive an error that RouterOS<span> </span><strong>Could not set MTU</strong>. This can happen when you are trying to set MTU larger than the L2MTU. In this case, you need to increase the L2MTU size on all slave interfaces, which will update the L2MTU size on the bridge interface. After this has been done, you will be able to set a larger MTU on the VLAN interface. The same principle applies to bond interfaces. You can increase the MTU on interfaces like VLAN, MPLS, VPLS, Bonding and other interfaces only when all physical slave interfaces have proper L2MTU set.</p><h2 style="text-align: left;" id="Layer2misconfiguration-Symptoms.11"><span class="mw-headline">Symptoms</span></h2><p style="text-align: left;">Below is a list of possible symptoms that might be a result of this kind of misconfiguration:</p><ul style="text-align: left;"><li>Cannot change MTU</li></ul><h2 style="text-align: left;" id="Layer2misconfiguration-Solution.11"><span class="mw-headline">Solution</span></h2><p style="text-align: left;">Increase the L2MTU on slave interfaces before changing the MTU on a master interface.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface ethernet
set ether1,ether2 l2mtu=9018
/interface vlan
set VLAN99 mtu=9000</pre>
</div></div><h1 style="text-align: left;" id="Layer2misconfiguration-MTUinconsistency"><span class="mw-headline">MTU inconsistency</span></h1><hr/><p style="text-align: left;">Consider the following scenario, you have multiple devices in your network, most of them are used as a switch/bridge in your network and there are certain endpoints that are supposed to receive and process traffic. To decrease the overhead in your network, you have decided to increase the MTU size so you set a larger MTU size on both endpoints, but you start to notice that some packets are being dropped.</p><p style="text-align: left;"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/19136718/19136788.png" data-image-src="attachments/19136718/19136788.png" data-unresolved-comment-count="0" data-linked-resource-id="19136788" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="MTU.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="19136718" data-linked-resource-container-version="27" tabindex="0" alt=""></span></p><h2 style="text-align: left;" id="Layer2misconfiguration-Configuration.12"><span class="mw-headline">Configuration</span></h2><p style="text-align: left;">In this case, both endpoints can be any type of device, we will assume that they are both Linux servers that are supposed to transfer a large amount of data. In such a scenario, you would have probably set interface MTU to 9000 on<span> </span><strong>ServerA</strong><span> </span>and<span> </span><strong>ServerB a</strong>nd on your<span> </span><strong>Switch</strong><span> </span>you have probably have set something similar to this:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge
add name=bridge1
/interface bridge port
add interface=ether1 bridge=bridge1
add interface=ether2 bridge=bridge1</pre>
</div></div><h2 style="text-align: left;" id="Layer2misconfiguration-Problem.11"><span class="mw-headline">Problem</span></h2><p style="text-align: left;">This is a very simple problem, but in larger networks, it can be hard to detect. For instance, ping might be working since a generic ping packet will be 70 bytes long (14 bytes for Ethernet header, 20 bytes for IPv4 header, 8 bytes for ICMP header, 28 bytes for ICMP payload), but data transfer might not work properly. The reason why some packets might not get forwarded is that MikroTik devices running RouterOS by default have MTU set to 1500 and L2MTU set to something around 1580 bytes (depends on the device), but the Ethernet interface will silently drop anything that does not fit into the L2MTU size. Note that the L2MTU parameter is not relevant to x86 or CHR devices. For a device that is only supposed to forward packets, there is no need to increase the MTU size, it is only required to increase the L2MTU size, RouterOS will not allow you to increase the MTU size that is larger than the L2MTU size. If you require the packet to be received on the interface and the device needs to process this packet rather than just forwarding it, for example, in the case of routing, then it is required to increase the L2MTU and the MTU size, but you can leave the MTU size on the interface to the default value if you are using only IP traffic (that supports packet fragmentation) and don't mind that packets are being fragmented. You can use the ping utility to make sure that all devices are able to forward jumbo frames:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ping 192.168.88.1 size=9000 do-not-fragment</pre>
</div></div><p style="text-align: left;">Remember that the L2MTU and MTU size needs to be larger or equal to the ping packet size on the device from which and to which you are sending a ping packet since ping (ICMP) is IP traffic that is sent out from an interface over Layer3.</p><h2 style="text-align: left;" id="Layer2misconfiguration-Symptoms.12"><span class="mw-headline">Symptoms</span></h2><p style="text-align: left;">Below is a list of possible symptoms that might be a result of this kind of misconfiguration:</p><ul style="text-align: left;"><li>Web pages are not able to load up, but ping works properly;</li><li>Tunnels dropping traffic;</li><li>Specific protocols are broken;</li><li>Large packet loss;</li></ul><h2 style="text-align: left;" id="Layer2misconfiguration-Solution.12"><span class="mw-headline">Solution</span></h2><p style="text-align: left;">Increase the L2MTU size on your<span> </span><strong>Switch</strong>:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface ethernet
set ether1,ether2 l2mtu=9000</pre>
</div></div><p style="text-align: left;">In case your traffic is encapsulated (VLAN, VPN, MPLS, VPLS, or other), then you might need to consider setting an even larger L2MTU size. In this scenario, it is not needed to increase the MTU size for the reason described above.</p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Full frame MTU is not the same as L2MTU. L2MTU size does not include the Ethernet header (14 bytes) and the CRC checksum (FCS) field. The FCS field is stripped by the Ethernet's driver and RouterOS will never show the extra 4 bytes to any packet. For example, if you set MTU and L2MTU to 9000, then the full-frame MTU is 9014 bytes long, this can also be observed when sniffing packets with<span> &quot;</span><code>/tool sniffer quick&quot;</code> command.</p></div></div><h1 style="text-align: left;" id="Layer2misconfiguration-BridgeandreservedMACaddresses"><span class="mw-headline">Bridge and reserved MAC addresses</span></h1><hr/><p style="text-align: left;">Consider the following scenario, you want to transparently bridge two network segments together, either those are tunnel interfaces like EoIP, Wireless interfaces, Ethernet interface, or any other kind of interfaces that can be added to a bridge. Such a setup allows you to seamlessly connect two devices together like there was only a physical cable between them, this is sometimes called a<span> </span><strong>transparent bridge</strong><span> </span>from<span> </span><strong>DeviceA</strong><span> </span>to<span> </span><strong>DeviceB</strong>.</p><h2 style="text-align: left;" id="Layer2misconfiguration-Configuration.13"><span class="mw-headline">Configuration</span></h2><p style="text-align: left;">For both devices<span> </span><strong>DeviceA</strong><span> </span>and<span> </span><strong>DeviceB</strong><span> </span>there should be a very similar configuration.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge
add name=bridge1 protocol-mode=rstp
/interface bridge port
add interface=ether1 bridge=bridge1
add interface=eoip1 bridge=bridge1</pre>
</div></div><h2 style="text-align: left;" id="Layer2misconfiguration-Problem.12"><span class="mw-headline">Problem</span></h2><p style="text-align: left;">Both devices are able to communicate with each other, but some protocols do not work properly. The reason is that as soon as you use any STP variant (STP, RSTP, MSTP), you make the bridge compliant with IEEE 802.1D and IEEE 802.1Q, these standards recommend that packets that are destined to<span> <strong style="text-align: left;">01:80:C2:00:00:0X</strong></span><span> </span>should<span> </span><strong>NOT</strong><span> </span>be forwarded. In cases where there are only 2 ports added to a bridge (R/M)STP should not be used since a loop cannot occur from 2 interfaces and if a loop does occur, the cause is elsewhere and should be fixed on a different bridge. Since (R/M)STP is not needed in transparent bridge setups, it can be disabled. As soon as (R/M)STP is disabled, the RouterOS bridge is not compliant with IEEE 802.1D and IEEE 802.1Q and therefore will forward packets that are destined to<span> <strong style="text-align: left;">01:80:C2:00:00:0X</strong></span>.</p><h2 style="text-align: left;" id="Layer2misconfiguration-Symptoms.13"><span class="mw-headline">Symptoms</span></h2><p style="text-align: left;">Below is a list of possible symptoms that might be a result of this kind of misconfiguration:</p><ul style="text-align: left;"><li>LLDP neighbors not showing up;</li><li>802.1x authentication (dot1x) not working;</li><li>LACP interface not passing traffic;</li></ul><h2 style="text-align: left;" id="Layer2misconfiguration-Solution.13"><span class="mw-headline">Solution</span></h2><p style="text-align: left;">It is possible to partly disable compliance with IEEE 802.1D and IEEE 802.1Q, this can be done by changing the bridge protocol mode.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge
set bridge1 protocol-mode=none</pre>
</div></div><div role="region" aria-label="Warning" class="confluence-information-macro  confluence-information-macro-warning" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>The IEEE 802.1x standard is meant to be used between a switch and a client directly. If it is possible to connect a device between the switch and the client, then this creates a security threat. For this reason, it is not recommended to disable the compliance with IEEE 802.1D and IEEE 802.1Q, but rather design a proper network topology.</p></div></div><h1 style="text-align: left;" id="Layer2misconfiguration-BondingbetweenWirelesslinks"><span class="mw-headline">Bonding between Wireless links</span></h1><hr/><p style="text-align: left;">Consider the following scenario, you have set up multiple Wireless links and to achieve maximum throughput and yet to achieve redundancy you have decided to place Ethernet interfaces into a bond and depending on the traffic that is being forwarded you have chosen a certain bonding mode. This scenario can be applied to any case, where a bonding interface is created between links, that are not directly connected to each other.</p><p style="text-align: left;"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/19136718/19136794.png" data-image-src="attachments/19136718/19136794.png" data-unresolved-comment-count="0" data-linked-resource-id="19136794" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="Lacp_wlan.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="19136718" data-linked-resource-container-version="27" tabindex="0" alt=""></span></p><h2 style="text-align: left;" id="Layer2misconfiguration-Configuration.14"><span class="mw-headline">Configuration</span></h2><p style="text-align: left;">The following configuration is relevant to<span> </span><strong>R1</strong><span> </span>and<span> </span><strong>R2</strong>:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bonding
add mode=802.3ad name=bond1 slaves=ether1,ether2 transmit-hash-policy=layer-2-and-3
/ip address
add address=192.168.1.X/24 interface=bond1</pre>
</div></div><p style="text-align: left;">While the following configuration is relevant to<span> </span><strong>AP1</strong>,<span> </span><strong>AP2</strong>,<span> </span><strong>ST1,</strong><span> </span>and<span> </span><strong>ST2</strong>, where<span> </span><strong>X</strong><span> </span>corresponds to an IP address for each device.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge
add name=bridge1 protocol-mode=none
/interface bridge port
add interface=ether1 bridge=bridge1
add interface=wlan1 bridge=bridge1
/ip address
add address=192.168.1.X/24 interface=bridge1</pre>
</div></div><h2 style="text-align: left;" id="Layer2misconfiguration-Problem.13"><span class="mw-headline">Problem</span></h2><p style="text-align: left;">While traffic is being forwarded properly between<span> </span><strong>R1</strong><span> </span>and<span> </span><strong>R2</strong>, load balancing, link failover is working properly as well, but devices between<span> </span><strong>R1</strong><span> </span>and<span> </span><strong>R2</strong><span> </span>are not always accessible or some of them are completely inaccessible (in most cases<span> </span><strong>AP2</strong><span> </span>and<span> </span><strong>ST2</strong><span> </span>are inaccessible). After examining the problem you might notice that packets do not always get forwarded over the required bonding slave and as a result, never is received by the device you are trying to access. This is a network design and bonding protocol limitation. As soon as a packet needs to be sent out through a bonding interface (in this case you might be trying to send ICMP packets to<span> </span><strong>AP2</strong><span> </span>or<span> </span><strong>ST2</strong>), the bonding interface will create a hash based on the selected bonding mode and<span> </span>transmit-hash-policy<span> </span>and will select an interface, through which to send the packet out, regardless of the destination is only reachable through a certain interface. Some devices will be accessible because the generated hash matches the interface, on which the device is located on, but it might not choose the needed interface as well, which will result in inaccessible device. Only broadcast bonding mode does not have this kind of protocol limitation, but this bonding mode has a very limited use case.</p><h2 style="text-align: left;" id="Layer2misconfiguration-Symptoms.14"><span class="mw-headline">Symptoms</span></h2><p style="text-align: left;">Below is a list of possible symptoms that might be a result of this kind of misconfiguration:</p><ul style="text-align: left;"><li>Limited connectivity</li><li>Unstable links (in case of balance-rr)</li></ul><h2 style="text-align: left;" id="Layer2misconfiguration-Solution.14"><span class="mw-headline">Solution</span></h2><p style="text-align: left;">Bonding interfaces are not supposed to be connected using in-direct links, but it is still possible to create a workaround. The idea behind this workaround is to find a way to bypass packets being sent out using the bonding interface. There are multiple ways to force a packet not to be sent out using the bonding interface, but essentially the solution is to create new interfaces on top of physical interfaces and add these newly created interfaces to a bond instead of the physical interfaces. One way to achieve this is to create EoIP tunnels on each physical interface, but that creates a huge overhead and will reduce overall throughput. You should create a VLAN interface on top of each physical interface instead, this creates a much smaller overhead and will not impact overall performance noticeably. Here is an example of how<span> </span><strong>R1</strong><span> </span>and<span> </span><strong>R2</strong><span> </span>should be reconfigured:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface vlan
add interface=ether1 name=VLAN_ether1 vlan-id=999
add interface=ether2 name=VLAN_ether2 vlan-id=999
/interface bonding
add mode=balance-xor name=bond1 slaves=VLAN_ether1,VLAN_ether2 transmit-hash-policy=layer-2-and-3
/ip address
add address=192.168.1.X/24 interface=bond1
add address=192.168.11.X/24 interface=ether1
add address=192.168.22.X/24 interface=ether2</pre>
</div></div><p style="text-align: left;"><strong>AP1</strong><span> </span>and<span> </span><strong>ST1</strong><span> </span>only need updated IP addresses to the correct subnet:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip address
add address=192.168.11.X/24 interface=bridge1</pre>
</div></div><p style="text-align: left;">Same changes must be applied to<span> </span><strong>AP2</strong><span> </span>and<span> </span><strong>ST2</strong><span> </span>(make sure to use the correct subnet):</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip address
add address=192.168.22.X/24 interface=bridge1</pre>
</div></div><p style="text-align: left;">With this approach, you create the least overhead and the least configuration changes are required.</p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>LACP (802.3ad) is not mean to be used in setups, where devices bonding slaves are not directly connected, in this case, it is not recommended to use LACP if there are Wireless links between both routers. LACP requires both bonding slaves to be at the same link speeds, Wireless links can change their rates at any time, which will decrease overall performance and stability. Other bonding modes should be used instead.</p></div></div><h1 style="text-align: left;" id="Layer2misconfiguration-Bandwidthtesting"><span class="mw-headline">Bandwidth testing</span></h1><hr/><p style="text-align: left;">Consider the following scenario, you set up a link between two devices, this can be any link, an Ethernet cable, a wireless link, a tunnel or any other connection. You decide that you want to test the link's bandwidth, but for convenience reasons, you decide to start testing the link with the same devices that are running the link.</p><p style="text-align: left;"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/19136718/19136799.png" data-image-src="attachments/19136718/19136799.png" data-unresolved-comment-count="0" data-linked-resource-id="19136799" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="Bandwidth_bad.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="19136718" data-linked-resource-container-version="27" tabindex="0" alt=""></span></p><h2 style="text-align: left;" id="Layer2misconfiguration-Problem.14"><span class="mw-headline">Problem</span></h2><p style="text-align: left;">As soon as you start<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/Bandwidth+Test" rel="nofollow">Bandwidth test</a><span> </span>or<span> </span><a class="external-link" href="https://wiki.mikrotik.com/wiki/Manual:Tools/Traffic_Generator" rel="nofollow" style="text-decoration: none;" title="Manual:Tools/Traffic Generator">Traffic generator</a><span> </span>you notice that the throughput is much smaller than expected. For very powerful routers, which should be able to forward many Gigabits per second (Gbps) you notice that only a few Gigabits per second gets forwarded. The reason why this is happening is because of the testing method you are using, you should never test throughput on a router while using the same router for generating traffic because you are adding an additional load on the CPU that reduces the total throughput.</p><h2 style="text-align: left;" id="Layer2misconfiguration-Symptoms.15"><span class="mw-headline">Symptoms</span></h2><p style="text-align: left;">Below is a list of possible symptoms that might be a result of this kind of misconfiguration:</p><ul style="text-align: left;"><li>Low throughput;</li><li>High CPU usage;</li></ul><h2 style="text-align: left;" id="Layer2misconfiguration-Solution.15"><span class="mw-headline">Solution</span></h2><p style="text-align: left;">Use a proper testing method. Don't use Bandwidth-test to test large capacity links and don't run any tool that generates traffic on the same device you are testing. Design your network properly so you can attach devices that will generate and receive traffic on both ends. If you are familiar with<span> </span><strong>Iperf</strong>, then this concept should be clear. Remember that in real-world a router or a switch does not generate large amounts of traffic (at least it shouldn't, otherwise, it might indicate an existing security issue), a server/client generates the traffic while a router/switch forwards the traffic (and does some manipulations to the traffic in appropriate cases).</p><p style="text-align: left;"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/19136718/19136800.png" data-image-src="attachments/19136718/19136800.png" data-unresolved-comment-count="0" data-linked-resource-id="19136800" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="Bandwidth_good.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="19136718" data-linked-resource-container-version="27" tabindex="0" alt=""></span></p><h1 style="text-align: left;" id="Layer2misconfiguration-Bridgesplit-horizonusage"><span class="mw-headline">Bridge split-horizon usage</span></h1><hr/><p style="text-align: left;">Consider the following scenario, you have a bridge and you need to isolate certain bridge ports from each other. There are options to use a built-in switch chip to isolate certain ports on certain switch chips, you can use bridge firewall rules to prevent certain ports to be able to send any traffic to other ports, you can isolate ports in a PVLAN type of setup using port isolation, but there is also a software-based solution to use bridge split-horizon (which disables hardware offloading on all switch chips).</p><h2 style="text-align: left;" id="Layer2misconfiguration-Configuration.15"><span class="mw-headline">Configuration</span></h2><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge
add name=bridge1
/interface bridge port
add bridge=bridge1 horizon=1 hw=no interface=ether1
add bridge=bridge1 horizon=2 hw=no interface=ether2
add bridge=bridge1 horizon=3 hw=no interface=ether3
add bridge=bridge1 horizon=4 hw=no interface=ether4</pre>
</div></div><h2 style="text-align: left;" id="Layer2misconfiguration-Problem.15"><span class="mw-headline">Problem</span></h2><p style="text-align: left;">After setting the bridge split-horizon on each port, you start to notice that each port is still able to send data between each other. The reason for this is the misuse of bridge split-horizon. A bridge port is only not able to communicate with ports that are in the same horizon, for example, horizon=1 is not able to communicate with horizon=1, but is able to communicate with horizon=2, horizon=3, and so on.</p><h2 style="text-align: left;" id="Layer2misconfiguration-Symptoms.16"><span class="mw-headline">Symptoms</span></h2><p style="text-align: left;">Below is a list of possible symptoms that might be a result of this kind of misconfiguration:</p><ul style="text-align: left;"><li>Traffic is being forwarded on different bridge split-horizons</li></ul><h2 style="text-align: left;" id="Layer2misconfiguration-Solution.16"><span class="mw-headline">Solution</span></h2><p style="text-align: left;">Set a proper value as the bridge split-horizon. In case you want to isolate each port from each other (a common scenario for PPPoE setups) and each port is only able to communicate with the bridge itself, then all ports must be in the same bridge split-horizon.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge port
set [f] horizon=1</pre>
</div></div><p><br/></p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Setting all bridge ports in the same bridge split-horizon will result in traffic being only able to reach the bridge interface itself, then packets can only be routed. This is useful when you want other devices to filter out certain traffic. Similar behavior can be achieved using bridge filter rules.</p></div></div><h1 style="text-align: left;" id="Layer2misconfiguration-UnsupportedSFPmodules"><span class="mw-headline">Unsupported SFP modules</span></h1><hr/><p style="text-align: left;">Consider the following scenario, you have decided to use optical fiber cables to connect your devices together by using SFP or SFP+ optical modules, but for convenience reasons, you have decided to use SFP optical modules that were available.</p><h2 style="text-align: left;" id="Layer2misconfiguration-Problem.16"><span class="mw-headline">Problem</span></h2><p style="text-align: left;">As soon as you configure your devices to have connectivity on the ports that are using these SFP optical modules, you might notice that either the link is working properly or experiencing random connectivity issues. There are many vendors that manufacture SFP optical modules, but not all vendors strictly follow SFP MSA, SFF, and IEEE 802.3 standards, which can lead to unpredictable compatibility issues, which is a very common issue when using not well known or unsupported SFP optical modules in MikroTik devices.</p><h2 style="text-align: left;" id="Layer2misconfiguration-Symptoms.17"><span class="mw-headline">Symptoms</span></h2><p style="text-align: left;">Below is a list of possible symptoms that might be a result of this kind of misconfiguration:</p><ul style="text-align: left;"><li>SFP interface does not link up</li><li>Random packet drop</li><li>Unstable link (flapping)</li><li>SFP module not running after a reboot</li><li>SFP module not running after power-cycle</li><li>SFP module running only on one side</li></ul><h2 style="text-align: left;" id="Layer2misconfiguration-Solution.17"><span class="mw-headline">Solution</span></h2><p style="text-align: left;">You should only use supported SFP modules. Always check<span> the </span><a href="https://help.mikrotik.com/docs/display/ROS/MikroTik+wired+interface+compatibility" rel="nofollow">SFP compatibility table</a><span> </span>if you are intending to use SFP modules manufactured by MikroTik. There are other SFP modules that do work with MikroTik devices as well, check<span> the </span><a href="https://help.mikrotik.com/docs/display/ROS/Peripherals#Peripherals-SFPmodules" rel="nofollow">Supported peripherals table</a><span> </span>to find other SFP modules that have been confirmed to work with MikroTik devices. Some unsupported modules might not be working properly at certain speeds and with auto-negotiation, you might want to try to disable it and manually set a link speed.</p>
                    </div>

                                                            <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19136718/62390288.png">Switch_chip_block_diagram.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19136718/62390289.png">Lacp.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19136718/62390290.png">Vlan_on_bridge_in_bridge.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19136718/62390291.png">Bridged_vlans.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19136718/62390292.png">MTU.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19136718/62390293.png">Lacp_wlan.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19136718/62390294.png">Bandwidth_bad.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19136718/62390295.png">Bandwidth_good.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19136718/19136804.png">Switch_multiple_untagged.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19136718/19136805.png">Switch_multiple_untagged.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19136718/19136807.png">Switch_multiple_untagged.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19136718/19136803.png">Switch_multiple_untagged.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19136718/19136719.png">Switch_chip_block_diagram.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19136718/19136722.png">Lacp.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19136718/19136759.png">Vlan_on_bridge_in_bridge.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19136718/19136766.png">Bridged_vlans.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19136718/19136788.png">MTU.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19136718/19136794.png">Lacp_wlan.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19136718/19136799.png">Bandwidth_bad.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/19136718/19136800.png">Bandwidth_good.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on May 20, 2025 14:53</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
