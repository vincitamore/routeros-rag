<!DOCTYPE html>
<html>
    <head>
        <title>RouterOS : LDP</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">RouterOS</a></span>
                            </li>
                                                    <li>
                                <span><a href="RouterOS_328059.html">RouterOS</a></span>
                            </li>
                                                    <li>
                                <span><a href="Multi-Protocol-Label-Switching---MPLS_328082.html">Multi Protocol Label Switching - MPLS</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            RouterOS : LDP
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> Māris B.</span>, last updated on Apr 12, 2024
    
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><span> <style type='text/css'>/*<![CDATA[*/
div.rbtoc1747742029907 {padding: 0px;}
div.rbtoc1747742029907 ul {margin-left: 0px;}
div.rbtoc1747742029907 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1747742029907'>
<ul class='toc-indentation'>
<li><a href='#LDP-Overview'>Overview</a></li>
<li><a href='#LDP-PrerequisitesforMPLS'>Prerequisites for MPLS</a>
<ul class='toc-indentation'>
<li><a href='#LDP-&quot;Loopback&quot;IPaddress'>&quot;Loopback&quot; IP address</a></li>
<li><a href='#LDP-IPconnectivity'>IP connectivity</a></li>
</ul>
</li>
<li><a href='#LDP-ExampleSetup'>Example Setup</a>
<ul class='toc-indentation'>
<li><a href='#LDP-IpReachability'>Ip Reachability</a></li>
<li><a href='#LDP-LDPSetup'>LDP Setup</a></li>
</ul>
</li>
<li><a href='#LDP-UsingtracerouteinMPLSnetworks'>Using traceroute in MPLS networks</a>
<ul class='toc-indentation'>
<li><a href='#LDP-DrawbacksofusingtracerouteinMPLSnetwork'>Drawbacks of using traceroute in MPLS network</a>
<ul class='toc-indentation'>
<li><a href='#LDP-LabelswitchingICMPerrors'>Label switching ICMP errors</a></li>
<li><a href='#LDP-Penultimatehoppoppingandtraceroutesourceaddress'>Penultimate hop popping and traceroute source address</a></li>
</ul>
</li>
</ul>
</li>
<li><a href='#LDP-Optimizinglabeldistribution'>Optimizing label distribution</a>
<ul class='toc-indentation'>
<li><a href='#LDP-Labelbindingfiltering'>Label binding filtering</a></li>
</ul>
</li>
<li><a href='#LDP-LDPonIpv6andDual-Stacklinks'>LDP on Ipv6 and Dual-Stack links</a></li>
<li><a href='#LDP-PropertyReference'>Property Reference</a>
<ul class='toc-indentation'>
<li><a href='#LDP-LDPInstance'>LDP Instance</a></li>
<li><a href='#LDP-Interface'>Interface</a></li>
<li><a href='#LDP-Neighbors'>Neighbors</a></li>
<li><a href='#LDP-AcceptFilter'>Accept Filter</a></li>
<li><a href='#LDP-AdvertiseFilter'>Advertise Filter</a></li>
<li><a href='#LDP-LocalMapping'>Local Mapping</a></li>
<li><a href='#LDP-RemoteMapping'>Remote Mapping</a></li>
</ul>
</li>
</ul>
</div></span></p><h1 style="text-decoration: none;" id="LDP-Overview"><span class="mw-headline">Overview</span></h1><p><span class="mw-headline"><span><span style="text-decoration: none;color:var(--ds-text-accent-lime-bolder,#37471f);">MikroTik RouterOS implements Label Distribution Protocol (RFC 3036, RFC 5036, and RFC 7552) for IPv4 and IPv6 address families. LDP is a protocol that performs the set of procedures and exchange messages by which Label Switched Routers (LSRs) establish Label Switched Paths (LSPs) through a network by mapping network-layer routing information directly to data-link layer switched paths.</span></span></span></p><h1 style="text-decoration: none;" id="LDP-PrerequisitesforMPLS"><span class="mw-headline">Prerequisites for MPLS</span></h1><h2 style="text-decoration: none;" id="LDP-&quot;Loopback&quot;IPaddress"><span class="mw-headline">&quot;Loopback&quot; IP address</span></h2><p>Although not a strict requirement, it is advisable to configure routers participating in the MPLS network with &quot;loopback&quot; IP addresses (not attached to any real network interface) to be used by LDP to establish sessions.</p><p>This serves 2 purposes:</p><ul style="text-decoration: none;"><li>as there is only one LDP session between any 2 routers, no matter how many links connect them, the loopback IP address ensures that the LDP session is not affected by interface state or address changes</li><li>use of loopback address as LDP transport address ensures proper penultimate hop popping behavior when multiple labels are attached to the packet as in the case of VPLS</li></ul><p>In RouterOS &quot;loopback&quot; IP address can be configured by creating a dummy bridge interface without any ports and adding the address to it. For example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge add name=lo
/ip address add address=255.255.255.1/32 interface=lo</pre>
</div></div><p><br/></p><p><br/></p><h2 style="text-decoration: none;" id="LDP-IPconnectivity"><span class="mw-headline">IP connectivity</span></h2><p>As LDP distributes labels for active routes, the essential requirement is properly configured IP routing. LDP by default distributes labels for active IGP routes (that is - connected, static, and routing protocol learned routes, except BGP).</p><p>For instructions on how to set up properly IGP refer to appropriate documentation sections:</p><ul><li><a href="OSPF_9863229.html">OSPF</a></li><li><a href="IP-Routing_328084.html">Static Routing</a></li><li>etc</li></ul><p>LDP supports ECMP routes.</p><p>You should be able to reach any loopback address from any location of your network before continuing with the LDP configuration. Connectivity can be verified with the ping tool running from loopback address to loopback address.</p><h1 id="LDP-ExampleSetup">Example Setup</h1><p>Let's consider that we have already existing four routers setup, with working IP connectivity.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">   (lo:111.111.111.1)       (lo:111.111.111.2)          (lo:111.111.111.3)         (lo:111.111.111.4)
|---------R1-----(111.11.0.0/24)-----R2-----(111.12.0.0/24)-----R3-----(111.13.0.0/24)-----R4---------|</pre>
</div></div><p><br/></p><h2 id="LDP-IpReachability">Ip Reachability</h2><p>Not going deep into routing setup here is the quit export of the IP and OSPF configurations:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">#R1
/interface bridge
add name=loopback
/ip address
add address=111.11.0.1/24 interface=ether2
add address=111.111.111.1 interface=loopback

/routing ospf instance
add name=default_ip4 router-id=111.111.111.1
/routing ospf area
add instance=default_ip4 name=backbone_ip4
/routing ospf interface-template
add area=backbone_ip4 dead-interval=10s hello-interval=1s networks=111.111.111.1 
add area=backbone_ip4 dead-interval=10s hello-interval=1s networks=111.11.0.0/24 


#R2
/interface bridge
add name=loopback
/ip address
add address=111.11.0.2/24 interface=ether2
add address=111.12.0.1/24 interface=ether3
add address=111.111.111.2 interface=loopback

/routing ospf instance
add name=default_ip4 router-id=111.111.111.2
/routing ospf area
add instance=default_ip4 name=backbone_ip4
/routing ospf interface-template
add area=backbone_ip4 dead-interval=10s hello-interval=1s networks=111.111.111.2
add area=backbone_ip4 dead-interval=10s hello-interval=1s networks=111.11.0.0/24
add area=backbone_ip4 dead-interval=10s hello-interval=1s networks=111.12.0.0/24


#R3
/interface bridge
add name=loopback

/ip address
add address=111.12.0.2/24 interface=ether2
add address=111.13.0.1/24 interface=ether3
add address=111.111.111.3 interface=loopback

/routing ospf instance
add name=default_ip4 router-id=111.111.111.3
/routing ospf area
add instance=default_ip4 name=backbone_ip4
/routing ospf interface-template
add area=backbone_ip4 dead-interval=10s hello-interval=1s networks=111.111.111.3
add area=backbone_ip4 dead-interval=10s hello-interval=1s networks=111.12.0.0/24
add area=backbone_ip4 dead-interval=10s hello-interval=1s networks=111.13.0.0/24


#R4
/interface bridge
add name=loopback
/ip address
add address=111.13.0.2/24 interface=ether2
add address=111.111.111.4 interface=loopback

/routing ospf instance
add name=default_ip4 router-id=111.111.111.4
/routing ospf area
add instance=default_ip4 name=backbone_ip4
/routing ospf interface-template
add area=backbone_ip4 dead-interval=10s hello-interval=1s networks=111.111.111.4
add area=backbone_ip4 dead-interval=10s hello-interval=1s networks=111.13.0.0/24

</pre>
</div></div><p><br/></p><p>Verify that IP connectivity and routing are working properly</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false">[admin@R4] /ip/address&gt; /tool traceroute 111.111.111.1 src-address=111.111.111.4
Columns: ADDRESS, LOSS, SENT, LAST, AVG, BEST, WORST, STD-DEV
#  ADDRESS        LOSS  SENT  LAST   AVG  BEST  WORST  STD-DEV
1  111.13.0.1     0%       4  0.6ms  0.6  0.6   0.6    0      
2  111.12.0.1     0%       4  0.5ms  0.6  0.5   0.6    0.1    
3  111.111.111.1  0%       4  0.6ms  0.6  0.6   0.6    0      

</pre>
</div></div><p><br/></p><h2 id="LDP-LDPSetup">LDP Setup</h2><p>In order to start distributing labels, LDP is enabled on interfaces that connect other LDP routers and not enabled on interfaces that connect customer networks.</p><p>On R1 it will look like this:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/mpls ldp
add afi=ip lsr-id=111.111.111.1 transport-addresses=111.111.111.1
/mpls ldp interface
add interface=ether2    

</pre>
</div></div><div role="region" aria-label="Info" class="confluence-information-macro  confluence-information-macro-information" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-info-filled confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Note that the transport address gets set to 111.111.111.1. This makes the router originate LDP session connections with this address and also advertise this address as a transport address to LDP neighbors.</p></div></div><p><br/></p><p>Other routers are set up similarly.</p><p>R2:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/mpls ldp
add afi=ip lsr-id=111.111.111.2 transport-addresses=111.111.111.2
/mpls ldp interface
add interface=ether2   
add interface=ether3   

</pre>
</div></div><p>On R3:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/mpls ldp
add afi=ip lsr-id=111.111.111.3 transport-addresses=111.111.111.3
/mpls ldp interface
add interface=ether2   
add interface=ether3   

</pre>
</div></div><p>On R4:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/mpls ldp
add afi=ip lsr-id=111.111.111.4 transport-addresses=111.111.111.4
/mpls ldp interface
add interface=ether2   

</pre>
</div></div><p><br/></p><p><br/></p><p>After LDP sessions are established, R2 should have two LDP neighbors:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false">[admin@R2] /mpls/ldp/neighbor&gt; print 
Flags: D, I - INACTIVE; O, T - THROTTLED; p - PASSIVE
Columns: TRANSPORT, LOCAL-TRANSPORT, PEER, ADDRESSES
#     TRANSPORT      LOCAL-TRANSPORT  PEER             ADDRESSES    
0 DO  111.111.111.1  111.111.111.2    111.111.111.1:0  111.11.0.1   
                                                       111.111.111.1
1 DOp 111.111.111.3  111.111.111.2    111.111.111.3:0  111.12.0.2   
                                                       111.13.0.1   
                                                       111.111.111.3</pre>
</div></div><p><br/></p><p>The local mappings table shows what label is assigned to what route and peers the router have distributed labels to.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false">[admin@R2] /mpls/ldp/local-mapping&gt; print 
Flags: I - INACTIVE; D - DYNAMIC; E - EGRESS; G - GATEWAY; L - LOCAL
Columns: VRF, DST-ADDRESS, LABEL, PEERS
#       VRF   DST-ADDRESS      LABEL      PEERS          
0  D G  main  10.0.0.0/8       16         111.111.111.1:0
                                          111.111.111.3:0
1 IDE L main  10.155.130.0/25  impl-null  111.111.111.1:0
                                          111.111.111.3:0
2 IDE L main  111.11.0.0/24    impl-null  111.111.111.1:0
                                          111.111.111.3:0
3 IDE L main  111.12.0.0/24    impl-null  111.111.111.1:0
                                          111.111.111.3:0
4 IDE L main  111.111.111.2    impl-null  111.111.111.1:0
                                          111.111.111.3:0
5  D G  main  111.111.111.1    17         111.111.111.1:0
                                          111.111.111.3:0
6  D G  main  111.111.111.3    18         111.111.111.1:0
                                          111.111.111.3:0
7  D G  main  111.111.111.4    19         111.111.111.1:0
                                          111.111.111.3:0
8  D G  main  111.13.0.0/24    20         111.111.111.1:0
                                          111.111.111.3:0


</pre>
</div></div><p><br/></p><p style="margin-left: 20.0px;"><br/></p><p>Remote mappings table on the other hand shows labels that are allocated for routes by neighboring LDP routers and advertised to this router:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false">[admin@R2] /mpls/ldp/remote-mapping&gt; print 
Flags: I - INACTIVE; D - DYNAMIC
Columns: VRF, DST-ADDRESS, NEXTHOP, LABEL, PEER
 #    VRF   DST-ADDRESS      NEXTHOP     LABEL      PEER           
 0 ID main  10.0.0.0/8                   16         111.111.111.1:0
 1 ID main  10.155.130.0/25              impl-null  111.111.111.1:0
 2 ID main  111.11.0.0/24                impl-null  111.111.111.1:0
 3 ID main  111.12.0.0/24                17         111.111.111.1:0
 4  D main  111.111.111.1    111.11.0.1  impl-null  111.111.111.1:0
 5 ID main  111.111.111.2                19         111.111.111.1:0
 6 ID main  111.111.111.3                20         111.111.111.1:0
 7 ID main  111.111.111.4                21         111.111.111.1:0
 8 ID main  111.13.0.0/24                18         111.111.111.1:0
 9 ID main  0.0.0.0/0                    impl-null  111.111.111.3:0
10 ID main  111.111.111.2                16         111.111.111.3:0
11 ID main  111.111.111.1                18         111.111.111.3:0
12  D main  111.111.111.3    111.12.0.2  impl-null  111.111.111.3:0
13  D main  111.111.111.4    111.12.0.2  19         111.111.111.3:0
14 ID main  10.155.130.0/25              impl-null  111.111.111.3:0
15 ID main  111.11.0.0/24                17         111.111.111.3:0
16 ID main  111.12.0.0/24                impl-null  111.111.111.3:0
17  D main  111.13.0.0/24    111.12.0.2  impl-null  111.111.111.3:0

</pre>
</div></div><p><br/></p><p>We can observe that router has received label bindings for all routes from both its neighbors - R1 and R3.</p><p>The remote mapping table will have active mappings only for the destinations that have direct next-hop, for example, let's take a closer look at 111.111.111.4 mappings. The routing table indicates that the network 111.111.111.4 is reachable via 111.12.0.2 (R3):</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false">[admin@R2] /ip/route&gt; print where dst-address=111.111.111.4
Flags: D - DYNAMIC; A - ACTIVE; o, y - COPY
Columns: DST-ADDRESS, GATEWAY, DISTANCE
    DST-ADDRESS       GATEWAY            DISTANCE
DAo 111.111.111.4/32  111.12.0.2%ether3       110</pre>
</div></div><p>And if we look again at the remote mapping table, the only active mapping is the one received from R3 with assigned label 19. This implies that when R2 when routing traffic to this network, will impose label 19.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false">17  D main  111.111.111.4    111.12.0.2  19         111.111.111.3:0</pre>
</div></div><p><br/></p><p><br/></p><p>Label switching rules can be seen in the forwarding table:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false">[admin@R2] /mpls/forwarding-table&gt; print 
Flags: L, V - VPLS
Columns: LABEL, VRF, PREFIX, NEXTHOPS
#   LABEL  VRF   PREFIX         NEXTHOPS                                            
0 L    16  main  10.0.0.0/8     { nh=10.155.130.1; interface=ether1 }               
1 L    18  main  111.111.111.3  { label=impl-null; nh=111.12.0.2; interface=ether3 }
2 L    19  main  111.111.111.4  { label=19; nh=111.12.0.2; interface=ether3 }       
3 L    20  main  111.13.0.0/24  { label=impl-null; nh=111.12.0.2; interface=ether3 }
4 L    17  main  111.111.111.1  { label=impl-null; nh=111.11.0.1; interface=ether2 }</pre>
</div></div><p>If we take a look at rule number 2, the rule says that when R2 received the packet with label 19, it will change the label to new label 19 (assigned by the R3).</p><p>As you can see from this example it is not mandatory that labels along the path should be unique.</p><p><br/></p><p>Now if we look at the forwarding table of R3:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false">[admin@R3] /mpls/forwarding-table&gt; print 
Flags: L, V - VPLS
Columns: LABEL, VRF, PREFIX, NEXTHOPS
#   LA  VRF   PREFIX         NEXTHOPS                                            
0 L 19  main  111.111.111.4  { label=impl-null; nh=111.13.0.2; interface=ether3 }
1 L 17  main  111.11.0.0/24  { label=impl-null; nh=111.12.0.1; interface=ether2 }
2 L 16  main  111.111.111.2  { label=impl-null; nh=111.12.0.1; interface=ether2 }
3 L 18  main  111.111.111.1  { label=17; nh=111.12.0.1; interface=ether2 } </pre>
</div></div><p>Rule number 0, shows that the out label is &quot;<strong>impl-null</strong>&quot;. The reason for this is that R3 is the last hop before 111.111.111.4 will be reachable and there is no need to swap to any real label. It is known that R4 is the egress point for the 111.111.111.4 network (router is the egress point for directly connected networks because the next hop for traffic is not MPLS router), therefore it advertises the &quot;implicit null&quot; label for this route. This tells R3 to forward traffic for the destination 111.111.111.4/32 to R4 unlabelled, which is exactly what R3 forwarding table entry tells.</p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Action, when the label is not swapped to any real label, is called <strong>Penultimate hop popping,</strong> it ensures that routers do not have to do unnecessary label lookup when it is known in advance that the router will have to route the packet.</p></div></div><p><br/></p><h1 style="text-decoration: none;" id="LDP-UsingtracerouteinMPLSnetworks"><span class="mw-headline">Using traceroute in MPLS networks</span></h1><p>RFC4950 introduces extensions to the ICMP protocol for MPLS. The basic idea is that some ICMP messages may carry an MPLS &quot;label stack object&quot; (a list of labels that were on the packet when it caused a particular ICMP message). ICMP messages of interest for MPLS are Time Exceeded and Need Fragment.</p><p>MPLS label carries not only label value, but also TTL field. When imposing a label on an IP packet, MPLS TTL is set to value in the IP header, when the last label is removed from the IP packet, IP TTL is set to value in MPLS TTL. Therefore MPLS switching network can be diagnosed by means of a traceroute tool that supports MPLS extension.</p><p>For example, the traceroute from R4 to R1 looks like this:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false">[admin@R1] /mpls/ldp/neighbor&gt; /tool traceroute 111.111.111.4 src-address=111.111.111.1
Columns: ADDRESS, LOSS, SENT, LAST, AVG, BEST, WORST, STD-DEV, STATUS
#  ADDRESS        LOSS  SENT  LAST   AVG  BEST  WORST  STD-DEV  STATUS         
1  111.11.0.2     0%       2  0.7ms  0.7  0.7   0.7          0  &lt;MPLS:L=19,E=0&gt;
2  111.12.0.2     0%       2  0.4ms  0.4  0.4   0.4          0  &lt;MPLS:L=19,E=0&gt;
3  111.111.111.4  0%       2  0.5ms  0.5  0.5   0.5          0 </pre>
</div></div><p style="margin-left: 20.0px;"><br/></p><p>Traceroute results show MPLS labels on the packet when it produced ICMP Time Exceeded. The above means: that when R3 received a packet with MPLS TTL 1, it had label 18 on it. This match advertised label by R3 for 111.111.111.4. In the same way, R2 observed label 17 on the packet on the next traceroute iteration - R3 switched label 17 to label 17, as explained above. R1 received packet without labels - R2 did penultimate hop popping as explained above.</p><p><br/></p><h2 style="text-decoration: none;" id="LDP-DrawbacksofusingtracerouteinMPLSnetwork"><span class="mw-headline">Drawbacks of using traceroute in MPLS network</span></h2><h3 style="text-decoration: none;" id="LDP-LabelswitchingICMPerrors"><span class="mw-headline">Label switching ICMP errors</span></h3><p>One of the drawbacks of using traceroute in MPLS networks is the way MPLS handles produced ICMP errors. In IP networks ICMP errors are simply routed back to the source of the packet that caused the error. In an MPLS network, it is possible that a router that produces an error message does not even have a route to the source of the IP packet (for example in the case of asymmetric label switching paths or some kind of MPLS tunneling, e.g. to transport MPLS VPN traffic).</p><p>Due to this produced ICMP errors are not routed to the source of the packet that caused the error but switched further along the label switching path, assuming that when the label switching path endpoint will receive an ICMP error, it will know how to properly route it back to the source.</p><p>This causes the situation, that traceroute in MPLS network can not be used the same way as in IP network - to determine failure point in the network. If the label switched path is broken anywhere in the middle, no ICMP replies will come back, because they will not make it to the far endpoint of the label switching path.</p><h3 style="text-decoration: none;" id="LDP-Penultimatehoppoppingandtraceroutesourceaddress"><span class="mw-headline">Penultimate hop popping and traceroute source address</span></h3><p>A thorough understanding of penultimate hop behavior and routing is necessary to understand and avoid problems that penultimate hop popping causes to traceroute.</p><p>In the example setup, a regular traceroute from R5 to R1 would yield the following results:</p><pre style="margin-left: 20.0px;">[admin@R5] &gt; /tool traceroute 9.9.9.1
     ADDRESS                                    STATUS
   1         0.0.0.0 timeout timeout timeout
   2         2.2.2.2 37ms 4ms 4ms
                      mpls-label=17
   3         9.9.9.1 4ms 2ms 11ms
</pre><p>compared to:</p><pre style="margin-left: 20.0px;">[admin@R5] &gt; /tool traceroute 9.9.9.1 src-address=9.9.9.5
     ADDRESS                                    STATUS
   1         4.4.4.3 15ms 5ms 5ms
                      mpls-label=17
   2         2.2.2.2 5ms 3ms 6ms
                      mpls-label=17
   3         9.9.9.1 6ms 3ms 3ms
</pre><p>The reason why the first traceroute does not get a response from R3 is that by default traceroute on R5 uses source address 4.4.4.5 for its probes because it is the preferred source for a route over which next-hop to 9.9.9.1/32 is reachable:</p><pre style="margin-left: 20.0px;">[admin@R5] &gt; /ip route print
Flags: X - disabled, A - active, D - dynamic,
C - connect, S - static, r - rip, b - bgp, o - ospf, m - mme,
B - blackhole, U - unreachable, P - prohibit
 #      DST-ADDRESS        PREF-SRC        G GATEWAY         DISTANCE             INTERFACE
 ...
 3 ADC  4.4.4.0/24         4.4.4.5                           0                    ether1
 ...
 5 ADo  9.9.9.1/32                         r 4.4.4.3         110                  ether1
 ...
</pre><p>When the first traceroute probe is transmitted (source: 4.4.4.5, destination 9.9.9.1), R3 drops it and produces an ICMP error message (source 4.4.4.3 destination 4.4.4.5) that is switched all the way to R1. R1 then sends ICMP error back - it gets switched along the label switching path to 4.4.4.5.</p><p>R2 is the penultimate hop popping router for network 4.4.4.0/24 because 4.4.4.0/24 is directly connected to R3. Therefore R2 removes the last label and sends ICMP error to R3 unlabelled:</p><pre style="margin-left: 20.0px;">[admin@R2] &gt; /mpls forwarding-table print
 # IN-LABEL             OUT-LABELS           DESTINATION        INTERFACE            NEXTHOP
 ...
 3 19                                        4.4.4.0/24         ether2               2.2.2.3
 ...
</pre><p>R3 drops the received IP packet because it receives a packet with its own address as a source address. ICMP errors produced by following probes come back correctly because R3 receives unlabelled packets with source addresses 2.2.2.2 and 9.9.9.1, which are acceptable to a route.</p><p>Command:</p><pre style="margin-left: 20.0px;">[admin@R5] &gt; /tool traceroute 9.9.9.1 src-address=9.9.9.5
 ...
</pre><p>produces expected results, because the source address of traceroute probes is 9.9.9.5. When ICMP errors are traveling back from R1 to R5, the penultimate hop popping for the 9.9.9.5/32 network happens at R3, therefore it never gets to route packet with its own address as a source address.</p><h1 style="text-decoration: none;" id="LDP-Optimizinglabeldistribution"><span class="mw-headline">Optimizing label distribution</span></h1><h2 style="text-decoration: none;" id="LDP-Labelbindingfiltering"><span class="mw-headline">Label binding filtering</span></h2><p>During the implementation of the given example setup, it has become clear that not all label bindings are necessary. For example, there is no need to exchange IP route label bindings between R1 and R3 or R2 and R4, as there is no chance they will ever be used. Also, if the given network core is providing connectivity only for mentioned customer ethernet segments, there is no real use to distribute labels for networks that connect routers between themselves, the only routes that matter are /32 routes to endpoints or attached customer networks.</p><p>Label binding filtering can be used to distribute only specified sets of labels to reduce resource usage and network load.</p><p>There are 2 types of label binding filters:</p><ul style="text-decoration: none;"><li>which label bindings should be advertised to LDP neighbors, configured in the <span style="color:var(--ds-text-accent-blue,#0055cc);"><code>/mpls ldp advertise-filter </code></span>menu</li><li>which label bindings should be accepted from LDP neighbors, configured in <span style="color:var(--ds-text-accent-blue,#0055cc);"><code>/mpls ldp accept-filter </code></span>menu</li></ul><p>Filters are organized in the ordered list, specifying prefixes that must include the prefix that is tested against the filter and neighbor (or wildcard).</p><p>In the given example setup all routers can be configured so that they advertise labels only for routes that allow reaching the endpoints of tunnels. For this 2 advertise filters need to be configured on all routers:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/mpls ldp advertise-filter add prefix=111.111.111.0/24 advertise=yes
/mpls ldp advertise-filter add prefix=0.0.0.0/0 advertise=no</pre>
</div></div><p style="margin-left: 20.0px;"><br/></p><p style="margin-left: 20.0px;"><br/></p><p>This filter causes routers to advertise only bindings for routes that are included by the 111.111.111.0/24 prefix which covers loopbacks (111.111.111.1/32, 111.111.111.2/32, etc). The second rule is necessary because the default filter results when no rule matches are to allow the action in question.</p><p>In the given setup there is no need to set up accept filter because by convention introduced by 2 abovementioned rules no LDP router will distribute unnecessary bindings.</p><p>Note that filter changes do not affect existing mappings, so to take the filter into effect, connections between neighbors need to be reset. either by removing neighbors from the LDP neighbor table or by restarting the LDP instance.</p><p>So on R2, for example, we get:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false">[admin@R2] /mpls/ldp/remote-mapping&gt; print 
Flags: I - INACTIVE; D - DYNAMIC
Columns: VRF, DST-ADDRESS, NEXTHOP, LABEL, PEER
#    VRF   DST-ADDRESS    NEXTHOP     LABEL      PEER           
0 ID main  111.111.111.2              17         111.111.111.3:0
1 ID main  111.111.111.1              16         111.111.111.3:0
2  D main  111.111.111.3  111.12.0.2  impl-null  111.111.111.3:0
3  D main  111.111.111.4  111.12.0.2  18         111.111.111.3:0
4 ID main  111.111.111.2              16         111.111.111.1:0
5  D main  111.111.111.1  111.11.0.1  impl-null  111.111.111.1:0
6 ID main  111.111.111.3              17         111.111.111.1:0
7 ID main  111.111.111.4              18         111.111.111.1:0</pre>
</div></div><p><br/></p><h1 id="LDP-LDPonIpv6andDual-Stacklinks">LDP on Ipv6 and Dual-Stack links</h1><p>RouterOS implements RFC 7552 to support LDP on dual-stack links.</p><p>Supported AFIs can be selected by LDP instance, as well as explicitly configured per LDP interface.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/mpls ldp
add afi=ip,ipv6 lsr-id=111.111.111.1 preferred-afi=ipv6
/mpls ldp interface
add interface=ether2 afi=ip
add interface=ether3 afi=ipv6</pre>
</div></div><p>The example above enables LDP instance to use IPv4 and IPv6 address families and sets the preference to IPv6 with <span style="color:var(--ds-text-accent-green,#216e4e);"><code>preferred-afi </code></span>parameter. LDP interface configuration on the other hand explicitly sets that <strong>ether2</strong> supports only IPv4 and <strong>ether3</strong> supports only IPv6.</p><p><br/></p><p style="text-align: left;">The main question occurs how AFI is selected when there are a mix of different AFIs and what if one of the supported AFIs flaps. </p><p style="text-align: left;">The logic behind sending hellos is as follows:</p><ul><li style="text-align: left;">if an interface has only one AFI:<ul><li style="text-align: left;">dual-stack element is not sent</li><li style="text-align: left;">sends hello only if there is an IP address on the interface from the corresponding AFI.</li></ul></li><li style="text-align: left;">If an interface has both AFIs:<ul><li style="text-align: left;">dual-stack element is always sent and contains the value from preferred-afi</li><li style="text-align: left;">sends hellos on each AFI if a corresponding address is present on the interface.</li></ul></li></ul><p><br/></p><p>From all received hellos peer determines which AFI to use for connection and for which AFIs to bind and send labels. For LDP to be able to use a specific AFI, receiving hello for that specific AFI is mandatory. Hello packet contains the transport address necessary for proper LDP operation. By comparing received AFI addresses, is determined active/passive role.</p><p>The logic behind receiving and processing hellos is as follows:</p><ul><li>if the LDP instance has only one AFI (it means that all interfaces can have only that specific AFI operational):<ul><li>drop hellos from not supported AFI</li><li>ignore/forget the dual-stack element for the hello packet</li><li>the role is determined only for this one specific AFI</li><li>labels are sent only for this one specific AFI</li></ul></li><li>if the LDP instance has both AFIs (interfaces can have different combinations of supported AFIs):<ul><li>drop hellos from AFI that are not configured as supported on the interface.</li><li>ignore/forget the dual-stack element (preference is not taken into account) for hello packets, if an interface has only one supported AFI.</li><li>drop hello if received preference in dual-stack element does not match configured <span style="color:var(--ds-text-accent-green,#216e4e);"><code>preferred-afi</code></span>.</li></ul></li></ul><p><br/></p><p>If there are changes in hello packets, the existing session is terminated only in case if address family used by labels is changed, otherwise, the session is preserved.</p><p>Dual-stack element in hello packets is set only if an interface is determined to be dual-stack compatible:</p><ul><li>Normally such an interface should be able to receive hellos from both AFIs,<ul><li>Before proceeding LDP should wait for hello from the preferred AFI.</li><li>if hello is received only from one AFI:<ul><li>if hello from preferred AFI is not received then it is considered an error. </li><li>otherwise, wait for missing hello for x seconds (x = 3 * hello-interval)<ul><li>if missing hello appears within a time interval consider peer to be dual-stack</li><li>if missing hello did not appear, then consider peer to be single-stack</li><li>if missing hello appeared after the time interval then restart the session.</li></ul></li></ul></li></ul></li><li>the dual-stack element indicates that LDP wants to distribute labels for both AFIs.</li></ul><p style="text-align: left;">In summary, the following combinations of AFIs and dual-stack element (ds6) are possible assuming that preferred-afi=ipv6:</p><ol><li style="text-align: left;">ipv4 - wait X seconds, if no changes, then use the IPv4 LDP session and distribute IPv4 labels</li><li style="text-align: left;">ipv4+ds6 - wait for IPv6 hello, dual-stack element indicates that there should be IPv6</li><li style="text-align: left;">ipv6 - wait X seconds, if no changes, then use the IPv6 LDP session and distribute IPv6 labels</li><li style="text-align: left;">ipv6+ds6 - use IPv6 LDP session and distribute IPv6 labels</li><li style="text-align: left;">ipv4,ipv6 - use IPv6 LDP session and distribute IPv4 and IPv6 labels</li><li>ipv4,ipv6+ds6 - use IPv6 LDP session and distribute IPv4 and IPv6 labels</li></ol><h1 id="LDP-PropertyReference">Property Reference</h1><h2 id="LDP-LDPInstance"><span>LDP Instance</span></h2><p><br/></p><p><strong>Sub-menu:</strong><span> </span><span style="color:var(--ds-text-accent-blue,#0055cc);"><code>/mpls</code></span></p><p><strong>Properties</strong></p><div class="table-wrap"><table class="wrapped confluenceTable" style="margin-left: 14.4318px;"><colgroup><col/><col/></colgroup><tbody><tr><th class="highlight-#deebff confluenceTh" data-highlight-colour="#deebff" title="Background colour : Light blue 35%">Property</th><th class="highlight-#deebff confluenceTh" data-highlight-colour="#deebff" title="Background colour : Light blue 35%">Description</th></tr><tr><td class="confluenceTd"><strong>afi<span> </span>(</strong><em>ip | ipv6</em><strong>; </strong>Default: <strong>)</strong></td><td class="confluenceTd">Determines supported address families by the instance.</td></tr><tr><td class="confluenceTd"><strong>comments</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">Short description of the entry</td></tr><tr><td class="confluenceTd"><strong>disabled</strong><span> </span>(<em>yes | no</em>; Default:<span> </span><strong>no</strong>)</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd"><strong>distribute-for-default </strong>(<em>yes | no</em>; Default:<span> </span>no)</td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text-accent-lime-bolder,#37471f);">Defines whether to map label for the default route.</span></td></tr><tr><td class="confluenceTd"><strong>hop-limit</strong><span> </span>(<em>integer[0..255]</em>; Default: )</td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text-accent-lime-bolder,#37471f);">Max hop limit used for loop detection. Works in combination with the </span><span style="color:var(--ds-text-accent-green,#216e4e);"><strong style="text-decoration: none;">loop-detect</strong></span><span style="text-decoration: none;color:var(--ds-text-accent-lime-bolder,#37471f);"><span style="color:var(--ds-text-accent-green,#216e4e);"> </span>property.</span></td></tr><tr><td class="confluenceTd"><strong>loop-detect</strong><span> </span>(<em>yes | no</em>; Default: )</td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text-accent-lime-bolder,#37471f);">Defines whether to run LSP loop detection. Will not work correctly if not enabled on all LSRs. Should be used only on non-TTL networks such as ATMs.</span></td></tr><tr><td class="confluenceTd"><strong>lsr-id </strong>(<em>IP</em>; Default: )</td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text-accent-lime-bolder,#37471f);">Unique label switching router's ID.</span></td></tr><tr><td class="confluenceTd"><strong>path-vector-limit </strong>(<em>IP</em>; Default: )</td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text-accent-lime-bolder,#37471f);">Max path vector limit used for loop detection. Works in combination with the </span><span style="color:var(--ds-text-accent-green,#216e4e);"><strong style="text-decoration: none;">loop-detect</strong></span><span style="text-decoration: none;color:var(--ds-text-accent-lime-bolder,#37471f);"><span style="color:var(--ds-text-accent-green,#216e4e);"> </span>property.</span></td></tr><tr><td class="confluenceTd"><strong>preferred-afi </strong>(ip | ipv6; Default: <strong>ipv6</strong>)</td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text-accent-lime-bolder,#37471f);">Determining which address family connection is preferred. Value is also set in dual-stack element (if used).</span></td></tr><tr><td class="confluenceTd"><strong>transport-addresses </strong>(<em>IP</em>; Default: )</td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text-accent-lime-bolder,#37471f);">Specifies LDP session connections origin addresses and also advertises these addresses as transport addresses to LDP neighbors.</span></td></tr><tr><td class="confluenceTd"><strong>use-explicit-null </strong>(<em>yes | no</em>; Default:<span> </span>no)</td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text-accent-lime-bolder,#37471f);">Whether to distribute explicit-null label bindings.</span></td></tr><tr><td class="confluenceTd"><strong>vrf<span> </span>(</strong><em>name</em>; Default: main<strong>)</strong></td><td class="confluenceTd">Name of the VRF table this instance will operate on.</td></tr></tbody></table></div><h2 id="LDP-Interface"><span>Interface</span></h2><p><strong>Sub-menu:</strong><span> </span><span style="color:var(--ds-text-accent-blue,#0055cc);"><code>/mpls ldp interface</code></span></p><p><br/></p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th class="highlight-#deebff confluenceTh" data-highlight-colour="#deebff">Property</th><th class="highlight-#deebff confluenceTh" data-highlight-colour="#deebff">Description</th></tr><tr><td class="confluenceTd"><strong>afi<span> </span>(</strong><em>ip | ipv6</em><strong>; </strong>Default: <strong>)</strong></td><td class="confluenceTd">Determines interface address family. Only AFIs that are configured as supported by the instance is taken into account. If the value is not explicitly specified then it is considered to be equal to the instance-supported AFIs.</td></tr><tr><td class="confluenceTd"><strong>accept-dynamic-neighbors </strong>(<em>yes | no</em>; Default:)</td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text-accent-lime-bolder,#37471f);">Defines whether to discover neighbors dynamically or use only statically configured in </span><a href="#LDP-Neighbors">LDP neighbors menu</a></td></tr><tr><td class="confluenceTd"><strong>comments</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">Short description of the entry</td></tr><tr><td class="confluenceTd"><strong>disabled</strong><span> </span>(<em>yes | no</em>; Default:<span> </span><strong>no</strong>)</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd"><strong>hello-interval<span> </span></strong>(<em>string</em>; Default: )</td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text-accent-lime-bolder,#37471f);">The interval between hello packets that the router sends out on specified interface/s. The default value is 5s.</span></td></tr><tr><td class="confluenceTd"><strong>hold-time<span> </span></strong>(<em>string</em>; Default: )</td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text-accent-lime-bolder,#37471f);">Specifies the interval after which a neighbor discovered on the interface is declared as not reachable. The default value is 15s.</span></td></tr><tr><td class="confluenceTd"><strong>interface<span> </span></strong>(<em>string</em>; Default: )</td><td class="confluenceTd">Name of the interface or interface list where LDP will be listening.</td></tr><tr><td class="confluenceTd"><strong>transport-addresses<span> </span></strong>(List of <em>IPs</em>; Default: )</td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text-accent-lime-bolder,#37471f);">Used transport addresses if differs from LDP Instance settings.</span></td></tr></tbody></table></div><p><br/></p><h2 id="LDP-Neighbors"><span>Neighbors</span></h2><p><strong>Sub-menu:</strong><span> </span><span style="color:var(--ds-text-accent-blue,#0055cc);"><code>/mpls ldp neighbor</code></span></p><p>List of discovered and statically configured LDP neighbors.</p><p><strong>Properties</strong></p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 66.64388%;"><colgroup><col style="width: 28.102564%;"/><col style="width: 71.79487%;"/></colgroup><tbody><tr><th class="highlight-#deebff confluenceTh" data-highlight-colour="#deebff">Property</th><th class="highlight-#deebff confluenceTh" data-highlight-colour="#deebff">Description</th></tr><tr><td class="confluenceTd"><strong>comments</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">Short description of the entry</td></tr><tr><td class="confluenceTd"><strong>disabled</strong><span> </span>(<em>yes | no</em>; Default:<span> </span><strong>no</strong>)</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd"><strong>send-targeted<span> </span></strong>(<em>yes | no</em>; Default: )</td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text-accent-lime-bolder,#37471f);">Specifies whether to try to send targeted hellos, used for targeted (not directly connected) LDP sessions.</span></td></tr><tr><td class="confluenceTd"><strong>transport<span> </span></strong>(<em>IP</em>; Default: )</td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text-accent-lime-bolder,#37471f);">Remote transport address.</span></td></tr></tbody></table></div><p><br/></p><p><strong>Read-only Properties</strong></p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 51.8797%;"><colgroup><col style="width: 36.363636%;"/><col style="width: 63.504612%;"/></colgroup><tbody><tr><th class="highlight-#deebff confluenceTh" data-highlight-colour="#deebff">Property</th><th class="highlight-#deebff confluenceTh" data-highlight-colour="#deebff">Description</th></tr><tr><td class="confluenceTd"><strong>active-connect</strong><span> </span>(<em>yes | no</em>)</td><td class="confluenceTd">Indicates that active role have been selected and the router is trying to establish the session.</td></tr><tr><td class="confluenceTd"><strong>addresses</strong><span> </span>(<em>list of IPs</em>)</td><td class="confluenceTd">List of discovered addresses on the neighbor</td></tr><tr><td class="confluenceTd"><strong>inactive</strong><span> </span>(<em>yes | no</em>)</td><td class="confluenceTd">Whether binding is active and can be selected as a candidate for forwarding.</td></tr><tr><td class="confluenceTd"><strong>dynamic</strong><span> </span>(<em>yes | no</em>)</td><td class="confluenceTd">Whether entry was dynamically added</td></tr><tr><td class="confluenceTd"><strong>local-transport</strong><span> </span>(<em>IP</em>)</td><td class="confluenceTd">Selected local transport address.</td></tr><tr><td class="confluenceTd"><strong>on-demand</strong><span> </span>(<em>yes | no</em>)</td><td class="confluenceTd"><p class="newpage">Downstream On Demand label distribution</p></td></tr><tr><td class="confluenceTd"><strong>operational</strong><span> </span>(<em>yes | no</em>)</td><td class="confluenceTd">Indicates whether the peer is operational.</td></tr><tr><td class="confluenceTd"><strong>passive</strong><span> </span>(<em>yes | no</em>)</td><td class="confluenceTd">Indicates whether the peer is in a passive role.</td></tr><tr><td class="confluenceTd"><strong>passive-wait</strong><span> </span>(<em>yes | no</em>)</td><td class="confluenceTd">Indicates whether the peer is in a passive role and currently is waiting for the session to be initialized.</td></tr><tr><td class="confluenceTd"><strong>path-vector-limit</strong><span> </span>(<em>integer</em>)</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd"><strong>peer</strong><span> </span>(<em>IP:integer</em>)</td><td class="confluenceTd">LSR-ID and label space of the neighbor</td></tr><tr><td class="confluenceTd"><strong>sending-targeted-hello</strong>(<em>yes | no</em>)</td><td class="confluenceTd">Whether targeted hellos are being sent to the neighbor.</td></tr><tr><td class="confluenceTd"><strong>throttled</strong><span> </span>(<em>yes | no</em>)</td><td class="confluenceTd">Indicates whether session is in throttled state. Session is throttled after initialization failure, max throttle time 120s. </td></tr><tr><td class="confluenceTd"><strong>used-afi</strong><span> </span>(<em>yes | no</em>)</td><td class="confluenceTd">Used transport AFI</td></tr><tr><td class="confluenceTd"><strong>vpls</strong><span> </span>(<em>yes | no</em>)</td><td class="confluenceTd">Whether neighbor is used by VPLS tunnel</td></tr></tbody></table></div><h2 id="LDP-AcceptFilter"><span>Accept Filter</span></h2><p><strong>Sub-menu:</strong><span> </span><span style="color:var(--ds-text-accent-blue,#0055cc);"><code>/mpls ldp accept-filter</code></span></p><p><span style="text-decoration: none;color:var(--ds-text-accent-lime-bolder,#37471f);">List of label bindings that should be accepted from LDP neighbors.</span></p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 66.64388%;"><colgroup><col style="width: 28.102564%;"/><col style="width: 71.79487%;"/></colgroup><tbody><tr><th class="highlight-#deebff confluenceTh" data-highlight-colour="#deebff">Property</th><th class="highlight-#deebff confluenceTh" data-highlight-colour="#deebff">Description</th></tr><tr><td class="confluenceTd"><strong>accept</strong><span> </span>(<em>yes | no</em>; Default: <strong>no</strong>)</td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text-accent-lime-bolder,#37471f);">Whether to accept label bindings from the neighbors for the specified prefix.</span></td></tr><tr><td class="confluenceTd"><strong>comments</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">Short description of the entry</td></tr><tr><td class="confluenceTd"><strong>disabled</strong><span> </span>(<em>yes | no</em>; Default:<span> </span><strong>no</strong>)</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd"><strong>neighbor</strong>(<em>string</em>; Default: )</td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text-accent-lime-bolder,#37471f);">Neighbor to which this filter applies.</span></td></tr><tr><td class="confluenceTd"><strong>prefix<span> </span></strong>(<em>IP/mask</em>; Default: )</td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text-accent-lime-bolder,#37471f);">Prefix to match.</span></td></tr><tr><td class="confluenceTd"><strong>vrf<span> </span></strong>(name; Default: )</td><td class="confluenceTd"><br/></td></tr></tbody></table></div><p><br/></p><h2 id="LDP-AdvertiseFilter"><span>Advertise Filter</span></h2><p><strong>Sub-menu:</strong><span> </span><span style="color:var(--ds-text-accent-blue,#0055cc);"><code>/mpls ldp advertise-filter</code></span></p><p><span style="text-decoration: none;color:var(--ds-text-accent-lime-bolder,#37471f);">List of label bindings that should be advertised to LDP neighbors.</span></p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 66.64388%;"><colgroup><col style="width: 28.102564%;"/><col style="width: 71.79487%;"/></colgroup><tbody><tr><th class="highlight-#deebff confluenceTh" data-highlight-colour="#deebff">Property</th><th class="highlight-#deebff confluenceTh" data-highlight-colour="#deebff">Description</th></tr><tr><td class="confluenceTd"><strong>advertise</strong><span> </span>(<em>yes | no</em>; Default: <strong>no</strong> )</td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text-accent-lime-bolder,#37471f);">Whether to advertise label bindings to the neighbors for the specified prefix.</span></td></tr><tr><td class="confluenceTd"><strong>comments</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">Short description of the entry</td></tr><tr><td class="confluenceTd"><strong>disabled</strong><span> </span>(<em>yes | no</em>; Default:<span> </span><strong>no</strong>)</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd"><strong>neighbor</strong>(<em>string</em>; Default: )</td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text-accent-lime-bolder,#37471f);">Neighbor to which this filter applies.</span></td></tr><tr><td class="confluenceTd"><strong>prefix<span> </span></strong>(<em>IP/mask</em>; Default: )</td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text-accent-lime-bolder,#37471f);">Prefix to match.</span></td></tr><tr><td class="confluenceTd"><strong>vrf<span> </span></strong>(name; Default: )</td><td class="confluenceTd"><br/></td></tr></tbody></table></div><h2 id="LDP-LocalMapping"><span>Local Mapping</span></h2><p><strong>Sub-menu:</strong><span> </span><span style="color:var(--ds-text-accent-blue,#0055cc);"><code>/mpls local-mapping</code></span></p><p>This sub-menu shows labels bound to the routes locally in the router. In this menu also static mappings can be configured if there is no intention to use LDP dynamically.</p><p><br/><strong>Properties</strong></p><div class="table-wrap"><table class="wrapped relative-table confluenceTable" style="margin-left: 14.4318px;width: 41.01162%;"><colgroup><col style="width: 45.0%;"/><col style="width: 54.833332%;"/></colgroup><tbody><tr><th class="highlight-#deebff confluenceTh" data-highlight-colour="#deebff" title="Background colour : Light blue 35%">Property</th><th class="highlight-#deebff confluenceTh" data-highlight-colour="#deebff" title="Background colour : Light blue 35%">Description</th></tr><tr><td class="confluenceTd"><strong>comments</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">Short description of the entry</td></tr><tr><td class="confluenceTd"><strong>disabled</strong><span> </span>(<em>yes | no</em>; Default:<span> </span><strong>no</strong>)</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd"><strong>dst-address</strong><span> </span>(<em>IP/Mask</em>; Default: )</td><td class="confluenceTd">Destination prefix the label is assigned to.</td></tr><tr><td class="confluenceTd"><strong>label</strong><span> </span>(<em>integer[0..1048576] | alert | expl-null | expl-null6 | impl-null | none</em>; Default: )</td><td class="confluenceTd">Label number assigned to destination.</td></tr><tr><td class="confluenceTd"><strong>vrf<span> </span>(</strong><em>name</em>; Default: main<strong>)</strong></td><td class="confluenceTd">Name of the VRF table this mapping belongs to.</td></tr></tbody></table></div><p><br/><strong>Read-only Properties</strong></p><div class="table-wrap"><table class="wrapped relative-table confluenceTable" style="margin-left: 14.4318px;width: 53.041695%;"><colgroup><col style="width: 35.051548%;"/><col style="width: 64.81959%;"/></colgroup><tbody><tr><th class="highlight-#deebff confluenceTh" data-highlight-colour="#deebff" title="Background colour : Light blue 35%">Property</th><th class="highlight-#deebff confluenceTh" data-highlight-colour="#deebff" title="Background colour : Light blue 35%">Description</th></tr><tr><td class="confluenceTd"><strong>adv-path</strong><span> </span>()</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd"><strong>inactive</strong><span> </span>(<em>yes | no</em>)</td><td class="confluenceTd">Whether binding is active and can be selected as a candidate for forwarding.</td></tr><tr><td class="confluenceTd"><strong>dynamic</strong><span> </span>(<em>yes | no</em>)</td><td class="confluenceTd">Whether entry was dynamically added</td></tr><tr><td class="confluenceTd"><strong>egress</strong><span> </span>(<em>yes | no</em>)</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd"><strong>gateway</strong><span> </span>(<em>yes | no</em>)</td><td class="confluenceTd">Whether the destination is reachable through the gateway.</td></tr><tr><td class="confluenceTd"><strong>local</strong><span> </span>(<em>yes | no</em>)</td><td class="confluenceTd">Whether the destination is locally reachable on the router</td></tr><tr><td class="confluenceTd"><strong>peers</strong><span> </span>(<em>IP:label_space</em>)</td><td class="confluenceTd">IP address and label space of the peer to which this entry was advertised.</td></tr></tbody></table></div><h2 id="LDP-RemoteMapping"><span class="mw-headline">Remote Mapping</span></h2><p><strong>Sub-menu:</strong><span> </span><span style="color:var(--ds-text-accent-blue,#0055cc);"><code>/mpls remote-mapping</code></span></p><p>Sub-menu shows label bindings for routes received from other routers. Static mapping can be configured if there is no intention to use LDP dynamically. This table is used to build<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/Mpls+Overview#MplsOverview-ForwardingTable" rel="nofollow">Forwarding Table</a></p><p><strong>Properties</strong></p><div class="table-wrap"><table class="wrapped relative-table confluenceTable" style="margin-left: 14.4318px;width: 40.328094%;"><colgroup><col style="width: 46.440678%;"/><col style="width: 53.38983%;"/></colgroup><tbody><tr><th class="highlight-#deebff confluenceTh" data-highlight-colour="#deebff" title="Background colour : Light blue 35%">Property</th><th class="highlight-#deebff confluenceTh" data-highlight-colour="#deebff" title="Background colour : Light blue 35%">Description</th></tr><tr><td class="confluenceTd"><strong>comments</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">Short description of the entry</td></tr><tr><td class="confluenceTd"><strong>disabled</strong><span> </span>(<em>yes | no</em>; Default:<span> </span><strong>no</strong>)</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd"><strong>dst-address</strong><span> </span>(<em>IP/Mask</em>; Default: )</td><td class="confluenceTd">Destination prefix the label is assigned to.</td></tr><tr><td class="confluenceTd"><strong>label</strong><span> </span>(<em>integer[0..1048576] | alert | expl-null | expl-null6 | impl-null | none</em>; Default: )</td><td class="confluenceTd">Label number assigned to destination.</td></tr><tr><td class="confluenceTd"><strong>nexthop<span> </span>(</strong><em>IP</em>; Default:<strong>)</strong></td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd"><strong>vrf<span> </span>(</strong><em>name</em>; Default: main<strong>)</strong></td><td class="confluenceTd">Name of the VRF table this mapping belongs to.</td></tr></tbody></table></div><p><br/></p><p><strong>Read-only Properties</strong></p><div class="table-wrap"><table class="wrapped relative-table confluenceTable" style="margin-left: 14.4318px;width: 51.811348%;"><colgroup><col style="width: 36.279682%;"/><col style="width: 63.58839%;"/></colgroup><tbody><tr><th class="highlight-#deebff confluenceTh" data-highlight-colour="#deebff" title="Background colour : Light blue 35%">Property</th><th class="highlight-#deebff confluenceTh" data-highlight-colour="#deebff" title="Background colour : Light blue 35%">Description</th></tr><tr><td class="confluenceTd"><strong>inactive</strong><span> </span>(<em>yes | no</em>)</td><td class="confluenceTd">Whether binding is active and can be selected as a candidate for forwarding.</td></tr><tr><td class="confluenceTd"><strong>dynamic</strong><span> </span>(<em>yes | no</em>)</td><td class="confluenceTd">Whether entry was dynamically added</td></tr><tr><td class="confluenceTd"><strong>path</strong><span> </span>(<em>string</em>)</td><td class="confluenceTd"><br/></td></tr></tbody></table></div>
                    </div>

                                        
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on May 20, 2025 14:53</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
