<!DOCTYPE html>
<html>
    <head>
        <title>RouterOS : Switch Chip Features</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">RouterOS</a></span>
                            </li>
                                                    <li>
                                <span><a href="RouterOS_328059.html">RouterOS</a></span>
                            </li>
                                                    <li>
                                <span><a href="Bridging-and-Switching_328068.html">Bridging and Switching</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            RouterOS : Switch Chip Features
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> Edgars P.</span>, last updated on Mar 10, 2025
    
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><span class="mw-headline"><style type='text/css'>/*<![CDATA[*/
div.rbtoc1747742024479 {padding: 0px;}
div.rbtoc1747742024479 ul {margin-left: 0px;}
div.rbtoc1747742024479 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1747742024479'>
<ul class='toc-indentation'>
<li><a href='#SwitchChipFeatures-Introduction'>Introduction</a></li>
<li><a href='#SwitchChipFeatures-Features'>Features</a>
<ul class='toc-indentation'>
<li><a href='#SwitchChipFeatures-PortSwitching'>Port Switching</a>
<ul class='toc-indentation'>
<li><a href='#SwitchChipFeatures-SwitchAllPortsFeature'>Switch All Ports Feature</a></li>
</ul>
</li>
<li><a href='#SwitchChipFeatures-PortMirroring'>Port Mirroring</a></li>
<li><a href='#SwitchChipFeatures-PortSettings'>Port Settings</a></li>
<li><a href='#SwitchChipFeatures-VLANTable'>VLAN Table</a></li>
<li><a href='#SwitchChipFeatures-HostTable'>Host Table</a></li>
<li><a href='#SwitchChipFeatures-RuleTable'>Rule Table</a></li>
<li><a href='#SwitchChipFeatures-Portisolation'>Port isolation</a>
<ul class='toc-indentation'>
<li><a href='#SwitchChipFeatures-PrivateVLAN'>Private VLAN</a></li>
<li><a href='#SwitchChipFeatures-Isolatedswitchgroups'>Isolated switch groups</a></li>
</ul>
</li>
<li><a href='#SwitchChipFeatures-CPUFlowControl'>CPU Flow Control</a></li>
<li><a href='#SwitchChipFeatures-Statistics'>Statistics</a></li>
</ul>
</li>
<li><a href='#SwitchChipFeatures-SetupExamples'>Setup Examples</a>
<ul class='toc-indentation'>
<li><a href='#SwitchChipFeatures-VLANExample1(TrunkandAccessPorts)'>VLAN Example 1 (Trunk and Access Ports)</a></li>
<li><a href='#SwitchChipFeatures-VLANExample2(TrunkandHybridPorts)'>VLAN Example 2 (Trunk and Hybrid Ports)</a></li>
<li><a href='#SwitchChipFeatures-Managementaccessconfiguration'>Management access configuration</a>
<ul class='toc-indentation'>
<li><a href='#SwitchChipFeatures-Tagged'>Tagged</a></li>
<li><a href='#SwitchChipFeatures-Untagged'>Untagged</a></li>
<li><a href='#SwitchChipFeatures-Untaggedfromtaggedport'>Untagged from tagged port</a></li>
</ul>
</li>
<li><a href='#SwitchChipFeatures-Inter-VLANrouting'>Inter-VLAN routing</a></li>
</ul>
</li>
<li><a href='#SwitchChipFeatures-Seealso'>See also</a></li>
</ul>
</div></span></p><h1 id="SwitchChipFeatures-Introduction"><span class="mw-headline">Introduction</span></h1><hr/><p>There are several types of switch chips on Routerboards and they have different sets of features. Most of them (from now on &quot;Other&quot;) have only the basic &quot;Port Switching&quot; feature, but there are a few with more features:</p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/><col/><col/><col/><col/><col/><col/><col/><col/><col/><col/><col/><col/><col/></colgroup><tbody><tr><th class="confluenceTh">Feature</th><th class="confluenceTh">QCA8337</th><th class="confluenceTh">Atheros8327</th><th class="confluenceTh">Atheros8316</th><th class="confluenceTh">Atheros8227</th><th class="confluenceTh">Atheros7240</th><th class="confluenceTh">IPQ-PPE</th><th class="confluenceTh">ICPlus175D</th><th class="confluenceTh">MT7621, MT7531</th><th class="confluenceTh">EN7562CT</th><th class="confluenceTh">RTL8367</th><th class="confluenceTh">88E6393X</th><th class="confluenceTh">88E6191X, <span style="color:var(--ds-text,#172b4d);">88E6190</span></th><th class="confluenceTh">98PX1012</th><th class="confluenceTh">Other</th></tr><tr><td class="confluenceTd">Port Switching</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">no</td><td class="confluenceTd">yes</td></tr><tr><td class="confluenceTd">Port Mirroring</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">no</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">no</td><td class="confluenceTd">no</td></tr><tr><td class="confluenceTd">TX limit <sup>1</sup></td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">no</td><td class="confluenceTd">no</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">no</td><td class="confluenceTd">no</td></tr><tr><td class="confluenceTd">RX limit <sup>1</sup></td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">no</td><td class="confluenceTd">no</td><td class="confluenceTd">no</td><td class="confluenceTd">no</td><td class="confluenceTd">no</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">yes</td><td class="confluenceTd">no</td><td class="confluenceTd">no</td></tr><tr><td class="confluenceTd">Host table</td><td class="confluenceTd">2048 entries</td><td class="confluenceTd">2048 entries</td><td class="confluenceTd">2048 entries</td><td class="confluenceTd">1024 entries</td><td class="confluenceTd">2048 entries</td><td class="confluenceTd">2048 entries</td><td class="confluenceTd"><div class="content-wrapper"><p>2048 entries <sup>2</sup></p></div></td><td class="confluenceTd">2048 entries</td><td class="confluenceTd">1024 entries</td><td class="confluenceTd">2048 entries</td><td class="confluenceTd">16k entries</td><td class="confluenceTd">16k entries</td><td class="confluenceTd">no</td><td class="confluenceTd">no</td></tr><tr><td class="confluenceTd">Vlan table</td><td class="confluenceTd">4096 entries</td><td class="confluenceTd">4096 entries</td><td class="confluenceTd">4096 entries</td><td class="confluenceTd">4096 entries</td><td class="confluenceTd">16 entries</td><td class="confluenceTd">no</td><td class="confluenceTd">no</td><td class="confluenceTd">4096 entries <sup>3</sup></td><td class="confluenceTd">4096 entries <sup>3</sup></td><td class="confluenceTd">4096 entries <sup>3</sup></td><td class="confluenceTd">4096 entries <sup>3</sup></td><td class="confluenceTd">4096 entries <sup>3</sup></td><td class="confluenceTd">no</td><td class="confluenceTd">no</td></tr><tr><td class="confluenceTd">Rule table</td><td class="confluenceTd">92 rules</td><td class="confluenceTd">92 rules</td><td class="confluenceTd">32 rules</td><td class="confluenceTd">no</td><td class="confluenceTd">no</td><td class="confluenceTd">no</td><td class="confluenceTd">no</td><td class="confluenceTd">no</td><td class="confluenceTd">no</td><td class="confluenceTd">no</td><td class="confluenceTd">256</td><td class="confluenceTd">no</td><td class="confluenceTd">no</td><td class="confluenceTd">no</td></tr></tbody></table></div><p><strong><span style="letter-spacing: 0.0px;">Notes</span></strong></p><ol><li><span>For QCA8337, Atheros8327, Atheros8316, Atheros8227, and Atheros7240 the Tx/Rx rate limits can be changed with <code>bandwidth</code> property on <code>&quot;<span style="color:var(--ds-icon-success,#22a06b);">/interface ethernet</span>&quot;</code> menu, see more details in the <a href="https://help.mikrotik.com/docs/display/ROS/Ethernet" rel="nofollow">Ethernet manual</a>. For RTL8367, 88E6393X, 88E6191X, <span style="color:var(--ds-text,#172b4d);">88E6190,</span> MT7621, MT7531 and <span style="color:var(--ds-text,#172b4d);">EN7562CT</span> Tx/Rx rate limit can be changed with<span style="color:var(--ds-icon-success,#22a06b);"><code> egress-rate</code></span> and <code><span style="color:var(--ds-icon-success,#22a06b);">ingress-rate</span></code> properties on &quot;<span style="color:var(--ds-icon-success,#22a06b);"><code>/interface ethernet switch port</code></span>&quot; menu.</span></li><li><span style="letter-spacing: 0.0px;">MAC addresses are learned up to the specified number, but the content of a switch host table is not available in RouterOS and static host configuration is not supported. </span></li><li><a href="https://help.mikrotik.com/docs/display/ROS/Bridging+and+Switching#BridgingandSwitching-BridgeVLANFiltering" rel="nofollow">Bridge HW vlan-filtering</a> was added in the RouterOS <span style="color:var(--ds-text,#172b4d);">7.1 for RTL8367, MT7621, <span>MT7531, <span style="color:var(--ds-text,#172b4d);">EN7562CT</span></span></span>. <span style="color:var(--ds-text,#333333);"><span>The switch does not support<span> </span></span>other<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>ether-type</code></span><span> </span>0x88a8 or 0x9100 (only 0x8100 is supported) and no<span> </span><code><span style="color:var(--ds-icon-success,#22a06b);">tag-stacking</span></code>. Using these features will disable HW offload.</span></li></ol><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Cloud Router Switch (CRS) series devices have highly advanced switch chips built-in, they support a wide variety of features. For more details about switch chip capabilities on CRS1xx/CRS2xx series devices check the <a href="https://help.mikrotik.com/docs/pages/viewpage.action?pageId=103841835" rel="nofollow">CRS1xx/CRS2xx series switches</a> manual, for CRS3xx series devices check the <a href="https://help.mikrotik.com/docs/display/ROS/CRS3xx%2C+CRS5xx%2C+CCR2116%2C+CCR2216+switch+chip+features" rel="nofollow">CRS3xx, CRS5xx series switches, and CCR2116, CCR2216 routers</a> manual.</p></div></div><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th class="confluenceTh">RouterBoard</th><th class="confluenceTh">Switch-chip description</th></tr><tr><td class="confluenceTd"><strong>C52iG-5HaxD2HaxD-TC (hAP ax<sup>2</sup>), C53UiG+5HPaxD2HPaxD (hAP ax<sup>3</sup>), Chateau ax series</strong></td><td class="confluenceTd">IPQ-PPE (ether1-ether5)</td></tr><tr><td class="confluenceTd"><strong>cAPGi-5HaxD2HaxD (cAP ax)</strong></td><td class="confluenceTd">IPQ-PPE (ether1-ether2)</td></tr><tr><td class="confluenceTd"><strong>L009 series</strong></td><td class="confluenceTd"><span style="color:var(--ds-text,#172b4d);">88E6190 (ether2-ether8, sfp1)</span></td></tr><tr><td class="confluenceTd"><strong>RB5009 series</strong></td><td class="confluenceTd">88E6393X (ether1-ether8, sfp-sfpplus1)</td></tr><tr><td class="confluenceTd"><strong>CCR2004-16G-2S+</strong></td><td class="confluenceTd">88E6191X (ether1-ether8); 88E6191X (ether9-ether16); </td></tr><tr><td class="confluenceTd"><strong>RB4011iGS+</strong></td><td class="confluenceTd">RTL8367 (ether1-ether5); RTL8367 (ether6-ether10);</td></tr><tr><td class="confluenceTd"><strong>RB1100AHx4</strong></td><td class="confluenceTd">RTL8367 (ether1-ether5); RTL8367 (ether6-ether10); RTL8367 (ether11-ether13)</td></tr><tr><td class="confluenceTd"><strong>L41G-2axD (hAP ax lite)</strong></td><td class="confluenceTd">MT7531 (ether1-ether4)</td></tr><tr><td class="confluenceTd"><strong>RB750Gr3 (hEX), RB760iGS (hEX S)</strong></td><td class="confluenceTd">MT7621 (ether1-ether5)</td></tr><tr><td class="confluenceTd"><strong>E50UG (hEX Refresh)</strong></td><td style="text-align: left;" class="confluenceTd">EN7562CT (ether2-ether5)</td></tr><tr><td class="confluenceTd"><strong>RBM33G</strong></td><td class="confluenceTd">MT7621 (ether1-ether3)</td></tr><tr><td class="confluenceTd"><strong>RB3011 series</strong></td><td class="confluenceTd">QCA8337 (ether1-ether5); QCA8337 (ether6-ether10)</td></tr><tr><td class="confluenceTd"><strong>RB OmniTik ac series</strong></td><td class="confluenceTd">QCA8337 (ether1-ether5)</td></tr><tr><td class="confluenceTd"><strong>RBwsAP-5Hac2nD (wsAP ac lite)</strong></td><td class="confluenceTd">Atheros8227 (ether1-ether3)</td></tr><tr><td class="confluenceTd"><strong>RB941-2nD (hAP lite)</strong></td><td class="confluenceTd">Atheros8227 (ether1-ether4)</td></tr><tr><td class="confluenceTd"><strong>RB951Ui-2nD (hAP); RB952Ui-5ac2nD (hAP ac lite); RB750r2 (hEX lite); RB750UPr2 (hEX PoE lite); RB750P-PBr2 (PowerBox); RB750P r2; RBOmniTikU-5HnDr2 (OmniTIK 5); RBOmniTikUPA-5HnDr2 (OmniTIK 5 PoE)</strong></td><td class="confluenceTd">Atheros8227 (ether1-ether5)</td></tr><tr><td class="confluenceTd"><strong>RB750Gr2 (hEX); RB962UiGS-5HacT2HnT (hAP ac); RB960PGS (hEX PoE); RB960PGS-PB (PowerBox Pro)</strong></td><td class="confluenceTd">QCA8337 (ether1-ether5)</td></tr><tr><td class="confluenceTd"><strong>RB953GS</strong></td><td class="confluenceTd">Atheros8327 (ether1-ether3+sfp1)</td></tr><tr><td class="confluenceTd"><strong>RB850Gx2</strong></td><td class="confluenceTd">Atheros8327 (ether1-ether5) with ether1 optional</td></tr><tr><td class="confluenceTd"><strong>RB2011 series</strong></td><td class="confluenceTd">Atheros8327 (ether1-ether5+sfp1); Atheros8227 (ether6-ether10)</td></tr><tr><td class="confluenceTd"><strong>RB750GL; RB751G-2HnD; RB951G-2HnD; RBD52G-5HacD2HnD (hAP ac²), RBD53iG-5HacD2HnD (hAP ac³), RBD53GR-5HacD2HnD&amp;R11e-LTE6 (hAP ac³ LTE6 kit), RBD53G-5HacD2HnD-TC&amp;EG12-EA (Chateau LTE12)<br/></strong></td><td class="confluenceTd">Atheros8327 (ether1-ether5)</td></tr><tr><td class="confluenceTd"><strong>RBcAPGi-5acD2nD (cAP ac), RBwAPGR-5HacD2HnD (wAP R ac and wAP ac LTE series), RBwAPG-5HacD2HnD (wAP ac), RBD25G-5HPacQD2HPnD (Audience), RBD25GR-5HPacQD2HPnD&amp;R11e-LTE6 (Audience LTE6 kit), <br/></strong></td><td class="confluenceTd">Atheros8327 (ether1-ether2)</td></tr><tr><td class="confluenceTd"><strong>RBD22UGS-5HPacD2HnD (mANTBox 52 15s)</strong></td><td class="confluenceTd">Atheros8327 (ether1-sfp1)</td></tr><tr><td class="confluenceTd"><strong>RB1100AH</strong></td><td class="confluenceTd">Atheros8327 (ether1-ether5); Atheros8327 (ether6-ether10)</td></tr><tr><td class="confluenceTd"><strong>RB1100AHx2</strong></td><td class="confluenceTd">Atheros8327 (ether1-ether5); Atheros8327 (ether6-ether10)</td></tr><tr><td class="confluenceTd"><strong>CCR1009-8G-1S-1S+; CCR1009-8G-1S</strong></td><td class="confluenceTd">Atheros8327 (ether1-ether4)</td></tr><tr><td class="confluenceTd"><strong>RB493G</strong></td><td class="confluenceTd">Atheros8316 (ether1+ether6-ether9); Atheros8316 (ether2-ether5)</td></tr><tr><td class="confluenceTd"><strong>RB435G</strong></td><td class="confluenceTd">Atheros8316 (ether1-ether3) with ether1 optional</td></tr><tr><td class="confluenceTd"><strong>RB450G</strong></td><td class="confluenceTd">Atheros8316 (ether1-ether5) with ether1 optional</td></tr><tr><td class="confluenceTd"><strong>RB450Gx4</strong></td><td class="confluenceTd">Atheros8327 (ether1-ether5)</td></tr><tr><td class="confluenceTd"><strong>RB433GL</strong></td><td class="confluenceTd">Atheros8327 (ether1-ether3)</td></tr><tr><td class="confluenceTd"><strong>RB750G</strong></td><td class="confluenceTd">Atheros8316 (ether1-ether5)</td></tr><tr><td class="confluenceTd"><strong>RB1200</strong></td><td class="confluenceTd">Atheros8316 (ether1-ether5)</td></tr><tr><td class="confluenceTd"><strong>RB1100</strong></td><td class="confluenceTd">Atheros8316 (ether1-ether5); Atheros8316 (ether6-ether10)</td></tr><tr><td class="confluenceTd"><strong>DISC Lite5</strong></td><td class="confluenceTd">Atheros8227 (ether1)</td></tr><tr><td class="confluenceTd"><strong>RBmAP2nD</strong></td><td class="confluenceTd">Atheros8227 (ether1-ether2)</td></tr><tr><td class="confluenceTd"><strong>RBmAP2n</strong></td><td class="confluenceTd">Atheros7240 (ether1-ether2)</td></tr><tr><td class="confluenceTd"><strong>RB750</strong></td><td class="confluenceTd">Atheros7240 (ether2-ether5)</td></tr><tr><td class="confluenceTd"><strong>RB750UP</strong></td><td class="confluenceTd">Atheros7240 (ether2-ether5)</td></tr><tr><td class="confluenceTd"><strong>RB751U-2HnD</strong></td><td class="confluenceTd">Atheros7240 (ether2-ether5)</td></tr><tr><td class="confluenceTd"><strong>RB951-2n</strong></td><td class="confluenceTd">Atheros7240 (ether2-ether5)</td></tr><tr><td class="confluenceTd"><strong>RB951Ui-2HnD</strong></td><td class="confluenceTd">Atheros8227 (ether1-ether5)</td></tr><tr><td class="confluenceTd"><strong>RB433 series</strong></td><td class="confluenceTd">ICPlus175D (ether2-ether3); older models had ICPlus175C</td></tr><tr><td class="confluenceTd"><strong>RB450</strong></td><td class="confluenceTd">ICPlus175D (ether2-ether5); older models had ICPlus175C</td></tr><tr><td class="confluenceTd"><strong>RB493 series</strong></td><td class="confluenceTd">ICPlus178C (ether2-ether9)</td></tr><tr><td class="confluenceTd"><strong>RB816</strong></td><td class="confluenceTd">ICPlus178C (ether1-ether16)</td></tr></tbody></table></div><p>The command-line configuration is under the switch<span> </span>menu. This menu contains a list of all switch chips present in the system and some sub-menus as well.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] &gt; /interface ethernet switch print 
Flags: I - invalid 
 #   NAME         TYPE             MIRROR-SOURCE       MIRROR-TARGET       SWITCH-ALL-PORTS
 0   switch1      Atheros-8327     none                none               
 1   switch2      Atheros-8227     none                none               </pre>
</div></div><p>Depending on the switch type there can be different configuration capabilities available.</p><h1 id="SwitchChipFeatures-Features"><span class="mw-headline">Features</span></h1><hr/><h2 id="SwitchChipFeatures-PortSwitching"><span class="mw-headline">Port Switching</span></h2><p>To set up port switching on non-CRS series devices, check the<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/Bridging+and+Switching#BridgingandSwitching-BridgeHardwareOffloading" rel="nofollow">Bridge Hardware Offloading</a><span> </span>page.</p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Port switching in RouterOS v6.41 and newer is done using the bridge configuration. Before RouterOS v6.41 port switching was done using the<span> </span>master-port<span> </span>property.</p></div></div><h3 id="SwitchChipFeatures-SwitchAllPortsFeature"><span class="mw-headline">Switch All Ports Feature</span></h3><p>Ether1 port on RB450G/RB435G/RB850Gx2 devices has a feature that allows it to be removed/added to the default switch group, this setting is available on the <code><span style="color:var(--ds-icon-success,#22a06b);">/interface ethernet switch</span> </code>menu. By default ether1 port will be included in the switch group.</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/15302988/19136841.png" data-image-src="attachments/15302988/19136841.png" data-unresolved-comment-count="0" data-linked-resource-id="19136841" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Switch4.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="15302988" data-linked-resource-container-version="89" tabindex="0" alt=""></span></p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><span><strong>switch-all-ports</strong> </span>(no<em> | yes</em>; Default: <strong>yes</strong>)</td><td class="confluenceTd"><p>Changes ether1 switch group only on RB450G/RB435G/RB850Gx2 devices.</p><ul><li><code>yes</code> - ether1 is part of the switch and supports switch grouping and all other advanced Atheros8316/Atheros8327 features including extended statistics (<code>/interface ethernet print stats</code>).</li><li><code>no</code> - ether1 is not part of the switch, effectively making it a stand-alone ethernet port, this way increasing its throughput to other ports in bridged and routed mode, but removing the switching possibility on this port.</li></ul></td></tr></tbody></table></div><h2 id="SwitchChipFeatures-PortMirroring"><span class="mw-headline">Port Mirroring</span></h2><p>Port mirroring lets the switch to copy all traffic that is going in and out of one port (<code><span style="color:var(--ds-icon-success,#22a06b);">mirror-source</span></code>) and send out these copied frames to some other port (<code><span style="color:var(--ds-icon-success,#22a06b);">mirror-target</span></code>). This feature can be used to easily set up a 'tap' device that receives all traffic that goes in/out of some specific port. Note that <code><span style="color:var(--ds-icon-success,#22a06b);">mirror-source</span></code> and <code><span style="color:var(--ds-icon-success,#22a06b);">mirror-target</span></code> ports have to belong to the same switch (see which port belongs to which switch in<span> </span><code>/interface ethernet</code><span> </span>menu). Also, mirror-target can have a special '<code>cpu</code>' value, which means that mirrored packets should be sent out to the switch chips CPU port. Port mirroring happens independently of switching groups that have or have not been set up.</p><p><strong>Sub-menu:</strong><span> </span><code>/interface ethernet switch</code></p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><span><strong>mirror-source</strong> </span>(<em>name | none</em>; Default: <strong>none</strong>)</td><td class="confluenceTd"><p>Selects a single mirroring source port. Ingress and egress traffic will be sent to the <code><span style="color:var(--ds-icon-success,#22a06b);">mirror-target</span></code> port. <span style="color:var(--ds-text,#172b4d);">Note that <code><span style="color:var(--ds-icon-success,#22a06b);">mirror-target</span></code> port has to belong to the same switch (see which port belongs to which switch in</span><span style="color:var(--ds-text,#172b4d);"> </span><code>/interface ethernet</code><span style="color:var(--ds-text,#172b4d);"> </span><span style="color:var(--ds-text,#172b4d);">menu).</span></p></td></tr><tr><td colspan="1" class="confluenceTd"><span><strong>mirror-target</strong> </span>(<em>name | none | cpu</em>; Default: <strong>none</strong>)</td><td colspan="1" class="confluenceTd"><p>Selects a single mirroring target port. Mirrored packets from <code><span style="color:var(--ds-icon-success,#22a06b);">mirror-source</span></code> and <code><span style="color:var(--ds-icon-success,#22a06b);">mirror</span></code> (see the property in rule and host table) will be sent to the selected port.</p></td></tr><tr><td colspan="1" class="confluenceTd"><span><strong>mirror-egress-target</strong> </span>(<em>name | none</em>; Default: <strong>none</strong>)</td><td colspan="1" class="confluenceTd"><p>Selects a single mirroring egress target port, only available on <strong>88E6393X</strong>, <strong>88E6191X</strong> and <span style="color:var(--ds-text,#172b4d);"><strong>88E6190</strong> </span>switch chips. Mirrored packets from <code><span style="color:var(--ds-icon-success,#22a06b);">mirror-egress</span></code> (see the property in port menu) will be sent to the selected port.</p></td></tr></tbody></table></div><p><strong>Sub-menu:</strong><span> </span><code>/interface ethernet switch rule</code></p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>mirror</strong><span> </span>(<em>no | yes</em>; Default:<span> <strong>no</strong></span>)</td><td class="confluenceTd">Whether to send a packet copy to <span style="color:var(--ds-icon-success,#22a06b);"><code>mirror-target</code></span> port.</td></tr><tr><td colspan="1" class="confluenceTd"><strong>mirror-ports</strong><span> </span>(<em>name</em>; Default:<span> </span>)</td><td colspan="1" class="confluenceTd">Selects multiple mirroring target ports, only available on <strong>88E6393X</strong> switch chip. Matched packets in the ACL rule will be copied and sent to selected ports.</td></tr></tbody></table></div><p><strong>Sub-menu:</strong><span> </span><code>/interface ethernet switch host</code></p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>mirror</strong><span> </span>(<em>no | yes</em>; Default:<span> <strong>no</strong></span>)</td><td class="confluenceTd">Whether to send a frame copy to <span style="color:var(--ds-icon-success,#22a06b);"><code>mirror-target</code></span> port from a frame with a matching MAC destination address (matching destination or source address for CRS3xx series switches)</td></tr></tbody></table></div><p><strong>Sub-menu:</strong><span> </span><code>/interface ethernet switch port</code></p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col style="width: 344.0px;"/><col style="width: 1119.0px;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><span><strong>mirror-egress</strong> (<em>no | yes</em>; Default: <strong>no</strong>)</span></td><td class="confluenceTd"><p>Whether to send egress packet copy to the <span style="color:var(--ds-icon-success,#22a06b);"><code>mirror-egress-target</code></span> port, only available on <strong>88E6393X</strong>, <strong>88E6191X</strong> and <span style="color:var(--ds-text,#172b4d);"><strong>88E6190</strong></span> switch chips.</p></td></tr><tr><td colspan="1" class="confluenceTd"><span><strong>mirror-ingress</strong> (<em>no | yes</em>; Default: <strong>no</strong>)</span></td><td colspan="1" class="confluenceTd"><p>Whether to send ingress packet copy to the <span style="color:var(--ds-icon-success,#22a06b);"><code>mirror-ingress-target</code></span> port, only available on <strong>88E6393X</strong>, <strong>88E6191X</strong> and <span style="color:var(--ds-text,#172b4d);"><strong>88E6190</strong></span> switch chips.</p></td></tr><tr><td colspan="1" class="confluenceTd"><span><strong>mirror-ingress-target</strong> </span>(<em>name | none</em>; Default: <strong>none</strong>)</td><td colspan="1" class="confluenceTd"><p>Selects a single mirroring ingress target port, only available on  <strong>88E6393X</strong>, <strong>88E6191X</strong> and <span style="color:var(--ds-text,#172b4d);"><strong>88E6190</strong></span> switch chips. Mirrored packets from <code><span style="color:var(--ds-icon-success,#22a06b);">mirror-ingress</span></code> will be sent to the selected port.</p></td></tr></tbody></table></div><p>Port mirroring configuration example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface ethernet switch
set switch1 mirror-source=ether2 mirror-target=ether3</pre>
</div></div><div role="region" aria-label="Warning" class="confluence-information-macro  confluence-information-macro-warning" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p><span> </span>If you set <span style="color:var(--ds-icon-success,#22a06b);">mirror-source</span> as an Ethernet port for a device with at least two switch chips and these mirror-source ports are in a single bridge while mirror-target for both switch chips are set to send the packets to the CPU, then this will result in a loop, which can make your device inaccessible.</p></div></div><h2 id="SwitchChipFeatures-PortSettings"><span class="mw-headline">Port Settings</span></h2><p>Properties under this menu are used to configure VLAN switching and filtering options for switch chips that support a VLAN Table. These properties are only available to switch chips that have VLAN Table support, check the<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/Switch+Chip+Features#SwitchChipFeatures-Introduction" rel="nofollow">Switch Chip Features</a><span> </span>table to make sure your device supports such a feature.</p><div role="region" aria-label="Warning" class="confluence-information-macro  confluence-information-macro-warning" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Ingress traffic is considered as traffic that is being sent<span> </span><strong>IN</strong><span> </span>a certain port, this port is sometimes called<span> </span><strong>ingress port</strong>. Egress traffic is considered as traffic that is being sent<span> </span><strong>OUT</strong><span> </span>of a certain port, this port is sometimes called<span> </span><strong>egress port</strong>. Distinguishing them is very important to properly set up VLAN filtering since some properties apply only to either ingress or egress traffic.</p></div></div><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>vlan-mode</strong><span> </span>(<em>check | disabled | fallback | secure</em>; Default:<span> </span><strong>disabled</strong>)</td><td class="confluenceTd">Changes the VLAN lookup mechanism against the<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/Switch+Chip+Features#SwitchChipFeatures-VLANTable" rel="nofollow">VLAN Table</a><span> </span>for ingress traffic.<ul><li><code>disabled</code><span> </span>- disables checking against the VLAN Table completely for ingress traffic. No traffic is dropped when set on the ingress port.</li><li><code>fallback</code><span> </span>- checks tagged traffic against the VLAN Table for ingress traffic and forwards all untagged traffic. If ingress traffic is tagged and the egress port is not found in the VLAN table for the appropriate VLAN ID, then traffic is dropped. If a VLAN ID is not found in the VLAN Table, then traffic is forwarded. Used to allow known VLANs only in specific ports.</li><li><code>check</code><span> </span>- checks tagged traffic against the VLAN Table for ingress traffic and drops all untagged traffic. If ingress traffic is tagged and the egress port is not found in the VLAN table for the appropriate VLAN ID, then traffic is dropped.</li><li><code>secure</code><span> </span>- checks tagged traffic against the VLAN Table for ingress traffic and drops all untagged traffic. Both ingress and egress port must be found in the VLAN Table for the appropriate VLAN ID, otherwise, traffic is dropped.</li></ul></td></tr><tr><td class="confluenceTd"><strong>vlan-header</strong><span> </span>(<em>add-if-missing | always-strip | leave-as-is</em>; Default:<span> </span><strong>leave-as-is</strong>)</td><td class="confluenceTd">Sets action which is performed on the port for egress traffic.<ul><li><code>add-if-missing</code><span> </span>- adds a VLAN tag on egress traffic and uses<span> </span>default-vlan-id<span> </span>from the ingress port. Should be used for trunk ports.</li><li><code>always-strip</code><span> </span>- removes a VLAN tag on egress traffic. Should be used for access ports.</li><li><code>leave-as-is</code><span> </span>- does not add nor remove a VLAN tag on egress traffic. Should be used for hybrid ports.</li></ul></td></tr><tr><td class="confluenceTd"><strong>default-vlan-id</strong><span> </span>(<em>auto | integer: 0..4095</em>; Default:<span> </span><strong>auto</strong>)</td><td class="confluenceTd">Adds a VLAN tag with the specified VLAN ID on all untagged ingress traffic on a port, should be used with<span> </span><span style="color:var(--ds-icon-success,#22a06b);">vlan-header</span><span> </span>set to<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>always-strip</code></span><span> </span>on a port to configure the port to be the access port. For hybrid ports<span> </span><span style="color:var(--ds-icon-success,#22a06b);">default-vlan-id </span>is used to tag untagged traffic. If two ports have the same<span style="color:var(--ds-icon-success,#22a06b);"> default-vlan-id</span>, then VLAN tag is not added since the switch chip assumes that traffic is being forwarded between access ports.</td></tr></tbody></table></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>On <strong>QCA8337</strong> and <strong>Atheros8327</strong> switch chips, a default <span style="color:var(--ds-icon-success,#22a06b);"><code>vlan-header=leave-as-is</code> </span>property should be used. The switch chip will determine which ports are access ports by using the <span style="color:var(--ds-icon-success,#22a06b);"><code>default-vlan-id</code></span> property. The <span style="color:var(--ds-icon-success,#22a06b);"><code>default-vlan-id</code></span> should only be used on access/hybrid ports to specify which VLAN the untagged ingress traffic is assigned to.</p></div></div><h2 id="SwitchChipFeatures-VLANTable"><span class="mw-headline">VLAN Table</span></h2><p><span style="color:var(--ds-text,#333333);">VLAN table specifies certain forwarding rules for packets that have a specific 802.1Q tag. Those rules are of higher priority than switch groups configured using the<span> </span></span><a href="https://help.mikrotik.com/docs/display/ROS/Bridging+and+Switching#BridgingandSwitching-BridgeHardwareOffloading" rel="nofollow">Bridge Hardware Offloading</a><span style="color:var(--ds-text,#333333);"><span> </span>feature. Basically, the table contains entries that map specific VLAN tag IDs to a group of one or more ports. Packets with VLAN tags leave the switch chip through one or more ports that are set in the corresponding table entry. The exact logic that controls how packets with VLAN tags are treated is controlled by a <code>vlan-mode</code> parameter that is changeable per switch port.</span></p><p><span style="color:var(--ds-text,#333333);">VLAN ID based forwarding takes into account the MAC addresses dynamically learned or manually added in the host table. QCA8337 and Atheros8327 switch-chips also support Independent VLAN Learning (IVL) which does the learning based on both - MAC addresses and VLAN IDs, thus allowing the same MAC to be used in multiple VLANs.</span></p><p>Packets without VLAN tag are treated just as if they had a VLAN tag with port<code><span> </span><span style="color:var(--ds-icon-success,#22a06b);">default-vlan-id</span></code>. If <span style="color:var(--ds-icon-success,#22a06b);"><code>vlan-mode=check</code></span> or <span style="color:var(--ds-icon-success,#22a06b);"><code>vlan=mode=secure</code></span> is configured, to forward packets without VLAN tags you have to add an entry to the VLAN table with the same VLAN ID according to<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>default-vlan-id</code></span>.</p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>disabled</strong><span> </span>(<em>no | yes</em>; Default:<span> <strong>no</strong></span>)</td><td class="confluenceTd">Enables or disables switch VLAN entry.</td></tr><tr><td class="confluenceTd"><span><strong>independent-learning</strong> </span>(no<em> | yes</em>; Default:<span> <strong>yes</strong></span>)</td><td class="confluenceTd">Whether to use shared-VLAN-learning (SVL) or independent-VLAN-learning (IVL). </td></tr><tr><td class="confluenceTd"><span><strong>ports</strong> </span>(<em>name</em>; Default:<span> <strong>none</strong></span>)</td><td class="confluenceTd">Interface member list for the respective VLAN. This setting accepts comma-separated values. e.g.<span> </span><code>ports=ether1,ether2</code>.</td></tr><tr><td class="confluenceTd"><span><strong>switch</strong> </span>(<em>name</em>; Default:<span> <strong>none</strong></span>)</td><td class="confluenceTd">Name of the switch <span style="color:var(--ds-text,#333333);">for which the respective VLAN entry is intended for.</span></td></tr><tr><td class="confluenceTd"><span><strong>vlan-id</strong> </span>(<em>integer: 0..4095</em>; Default:<strong> </strong>)</td><td class="confluenceTd">The VLAN ID for certain switch port configurations.</td></tr></tbody></table></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Devices with <strong>MT7621</strong>, <strong>MT7531</strong>,<strong> <span style="color:var(--ds-text,#172b4d);">EN7562CT,</span> RTL8367</strong>, <strong>88E6393X</strong>, <strong>88E6191X</strong>, <span style="color:var(--ds-text,#172b4d);"><strong>88E6190 </strong></span>switch chips support <a href="https://help.mikrotik.com/docs/display/ROS/Bridging+and+Switching#BridgingandSwitching-BridgeVLANFiltering" rel="nofollow">HW offloaded vlan-filtering</a> in RouterOS v7. VLAN-related configuration on the &quot;<span style="color:var(--ds-icon-success,#22a06b);">/interface ethernet switc</span><span style="color:var(--ds-background-accent-green-bolder,#1f845a);"><code>h</code></span>&quot; menu is not available.  </p></div></div><p><span style="font-size: 16.0px;font-weight: bold;letter-spacing: -0.006em;">VLAN Forwarding</span></p><p>Both<span> </span><code>vlan-mode</code><span> </span>and<span> </span><code>vlan-header</code><span> </span>along with the VLAN Table can be used to configure VLAN tagging, untagging and filtering, multiple combinations are possible, each achieving a different result. Below you can find a table of what kind of traffic is going to be sent out through an egress port when a certain traffic is received on an ingress port for each VLAN Mode.</p><p><strong>NOTES:</strong></p><ul><li><strong>L</strong><span> </span>-<span> </span><code>vlan-header</code><span> </span>is set to<span> </span><code>leave-as-is</code></li><li><strong>S</strong><span> </span>-<span> </span><code>vlan-header</code><span> </span>set to<span> </span><code>always-strip</code></li><li><strong>A</strong><span> </span>-<span> </span><code>vlan-header</code><span> </span>set to<span> </span><code>add-if-missing</code></li><li><strong>U</strong><span> </span>- Untagged traffic is sent out</li><li><strong>T</strong><span> </span>- Tagged traffic is sent out, a tag is already present on the ingress port</li><li><strong>TA</strong><span> </span>- Tagged traffic is sent out, a tag was added on the ingress port</li><li><strong>DI</strong><span> </span>- Traffic is dropped on ingress port because of mode selected in<span> </span>vlan-mode</li><li><strong>DE</strong><span> </span>- Traffic is dropped on egress port because egress port was not found in the VLAN Table</li><li><strong>VID match</strong><span> </span>- VLAN ID from the VLAN tag for ingress traffic is present in the VLAN Table</li><li><strong>Port match</strong><span> </span>- Ingress port is present in the VLAN Table for the appropriate VLAN ID</li></ul><div class="table-wrap"><table class="wrapped confluenceTable" style="text-align: center;"><colgroup><col/><col/><col/><col/><col/><col/><col/></colgroup><tbody><tr><td rowspan="2" class="confluenceTd"><em>VLAN Mode = disabled</em></td><th style="text-align: center;" colspan="3" class="confluenceTh">Egress port not present in VLAN Table</th><th style="text-align: center;" colspan="3" class="confluenceTh">Egress port is present in VLAN Table</th></tr><tr><th style="text-align: center;" class="confluenceTh">L</th><th style="text-align: center;" class="confluenceTh">S</th><th style="text-align: center;" class="confluenceTh">A</th><th style="text-align: center;" class="confluenceTh">L</th><th style="text-align: center;" class="confluenceTh">S</th><th style="text-align: center;" class="confluenceTh">A</th></tr><tr><th style="text-align: center;" class="confluenceTh">Untagged traffic</th><td class="confluenceTd">U</td><td class="confluenceTd">U</td><td class="confluenceTd">TA</td><td class="confluenceTd">U</td><td class="confluenceTd">U</td><td class="confluenceTd">TA</td></tr><tr><th style="text-align: center;" class="confluenceTh">Tagged traffic; no VID match</th><td class="confluenceTd">T</td><td class="confluenceTd">U</td><td class="confluenceTd">T</td><td colspan="3" class="confluenceTd"><br/></td></tr><tr><th style="text-align: center;" class="confluenceTh">Tagged traffic; VID match; no Port match</th><td class="confluenceTd">T</td><td class="confluenceTd">U</td><td class="confluenceTd">T</td><td class="confluenceTd">T</td><td class="confluenceTd">U</td><td class="confluenceTd">T</td></tr><tr><th style="text-align: center;" class="confluenceTh">Tagged traffic; VID match; Port match</th><td class="confluenceTd">T</td><td class="confluenceTd">U</td><td class="confluenceTd">T</td><td class="confluenceTd">T</td><td class="confluenceTd">U</td><td class="confluenceTd">T</td></tr></tbody></table></div><div class="table-wrap"><table class="wrapped confluenceTable" style="text-align: center;"><colgroup><col/><col/><col/><col/><col/><col/><col/></colgroup><tbody><tr><td rowspan="2" class="confluenceTd"><em>VLAN Mode = fallback</em></td><th style="text-align: center;" colspan="3" class="confluenceTh">Egress port not present in VLAN Table</th><th style="text-align: center;" colspan="3" class="confluenceTh">Egress port is present in VLAN Table</th></tr><tr><th style="text-align: center;" class="confluenceTh">L</th><th style="text-align: center;" class="confluenceTh">S</th><th style="text-align: center;" class="confluenceTh">A</th><th style="text-align: center;" class="confluenceTh">L</th><th style="text-align: center;" class="confluenceTh">S</th><th style="text-align: center;" class="confluenceTh">A</th></tr><tr><th style="text-align: center;" class="confluenceTh">Untagged traffic</th><td class="confluenceTd">U</td><td class="confluenceTd">U</td><td class="confluenceTd">TA</td><td class="confluenceTd">U</td><td class="confluenceTd">U</td><td class="confluenceTd">TA</td></tr><tr><th style="text-align: center;" class="confluenceTh">Tagged traffic; no VID match</th><td class="confluenceTd">T</td><td class="confluenceTd">U</td><td class="confluenceTd">T</td><td colspan="3" class="confluenceTd"><br/></td></tr><tr><th style="text-align: center;" class="confluenceTh">Tagged traffic; VID match; no Port match</th><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DE</td><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DE</td><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DE</td><td class="confluenceTd">T</td><td class="confluenceTd">U</td><td class="confluenceTd">T</td></tr><tr><th style="text-align: center;" class="confluenceTh">Tagged traffic; VID match; Port match</th><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DE</td><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DE</td><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DE</td><td class="confluenceTd">T</td><td class="confluenceTd">U</td><td class="confluenceTd">T</td></tr></tbody></table></div><div class="table-wrap"><table class="wrapped confluenceTable" style="text-align: center;"><colgroup><col/><col/><col/><col/><col/><col/><col/></colgroup><tbody><tr><td rowspan="2" class="confluenceTd"><em>VLAN Mode = check</em></td><th style="text-align: center;" colspan="3" class="confluenceTh">Egress port not present in VLAN Table</th><th style="text-align: center;" colspan="3" class="confluenceTh">Egress port is present in VLAN Table</th></tr><tr><th style="text-align: center;" class="confluenceTh">L</th><th style="text-align: center;" class="confluenceTh">S</th><th style="text-align: center;" class="confluenceTh">A</th><th style="text-align: center;" class="confluenceTh">L</th><th style="text-align: center;" class="confluenceTh">S</th><th style="text-align: center;" class="confluenceTh">A</th></tr><tr><th style="text-align: center;" class="confluenceTh">Untagged traffic</th><td colspan="6" class="confluenceTd"><br/></td></tr><tr><th style="text-align: center;" class="confluenceTh">Tagged traffic; no VID match</th><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DI</td><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DI</td><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DI</td><td colspan="3" class="confluenceTd"><br/></td></tr><tr><th style="text-align: center;" class="confluenceTh">Tagged traffic; VID match; no Port match</th><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DE</td><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DE</td><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DE</td><td class="confluenceTd">T</td><td class="confluenceTd">U</td><td class="confluenceTd">T</td></tr><tr><th style="text-align: center;" class="confluenceTh">Tagged traffic; VID match; Port match</th><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DE</td><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DE</td><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DE</td><td class="confluenceTd">T</td><td class="confluenceTd">U</td><td class="confluenceTd">T</td></tr></tbody></table></div><div class="table-wrap"><table class="wrapped confluenceTable" style="text-align: center;"><colgroup><col/><col/><col/><col/><col/><col/><col/></colgroup><tbody><tr><td rowspan="2" class="confluenceTd"><em>VLAN Mode = secure</em></td><th style="text-align: center;" colspan="3" class="confluenceTh">Egress port not present in VLAN Table</th><th style="text-align: center;" colspan="3" class="confluenceTh">Egress port is present in VLAN Table</th></tr><tr><th style="text-align: center;" class="confluenceTh">L</th><th style="text-align: center;" class="confluenceTh">S</th><th style="text-align: center;" class="confluenceTh">A</th><th style="text-align: center;" class="confluenceTh">L</th><th style="text-align: center;" class="confluenceTh">S</th><th style="text-align: center;" class="confluenceTh">A</th></tr><tr><th style="text-align: center;" class="confluenceTh">Untagged traffic</th><td colspan="6" class="confluenceTd"><br/></td></tr><tr><th style="text-align: center;" class="confluenceTh">Tagged traffic; no VID match</th><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DI</td><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DI</td><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DI</td><td colspan="3" class="confluenceTd"><br/></td></tr><tr><th style="text-align: center;" class="confluenceTh">Tagged traffic; VID match; no Port match</th><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DI</td><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DI</td><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DI</td><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DI</td><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DI</td><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DI</td></tr><tr><th style="text-align: center;" class="confluenceTh">Tagged traffic; VID match; Port match</th><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DE</td><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DE</td><td class="highlight-red confluenceTd" title="Background colour : Red" data-highlight-colour="red">DE</td><td class="confluenceTd">T</td><td class="confluenceTd">U</td><td class="confluenceTd">T</td></tr></tbody></table></div><p><br/></p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>The tables above are meant for more advanced configurations and to double-check your understanding of how packets will be processed with each VLAN related property.</p></div></div><h2 id="SwitchChipFeatures-HostTable"><span style="letter-spacing: -0.008em;">Host Table</span></h2><p>The host table represents switch chip's internal MAC address to port mapping. It can contain two kinds of entries: dynamic and static. Dynamic entries get added automatically, this is also called a learning process: when switch chip receives a packet from a certain port, it adds the packet's source MAC address and port it received the packet from to the host table, so when a packet comes in with the same destination MAC address, it knows to which port it should forward the packet. If the destination MAC address is not present in the host table (so-called unknown-unicast traffic) then it forwards the packet to all ports in the group. Dynamic entries take about 5 minutes to time out. Learning is enabled only on ports that are configured as part of the switch group, so you won't see dynamic entries if you have not set up port switching. Also, you can add static entries that take over dynamic if a dynamic entry with the same MAC address already exists. Since port switching is configured using a bridge with hardware offloading, any static entries created on one table (either bridge host or switch host) will appear on the opposite table as a dynamic entry. Adding a static entry on the switch host table will provide access to some more functionality that is controlled via the following params:</p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><span><strong>copy-to-cpu</strong> </span>(<em>no | yes</em>; Default:<span> </span><strong>no</strong>)</td><td class="confluenceTd">Whether to send a frame copy to switch CPU port from a frame with a matching MAC destination address (matching destination or source address for CRS3xx series switches)</td></tr><tr><td class="confluenceTd"><strong>drop</strong><span> </span>(<em>no | yes</em>; Default:<span> <strong>no</strong></span>)</td><td class="confluenceTd">Whether to drop a frame with a matching MAC source address received on a certain port (matching destination or source address for CRS3xx series switches)</td></tr><tr><td class="confluenceTd"><strong>mac-address</strong><span> </span>(<em>MAC;</em> Default:<span> <strong>00:00:00:00:00:00</strong></span>)</td><td class="confluenceTd">Host's MAC address</td></tr><tr><td colspan="1" class="confluenceTd"><strong>mirror</strong><span> </span>(<em>no | yes</em>; Default:<span> <strong>no</strong></span>)</td><td colspan="1" class="confluenceTd">Whether to send a frame copy to <span style="color:var(--ds-icon-success,#22a06b);"><code>mirror-target</code></span> port from a frame with a matching MAC destination address (matching destination or source address for CRS3xx series switches)</td></tr><tr><td colspan="1" class="confluenceTd"><span><strong>ports</strong> </span>(<em>name</em>; Default:<span> <strong>none</strong></span>)</td><td colspan="1" class="confluenceTd">Name of the interface, static MAC address can be mapped to more than one port, including switch CPU port</td></tr><tr><td colspan="1" class="confluenceTd"><span><strong>redirect-to-cpu</strong> </span>(<em>no | yes</em>; Default:<span> <strong>no</strong></span>)</td><td colspan="1" class="confluenceTd">Whether to redirect a frame to switch CPU port from a frame with a matching MAC destination address (matching destination or source address for CRS3xx series switches)</td></tr><tr><td colspan="1" class="confluenceTd"><strong>share-vlan-learned </strong>(<em>no | yes</em>; Default:<span> <strong>no</strong></span>)</td><td colspan="1" class="confluenceTd">Whether the static host MAC address lookup is used with shared-VLAN-learning (SVL) or independent-VLAN-learning (IVL). The SVL mode is used for those VLAN entries that do not support IVL or IVL is disabled (independent-learning=no)</td></tr><tr><td colspan="1" class="confluenceTd"><span><strong>switch</strong> </span>(<em>name</em>; Default:<span> <strong>none</strong></span>)</td><td colspan="1" class="confluenceTd">Name of the switch <span style="color:var(--ds-text,#333333);">to which the MAC address is going to be assigned to</span></td></tr><tr><td colspan="1" class="confluenceTd"><span><strong>vlan-id</strong> </span>(<em>integer: 0..4095</em>; Default:<strong> </strong>)</td><td colspan="1" class="confluenceTd">VLAN ID for the statically added MAC address entry</td></tr></tbody></table></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p><span class="mw-headline">Every switch chip has a finite number of MAC addresses it can store on the chip, see the Introduction table for a specific host table size. Once a host table is full, different techniques can be utilized to cope with the situation, for example, the switch can remove older entries to free space for more recent MAC addresses (used on QCA-8337 and Atheros-8327 switch chips), another option is to simply ignore the new MAC addresses and only remove entries after a timeout has passed (used on Atheros8316, Atheros8227, Atheros-7240, ICPlus175D and Realtek-RTL8367 switch chips), the last option is a combination of the previous two - only allow a certain amount of entries to be renewed and keep the other host portion intact till the timeout (used on MediaTek-MT7621, MT7531, <span style="color:var(--ds-text,#172b4d);">EN7562CT</span> switch chip). These techniques cannot be changed with configuration.</span></p></div></div><div role="region" aria-label="Warning" class="confluence-information-macro  confluence-information-macro-warning" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p class="auto-cursor-target">For <span class="mw-headline">Atheros8316, Atheros8227 and Atheros-7240 switch chips, the switch-cpu port will always participate in the host learning process when at least one hardware offloaded bridge port is active on the switching group. It will cause the switch-cpu port to learn MAC addresses from non-HW offloaded interfaces. This might cause packet loss when a single bridge contains HW and non-HW offloaded interfaces. Also, packet loss might appear when a duplicate MAC address is used on the same switching group regardless if hosts are located on different logical networks. It is recommended to use HW offloading only when all bridge ports can use HW offloaded or keep it disabled on all switch ports when one or more bridge ports cannot be configured with HW offloading.</span></p></div></div><div role="region" aria-label="Info" class="confluence-information-macro  confluence-information-macro-information" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-info-filled confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>The switch chips <span class="mw-headline"><strong>QCA-8337</strong> and <strong>Atheros-8327</strong> automatically add reserved mulitcast MAC addresses (01:80:C2:00:00:0x) to the host table when hardware-offloaded bridge is created with <strong>forward-reserved-addresses=no</strong> and <strong>protocol-mode=stp/rstp</strong>. These MACs should not be forwarded by 802.1Q compatible bridges and they are essential for correct operation with R/STP. Since the switch has a limited number of host table entries, these MAC addresses are only assigned to VLAN 1.</span></p><p>To ensure packets with these destination MAC addresses are processed correctly:</p><ul><li data-uuid="84005cd2-9a96-4980-a919-56b4eb6f2403">Switch ports should be set to default VLAN 1 <span class="mw-headline">(<code><span style="color:var(--ds-background-accent-green-bolder,#1f845a);">d</span><span style="color:var(--ds-background-accent-green-bolder,#1f845a);">efault-vlan-id=auto</span></code> or <span style="color:var(--ds-background-accent-green-bolder,#1f845a);"><code>default-vlan-id=1</code></span>).</span></li><li data-uuid="168228e5-ebd3-4767-8b14-37abdf6f8932"><span class="mw-headline">If VLAN 1 is explicitly configured, it must use independent VLAN learning <span class="mw-headline">(<code><span style="color:var(--ds-background-accent-green-bolder,#1f845a);">independent-learning=yes</span></code>).</span></span></li></ul></div></div><h2 class="auto-cursor-target" id="SwitchChipFeatures-RuleTable"><span style="font-size: 20.0px;letter-spacing: -0.008em;">Rule Table</span></h2><p>Rule table is a very powerful tool allowing wire-speed packet filtering, forwarding and VLAN tagging based on L2, L3 and L4 protocol header field conditions. The menu contains an ordered list of rules just like in<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>/ip firewall filter</code></span>, so ACL rules are checked for each packet until a match has been found. If multiple rules can match, then only the first rule will be triggered. A rule without any action parameters is a rule to accept the packet. </p><p>Each rule contains a conditions part and an action part. The action part is controlled by the following parameters:</p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col style="width: 248.0px;"/><col style="width: 1530.0px;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><span><strong>copy-to-cpu</strong> </span>(<em>no | yes</em>; Default:<span> </span><strong>no</strong>)</td><td class="confluenceTd">Whether to send a packet copy to switch CPU port</td></tr><tr><td colspan="1" class="confluenceTd"><strong>mirror</strong><span> </span>(<em>no | yes</em>; Default:<span> <strong>no</strong></span>)</td><td colspan="1" class="confluenceTd">Whether to send a packet copy to <span style="color:var(--ds-icon-success,#22a06b);"><code>mirror-target</code></span> port</td></tr><tr><td colspan="1" class="confluenceTd"><span><strong>new-dst-ports</strong> </span>(<em>name</em>; Default:<span> <strong>none</strong></span>)</td><td colspan="1" class="confluenceTd">Changes the destination port as specified, multiple ports allowed, including a switch CPU port. An empty setting will drop the packet. When the parameter is not used, the packet will be accepted</td></tr><tr><td colspan="1" class="confluenceTd"><span><strong>new-vlan-id</strong> </span>(<em>integer: 0..4095</em>)</td><td colspan="1" class="confluenceTd">Changes the VLAN ID to the specified value or adds a new VLAN tag if one was not already present (the property only applies to the<strong> Atheros8316</strong>, and <strong>88E6393X</strong> switch chips (<strong>NOTE</strong>: <span style="color:var(--ds-text-accent-purple-bolder,#352c63);">in case of </span>88E6393X <span style="color:var(--ds-text-accent-purple-bolder,#352c63);">switch chip, </span>vlan-filtering=yes<span style="color:var(--ds-text-accent-purple-bolder,#352c63);"> is also required)</span>  </td></tr><tr><td colspan="1" class="confluenceTd"><strong>new-vlan-priority </strong>(<em>integer: 0..7</em>)</td><td colspan="1" class="confluenceTd">Changes the VLAN priority field (priority code point, the property only applies to <strong>Atheros8327</strong>, <strong>QCA8337 </strong>and <strong>Atheros8316 </strong>switch chips)</td></tr><tr><td colspan="1" class="confluenceTd"><span><strong>rate</strong> </span>(<em>integer: 0..4294967295</em>)</td><td colspan="1" class="confluenceTd">Sets ingress traffic limitation (bits per second) for matched traffic, can only be applied to the first 32 rule slots (the property only applies to<strong> Atheros8327/QCA8337</strong> switch chips)</td></tr><tr><td colspan="1" class="confluenceTd"><span><strong>redirect-to-cpu</strong> </span>(<em>no | yes</em>; Default: <strong>no</strong>)</td><td colspan="1" class="confluenceTd">Changes the destination port of a matching packet to the switch CPU</td></tr></tbody></table></div><p>The conditions part is controlled by the rest of the parameters:</p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>disabled</strong> (<em>no | yes</em>; Default: <strong>no</strong>)</td><td class="confluenceTd">Enables or disables switch rule</td></tr><tr><td class="confluenceTd"><strong>dscp</strong> (<em>integer: 0..63</em>)</td><td class="confluenceTd">Matching DSCP field of the packet</td></tr><tr><td class="confluenceTd"><strong>dst-address</strong> (<em>IP address/Mask</em>)</td><td class="confluenceTd">Matching destination IP address and mask</td></tr><tr><td class="confluenceTd"><strong>dst-address6</strong> (<em>IPv6 address/Mask</em>)</td><td class="confluenceTd">Matching destination IPv6 address and mask</td></tr><tr><td class="confluenceTd"><strong>dst-mac-address</strong> (<em>MAC address/Mask</em>)</td><td class="confluenceTd">Matching destination MAC address and mask</td></tr><tr><td class="confluenceTd"><strong>dst-port</strong> (<em>integer: </em><em>0..65535</em>)</td><td class="confluenceTd">Matching destination protocol port number or range</td></tr><tr><td class="confluenceTd"><strong>flow-label</strong> (<em>integer: </em><em>0..1048575</em>)</td><td class="confluenceTd">Matching IPv6 flow label</td></tr><tr><td class="confluenceTd"><strong>mac-protocol</strong> (<em>802.2 | arp | capsman | dot1x | homeplug-av | ip | ipv6 | ipx | lacp | lldp | loop-protect | macsec | mpls-multicast | mpls-unicast | packing-compr | packing-simple | pppoe | pppoe-discovery | rarp | romon | service-vlan | vlan | or 0..65535 | or 0x0000-0xffff</em>)</td><td class="confluenceTd">Matching particular MAC protocol specified by protocol name or number (skips VLAN tags if any)</td></tr><tr><td class="confluenceTd"><strong>ports</strong> (<em>name</em>)</td><td class="confluenceTd">Name of the interface on which the rule will apply on the received traffic, multiple ports are allowed. If ports property is left empty, the rule will apply to all switch interfaces</td></tr><tr><td class="confluenceTd"><strong>protocol</strong> (<em>dccp | ddp | egp | encap | etherip | ggp | gre | hmp | icmp | icmpv6 | idpr-cmtp | igmp | ipencap | ipip | ipsec-ah | ipsec-esp | ipv6 | ipv6-frag | ipv6-nonxt | ipv6-opts | ipv6-route | iso-tp4 | l2tp | ospf | pim | pup | rdp | rspf | rsvp | sctp | st | tcp | udp | udp-lite | vmtp | vrrp | xns-idp | xtp | or 0..255</em>)</td><td class="confluenceTd">Matching particular IP protocol specified by protocol name or number</td></tr><tr><td class="confluenceTd"><strong>src-address</strong> (<em>IP address/Mask</em>)</td><td class="confluenceTd">Matching source IP address and mask</td></tr><tr><td class="confluenceTd"><strong>src-address6</strong> (<em>IPv6 address/Mask</em>)</td><td class="confluenceTd">Matching source IPv6 address and mask</td></tr><tr><td class="confluenceTd"><strong>src-mac-address</strong> (<em>MAC address/Mask</em>)</td><td class="confluenceTd">Matching source MAC address and mask</td></tr><tr><td class="confluenceTd"><strong>src-port</strong> (<em>0..65535</em>)</td><td class="confluenceTd">Matching source protocol port number or range</td></tr><tr><td class="confluenceTd"><strong>switch</strong> (<em>switch group</em>)</td><td class="confluenceTd">Matching switch group on which will the rule apply</td></tr><tr><td class="confluenceTd"><strong>traffic-class</strong> (<em>0..255</em>)</td><td class="confluenceTd">Matching IPv6 traffic class</td></tr><tr><td class="confluenceTd"><strong>vlan-id</strong> (<em>0..4095</em>)</td><td class="confluenceTd">Matching VLAN ID (the property only applies to the<span style="color:var(--ds-background-accent-red-bolder,#c9372c);"><strong> </strong><span style="color:var(--ds-text,#333333);">Atheros8316, Atheros8327, QCA8337, 88E6393X </span></span>switch chips)</td></tr><tr><td class="confluenceTd"><strong>vlan-header</strong> (<em>not-present | present</em>)</td><td class="confluenceTd"><p>Matching VLAN header, whether the VLAN header is present or not (the property only applies to th<span style="color:var(--ds-text,#333333);">e Atheros8316, Atheros8327, QCA8337, 88E6393X switch chips. <span style="color:var(--ds-text-accent-purple-bolder,#352c63);">in case of <strong>88E6393X </strong>switch chip, vlan-filtering=yes is also required</span></span>)</p></td></tr><tr><td class="confluenceTd"><strong>vlan-priority</strong> (<em>0..7</em>)</td><td class="confluenceTd">Matching VLAN priority (priority code point)</td></tr></tbody></table></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>IPv4 and IPv6 specific conditions cannot be present in the same rule.</p></div></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Because the rule table is processed entirely in switch chips hardware, there is a limitation to how many rules you may have. Depending on the number of conditions (MAC layer, IP layer, IPv6, L4 layer) you use in your rules, the number of active rules may vary from 8 to 32 for Atheros8316 switch chip, from 8 to 16 for Atheros8327/QCA8337 switch chip and from 42 to 256 for 88E6393X switch chip. You can always do <code><span style="color:var(--ds-icon-success,#22a06b);">/interface ethernet switch rule print</span> </code>after modifying your rule set to see that no rules at the end of the list are 'invalid' which means those rules did not fit into the switch chip.</p></div></div><h2 id="SwitchChipFeatures-Portisolation"><span class="mw-headline">Port isolation</span></h2><p>Port isolation provides the possibility to divide (isolate) certain parts of your network, this might be useful when you need to make sure that certain devices cannot access other devices, this can be done by isolating switch ports. Port isolation only works between ports that are members of the same switch. Switch port isolation is available on all switch chips since RouterOS v6.43.</p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>forwarding-override</strong><span> </span>(<em>interface</em>; Default: )</td><td class="confluenceTd">Forces ingress traffic to be forwarded to a specific interface. Multiple interfaces can be specified by separating them with a comma.</td></tr></tbody></table></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>(R/M)STP will only work properly in PVLAN setups, (R/M)STP will not work properly in setups, where there are multiple isolated switch groups, because switch groups might not properly receive BPDUs and therefore fail to detect network loops.</p></div></div><div role="region" aria-label="Warning" class="confluence-information-macro  confluence-information-macro-warning" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>The<span> </span><code>forwarding-override</code><span> </span>property affects ingress traffic only. Switch ports that do not have the<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>forwarding-override</code></span><span> </span>specified can send packets through all switch ports.</p></div></div><div role="region" aria-label="Warning" class="confluence-information-macro  confluence-information-macro-warning" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Switch chips with a VLAN table support (<strong>QCA8337</strong>,<span> </span><strong>Atheros8327</strong>,<span> </span><strong>Atheros8316</strong>,<span> </span><strong>Atheros8227</strong><span> </span>and<span> </span><strong>Atheros7240</strong>) can override the port isolation configuration when enabling a VLAN lookup on the switch port (the<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>vlan-mode</code></span><span> </span>is set to<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>fallback</code></span>,<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>check</code></span><span> </span>or<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>secure</code></span>). If additional port isolation is needed between ports on the same VLAN, a switch rule with a<span> </span>new-dst-ports<span> </span>property can be implemented. Other devices without switch rule support cannot overcome this limitation.</p></div></div><h3 id="SwitchChipFeatures-PrivateVLAN"><span class="mw-headline">Private VLAN</span></h3><p>In some scenarios, you might need to forward all traffic to an uplink port while all other ports are isolated from each other. This kind of setup is called<span> </span><strong>Private VLAN</strong><span> </span>configuration, the<span> </span><strong>Switch</strong><span> </span>will forward all Ethernet frames directly to the uplink port allowing the<span> </span><strong>Router</strong><span> </span>to filter unwanted packets and limit access between devices that are behind switch ports.</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/15302988/16351616.png" data-image-src="attachments/15302988/16351616.png" data-unresolved-comment-count="0" data-linked-resource-id="16351616" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="Isolation.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="15302988" data-linked-resource-container-version="89" tabindex="0" alt=""></span></p><p>To configure switch port isolation, you need to switch all required ports:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge
add name=bridge1
/interface bridge port
add interface=sfp1 bridge=bridge1 hw=yes
add interface=ether1 bridge=bridge1 hw=yes
add interface=ether2 bridge=bridge1 hw=yes
add interface=ether3 bridge=bridge1 hw=yes</pre>
</div></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>By default, the bridge interface is configured with <code>protocol-mode</code> set to <code>rstp</code>. For some devices, this can disable hardware offloading because specific switch chips do not support this feature. See the <a href="https://help.mikrotik.com/docs/display/ROS/Bridging+and+Switching#BridgingandSwitching-BridgeHardwareOffloading" rel="nofollow">Bridge Hardware Offloading</a> section with supported features.</p></div></div><p>Override the egress port for each switch port that needs to be isolated (excluding the uplink port):</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface ethernet switch port-isolation
set ether1 forwarding-override=sfp1
set ether2 forwarding-override=sfp1
set ether3 forwarding-override=sfp1</pre>
</div></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>It is possible to set multiple uplink ports for a single switch chip, this can be done by specifying multiple interfaces and separating them with a comma.</p></div></div><h3 id="SwitchChipFeatures-Isolatedswitchgroups"><span class="mw-headline">Isolated switch groups</span></h3><p>In some scenarios you might need to isolate a group of devices from other groups, this can be done using the switch port isolation feature. This is useful when you have multiple networks but you want to use a single switch, with port isolation you can allow certain switch ports to be able to communicate through only a set of switch ports. In this example, devices on<span> </span><strong>ether1-3</strong><span> </span>will only be able to communicate with devices that are on<span> </span><strong>ether1-3</strong>, while devices on<span> </span><strong>ether4-5</strong><span> </span>will only be able to communicate with devices on<span> </span><strong>ether4-5</strong><span> </span>(<strong>ether1-3</strong><span> </span>is not able to communicate with<span> </span><strong>ether4-5</strong>)</p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Port isolation is only available between ports that are members of the same switch.</p></div></div><p><br/></p><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/15302988/66355232.png" data-image-src="attachments/15302988/66355232.png" data-unresolved-comment-count="0" data-linked-resource-id="66355232" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Port_isolation_2.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="15302988" data-linked-resource-container-version="89" tabindex="0" alt=""></span></p><p>To configure isolated switch groups you must first switch all ports:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge
add name=bridge
/interface bridge port
add bridge=bridge1 interface=ether1 hw=yes
add bridge=bridge1 interface=ether2 hw=yes
add bridge=bridge1 interface=ether3 hw=yes
add bridge=bridge1 interface=ether4 hw=yes
add bridge=bridge1 interface=ether5 hw=yes</pre>
</div></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>By default, the bridge interface is configured with <span style="color:var(--ds-icon-success,#22a06b);"><code>protocol-mode</code></span> set to <span style="color:var(--ds-icon-success,#22a06b);"><code>rstp</code></span>. For some devices, this can disable hardware offloading because specific switch chips do not support this feature. See the <a href="https://help.mikrotik.com/docs/display/ROS/Bridging+and+Switching#BridgingandSwitching-BridgeHardwareOffloading" rel="nofollow">Bridge Hardware Offloading</a> section with supported features.</p></div></div><p>Then specify in the<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>forwarding-override</code></span><span> </span>property all ports that you want to be in the same isolated switch group (except the port on which you are applying the property), for example, to create an isolated switch group for<span> </span><strong>A</strong><span> </span>devices:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface ethernet switch port-isolation
set ether1 forwarding-override=ether2,ether3
set ether2 forwarding-override=ether1,ether3
set ether3 forwarding-override=ether1,ether2</pre>
</div></div><p>To create an isolated switch group for<span> </span><strong>B</strong><span> </span>devices:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface ethernet switch port-isolation
set ether4 forwarding-override=ether5
set ether5 forwarding-override=ether4</pre>
</div></div><h2 id="SwitchChipFeatures-CPUFlowControl"><span class="mw-headline">CPU Flow Control</span></h2><p>All switch chips have a special port that is called<span> </span><strong>switchX-cpu</strong>, this is the CPU port for a switch chip, it is meant to forward traffic from a switch chip to the CPU, such a port is required for management traffic and routing features. By default the switch chip ensures that this special CPU port is not congested and sends out Pause Frames when link capacity is exceeded to make sure the port is not oversaturated, this feature is called<span> </span><strong>CPU Flow Control</strong>. Without this feature packets that might be crucial for routing or management purposes might get dropped.</p><p>Since RouterOS v6.43 it is possible to disable the CPU Flow Control feature on some devices that are using one of the following switch chips: QCA8337, Atheros8227, Atheros8327, Atheros7240, Atheros8316, <span style="color:var(--ds-text,#172b4d);">88E6191X and 88E6393X</span> . Other switch chips have this feature enabled by default and cannot be changed. To disable CPU Flow Control use the following command:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface ethernet switch set switch1 cpu-flow-control=no</pre>
</div></div><h2 id="SwitchChipFeatures-Statistics"><span class="mw-headline">Statistics</span></h2><p>Some switch chips are capable of reporting statistics, this can be useful to monitor how many packets are sent to the CPU from the built-in switch chip. These statistics can also be used to monitor CPU Flow Control. You can find an example of the switch chip's statistics below:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] &gt; /interface ethernet switch print stats

                      name:      switch1
            driver-rx-byte:  221 369 701
          driver-rx-packet:    1 802 975
            driver-tx-byte:   42 621 969
          driver-tx-packet:      310 485
                  rx-bytes:  414 588 529
                 rx-packet:    2 851 236
              rx-too-short:            0
               rx-too-long:            0
              rx-broadcast:    1 040 309
                  rx-pause:            0
              rx-multicast:      486 321
              rx-fcs-error:            0
            rx-align-error:            0
               rx-fragment:            0
                rx-control:            0
             rx-unknown-op:            0
           rx-length-error:            0
             rx-code-error:            0
          rx-carrier-error:            0
                 rx-jabber:            0
                   rx-drop:            0
                  tx-bytes:   44 071 621
                 tx-packet:      312 597
              tx-too-short:            0
               tx-too-long:        8 397
              tx-broadcast:        2 518
                  tx-pause:        2 112
              tx-multicast:        7 142
    tx-excessive-collision:            0
     tx-multiple-collision:            0
       tx-single-collision:            0
     tx-excessive-deferred:            0
               tx-deferred:            0
         tx-late-collision:            0
        tx-total-collision:            0
                   tx-drop:            0
                 tx-jabber:            0
              tx-fcs-error:            0
                tx-control:        2 112
               tx-fragment:            0
                  tx-rx-64:        6 646
              tx-rx-65-127:    1 509 891
             tx-rx-128-255:    1 458 299
             tx-rx-256-511:      178 975
            tx-rx-512-1023:          953
           tx-rx-1024-1518:          672
            tx-rx-1519-max:            0</pre>
</div></div><p>Some devices have multiple CPU cores that are directly connected to a built-in switch chip using separate data lanes. These devices can report which data lane was used to forward the packet from or to the CPU port from the switch chip. For such devices an extra line is added for each row, the first line represents data that was sent using the first data lane, the second line represents data that was sent using the second data line, and so on. You can find an example of the switch chip's statistics for a device with multiple data lanes connecting the CPU and the built-in switch chip:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] &gt; /interface ethernet switch print stats
                  name:      switch1
        driver-rx-byte:  226 411 248
                                   0
      driver-rx-packet:    1 854 971
                                   0
        driver-tx-byte:   45 988 067
                                   0
      driver-tx-packet:      345 282
                                   0
              rx-bytes:  233 636 763
                                   0
             rx-packet:    1 855 018
                                   0
          rx-too-short:            0
                                   0
           rx-too-long:            0
                                   0
              rx-pause:            0
                                   0
          rx-fcs-error:            0
                                   0
           rx-overflow:            0
                                   0
              tx-bytes:   47 433 203
                                   0
             tx-packet:      345 282
                                   0
    tx-total-collision:            0
                                   0</pre>
</div></div><h1 id="SwitchChipFeatures-SetupExamples"><span class="mw-headline">Setup Examples</span></h1><hr/><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Make sure you have added all needed interfaces to the VLAN table when using secure <code>vlan-mode</code>. For routing functions to work properly on the same device through ports that use secure <code>vlan-mode</code>, you will need to allow access to the CPU from those ports, this can be done by adding the switchX-cpu interface itself to the VLAN table. Examples can be found in the <a href="https://help.mikrotik.com/docs/display/ROS/Switch+Chip+Features#SwitchChipFeatures-Managementaccessconfiguration" rel="nofollow">Management port</a> section.</p></div></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>It is possible to use the built-in switch chip and the CPU at the same time to create a Switch-Router setup, where a device acts as a switch and as a router at the same time. You can find a configuration example in the<span> </span><a class="external-link" href="https://wiki.mikrotik.com/wiki/Manual:Switch_Router" rel="nofollow" style="text-decoration: none;" title="Manual:Switch Router">Switch-Router</a><span> </span>guide.</p></div></div><p><br/></p><div role="region" aria-label="Warning" class="confluence-information-macro  confluence-information-macro-warning" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>When allowing access to the CPU, you are allowing access from a certain port to the actual router/switch, this is not always desirable. Make sure you implement proper firewall filter rules to secure your device when access to the CPU is allowed from a certain VLAN ID and port, use firewall filter rules to allow access to only certain services.</p></div></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Devices with <strong>MT7621</strong>, <strong>MT7531</strong>, <strong><span style="color:var(--ds-text,#172b4d);">EN7562CT,</span> RTL8367</strong>, <strong>88E6393X</strong>, <strong>88E6191X,</strong> <span style="color:var(--ds-text,#172b4d);"><strong>88E6190 </strong></span>switch chips support <a href="https://help.mikrotik.com/docs/display/ROS/Bridging+and+Switching#BridgingandSwitching-BridgeVLANFiltering" rel="nofollow">HW offloaded vlan-filtering</a> in RouterOS v7. VLAN-related configuration on the &quot;/interface ethernet switch&quot; menu is not available. </p></div></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>For VLAN related matchers or VLAN related action parameters to work on <strong>88E6393X </strong>switch chip, you need to enable vlan-filtering on the bridge interface and make sure that hardware offloading is enabled on those ports, otherwise, these parameters will not have any effect.. </p></div></div><h2 id="SwitchChipFeatures-VLANExample1(TrunkandAccessPorts)"><span class="mw-headline">VLAN Example 1 (Trunk and Access Ports)</span></h2><p style="text-align: justify;">RouterBOARDs with Atheros switch chips can be used for 802.1Q Trunking. This feature in RouterOS v6 is supported by<span> </span><strong>QCA8337, Atheros8316, Atheros8327, Atheros8227</strong><span> </span>and<span> </span><strong>Atheros7240</strong><span> </span>switch chips. In this example,<span> </span><strong>ether3</strong>, <strong>ether4,</strong><span> </span>and<span> </span><strong>ether5</strong><span> </span>interfaces are access ports, while<span> </span><strong>ether2</strong><span> </span>is a trunk port. VLAN IDs for each access port: ether3 - 400, ether4 - 300, ether5 - 200.</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/15302988/76939375.png" data-image-src="attachments/15302988/76939375.png" data-unresolved-comment-count="0" data-linked-resource-id="76939375" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="access_ports_small.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="15302988" data-linked-resource-container-version="89" tabindex="0" alt=""></span></p><p>Switch together the required ports:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge
add name=bridge1
/interface bridge port
add bridge=bridge1 interface=ether2 hw=yes
add bridge=bridge1 interface=ether3 hw=yes
add bridge=bridge1 interface=ether4 hw=yes
add bridge=bridge1 interface=ether5 hw=yes</pre>
</div></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>By default, the bridge interface is configured with<span> </span><code>protocol-mode</code><span> </span>set to<span> </span><code>rstp</code>. For some devices, this can disable hardware offloading because specific switch chips do not support this feature. See the<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/Bridging+and+Switching#BridgingandSwitching-BridgeHardwareOffloading" rel="nofollow">Bridge Hardware Offloading</a><span> </span>section with supported features.</p></div></div><p>Add VLAN table entries to allow frames with specific VLAN IDs between ports:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface ethernet switch vlan
add ports=ether2,ether3 switch=switch1 vlan-id=200
add ports=ether2,ether4 switch=switch1 vlan-id=300
add ports=ether2,ether5 switch=switch1 vlan-id=400</pre>
</div></div><p>Assign<span> </span><code>vlan-mode</code><span> </span>and<span> </span><code>vlan-header</code> mode for each port and also<span> </span><code>default-vlan-id</code><span> </span>on ingress for each access port:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface ethernet switch port
set ether2 vlan-mode=secure vlan-header=add-if-missing
set ether3 vlan-mode=secure vlan-header=always-strip default-vlan-id=200
set ether4 vlan-mode=secure vlan-header=always-strip default-vlan-id=300
set ether5 vlan-mode=secure vlan-header=always-strip default-vlan-id=400</pre>
</div></div><ul><li>Setting<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>vlan-mode=secure</code></span><span> </span>ensures strict use of the VLAN table.</li><li>Setting<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>vlan-header=always-strip</code></span><span> </span>for access ports removes the VLAN header from the frame when it leaves the switch chip.</li><li>Setting<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>vlan-header=add-if-missing</code></span><span> </span>for trunk port adds VLAN header to untagged frames.</li><li><span style="color:var(--ds-icon-success,#22a06b);"><code>default-vlan-id</code></span><span> </span>specifies what VLAN ID is added for untagged ingress traffic of the access port.</li></ul><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>On <strong>QCA8337</strong> and <strong>Atheros8327</strong> switch chips, a default <code>vlan-header=leave-as-is</code> property should be used. The switch chip will determine which ports are access ports by using the <span style="color:var(--ds-icon-success,#22a06b);"><code>default-vlan-id</code></span> property. The <span style="color:var(--ds-icon-success,#22a06b);"><code>default-vlan-id</code> </span>should only be used on access/hybrid ports to specify which VLAN the untagged ingress traffic is assigned to.</p></div></div><h2 id="SwitchChipFeatures-VLANExample2(TrunkandHybridPorts)"><span class="mw-headline">VLAN Example 2 (Trunk and Hybrid Ports)</span></h2><p style="text-align: justify;">VLAN Hybrid ports can forward both tagged and untagged traffic. This configuration is supported only by some Gigabit switch chips (<strong>QCA8337, Atheros8327</strong>).</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/15302988/76939376.png" data-image-src="attachments/15302988/76939376.png" data-unresolved-comment-count="0" data-linked-resource-id="76939376" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="hybrid_ports_small.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="15302988" data-linked-resource-container-version="89" tabindex="0" alt=""></span></p><p>Switch together the required ports:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge
add name=bridge1
/interface bridge port
add bridge=bridge1 interface=ether2 hw=yes
add bridge=bridge1 interface=ether3 hw=yes
add bridge=bridge1 interface=ether4 hw=yes
add bridge=bridge1 interface=ether5 hw=yes</pre>
</div></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>By default, the bridge interface is configured with<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>protocol-mode</code></span><span> </span>set to<span style="color:var(--ds-icon-success,#22a06b);"> <code>rstp</code></span>. For some devices, this can disable hardware offloading because specific switch chips do not support this feature. See the<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/Bridging+and+Switching#BridgingandSwitching-BridgeHardwareOffloading" rel="nofollow">Bridge Hardware Offloading</a><span> </span>section with supported features.</p></div></div><p>Add VLAN table entries to allow frames with specific VLAN IDs between ports.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface ethernet switch vlan
add ports=ether2,ether3,ether4,ether5 switch=switch1 vlan-id=200
add ports=ether2,ether3,ether4,ether5 switch=switch1 vlan-id=300
add ports=ether2,ether3,ether4,ether5 switch=switch1 vlan-id=400</pre>
</div></div><p>In the switch port menu set<span style="color:var(--ds-icon-success,#22a06b);"> <code>vlan-mode</code></span><span> </span>on all ports and also<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>default-vlan-id</code></span><span> </span>on planned hybrid ports:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface ethernet switch port
set ether2 vlan-mode=secure vlan-header=leave-as-is
set ether3 vlan-mode=secure vlan-header=leave-as-is default-vlan-id=200
set ether4 vlan-mode=secure vlan-header=leave-as-is default-vlan-id=300
set ether5 vlan-mode=secure vlan-header=leave-as-is default-vlan-id=400</pre>
</div></div><ul><li><span style="color:var(--ds-icon-success,#22a06b);"><code>vlan-mode=secure</code></span><span> </span>will ensure strict use of the VLAN table.</li><li><span style="color:var(--ds-icon-success,#22a06b);"><code>default-vlan-id</code></span><span> </span>will define VLAN for untagged ingress traffic on the port.</li><li>In QCA8337 and Atheros8327 chips when<span> </span><code><span style="color:var(--ds-icon-success,#22a06b);">vlan-mode=secur</span>e</code><span> </span>is used, it ignores switch port<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>vlan-header</code></span><span> </span>options. VLAN table entries handle all the egress tagging/untagging and works as<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>vlan-header=leave-as-is</code></span><span> </span>on all ports. It means what comes in tagged, goes out tagged as well, only<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>default-vlan-id</code></span><span> </span>frames are untagged at the egress port.</li></ul><h2 id="SwitchChipFeatures-Managementaccessconfiguration"><span class="mw-headline">Management access configuration</span></h2><p>In these examples, there will be shown examples for multiple scenarios, but each of these scenarios requires you to have switched ports. Below you can find how to switch multiple ports:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge
add name=bridge1
/interface bridge port
add interface=ether1 bridge=bridge1 hw=yes
add interface=ether2 bridge=bridge1 hw=yes</pre>
</div></div><p><br/></p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>By default, the bridge interface is configured with<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>protocol-mode</code></span><span> </span>set to<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>rstp</code></span>. For some devices, this can disable hardware offloading because specific switch chips do not support this feature. See the<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/Bridging+and+Switching#BridgingandSwitching-BridgeHardwareOffloading" rel="nofollow">Bridge Hardware Offloading</a><span> </span>section with supported features.</p></div></div><p>In these examples, it will be assumed that<span> </span><strong>ether1</strong><span> </span>is the trunk port and<span> </span><strong>ether2</strong><span> </span>is the access port, for configuration as the following:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface ethernet switch port
set ether1 vlan-header=add-if-missing
set ether2 default-vlan-id=100 vlan-header=always-strip
/interface ethernet switch vlan
add ports=ether1,ether2,switch1-cpu switch=switch1 vlan-id=100</pre>
</div></div><h3 id="SwitchChipFeatures-Tagged"><span class="mw-headline">Tagged</span></h3><p>To make the device accessible only from a certain VLAN, you need to create a new VLAN interface on the bridge interface and assign an IP address to it:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface vlan
add name=MGMT vlan-id=99 interface=bridge1
/ip address
add address=192.168.99.1/24 interface=MGMT</pre>
</div></div><p>Specify from which interfaces it is allowed to access the device:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface ethernet switch vlan
add ports=ether1,switch1-cpu switch=switch1 vlan-id=99</pre>
</div></div><p style="margin-left: 20.0px;"><br/></p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Only specify trunk ports in this VLAN table entry, it is not possible to allow access to the CPU with tagged traffic through an access port since the access port will tag all ingress traffic with the specified<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>default-vlan-id</code></span><span> </span>value.</p></div></div><p>When the VLAN table is configured, you can enable<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>vlan-mode=secure</code></span><span> </span>to limit access to the CPU:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface ethernet switch port
set ether1 vlan-header=add-if-missing vlan-mode=secure
set ether2 default-vlan-id=100 vlan-header=always-strip vlan-mode=secure
set switch1-cpu vlan-header=leave-as-is vlan-mode=secure</pre>
</div></div><h3 id="SwitchChipFeatures-Untagged"><span class="mw-headline">Untagged</span></h3><p>To make the device accessible from the access port, create a VLAN interface with the same VLAN ID as set in<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>default-vlan-id</code></span>, for example, VLAN 100, and add an IP address to it:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface vlan
add name=VLAN100 vlan-id=100 interface=bridge1
/ip address
add address=192.168.100.1/24 interface=VLAN100</pre>
</div></div><p>Specify which access (untagged) ports are allowed to access the CPU:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface ethernet switch vlan
add ports=ether1,ether2,switch1-cpu switch=switch1 vlan-id=100</pre>
</div></div><div role="region" aria-label="Warning" class="confluence-information-macro  confluence-information-macro-warning" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Most commonly an access (untagged) port is accompanied by a trunk (tagged) port. In case of untagged access to the CPU, you are forced to specify both the access port and the trunk port, this gives access to the CPU from the trunk port as well. Not always this is desired and a Firewall might be required on top of VLAN filtering.</p></div></div><p>When the VLAN table is configured, you can enable<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>vlan-mode=secure</code></span><span> </span>to limit access to the CPU:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface ethernet switch port
set ether1 vlan-header=add-if-missing vlan-mode=secure
set ether2 default-vlan-id=100 vlan-header=always-strip vlan-mode=secure
set switch1-cpu vlan-header=leave-as-is vlan-mode=secure</pre>
</div></div><p><br/></p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>To setup the management port using untagged traffic on a device with the<span> </span><strong>Atheros7240</strong><span> </span>switch chip, you will need to set<span> </span><code><span style="color:var(--ds-icon-success,#22a06b);">vlan-header=add-if-missin</span>g</code><span> </span>for the CPU port.</p></div></div><h3 id="SwitchChipFeatures-Untaggedfromtaggedport"><span class="mw-headline">Untagged from tagged port</span></h3><p>It is possible to allow access to the device from the trunk (tagged) port with untagged traffic. To do so, assign an IP address on the bridge interface:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip address
add address=10.0.0.1/24 interface=bridge1</pre>
</div></div><p>Specify which ports are allowed to access the CPU. Use<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>vlan-id</code></span><span> </span>that is used in<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>default-vlan-id</code></span><span> </span>for switch-cpu and trunk ports, by default it is set to 0 or 1.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface ethernet switch vlan
add ports=ether1,switch1-cpu switch=switch1 vlan-id=1</pre>
</div></div><p>When the VLAN table is configured, you can enable<span> </span><code>vlan-mode=secure</code><span> </span>to limit access to the CPU:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface ethernet switch port
set ether1 default-vlan-id=1 vlan-header=add-if-missing vlan-mode=secure
set switch1-cpu default-vlan-id=1 vlan-header=leave-as-is vlan-mode=secure</pre>
</div></div><p><strong> </strong></p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>This configuration example is not possible for devices with the<span> </span><strong>Atheros8316</strong><span> </span>and<span> </span><strong>Atheros7240</strong><span> </span>switch chips. For devices with<span> </span><strong>QCA8337</strong><span> </span>and<span> </span><strong>Atheros8327</strong><span> </span>switch chips, it is possible to use any other<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>default-vlan-id</code></span><span> </span>as long as it stays the same on switch-cpu and trunk ports. For devices with<span> </span><strong>Atheros8227</strong><span> </span>switch chip only<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>default-vlan-id=0</code> </span>can be used and the trunk port must use<span> </span><span style="color:var(--ds-icon-success,#22a06b);"><code>vlan-header=leave-as-is</code></span>.</p></div></div><h2 id="SwitchChipFeatures-Inter-VLANrouting"><span class="mw-headline">Inter-VLAN routing</span></h2><p><span class="mw-headline"><span style="color:var(--ds-text,#333333);">Many MikroTik's devices come with a built-in switch chip that can be used to greatly improve overall throughput when configured properly. Devices with a switch chip can be used as a router and a switch at the same time, this gives you the possibility to use a single device instead of multiple devices for your network.</span></span></p><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/15302988/131366957.jpg" data-image-src="attachments/15302988/131366957.jpg" data-unresolved-comment-count="0" data-linked-resource-id="131366957" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Switch_router.jpg" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="15302988" data-linked-resource-container-version="89" tabindex="0" alt=""></span></p><p><br/></p><p>For this type of setup to work, you must switch all required ports together</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface bridge
add name=bridge1
/interface bridge port
add bridge=bridge1 interface=ether2 hw=yes
add bridge=bridge1 interface=ether3 hw=yes</pre>
</div></div><p>Create a VLAN interface for each VLAN ID and assign an IP address to it:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface vlan
add interface=bridge1 name=VLAN10 vlan-id=10
add interface=bridge1 name=VLAN20 vlan-id=20
/ip address
add address=192.168.10.1/24 interface=VLAN10
add address=192.168.20.1/24 interface=VLAN20</pre>
</div></div><p>Setup a DHCP Server for each VLAN:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip pool
add name=POOL10 ranges=192.168.10.100-192.168.10.200
add name=POOL20 ranges=192.168.20.100-192.168.20.200
/ip dhcp-server
add address-pool=POOL10 disabled=no interface=VLAN10 name=DHCP10
add address-pool=POOL20 disabled=no interface=VLAN20 name=DHCP20
/ip dhcp-server network
add address=192.168.10.0/24 dns-server=8.8.8.8 gateway=192.168.10.1
add address=192.168.20.0/24 dns-server=8.8.8.8 gateway=192.168.20.1</pre>
</div></div><p>Enable NAT on the device:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip firewall nat
add action=masquerade chain=srcnat out-interface=ether1</pre>
</div></div><p>Add each port to the VLAN table and allow these ports to access the CPU to make DHCP and routing work:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface ethernet switch vlan
add independent-learning=yes ports=ether2,switch1-cpu switch=switch1 vlan-id=10
add independent-learning=yes ports=ether3,switch1-cpu switch=switch1 vlan-id=20</pre>
</div></div><p>Specify each port to be an access port, and enable secure VLAN mode on each port and on the switch1-cpu port:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface ethernet switch port
set ether2 default-vlan-id=10 vlan-header=always-strip vlan-mode=secure
set ether3 default-vlan-id=20 vlan-header=always-strip vlan-mode=secure
set switch1-cpu vlan-mode=secure</pre>
</div></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>On <strong>QCA8337</strong> and <strong>Atheros8327</strong> switch chips, a default <span style="color:var(--ds-icon-success,#22a06b);"><code>vlan-header=leave-as-is</code></span> property should be used. The switch chip will determine which ports are access ports by using the <span style="color:var(--ds-icon-success,#22a06b);"><code>default-vlan-id</code></span> property. The <span style="color:var(--ds-icon-success,#22a06b);"><code>default-vlan-id</code></span> should only be used on access/hybrid ports to specify which VLAN the untagged ingress traffic is assigned to.</p></div></div><p><span style="color:var(--ds-text,#333333);">If your device has a switch rule table, then you can limit access between VLANs on a hardware level. As soon as you add an IP address on the VLAN interface you enable inter-VLAN routing, but this can be limited on a hardware level while preserving DHCP Server and other router-related services. To do so, use these ACL rules. With this type of configuration, you can achieve isolated port groups using VLANs.</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/interface ethernet switch rule
add dst-address=192.168.20.0/24 new-dst-ports=&quot;&quot; ports=ether2 switch=switch1
add dst-address=192.168.10.0/24 new-dst-ports=&quot;&quot; ports=ether3 switch=switch1</pre>
</div></div><h1 id="SwitchChipFeatures-Seealso"><span class="mw-headline">See also</span></h1><ul><li><a class="external-link" href="https://wiki.mikrotik.com/wiki/Manual:Switch_Router" rel="nofollow" style="text-decoration: none;" title="Manual:Switch Router">Switch Router</a></li><li><a href="https://help.mikrotik.com/docs/display/ROS/Basic+VLAN+switching" rel="nofollow">Basic VLAN Switching</a></li><li><a href="https://help.mikrotik.com/docs/display/ROS/Bridging+and+Switching#BridgingandSwitching-BridgeHardwareOffloading" rel="nofollow">Bridge Hardware Offloading</a></li><li><a href="https://help.mikrotik.com/docs/display/ROS/Spanning+Tree+Protocol" rel="nofollow">Spanning Tree Protocol</a></li><li><a href="https://help.mikrotik.com/docs/display/ROS/Bridging+and+Switching#BridgingandSwitching-DHCPSnoopingandDHCPOption82" rel="nofollow">DHCP Snooping and Option 82</a></li><li><a href="https://help.mikrotik.com/docs/display/ROS/MTU+in+RouterOS" rel="nofollow">MTU on RouterBOARD</a></li><li><a href="https://help.mikrotik.com/docs/display/ROS/Layer2+misconfiguration" rel="nofollow">Layer2 misconfiguration</a></li><li><a class="external-link" href="https://wiki.mikrotik.com/wiki/Manual:Master-port" rel="nofollow" style="text-decoration: none;" title="Manual:Master-port">Master-port</a></li></ul>
                    </div>

                                                            <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15302988/62390297.png">Port_isolation.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15302988/62390286.png">Isolation.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15302988/19136841.png">Switch4.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15302988/21102643.png">Ath1.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15302988/21102644.png">Ath2.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15302988/16351616.png">Isolation.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15302988/16351614.png">Port_isolation.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15302988/66355232.png">Port_isolation_2.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15302988/76939382.png">access_ports_small.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15302988/76939376.png">hybrid_ports_small.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15302988/76939375.png">access_ports_small.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15302988/128221378.png">Switch_router.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/15302988/131366957.jpg">Switch_router.jpg</a> (image/jpeg)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on May 20, 2025 14:53</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
