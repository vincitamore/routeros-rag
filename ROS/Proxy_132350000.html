<!DOCTYPE html>
<html>
    <head>
        <title>RouterOS : Proxy</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">RouterOS</a></span>
                            </li>
                                                    <li>
                                <span><a href="RouterOS_328059.html">RouterOS</a></span>
                            </li>
                                                    <li>
                                <span><a href="Network-Management_119144613.html">Network Management</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            RouterOS : Proxy
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> Artūrs C.</span>, last updated on Jul 21, 2022
    
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h1 id="Proxy-Summary"><style type='text/css'>/*<![CDATA[*/
div.rbtoc1747742030842 {padding: 0px;}
div.rbtoc1747742030842 ul {margin-left: 0px;}
div.rbtoc1747742030842 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1747742030842'>
<ul class='toc-indentation'>
<li><a href='#Proxy-Summary'>Summary</a></li>
<li><a href='#Proxy-Configurationexamples'>Configuration examples</a>
<ul class='toc-indentation'>
<li><a href='#Proxy-Transparentproxyconfigurationexample'>Transparent proxy configuration example</a></li>
<li><a href='#Proxy-Proxy-basedfirewall–AccessList'>Proxy-based firewall – Access List</a></li>
</ul>
</li>
<li><a href='#Proxy-EnablingRAMorStore-basedcaching.'>Enabling RAM or Store-based caching.</a>
<ul class='toc-indentation'>
<li><a href='#Proxy-RAMproxycache:'>RAM proxy cache:</a></li>
<li><a href='#Proxy-Storeproxycache:'>Store proxy cache:</a></li>
</ul>
</li>
<li><a href='#Proxy-Reference'>Reference</a>
<ul class='toc-indentation'>
<li><a href='#Proxy-General'>General</a></li>
<li><a href='#Proxy-AccessList'>Access List</a></li>
<li><a href='#Proxy-DirectAccess'>Direct Access</a></li>
<li><a href='#Proxy-CacheManagement'>Cache Management</a></li>
<li><a href='#Proxy-Connections'>Connections</a></li>
<li><a href='#Proxy-CacheInserts'>Cache Inserts</a></li>
<li><a href='#Proxy-CacheLookups'>Cache Lookups</a></li>
<li><a href='#Proxy-CacheContents'>Cache Contents</a></li>
</ul>
</li>
<li><a href='#Proxy-HTTPMethods'>HTTP Methods</a>
<ul class='toc-indentation'>
<li><a href='#Proxy-Options'>Options</a></li>
<li><a href='#Proxy-GET'>GET</a></li>
<li><a href='#Proxy-HEAD'>HEAD</a></li>
<li><a href='#Proxy-POST'>POST</a></li>
<li><a href='#Proxy-PUT'>PUT</a></li>
<li><a href='#Proxy-TRACE'>TRACE</a></li>
</ul>
</li>
</ul>
</div>Summary</h1><p>MikroTik RouterOS performs proxying of HTTP and HTTP-proxy (for FTP and HTTP protocols) requests. The proxy server performs the Internet object cache function by storing requested Internet objects, i.e., data available via HTTP and FTP protocols on a system positioned closer to the recipient in the form of speeding up customer browsing by delivering them requested file copies from the proxy cache at local network speed. MikroTik RouterOS implements the following proxy server features:</p><ul class="bullets"><li>Regular HTTP proxy – customer (itself) specifies what is a proxy server for him;</li><li>Transparent proxy – the customer does not know about the proxy being enabled and there isn’t a necessity for any additional configuration for the web browser of the client;</li><li>Access list by source, destination, URL, and requested method (HTTP firewall);</li><li>Cache access list to specify which objects to cache, and which not;</li><li>Direct Access List – to specify which resources should be accessed directly, and which - through another proxy server;</li><li>Logging facility – allows to get and store information about the proxy operation;</li><li>Parent proxy support – allows to specify another proxy server,<span> </span><em>(if they don’t have the requested object ask their parents, or to the original server);</em></li></ul><p><br/>A proxy server usually is placed at various points between users and the destination server (<em>also known as the origin server</em>) on the Internet.</p><p style="margin-left: auto;"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/132350000/137986067.jpg" data-image-src="attachments/132350000/137986067.jpg" data-unresolved-comment-count="0" data-linked-resource-id="137986067" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Image10002.jpg" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="132350000" data-linked-resource-container-version="5" tabindex="0" alt=""></span></p><p>A<span> </span><em>Web proxy (cache)<span> </span></em>watches requests coming from clients, saving copies of the responses for itself. Then, if there is another request for the same URL, it can use the response that it has, instead of asking the origin server for it again. If the proxy has not requested a file, it downloads that from the original server.</p><p>There can be many potential purposes of proxy servers:</p><ul class="bullets"><li>To increase access speed to resources (it takes less time for the client to get the object);</li><li>Works as HTTP firewall (deny access to undesirable web pages);</li></ul><p>Allows filtering web content (by specific parameters, like source address, a destination address, port, URL, HTTP request method) scan outbound content, e.g., for data leak protection.</p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>It may be useful to have a Web proxy running even with no cache when you want to use it only as something like an HTTP and FTP firewall (for example, denying access to undesired web pages or denying a specific type of files e.g. .mp3 files) or to redirect requests to external proxy (possibly, to a proxy with caching functions) transparently.</p></div></div><h1 class="auto-cursor-target" id="Proxy-Configurationexamples">Configuration examples</h1><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip/proxy</pre>
</div></div><p class="auto-cursor-target"><span style="color:var(--ds-text-accent-lime-bolder,#37471f);">In MikroTik RouterOS, a proxy configuration is performed in<span> the <em>/ip/proxy</em> </span></span><span style="color:var(--ds-text-accent-lime-bolder,#37471f);">menu. See below how to enable the proxy on port 8080 and set up 192.168.88.254 as the proxy source address:</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] &gt; ip/proxy/set enabled=yes port=8080 src-address=192.168.88.254
[admin@MikroTik] &gt; ip/proxy/print 
                 enabled: yes
             src-address: 192.168.88.254
                    port: 8080
               anonymous: no
            parent-proxy: ::
       parent-proxy-port: 0
     cache-administrator: webmaster
          max-cache-size: unlimited
   max-cache-object-size: 2048KiB
           cache-on-disk: no
  max-client-connections: 600
  max-server-connections: 600
          max-fresh-time: 3d
   serialize-connections: no
       always-from-cache: no
          cache-hit-dscp: 4
              cache-path: web-proxy</pre>
</div></div><div role="region" aria-label="Tip" class="confluence-information-macro  confluence-information-macro-tip" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p><span style="color:var(--ds-text-accent-lime-bolder,#37471f);">When setting up a regular proxy service, make sure it serves only your clients and prevents unauthorized access to it by creating a firewall that allows only your clients to use a proxy, otherwise, it may be used as an open proxy.</span></p></div></div><h2 id="Proxy-Transparentproxyconfigurationexample"><span class="mw-headline">Transparent proxy configuration example</span></h2><p>RouterOS can also act as a Transparent Caching server, with no configuration required in the customer’s web browser. A transparent proxy does not modify the requested URL or response. RouterOS will take all HTTP requests and redirect them to the local proxy service. This process will be entirely transparent to the user (users may not know anything about a proxy server that is located between them and the original server), and the only difference to them will be the increased browsing speed.</p><p>To enable the transparent mode, the firewall rule in destination NAT has to be added, specifying which connections (to which ports) should be transparently redirected to the proxy. Check proxy settings above and redirect us users (192.168.1.0/24) to a proxy server:</p><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] ip firewall nat&gt; add chain=dstnat protocol=tcp src-address=192.168.1.0/24 dst-port=80 action=redirect to-ports=8080
[admin@MikroTik] ip firewall nat&gt; print
Flags: X - disabled, I - invalid, D - dynamic
 0   chain=dstnat protocol=tcp dst-port=80 action=redirect to-ports=8080</pre>
</div></div><p> The web proxy can be used as a transparent and normal web proxy at the same time. In transparent mode, it is possible to use it as a standard web proxy, too. However, in this case, proxy users may have trouble reaching web pages that are accessed transparently.</p><h2 id="Proxy-Proxy-basedfirewall–AccessList"><span class="mw-headline">Proxy-based firewall – Access List</span></h2><p>An access list is implemented in the same way as MikroTik firewall rules processed from the top to the bottom. The first matching rule specifies the decision of what to do with this connection. Connections can be matched by their source address, destination address, destination port, sub-string of the requested URL (Uniform Resource Locator), or request method. If none of these parameters is specified, every connection will match this rule.</p><p>If a connection is matched by a rule, the action property of this rule specifies whether a connection will be allowed or not (deny). If a connection does not match any rule, it will be allowed.</p><p>In this example assume that we have configured a transparent proxy server, it will block the website<span> </span><a class="external-link" href="http://www.facebook.com/" rel="nofollow" style="text-decoration: none;">http://www.facebook.com</a>, we can always block the same for different networks by giving src-address:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip proxy access add src-address=192.168.1.0/24 dst-host=www.facebook.com action=deny</pre>
</div></div><p>Users from network 192.168.1.0/24 will not be able to access the website<span> </span><a class="external-link" href="http://www.facebook.com/" rel="nofollow" style="text-decoration: none;">www.facebook.com</a>.</p><p>You can block also websites that contain specific words in the URL:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip proxy access add dst-host=:mail action=deny</pre>
</div></div><p>This statement will block all websites which contain the word “mail” in the URL. Like<span> </span><a class="external-link" href="http://www.mail.com/" rel="nofollow" style="text-decoration: none;">www.mail.com</a>,<span> </span><a class="external-link" href="http://www.hotmail.com/" rel="nofollow" style="text-decoration: none;">www.hotmail.com</a>, <a class="external-link" href="http://mail.yahoo.com" rel="nofollow">mail.yahoo.com</a>, etc.</p><p><em><strong>We can also stop downloading specific types of files like .flv, .avi, .mp4, .mp3, .exe, .dat, …etc.</strong></em></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false"> /ip proxy access
 add path=*.flv action=deny
 add path=*.avi action=deny
 add path=*.mp4 action=deny
 add path=*.mp3 action=deny
 add path=*.zip action=deny
 add path=*.rar action=deny</pre>
</div></div><p style="margin-left: 20.0px;"><br/></p><p>Here are available also different wildcard characters, to create specific conditions and to match them by proxy access list. Wildcard properties (dst-host and dst-path) match a complete string (i.e., they will not match &quot;<a class="external-link" href="http://example.com" rel="nofollow">example.com</a>&quot; if they are set to &quot;example&quot;). Available wildcards are '*' (match any number of any characters) and '?' (match any one character).</p><p>Regular expressions are also accepted here, but if the property should be treated as a regular expression, it should start with a colon (':').</p><p>To show that no symbols are allowed before the given pattern, we use the ^ symbol at the beginning of the pattern.</p><p>To specify that no symbols are allowed after the given pattern, we use the $ symbol at the end of the pattern.</p><h1 id="Proxy-EnablingRAMorStore-basedcaching."><span class="mw-headline">Enabling RAM or Store-based caching.</span></h1><p>In this example, it will presume that you already have the proxy configured and working and you just want to enable caching. If a command/parameter detailed description is required check the reference section which is located right below the example section.</p><ul><li>RAM-based caching:<ul><li>Good if you have a device with a considerable amount of RAM for caching. Enabling this on a device with RAM 256MB or less will not give your network any benefit.</li><li>Way faster cache writes/read than one that is stored on USB or SATA connected mediums.</li></ul></li></ul><ul><li>Store-based caching:<ul><li>Larger proxy caches are available simply due to medium capacity differences.</li></ul></li></ul><h2 id="Proxy-RAMproxycache:"><strong>RAM proxy cache:</strong></h2><p>Important commands:</p><ul><li>max-cache-size=</li><li>max-cache-object-size=</li><li>cache-on-disk=</li></ul><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] /ip proxy&gt; set max-cache-size=unlimited max-cache-object-size=50000KiB cache-on-disk=no 
...
[admin@MikroTik] /ip proxy&gt; print 
                 enabled: yes
             src-address: ::
                    port: 8080
               anonymous: no
            parent-proxy: 0.0.0.0
       parent-proxy-port: 0
     cache-administrator: webmaster
          max-cache-size: unlimited  &lt;-------
   max-cache-object-size: 500000KiB  &lt;-------
           cache-on-disk: no  &lt;-------
  max-client-connections: 600
  max-server-connections: 600
          max-fresh-time: 3d
   serialize-connections: no 
       always-from-cache: no
          cache-hit-dscp: 4
              cache-path: proxy-cache</pre>
</div></div><h2 id="Proxy-Storeproxycache:"><strong>Store proxy cache:</strong></h2><p>Important commands:</p><ul><li>max-cache-size=</li><li>max-cache-object-size=</li><li>cache-on-disk=</li><li>cache-path=</li></ul><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] &gt; ip proxy set cache-on-disk=yes cache-path=/usb1/proxy/cache

[admin@MikroTik] &gt; ip proxy print                                                
                 enabled: yes
             src-address: ::
                    port: 8080
               anonymous: no
            parent-proxy: 0.0.0.0
       parent-proxy-port: 0
     cache-administrator: webmaster
          max-cache-size: unlimited  &lt;-------
   max-cache-object-size: 50000KiB  &lt;-------
           cache-on-disk: yes  &lt;-------
  max-client-connections: 600
  max-server-connections: 600
          max-fresh-time: 3d
   serialize-connections: no
       always-from-cache: no
          cache-hit-dscp: 4
              cache-path: usb1/proxy/cache  &lt;-------

[admin@MikroTik] &gt; file print                                                    
 # NAME                                                           TYPE              
 0 skins                                                          directory        
 5 usb1/proxy                                                     directory           
 6 usb1/proxy/cache                                               web-proxy store   &lt;-------      
 7 usb1/lost+found                                                directory  </pre>
</div></div><p><strong>Check if a cache is working:</strong></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] &gt; ip proxy monitor 
                 status: running
                 uptime: 2w20h28m25s
     client-connections: 15
     server-connections: 7
               requests: 79772
                   hits: 30513
             cache-used: 481KiB
         total-ram-used: 1207KiB
  received-from-servers: 4042536KiB
        sent-to-clients: 4399757KiB
   hits-sent-to-clients: 176934KiB</pre>
</div></div><h1 id="Proxy-Reference"><span class="mw-headline">Reference</span></h1><p>List of all available parameters and commands per menu.</p><h3 id="Proxy-General"><span class="mw-headline">General</span></h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip/proxy</pre>
</div></div><p class="mw-empty-elt"><br/></p><div class="table-wrap"><table class="wrapped confluenceTable" style="margin-left: 20.8665px;"><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>always-from-cache</strong><span> </span>(<em>yes | no</em>; Default:<span> </span><strong>no</strong>)</td><td class="confluenceTd">ignore client refresh requests if the content is considered fresh</td></tr><tr><td class="confluenceTd"><strong>anonymous</strong><span> </span>(<em>yes | no</em>; Default:<span> </span><strong>no</strong>)</td><td class="confluenceTd">If not set, the IP address of the client would be passed X-Forwarded-For header (could be accessed using HTTP_X_FORWARDED_FOR environment variable in remote servers)</td></tr><tr><td class="confluenceTd"><strong>cache-administrator</strong><span> </span>(<em>string</em>; Default:<span> </span><strong>webmaster</strong>)</td><td class="confluenceTd">Administrator's e-mail displayed on proxy error page</td></tr><tr><td class="confluenceTd"><strong>cache-hit-dscp</strong><span> </span>(<em>integer: 0..63</em>; Default:<span> </span><strong>4</strong>)</td><td class="confluenceTd">Automatically mark cache hit with the provided DSCP value</td></tr><tr><td class="confluenceTd"><strong>cache-on-disk</strong><span> </span>(<em>yes | no</em>; Default:<span> </span><strong>no</strong>)</td><td class="confluenceTd">Whether to store cache on disk</td></tr><tr><td class="confluenceTd"><strong>cache-path</strong><span> </span>(<em>string</em>; Default:<span> </span><strong>web-proxy</strong>)</td><td class="confluenceTd">A path where the cache will be stored, when<span> </span>cache-on-disk<span> </span>is enabled.</td></tr><tr><td class="confluenceTd"><strong>max-cache-object-size</strong><span> </span>(<em>integer: 0..4294967295[KiB]</em>; Default:<span> </span><strong>2048KiB</strong>)</td><td class="confluenceTd">Specifies the maximal cache object size, measured in kilobytes</td></tr><tr><td class="confluenceTd"><strong>max-cache-size</strong><span> </span>(<em>none | unlimited | integer: 0..4294967295[KiB]</em>; Default:<span> </span><strong>unlimited</strong>)</td><td class="confluenceTd">Specifies the maximal cache size, measured in kilobytes</td></tr><tr><td class="confluenceTd"><strong>max-client-connections</strong><span> </span>(<em>integer: Dynamic<span> </span></em>; Default:<span> </span><strong>600</strong>)</td><td class="confluenceTd">Maximal number of connections accepted from clients (any further connections will be rejected)</td></tr><tr><td class="confluenceTd"><strong>max-fresh-time</strong><span> </span>(<em>time</em>; Default:<span> </span><strong>3d</strong>)</td><td class="confluenceTd">Maximal time to store a cached object. The validity period of an object is usually defined by the object itself, but in case it is set too high, you can override the maximal value</td></tr><tr><td class="confluenceTd"><strong>max-server-connections</strong><span> </span>(<em>integer: Dynamic<span> </span></em>; Default:<span> </span><strong>600</strong>)</td><td class="confluenceTd">Maximal number of connections made to servers (any further connections from clients will be put on hold until some server connections will terminate)</td></tr><tr><td class="confluenceTd"><strong>parent-proxy</strong><span> </span>(<em>Ip4 | ip6</em>; Default:<span> </span><strong>0.0.0.0</strong>)</td><td class="confluenceTd">IP address and port of another HTTP proxy to redirect all requests to. If set to<span> </span><strong>0.0.0.0</strong><span> </span>parent proxy is not used.</td></tr><tr><td class="confluenceTd"><strong>parent-proxy-port</strong><span> </span>(<em>integer: 0..65535</em>; Default:<span> </span><strong>0</strong>)</td><td class="confluenceTd">Port that parent proxy is listening on.</td></tr><tr><td class="confluenceTd"><strong>port</strong><span> </span>(<em>integer: 0..65535</em>; Default:<span> </span><strong>8080</strong>)</td><td class="confluenceTd">TCP port the proxy server will be listening on. This port has to be specified on all clients that want to use the server as an HTTP proxy. A transparent (with zero configuration for clients) proxy setup can be made by redirecting HTTP requests to this port in the IP firewall using the destination NAT feature</td></tr><tr><td class="confluenceTd"><strong>serialize-connections</strong><span> </span>(<em>yes | no</em>; Default:<span> </span><strong>no</strong>)</td><td class="confluenceTd">Do not make multiple connections to the server for multiple client connections, if possible (i.e. server supports persistent HTTP connections). Clients will be served on the FIFO principle; the next client is processed when the response transfer to the previous one is completed. If a client is idle for too long (max 5 seconds by default), it will give up waiting and open another connection to the server</td></tr><tr><td class="confluenceTd"><strong>src-address</strong><span> </span>(<em>Ip4 | Ip6</em>; Default:<span> </span><strong>0.0.0.0</strong>)</td><td class="confluenceTd">A proxy will use a specified address when connecting to the parent proxy or website. If set to<span> </span><strong>0.0.0.0</strong><span> </span>then the appropriate IP address will be taken from the routing table.</td></tr></tbody></table></div><h3 id="Proxy-AccessList"><span class="mw-headline">Access List</span></h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip/proxy/access</pre>
</div></div><p>An access list is configured like regular firewall rules. Rules are processed from the top to the bottom. The first matching rule specifies the decision of what to do with this connection. There is a total of 6 classifiers that specify matching constraints. If none of these classifiers is specified, the particular rule will match every connection.</p><p>If a connection is matched by a rule, the action property of this rule specifies whether a connection will be allowed or not. If the particular connection does not match any rule, it will be allowed.</p><p><br/></p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="margin-left: 20.8665px;width: 99.0662%;"><colgroup><col style="width: 20.6231%;"/><col style="width: 79.3769%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>action</strong><span> </span>(<em>allow | deny</em>; Default:<span> </span><strong>allow</strong>)</td><td class="confluenceTd">Specifies whether to pass or deny matched packets</td></tr><tr><td class="confluenceTd"><strong>dst-address</strong><span> </span>(<em>Ip4[-Ip4 | /0..32] | Ip6/0..128</em>; Default:<span> </span>)</td><td class="confluenceTd">The destination address of the target server.</td></tr><tr><td class="confluenceTd"><strong>dst-host</strong><span> </span>(<em>string</em>; Default:<span> </span>)</td><td class="confluenceTd">IP address or DNS name used to make a connection to the target server (this is the string user wrote in a browser before specifying the port and path to a particular web page</td></tr><tr><td class="confluenceTd"><strong>dst-port</strong><span> </span>(<em>integer[-integer[,integer[,...]]]: 0..65535</em>; Default:<span> </span>)</td><td class="confluenceTd">List or range of ports the packet is destined to</td></tr><tr><td class="confluenceTd"><strong>local-port</strong><span> </span>(<em>integer: 0..65535</em>; Default:<span> </span>)</td><td class="confluenceTd">Specifies the port of the web proxy via which the packet was received. This value should match one of the ports the web proxy is listening on.</td></tr><tr><td class="confluenceTd"><strong>method</strong><span> </span>(<em>any | connect | delete | get | head | options | post | put | trace</em>; Default:<span> </span>)</td><td class="confluenceTd">The HTTP method used in the request (see<span> </span>HTTP Methods<span> </span>section at the end of this document)</td></tr><tr><td class="confluenceTd"><strong>path</strong><span> </span>(<em>string</em>; Default:<span> </span>)</td><td class="confluenceTd">Name of the requested page within the target server (i.e. the name of a particular web page or document without the name of the server it resides on)</td></tr><tr><td class="confluenceTd"><strong>redirect-to</strong><span> </span>(<em>string</em>; Default:<span> </span>)</td><td class="confluenceTd">In case of access is denied by this rule, the user shall be redirected to the URL specified here</td></tr><tr><td class="confluenceTd"><strong>src-address</strong><span> </span>(<em>Ip4[-Ip4 | /0..32] | Ip6/0..128</em>; Default:<span> </span>)</td><td class="confluenceTd">The source address of the connection originator.</td></tr></tbody></table></div><p><br/>Read-only properties:</p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="margin-left: 20.8665px;width: 99.0256%;"><colgroup><col style="width: 20.6892%;"/><col style="width: 79.3108%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>hits</strong><span> </span>(<em>integer</em>)</td><td class="confluenceTd">Count of requests that were matched by this rule</td></tr></tbody></table></div><p><br/>Wildcard properties (dst-host and dst-path) match a complete string (i.e., they will not match &quot;<a class="external-link" href="http://example.com" rel="nofollow">example.com</a>&quot; if they are set to &quot;example&quot;). Available wildcards are '*' (match any number of any characters) and '?' (match any one character). Regular expressions are also accepted here, but if the property should be treated as a regular expression, it should start with a colon (':').</p><p>Small hints in using regular expressions:</p><ul><li>\\ symbol sequence is used to enter \ character in the console;</li><li>\. pattern means. only (in regular expressions single dot in a pattern means any symbol);</li><li>to show that no symbols are allowed before the given pattern, we use the ^ symbol at the beginning of the pattern;</li><li>to specify that no symbols are allowed after the given pattern, we use the $ symbol at the end of the pattern;</li><li>to enter [ or ] symbols, you should escape them with backslash &quot;\.&quot;;</li></ul><p>It is strongly recommended to deny all IP addresses except those behind the router as the proxy still may be used to access your internal-use-only (intranet) web servers. Also, consult examples in Firewall Manual on how to protect your router.</p><h3 id="Proxy-DirectAccess"><span class="mw-headline">Direct Access</span></h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip/proxy/direct</pre>
</div></div><p><span style="letter-spacing: 0.0px;">If</span><span style="letter-spacing: 0.0px;"> a </span><strong style="letter-spacing: 0.0px;">parent-proxy</strong><span style="letter-spacing: 0.0px;"> </span><span style="letter-spacing: 0.0px;">property is specified, it is possible to tell the proxy server whether to try to pass the request to the parent proxy or to resolve it by connecting to the requested server directly. The direct Access List is managed just like the Proxy Access List described in the previous chapter except for the action argument. </span>Unlike the access list, the direct proxy access list has a default action equal to deny. It takes place when no rules are specified or a particular request did not match any rule.</p><p><br/></p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="margin-left: 20.8665px;width: 98.9038%;"><colgroup><col style="width: 20.6621%;"/><col style="width: 79.3379%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>action</strong><span> </span>(<em>allow | deny</em>; Default:<span> </span><strong>allow</strong>)</td><td class="confluenceTd">Specifies the action to perform on matched packets:<ul class="bullets"><li>allow<span> </span>- always resolve matched requests directly bypassing the parent router</li><li>deny<span> </span>- resolve matched requests through the parent proxy. If no one is specified this has the same effect as<span> </span><strong>allow</strong>.</li></ul></td></tr><tr><td class="confluenceTd"><strong>dst-address</strong><span> </span>(<em>Ip4[-Ip4 | /0..32] | Ip6/0..128</em>; Default:<span> </span>)</td><td class="confluenceTd">The destination address of the target server.</td></tr><tr><td class="confluenceTd"><strong>dst-host</strong><span> </span>(<em>string</em>; Default:<span> </span>)</td><td class="confluenceTd">IP address or DNS name used to make a connection to the target server (this is the string user wrote in a browser before specifying port and path to a particular web page</td></tr><tr><td class="confluenceTd"><strong>dst-port</strong><span> </span>(<em>integer[-integer[,integer[,...]]]: 0..65535</em>; Default:<span> </span>)</td><td class="confluenceTd">List or range of ports used by connection to the target server.</td></tr><tr><td class="confluenceTd"><strong>local-port</strong><span> </span>(<em>integer: 0..65535</em>; Default:<span> </span>)</td><td class="confluenceTd">Specifies the port of the web proxy via which the packet was received. This value should match one of the ports the web proxy is listening on.</td></tr><tr><td class="confluenceTd"><strong>method</strong><span> </span>(<em>any | connect | delete | get | head | options | post | put | trace</em>; Default:<span> </span>)</td><td class="confluenceTd">The HTTP method used in the request (see<span> </span><a class="external-link" href="https://wiki.mikrotik.com/wiki/Manual:IP/Proxy#HTTP_Methods" rel="nofollow" style="text-decoration: none;">HTTP Methods</a><span> </span>section at the end of this document)</td></tr><tr><td class="confluenceTd"><strong>path</strong><span> </span>(<em>string</em>; Default:<span> </span>)</td><td class="confluenceTd">Name of the requested page within the target server (i.e. the name of a particular web page or document without the name of the server it resides on)</td></tr><tr><td class="confluenceTd"><strong>src-address</strong><span> </span>(<em>Ip4[-Ip4 | /0..32] | Ip6/0..128</em>; Default:<span> </span>)</td><td class="confluenceTd">The source address of the connection originator.</td></tr></tbody></table></div><p><br/>Read-only properties:</p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="margin-left: 20.8665px;width: 99.1068%;"><colgroup><col style="width: 20.8207%;"/><col style="width: 79.1793%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>hits</strong><span> </span>(<em>integer</em>)</td><td class="confluenceTd">Count of requests that were matched by this rule</td></tr></tbody></table></div><h3 id="Proxy-CacheManagement"><span class="mw-headline">Cache Management</span></h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip/proxy/cache</pre>
</div></div><p>The cache access list specifies, which requests (domains, servers, pages) have to be cached locally by web proxy, and which do not. This list is implemented exactly the same way as the web proxy access list. The default action is to cache an object (if no matching rule is found).</p><p><br/></p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="margin-left: 20.8665px;width: 99.188%;"><colgroup><col style="width: 20.6025%;"/><col style="width: 79.3975%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>action</strong><span> </span>(<em>allow | deny</em>; Default:<span> </span><strong>allow</strong>)</td><td class="confluenceTd">Specifies the action to perform on matched packets:<ul class="bullets"><li>allow<span> </span>- cache objects from matched request</li><li>deny<span> </span>- do not cache objects from matched request</li></ul></td></tr><tr><td class="confluenceTd"><strong>dst-address</strong><span> </span>(<em>Ip4[-Ip4 | /0..32] | Ip6/0..128</em>; Default:<span> </span>)</td><td class="confluenceTd">The destination address of the target server</td></tr><tr><td class="confluenceTd"><strong>dst-host</strong><span> </span>(<em>string</em>; Default:<span> </span>)</td><td class="confluenceTd">IP address or DNS name used to make a connection to the target server (this is the string user wrote in a browser before specifying port and path to a particular web page</td></tr><tr><td class="confluenceTd"><strong>dst-port</strong><span> </span>(<em>integer[-integer[,integer[,...]]]: 0..65535</em>; Default:<span> </span>)</td><td class="confluenceTd">List or range of ports the packet is destined to.</td></tr><tr><td class="confluenceTd"><strong>local-port</strong><span> </span>(<em>integer: 0..65535</em>; Default:<span> </span>)</td><td class="confluenceTd">Specifies the port of the web proxy via which the packet was received. This value should match one of the ports the web proxy is listening on.</td></tr><tr><td class="confluenceTd"><strong>method</strong><span> </span>(<em>any | connect | delete | get | head | options | post | put | trace</em>; Default:<span> </span>)</td><td class="confluenceTd">The HTTP method used in the request (see<span> </span>HTTP Methods<span> </span>section at the end of this document)</td></tr><tr><td class="confluenceTd"><strong>path</strong><span> </span>(<em>string</em>; Default:<span> </span>)</td><td class="confluenceTd">Name of the requested page within the target server (i.e. the name of a particular web page or document without the name of the server it resides on)</td></tr><tr><td class="confluenceTd"><strong>src-address</strong><span> </span>(<em>Ip4[-Ip4 | /0..32] | Ip6/0..128</em>; Default:<span> </span>)</td><td class="confluenceTd">The source address of the connection originator</td></tr></tbody></table></div><p><br/></p><p>Read-only properties:</p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="margin-left: 20.8665px;width: 99.3504%;"><colgroup><col style="width: 20.7442%;"/><col style="width: 79.2558%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>hits</strong><span> </span>(<em>integer</em>)</td><td class="confluenceTd">Count of requests that were matched by this rule</td></tr></tbody></table></div><p><br/></p><h3 id="Proxy-Connections"><span class="mw-headline">Connections</span></h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip/proxy/connections</pre>
</div></div><p class="auto-cursor-target"><span style="font-weight: 400;letter-spacing: 0.0px;">This menu contains the list of current connections the proxy is serving.</span></p><p>Read-only properties:</p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="margin-left: 20.8665px;width: 98.9038%;"><colgroup><col style="width: 29.1697%;"/><col style="width: 70.8303%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>client</strong><span> </span>()</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd"><strong>dst-address</strong><span> </span>(<em>Ip4 | Ip6</em>)</td><td class="confluenceTd">IPv4/Ipv6 destination address of the connection</td></tr><tr><td class="confluenceTd"><strong>protocol</strong><span> </span>(<em>string</em>)</td><td class="confluenceTd">Protocol name</td></tr><tr><td class="confluenceTd"><strong>rx-bytes</strong><span> </span>(<em>integer</em>)</td><td class="confluenceTd">The number of bytes received by the client</td></tr><tr><td class="confluenceTd"><strong>server</strong><span> </span>()</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd"><strong>src-address</strong><span> </span>(<em>Ip4 | Ip6</em>)</td><td class="confluenceTd">Ipv4/ipv6 address of the connection originator</td></tr><tr><td class="confluenceTd"><strong>state</strong><span> </span>(<em>closing | connecting | converting | hotspot | idle | resolving | rx-header | tx-body | tx-eof | tx-header | waiting</em>)</td><td class="confluenceTd">Connection state:<ul class="bullets"><li>closing<span> </span>- the data transfer is finished, and the connection is being finalized</li><li>connecting<span> </span>- establishing toe connection</li><li>converting<span> </span>- replacing header and footer fields in response or request packet</li><li>hotspot<span> </span>- check if hotspot authentication allows continuing (for hotspot proxy)</li><li>idle<span> </span>- staying idle</li><li>resolving<span> </span>- resolving the server's DNS name</li><li>rx-header<span> </span>- receiving HTTP header</li><li>tx-body<span> </span>- transmitting HTTP body to the client</li><li>tx-eof<span> </span>- writing chunk-end (when converting to chunked response)</li><li>tx-header<span> </span>- transmitting HTTP header to the client</li><li>waiting<span> </span>- waiting for transmission from a peer</li></ul></td></tr><tr><td class="confluenceTd"><strong>tx-bytes</strong><span> </span>(<em>integer</em>)</td><td class="confluenceTd">The number of bytes sent by the client</td></tr></tbody></table></div><p><br/></p><h3 id="Proxy-CacheInserts"><span class="mw-headline">Cache Inserts</span></h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip/proxy/inserts</pre>
</div></div><p>This menu shows statistics on objects stored in a cache (cache inserts).</p><p>Read-only properties:</p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="margin-left: 20.8665px;width: 99.2692%;"><colgroup><col style="width: 29.3093%;"/><col style="width: 70.6907%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>denied</strong><span> </span>(<em>integer</em>)</td><td class="confluenceTd">A number of inserts were denied by the<span> </span>caching list.</td></tr><tr><td class="confluenceTd"><strong>errors</strong><span> </span>(<em>integer</em>)</td><td class="confluenceTd">Number of disk or other system-related errors</td></tr><tr><td class="confluenceTd"><strong>no-memory</strong><span> </span>(<em>integer</em>)</td><td class="confluenceTd">Number of objects not stored because there was not enough memory</td></tr><tr><td class="confluenceTd"><strong>successes</strong><span> </span>(<em>integer</em>)</td><td class="confluenceTd">A number of successful cache inserts.</td></tr><tr><td class="confluenceTd"><strong>too-large</strong><span> </span>(<em>integer</em>)</td><td class="confluenceTd">Number of objects too large to store</td></tr></tbody></table></div><h3 id="Proxy-CacheLookups"><span class="mw-headline">Cache Lookups</span></h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip/proxy/lookup</pre>
</div></div><p>This menu shows statistics on objects read from cache (cache lookups).</p><p>Read-only properties:</p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="margin-left: 20.8665px;width: 99.2286%;"><colgroup><col style="width: 29.6017%;"/><col style="width: 70.3983%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>denied</strong><span> </span>(<em>integer</em>)</td><td class="confluenceTd">Number of requests denied by the<span> </span>access list.</td></tr><tr><td class="confluenceTd"><strong>expired</strong><span> </span>(<em>integer</em>)</td><td class="confluenceTd">Number of requests found in cache, but expired, and, thus, requested from an external server</td></tr><tr><td class="confluenceTd"><strong>no-expiration-info</strong><span> </span>(<em>integer</em>)</td><td class="confluenceTd">Conditional request received for a page that does not have the information to compare the request with</td></tr><tr><td class="confluenceTd"><strong>non-cacheable</strong><span> </span>(<em>integer</em>)</td><td class="confluenceTd">Number of requests requested from the external servers unconditionally (as their caching is denied by the cache access list)</td></tr><tr><td class="confluenceTd"><strong>not-found</strong><span> </span>(<em>integer</em>)</td><td class="confluenceTd">Number of requests not found in the cache, and, thus, requested from an external server (or parent proxy if configured accordingly)</td></tr><tr><td class="confluenceTd"><strong>successes</strong><span> </span>(<em>integer</em>)</td><td class="confluenceTd">Number of requests found in the cache.</td></tr></tbody></table></div><h3 id="Proxy-CacheContents"><span class="mw-headline">Cache Contents</span></h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip/proxy/cache-contents</pre>
</div></div><p>This menu shows cached contents.</p><p>Read-only properties:</p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="margin-left: 20.8665px;width: 99.1068%;"><colgroup><col style="width: 29.9403%;"/><col style="width: 70.0597%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>file-size</strong><span> </span>(<em>integer</em>)</td><td class="confluenceTd">Cached object size</td></tr><tr><td class="confluenceTd"><strong>last-accessed</strong><span> </span>(<em>time</em>)</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd"><strong>last-accessed-time</strong><span> </span>(<em>time</em>)</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd"><strong>last-modified</strong><span> </span>(<em>time</em>)</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd"><strong>last-modified-time</strong><span> </span>(<em>time</em>)</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd"><strong>uri</strong><span> </span>(<em>string</em>)</td><td class="confluenceTd"><br/></td></tr></tbody></table></div><p><br/></p><h1 id="Proxy-HTTPMethods"><span class="mw-headline">HTTP Methods</span></h1><h4 id="Proxy-Options"><span class="mw-headline">Options</span></h4><p>This method is a request for information about the communication options available on the chain between the client and the server identified by the<span> </span><strong>Request-URI</strong>. The method allows the client to determine the options and (or) the requirements associated with a resource without initiating any resource retrieval</p><h4 id="Proxy-GET"><span class="mw-headline">GET</span></h4><p>This method retrieves whatever information identified by the Request-URI. If the Request-URI refers to a data processing process then the response to the GET method should contain data produced by the process, not the source code of the process procedure(-s), unless the source is the result of the process.</p><p>The GET method can become a conditional GET if the request message includes an If-Modified-Since, If-Unmodified-Since, If-Match, If-None-Match, or If-Range header field. The conditional GET method is used to reduce the network traffic specifying that the transfer of the entity should occur only under circumstances described by conditional header field(-s).</p><p>The GET method can become a partial GET if the request message includes a Range header field. The partial GET method intends to reduce unnecessary network usage by requesting only parts of entities without transferring data already held by the client.</p><p>The response to a GET request is cacheable if and only if it meets the requirements for HTTP caching.</p><h4 id="Proxy-HEAD"><span class="mw-headline">HEAD</span></h4><p>This method shares all features of GET method except that the server must not return a message-body in the response. This retrieves the metainformation of the entity implied by the request which leads to its wide usage of it for testing hypertext links for validity, accessibility, and recent modification.</p><p>The response to a HEAD request may be cacheable in the way that the information contained in the response may be used to update the previously cached entity identified by that Request-URI.</p><h4 id="Proxy-POST"><span class="mw-headline">POST</span></h4><p>This method requests that the origin server accept the entity enclosed in the request as a new subordinate of the resource identified by the Request-URI.</p><p>The actual action performed by the POST method is determined by the origin server and usually is Request-URI dependent.</p><p>Responses to POST method are not cacheable, unless the response includes appropriate Cache-Control or Expires header fields.</p><h4 id="Proxy-PUT"><span class="mw-headline">PUT</span></h4><p>This method requests that the enclosed entity be stored under the supplied Request-URI. If another entity exists under specified Request-URI, the enclosed entity should be considered as an updated (newer) version of that residing on the origin server. If the Request-URI is not pointing to an existing resource, the origin server should create a resource with that URI.</p><p>If the request passes through a cache and the Request-URI identifies one or more currently cached entities, those entries should be treated as stale. Responses to this method are not cacheable.</p><h4 id="Proxy-TRACE"><span class="mw-headline">TRACE</span></h4><p>This method invokes a remote, application-layer loop-back of the request message. The final recipient of the request should reflect the message received back to the client as the entity-body of a 200 (OK) response. The final recipient is either the origin server or the first proxy or gateway to receive a Max-Forwards value of 0 in the request. A TRACE request must not include an entity.</p><p>Responses to this method MUST NOT be cached.</p>
                    </div>

                                                            <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/132350000/136839174.gif">Image10001.gif</a> (image/gif)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/132350000/137986067.jpg">Image10002.jpg</a> (image/jpeg)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on May 20, 2025 14:53</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
