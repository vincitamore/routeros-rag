<!DOCTYPE html>
<html>
    <head>
        <title>RouterOS : DNS</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">RouterOS</a></span>
                            </li>
                                                    <li>
                                <span><a href="RouterOS_328059.html">RouterOS</a></span>
                            </li>
                                                    <li>
                                <span><a href="Network-Management_119144613.html">Network Management</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            RouterOS : DNS
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> Artūrs C.</span>, last updated by <span class='editor'> Matīss O.</span> on May 08, 2025
    
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h1 id="DNS-/*&lt;![CDATA[*/div.rbtoc1747742030736{padding:0px;}div.rbtoc1747742030736ul{margin-left:0px;}div.rbtoc1747742030736li{margin-left:0px;padding-left:0px;}/*]]&gt;*/#DNS-Introduction#DNS-IntroductionDNSconfiguration#DNS-DNSconfigurationDNSCache#DNS-DNSCacheDN"><style type='text/css'>/*<![CDATA[*/
div.rbtoc1747742030736 {padding: 0px;}
div.rbtoc1747742030736 ul {margin-left: 0px;}
div.rbtoc1747742030736 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1747742030736'>
<ul class='toc-indentation'>
<li><a href='#DNS-'></a></li>
<li><a href='#DNS-Introduction'>Introduction</a>
<ul class='toc-indentation'>
<li><a href='#DNS-DNSconfiguration'>DNS configuration</a></li>
<li><a href='#DNS-DNSCache'>DNS Cache</a></li>
<li><a href='#DNS-DNSStatic'>DNS Static</a></li>
</ul>
</li>
<li><a href='#DNS-dohDNSoverHTTPS(DoH)'>DNS over HTTPS (DoH)</a>
<ul class='toc-indentation'>
<li><a href='#DNS-Knowncompatible/incompatibleDoHservices'>Known compatible/incompatible DoH services</a></li>
</ul>
</li>
<li><a href='#DNS-adlistAdlist'>Adlist</a>
<ul class='toc-indentation'>
<li><a href='#DNS-WhitelistforAdlist'>Whitelist for Adlist</a></li>
<li><a href='#DNS-Configurationexamples:'>Configuration examples:</a>
<ul class='toc-indentation'>
<li><a href='#DNS-URLbasedadlist:'>URL based adlist:</a></li>
<li><a href='#DNS-Locallyhostedadlist:'>Locally hosted adlist:</a></li>
</ul>
</li>
</ul>
</li>
<li><a href='#DNS-Forwarders'>Forwarders</a>
<ul class='toc-indentation'>
<li><a href='#DNS-Forwarderconfiguration'>Forwarder configuration</a></li>
<li><a href='#DNS-Configurationexample'>Configuration example</a></li>
</ul>
</li>
<li><a href='#DNS-mDNS'>mDNS</a></li>
</ul>
</div></h1><h1 id="DNS-Introduction">Introduction</h1><p>Domain Name System (DNS) usually refers to the Phonebook of the Internet. In other words, DNS is a database that links strings (known as hostnames), such as <a class="external-link" href="https://www.google.com" rel="nofollow">www.mikrotik.com</a> to a specific IP address, such as 159.148.147.196.</p><p>A MikroTik router with a DNS feature enabled can be set as a DNS cache for any DNS-compliant client. Moreover, the MikroTik router can be specified as a primary DNS server under its DHCP server settings. When the remote requests are enabled, the MikroTik router responds to TCP and UDP DNS requests on port 53.</p><p>When both static and dynamic servers are set, static server entries are preferred, however, it does not indicate that a static server will always be used (for example, previously query was received from a dynamic server, but static was added later, then a dynamic entry will be preferred).</p><div role="region" aria-label="Tip" class="confluence-information-macro  confluence-information-macro-tip" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>When DNS server <em>allow-remote-requests</em> are used make sure that you limit access to your server over TCP and UDP protocol port 53 only for known hosts.</p></div></div><p>There are several options on how you can manage DNS functionality on your LAN - use public DNS, use the router as a cache, or do not interfere with DNS configuration. Let us take as an example the following setup: <span class="module__title__link">Internet service provider (</span>ISP) → Gateway (GW) → <span class="module__title__link">Local area network (</span>LAN). The GW is RouterOS based device with the default configuration:</p><ul><li>You do not configure any DNS servers on the &quot;GW&quot; DHCP server network configuration - the device will forward the DNS server IP address configuration received from `ISP` to `LAN` devices;</li><li>You configure DNS servers on the &quot;GW&quot; DHCP server network configuration - the device will give configured DNS servers to `LAN` devices (also &quot;/ip dns set allow-remote-requests=yes<em>&quot; must</em> be enabled);</li><li>&quot;dns-none&quot; configured under DNS servers on &quot;GW&quot; DHCP server network configuration - the device will not forward any of the <strong>dynamic</strong> DNS servers to `LAN` devices;</li></ul><h2 id="DNS-DNSconfiguration">DNS configuration</h2><p>DNS facility is used to provide domain name resolution for the router itself as well as for the clients connected to it.</p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 100.0%;"><colgroup class=""><col class="" style="width: 25.609756%;"/><col class="" style="width: 74.314026%;"/></colgroup><tbody class=""><tr class=""><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr class=""><td class="confluenceTd"><strong>allow-remote-requests</strong> (<em>yes </em>|<em> no</em>; Default: <strong>no</strong>)</td><td class="confluenceTd">Specifies whether to allow router usage as a DNS cache for remote clients. Otherwise, only the router itself will use DNS configuration.</td></tr><tr><td class="confluenceTd"><strong>address-list-extra-time </strong><em>(time; Default: <strong>0s</strong>)</em></td><td class="confluenceTd"><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">Extra time added to TTL when creating address list entry.</span></td></tr><tr class=""><td class="confluenceTd"><strong>cache-max-ttl</strong> (<em>time</em>; Default: <strong>1w</strong>)</td><td class="confluenceTd">Maximum time-to-live for cache records. In other words, cache records will expire unconditionally after cache-max-TTL time. Shorter TTLs received from DNS servers are respected.</td></tr><tr class=""><td class="confluenceTd"><strong>cache-size</strong> (<em>integer[64..4294967295]</em>; Default: <strong>2048</strong>)</td><td class="confluenceTd">Specifies the size of the DNS cache in KiB.</td></tr><tr class=""><td class="confluenceTd"><strong>max-concurrent-queries</strong> (<em>integer</em>; Default: <strong>100</strong>)</td><td class="confluenceTd">Specifies how many concurrent queries are allowed.</td></tr><tr class=""><td class="confluenceTd"><strong>max-concurrent-tcp-sessions</strong> (<em>integer</em>; Default: <strong>20</strong>)</td><td class="confluenceTd">Specifies how many concurrent TCP sessions are allowed.</td></tr><tr class=""><td class="confluenceTd"><strong>max-udp-packet-size</strong> (<em>integer [50..65507]</em>; Default: <strong>4096</strong>)</td><td class="confluenceTd">Maximum size of allowed UDP packet.</td></tr><tr><td class="confluenceTd"><strong>mdns-repeat-ifaces </strong>(<em>list of interfaces</em>; Default: )</td><td class="confluenceTd">Once an interface in this list receives an mDNS packet, it will forward it to all other interfaces in this list. Only supports IPv4.</td></tr><tr class=""><td class="confluenceTd"><strong>query-server-timeout</strong> (<em>time</em>; Default: <strong>2s</strong>)</td><td class="confluenceTd">Specifies how long to wait for a query response from a server.</td></tr><tr class=""><td class="confluenceTd"><strong>query-total-timeout</strong> (<em>time</em>; Default: <strong>10s</strong>)</td><td class="confluenceTd">Specifies how long to wait for query response in total. Note that this setting must be configured taking into account &quot;query-server-timeout&quot; and the number of used DNS servers.</td></tr><tr class=""><td class="confluenceTd"><strong>servers</strong> (<em>list of IPv4/IPv6 addresses</em>; Default: )</td><td class="confluenceTd">List of DNS server IPv4/IPv6 addresses</td></tr><tr class=""><td class="confluenceTd"><strong>cache-used</strong> (<em>integer</em>)</td><td class="confluenceTd">Shows the currently used cache size in KiB</td></tr><tr class=""><td class="confluenceTd"><strong>dynamic-server</strong> (<em>IPv4/IPv6 list</em>)</td><td class="confluenceTd">List of dynamically added DNS servers from different services, for example, DHCP.</td></tr><tr class=""><td class="confluenceTd"><p><strong>doh-max-concurrent-queries </strong>(<em>integer</em>; Default: <strong>50</strong>)</p></td><td class="confluenceTd">Specifies how many DoH concurrent queries are allowed.</td></tr><tr class=""><td class="confluenceTd"><p><strong>doh-max-server-connections </strong>(<em>integer</em>; Default: <strong>5</strong>)</p></td><td class="confluenceTd">Specifies how many concurrent connections to the DoH server are allowed.</td></tr><tr class=""><td class="confluenceTd"><p><strong>doh-timeout </strong>(<em>time</em>; Default: <strong>5s</strong>)</p></td><td class="confluenceTd">Specifies how long to wait for query response from the DoH server.</td></tr><tr class=""><td class="confluenceTd"><p><strong>use-doh-server </strong><span style="text-decoration: none;color:var(--ds-text,#333333);">(</span><em style="text-decoration: none;">string; Default: )</em></p></td><td class="confluenceTd">Specified which DoH server must be used for DNS queries. DoH functionality overrides &quot;<em>servers</em>&quot; usage if specified. The server must be specified with an &quot;https://&quot; prefix. Supports only one DoH server.</td></tr><tr class=""><td class="confluenceTd"><p><strong>verify-doh-cert  </strong>(<em>yes </em>|<em> no</em>; Default: <strong>no</strong>)</p></td><td class="confluenceTd"><p>Specifies whether to validate the DoH server, when one is being used. Will use the &quot;/certificate&quot; list in order to verify server validity.</p></td></tr></tbody></table></div><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false">[admin@MikroTik] &gt; ip dns print         
                      servers: 
              dynamic-servers: 10.155.0.1
               use-doh-server: 
              verify-doh-cert: no
   doh-max-server-connections: 5
   doh-max-concurrent-queries: 50
                  doh-timeout: 5s
        allow-remote-requests: yes
          max-udp-packet-size: 4096
         query-server-timeout: 2s
          query-total-timeout: 10s
       max-concurrent-queries: 100
  max-concurrent-tcp-sessions: 20
                   cache-size: 2048KiB
                cache-max-ttl: 1d
                   cache-used: 48KiB</pre>
</div></div><p class="auto-cursor-target">Dynamic DNS servers are obtained from different facilities available in RouterOS, for example, DHCP client, VPN client, IPv6 Router Advertisements, etc. </p><p class="auto-cursor-target">Servers are processed in a queue order - static servers as an ordered list, dynamic servers as an ordered list. When DNS cache has to send a request to the server, it tries servers one by one until one of them responds. After that this server is used for all types of DNS requests. Same server is used for any types of DNS requests, for example, A and AAAA types. If you use only dynamic servers, then the DNS returned results can change after reboot, because servers can be loaded into IP/DNS settings in a different order due to a different speeds on how they are received from facilities mentioned above.</p><p class="auto-cursor-target">If at some point the server which was being used becomes unavailable and can not provide DNS answers, then the DNS cache restarts the DNS server lookup process and goes through the list of specified servers once more.</p><h2 id="DNS-DNSCache">DNS Cache</h2><p>This menu provides two lists with DNS records stored on the server:</p><ul><li><em>&quot;</em>/ip dns cache<em>&quot;</em>: this menu provides a list with cache DNS entries that RouterOS cache can reply with to client requests ;</li><li><em>&quot;</em>/ip dns cache all<em>&quot;</em>: This menu provides a complete list with all cached DNS records stored including also, for example, PTR records.</li></ul><div role="region" aria-label="Tip" class="confluence-information-macro  confluence-information-macro-tip" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>You can empty the DNS cache with the command: &quot;/ip dns cache flush&quot;<em>.</em></p></div></div><h2 class="auto-cursor-target" id="DNS-DNSStatic">DNS Static</h2><p>The MikroTik RouterOS DNS cache has an additional embedded DNS server feature that allows you to configure multiple types of DNS entries that can be used by the DNS clients using the router as their DNS server. This feature can also be used to provide false DNS information to your network clients. For example, resolving any DNS request for a certain set of domains (or for the whole Internet) to your own page.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false">[admin@MikroTik] /ip dns static add name=www.mikrotik.com address=10.0.0.1
</pre>
</div></div><p class="auto-cursor-target">The server is also capable of resolving DNS requests based on basic regular expressions so that multiple requests can be matched with the same entry. In case an entry does not conform with DNS naming standards, it is considered a regular expression. The list is ordered and checked from top to bottom. Regular expressions are checked first, then the plain records.</p><p class="auto-cursor-target">Use regex to match DNS requests:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false">[admin@MikroTik] /ip dns static add regexp=&quot;[*mikrotik*]&quot; address=10.0.0.2</pre>
</div></div><p class="auto-cursor-target">If DNS static entries list matches the requested domain name, then the router will assume that this router is responsible for any type of DNS request for the particular name. For example, if there is only an &quot;A&quot; record in the list, but the router receives an &quot;AAAA&quot; request, then it will reply with an &quot;A&quot; record from the static list and will query the upstream server for the &quot;AAAA&quot; record. If a record exists, then the reply will be forwarded, if not, then the router will reply with an &quot;ok&quot; DNS reply without any records in it. If you want to override domain name records from the upstream server with unusable records, then you can, for example, add a static entry for the particular domain name and specify a dummy IPv6 address for it &quot;::ffff&quot;.</p><p class="auto-cursor-target">List all of the configured DNS entries as an ordered list:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false">[admin@MikroTik] /ip/dns/static/print 
Columns: NAME, REGEXP, ADDRESS, TTL
# NAME             REGEXP       ADDRESS   TTL
0 www.mikrotik.com               10.0.0.1  1d 
1                  [*mikrotik*]  10.0.0.2  1d</pre>
</div></div><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 100.0%;"><colgroup class=""><col class="" style="width: 25.609756%;"/><col class="" style="width: 74.314026%;"/></colgroup><tbody class=""><tr class=""><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr class=""><td class="confluenceTd"><strong>address </strong>(<em>IPv4/IPv6</em>)</td><td class="confluenceTd">The address that will be used for &quot;A&quot; or &quot;AAAA&quot; type records.</td></tr><tr class=""><td class="confluenceTd"><strong>cname </strong><span style="text-decoration: none;color:var(--ds-text,#333333);">(</span><em style="text-decoration: none;text-align: left;">string</em><em style="text-decoration: none;text-align: left;">)</em></td><td class="confluenceTd">Alias name for a domain name.</td></tr><tr class=""><td class="confluenceTd"><strong>forward-to</strong></td><td class="confluenceTd">The IP address of a domain name server to which a particular DNS request must be forwarded.</td></tr><tr class=""><td class="confluenceTd"><strong>mx-exchange </strong><span style="text-decoration: none;color:var(--ds-text,#333333);">(</span><em style="text-decoration: none;text-align: left;">string</em>)</td><td class="confluenceTd">The domain name of the MX server.</td></tr><tr class=""><td class="confluenceTd"><strong>name </strong><span style="text-decoration: none;color:var(--ds-text,#333333);">(</span><em style="text-decoration: none;text-align: left;">string)</em></td><td class="confluenceTd">Domain name.</td></tr><tr class=""><td class="confluenceTd"><strong>srv-port</strong> (<em style="text-decoration: none;text-align: left;">integer</em><span style="text-decoration: none;color:var(--ds-text,#172b4d);">; Default: </span>0<span style="text-decoration: none;color:var(--ds-text,#172b4d);">)</span></td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text,#333333);">The TCP or UDP port on which the service is to be found.</span></td></tr><tr class=""><td class="confluenceTd"><strong>srv-target</strong></td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text,#333333);">The canonical hostname of the machine providing the service ends in a dot.</span></td></tr><tr class=""><td class="confluenceTd"><strong>text </strong><span style="text-decoration: none;color:var(--ds-text,#333333);">(</span><em style="text-decoration: none;text-align: left;">string</em><em style="text-decoration: none;text-align: left;">)</em></td><td class="confluenceTd">Textual information about the domain name.</td></tr><tr class=""><td class="confluenceTd"><strong>type </strong><span style="text-decoration: none;color:var(--ds-text,#172b4d);">(</span><em>A</em> <span style="text-decoration: none;color:var(--ds-text,#172b4d);">|</span> <em>AAAA</em> <span style="text-decoration: none;color:var(--ds-text,#172b4d);">|</span> <em>CNAME</em> <span style="text-decoration: none;color:var(--ds-text,#172b4d);">|</span> <em>FWD</em> <span style="text-decoration: none;color:var(--ds-text,#172b4d);">|</span> <em>MX</em> | <em>NS</em> | <em>NXDOMAIN</em> | <em>SRV</em> | <em>TXT</em> <span style="text-decoration: none;color:var(--ds-text,#172b4d);">; Default: </span><em>A</em><span style="text-decoration: none;color:var(--ds-text,#172b4d);">)</span></td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text,#333333);">Type of the DNS record.</span></td></tr><tr class=""><td class="confluenceTd"><strong>address-list </strong><span style="text-decoration: none;color:var(--ds-text,#333333);">(</span><em style="text-decoration: none;text-align: left;">string</em><em style="text-decoration: none;text-align: left;">)</em></td><td class="confluenceTd">Name of the Firewall address list to which address must be dynamically added when some request matches the entry. Entry will be removed from the address list when TTL expires.</td></tr><tr class=""><td class="confluenceTd"><strong>comment </strong><span style="text-decoration: none;color:var(--ds-text,#333333);">(</span><em style="text-decoration: none;text-align: left;">string</em><em style="text-decoration: none;text-align: left;">)</em></td><td class="confluenceTd">Comment about the domain name record.</td></tr><tr class=""><td class="confluenceTd"><p><strong>disabled </strong>(<em>yes </em>|<em> no</em>; Default: yes)</p></td><td class="confluenceTd">Whether the DNS record is active.</td></tr><tr class=""><td class="confluenceTd"><p><strong>match-subdomain </strong>(<em>yes </em>|<em> no</em>; Default: no)</p></td><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text,#707070);">Whether the record</span><span style="text-decoration: none;color:var(--ds-text,#707070);"> will match requests for subdomains.</span></td></tr><tr class=""><td class="confluenceTd"><p><strong>mx-preference </strong><span style="text-decoration: none;color:var(--ds-text,#172b4d);">(</span><em style="text-decoration: none;text-align: left;">integer</em><span style="text-decoration: none;color:var(--ds-text,#172b4d);">; Default: </span>0<span style="text-decoration: none;color:var(--ds-text,#172b4d);">)</span></p></td><td class="confluenceTd">Preference of the particular MX record.</td></tr><tr class=""><td class="confluenceTd"><p><strong>ns </strong><span style="text-decoration: none;color:var(--ds-text,#333333);">(</span><em style="text-decoration: none;text-align: left;">string</em>)</p></td><td class="confluenceTd">Name of the authoritative domain name server for the particular record.</td></tr><tr class=""><td class="confluenceTd"><p><strong>regexp </strong>(regex)</p></td><td class="confluenceTd">Regular expression against which domain names should be verified.</td></tr><tr class=""><td class="confluenceTd"><p><strong>srv-priority </strong><span style="text-decoration: none;color:var(--ds-text,#172b4d);">(</span><em style="text-decoration: none;text-align: left;">integer</em><span style="text-decoration: none;color:var(--ds-text,#172b4d);">; Default: </span>0<span style="text-decoration: none;color:var(--ds-text,#172b4d);">)</span></p></td><td class="confluenceTd"><p>Priority of the particular SRV record.</p></td></tr><tr class=""><td class="confluenceTd"><p><strong>srv-weight </strong>(<em style="text-decoration: none;text-align: left;">integer</em><span style="text-decoration: none;color:var(--ds-text,#172b4d);">; Default: </span>0<span style="text-decoration: none;color:var(--ds-text,#172b4d);">)</span></p></td><td class="confluenceTd"><p>Weight of the particular SRV record.</p></td></tr><tr class=""><td class="confluenceTd"><p><strong>ttl</strong> (<em>time</em>; Default: <em>24h</em>)</p></td><td class="confluenceTd"><p>Maximum time-to-live for cached records.</p></td></tr></tbody></table></div><div role="region" aria-label="Info" class="confluence-information-macro  confluence-information-macro-information" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-info-filled confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>For each static A and AAAA record, in cache automatically is added a PTR record.</p></div></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Regexp is case-sensitive, but DNS requests are not case sensitive, RouterOS converts DNS names to lowercase before matching any static entries. You should write regex only with lowercase letters. Regular expression matching is significantly slower than plain text entries, so it is advised to minimize the number of regular expression rules and optimize the expressions themselves.</p></div></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Be careful when you configure regex through mixed user interfaces - CLI and GUI. Adding the entry itself might require escape characters when added from CLI. It is recommended to add an entry and the execute print command in order to verify that regex was not changed during addition.</p></div></div><h1 class="auto-cursor-target" id="DNS-dohDNSoverHTTPS(DoH)"><span class="confluence-anchor-link" id="DNS-doh"></span>DNS over HTTPS (DoH)</h1><p>RouterOS support DNS over HTTPS (DoH). DoH uses HTTPS protocol to send and receive DNS requests for better data integrity. The main goal is to provide privacy by eliminating &quot;man-in-the-middle&quot; attacks (MITM). </p><p><a class="external-link" href="http://youtube.com/watch?v=w4erB0VzyIE" rel="nofollow">Video: DoH setup</a></p><div role="region" aria-label="Warning" class="confluence-information-macro  confluence-information-macro-warning" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>It is strongly recommended to import the root CA certificate of the DoH server you have chosen to use for increased security. We strongly suggest not using third-party download links for certificate fetching. Use the Certificate Authority's own website.</p></div></div><p>There are various ways to find out what root CA certificate is necessary. The easiest way is by using your WEB browser, navigating to the DoH site, and checking the security of the website. You can download the certificate straight from the browser or fetch the certificate from a trusted source. </p><p><br/></p><p>Download the certificate, upload it to your router and import it: </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/certificate import file-name=CertificateFileName</pre>
</div></div><p class="auto-cursor-target">Configure the DoH server: </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip dns set use-doh-server=DoH_Server_Query_URL verify-doh-cert=yes</pre>
</div></div><div role="region" aria-label="Info" class="confluence-information-macro  confluence-information-macro-information" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-info-filled confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Only one DoH server is supported.</p></div></div><p class="auto-cursor-target">Note that you need at least one regular DNS server configured for the router to resolve the DoH hostname itself. If you do not have any dynamical or static DNS server configured, add a static DNS entry for the DoH server domain name like this: </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip dns set servers=1.1.1.1</pre>
</div></div><p class="auto-cursor-target">If you do not have any dynamical or static DNS server configured, add a static DNS entry for the DoH server domain name like this: </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip dns static add address=IP_Address name=Domain_Name</pre>
</div></div><div role="region" aria-label="Tip" class="confluence-information-macro  confluence-information-macro-tip" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>If DoH server is being used (DoH DNS name can be resolved) then it will be the only DNS service working at the time and standard DNS servers from IP/DNS servers list will not be used.</p></div></div><div role="region" aria-label="Tip" class="confluence-information-macro  confluence-information-macro-tip" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>If <em>/certificate/settings/set crl-use</em> is set to <em>yes,</em> RouterOS will check CRL for each certificate in a certificate chain, therefore, an entire certificate chain should be installed into a device - starting from Root CA, intermediate CA (if there are such), and certificate that is used for specific service.</p><p>For example, Google DoH, Cloudflare, and OpenDNS full chain contain three certificates,  NextDNS has four certificates.</p></div></div><h2 class="auto-cursor-target" id="DNS-Knowncompatible/incompatibleDoHservices">Known compatible/incompatible DoH services</h2><p>Compatible DoH services:</p><ul><li><p>Cloudflare</p></li><li><p>Google</p></li><li><p>NextDNS</p></li><li><p>OpenDNS</p></li></ul><p>Incompatible DoH services:</p><ul><li><p>Mullvad</p></li><li>Yandex</li><li data-uuid="3ec02dce-99a5-459c-9526-60947d0d1efc">UncensoredDNS</li><li data-uuid="979fc873-153a-46fb-8900-fcdefbf53812">Quad9<em> (due to their migration to HTTP2 which is not currently supported in RouterOS)</em></li></ul><h1 class="auto-cursor-target" id="DNS-adlistAdlist"><span class="confluence-anchor-link" id="DNS-adlist"></span>Adlist </h1><p>Adlist is an integral component of network-level ad blocking, comprising a curated collection of domain names known for serving advertisements. This feature operates by utilizing Domain Name System (DNS) resolution to intercept A and AAAA requests to these domains. When a client device queries a DNS server for a domain listed on the adlist, the DNS resolution process is altered. Instead of returning the actual IP address of the ad-serving domain, the DNS server responds with the IP address 0.0.0.0. This effectively null-routes the request, as 0.0.0.0 is a non-routable meta-address used to denote an invalid, unknown, or non-applicable target. By redirecting ad-related requests in this manner, the adlist feature ensures that advertisement content is not loaded, enhancing network performance and improving the user experience by reducing unwanted ad traffic.</p><p><a class="external-link" href="http://youtube.com/watch?v=RMJnjyAOfLI" rel="nofollow">Video: Adlist setup</a></p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p><strong>Before configuring, increase the DNS cache as it's used to store adlist entries. If limit is reached and error in DNS,error topic is printed &quot;<em>adlist read: max cache size reache</em>d&quot;</strong></p></div></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Adlist is stored on device's internal memory. Ensure that there is enough free space to save the desired adlist.</p></div></div><p><br/></p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 97.3121%;"><colgroup><col style="width: 17.6513%;"/><col style="width: 82.3364%;"/></colgroup><tbody><tr><th scope="col" class="confluenceTh">Property</th><th scope="col" class="confluenceTh">Description</th></tr><tr><td class="confluenceTd">url</td><td class="confluenceTd">Used to specify the URL of an adlist.</td></tr><tr><td class="confluenceTd">ssl-verify</td><td class="confluenceTd">Specifies whether to validate the SSL certificate of the Adlist URL server.   Will use the &quot;/certificate&quot; list to verify server validity.</td></tr><tr><td class="confluenceTd">match-count</td><td class="confluenceTd"><p>Count of matched DNS name requests.</p></td></tr><tr><td class="confluenceTd">name-count</td><td class="confluenceTd">Count of DNS names imported from the Adlist.</td></tr><tr><td class="confluenceTd">file</td><td class="confluenceTd">Used to specify a local file path from which to read adlist data.</td></tr><tr><td class="confluenceTd">pause</td><td class="confluenceTd"><p>Temporarily pause the use of all adlist.</p></td></tr><tr><td class="confluenceTd">reload</td><td class="confluenceTd"><div class="content-wrapper"><p>Checks for updates for all lists, if updates are found, the list is updated, removing or adding entries as needed, the lists are not redownloaded in whole when issuing a reload, instead only necessary updates are done.</p><div role="region" aria-label="Info" class="confluence-information-macro  confluence-information-macro-information" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-info-filled confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>It's not mandatory to use reload to update the lists, Adlist checks for new updates once every hour.</p></div></div><p><br/></p></div></td></tr></tbody></table></div><h2 id="DNS-WhitelistforAdlist">Whitelist for Adlist</h2><p>To exempt certain domains from Adlist, you need to create a static DNS FWD entry, for example, <span style="color:var(--ds-background-accent-green-bolder,#1f845a);"><code>/ip/dns/static/add name=bar.test type=FWD</code><span style="color:var(--ds-text,#172b4d);">, if such entry is present, the query will be forwarded to the next DNS, either dynamic or one configured under &quot;<span style="color:var(--ds-background-accent-green-bolder,#1f845a);"><code>/ip/dns/set servers=</code><span style="color:var(--ds-text,#172b4d);">&quot; , FWD entries are supported by DoH as well.</span></span></span></span></p><h2 id="DNS-Configurationexamples:">Configuration examples:</h2><h3 id="DNS-URLbasedadlist:">URL based adlist:</h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip/dns/adlist add url=https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts ssl-verify=no</pre>
</div></div><p>To see how many domain names are present and matched, you can run:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip/dns/adlist/print 
Flags: X - disabled 
0 url=&quot;https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts&quot; ssl-verify=no match-count=122 name-count=164769
</pre>
</div></div><h3 id="DNS-Locallyhostedadlist:">Locally hosted adlist:</h3><p>To create your adlist, you can create a Txt file with the domains. Example:</p><div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>0.0.0.0 example1.com
0.0.0.0 eu1.example.com
0.0.0.0 ex.com
0.0.0.0 com.example.com</pre>
</div></div><div role="region" aria-label="Info" class="confluence-information-macro  confluence-information-macro-information" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-info-filled confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>You can create the txt file on your PC, but it is also possible to create it in RouterOS, with following commands</p><p>&quot;/file/add name=host.txt&quot;, and then you can run &quot;file/edit host.txt contents&quot; after adding entries, press &quot;ctrl o&quot; to save the entries.</p></div></div><p>To add file to adlist :</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip/dns/adlist/add file=host.txt
</pre>
</div></div><div role="region" aria-label="Info" class="confluence-information-macro  confluence-information-macro-information" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-info-filled confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>You can verify that file is formatted correctly with &quot;/ip/dns/adlist/print&quot; ,the results will show how many hostnames you have added, the hostname format must match the format given in previous example.</p></div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip/dns/adlist/print 
Flags: X - disabled 
 0   file=host.txt match-count=0 name-count=4 </pre>
</div></div><p><br/></p><h1 id="DNS-Forwarders">Forwarders</h1><p>DNS Forwarders allows a user to configure a named DNS forwarder that can be used for static FWD entries as <em>forward-to</em> value.</p><p>For each <em>Forwarder</em> is possible to configure multiple regular upstream and DoH servers. Configured <em>forwarder </em>servers will be used by round-robin algorithm - for each query, next server will be used to resolve DNS name.</p><h2 id="DNS-Forwarderconfiguration">Forwarder configuration</h2><p>In <em>/ip/dns/forwaders</em> section, <em>forwarders</em> can added, modified or removed. </p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 100.0%;"><colgroup class=""><col class="" style="width: 25.6098%;"/><col class="" style="width: 74.314%;"/></colgroup><tbody class=""><tr class=""><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr class=""><td class="confluenceTd"><strong>name </strong><span style="text-decoration: none;color:var(--ds-text,#333333);">(</span><em style="text-decoration: none;text-align: left;">string; </em>Default: )</td><td class="confluenceTd">Forwarder name.</td></tr><tr class=""><td class="confluenceTd"><strong>dns-servers </strong>(<em>string</em>; Default: )</td><td class="confluenceTd">An IP address or DNS name of a domain name server. Can contain multiple records, for example, <em>dns-servers=1.1.1.1,8.8.8.8,local.dns</em></td></tr><tr class=""><td class="confluenceTd"><strong>doh-servers</strong><em><strong> </strong></em>(<em>string; </em>Default: )</td><td class="confluenceTd">A URL of DoH server. Can contain multiple records.</td></tr><tr class=""><td class="confluenceTd"><span style="text-decoration: none;color:var(--ds-text,#333333);"><strong>verify-doh-cert</strong> (<em>yes</em> | <em>no</em></span><em style="text-decoration: none;text-align: left;">;</em> Default: <em>yes</em>)</td><td class="confluenceTd">Specifies whether to validate the DoH server, when one is being used. Will use the &quot;/certificate&quot; list in order to verify server validity.</td></tr></tbody></table></div><h2 id="DNS-Configurationexample">Configuration example</h2><p>Configure/add a <em>forwarder</em>: </p><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: routeros; gutter: false">/ip dns forwarders
add dns-servers=1.1.1.1,local.dns doh-servers=https://dns.google/dns-query name=forwarder1</pre>
</div></div><p><br/></p><p>Configure/add a statis DNS FWD entry:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: routeros; gutter: false">/ip dns static
add forward-to=forwarder1 name=mikrotik.com type=FWD</pre>
</div></div><p>Now each time when a router will receive request to resolve <a class="external-link" href="http://mikrotik.com" rel="nofollow">mikrotik.com</a>, request using round-robin algorithm will be forwarded to <em>1.1.1.1</em>, <em>local.dns</em> or <em>Google DoH </em>server.</p><p><br/></p><h1 id="DNS-mDNS">mDNS</h1><p>RouterOS supports <a class="external-link" href="https://datatracker.ietf.org/doc/html/rfc6762" rel="nofollow">Multicast DNS (mDNS)</a> for local network service discovery. By default, mDNS operates within a single subnet. The mDNS repeater feature allows to extend mDNS functionality across different interfaces or VLANs using the &quot;mdns-repeat-ifaces&quot; property.</p><p>Impact of using mDNS Repeater:</p><ul><li data-uuid="a1fc2b9a-1c72-41e5-832b-4753f8a7bcdc">Cross-Subnet Service Discovery: Devices on different subnets or VLANs can discover each other, enhancing the ability to find services (e.g., printers, file sharing);</li><li data-uuid="dc542a82-1e34-4731-a65a-0e3b8e7af968">Increased Network Traffic: mDNS repeater may increase multicast traffic, which could lead to congestion, especially in larger networks with many devices.</li></ul><p>The mDNS repeater is commonly used with devices such as:</p><ul><li data-uuid="8aac765c-aa28-4124-adfd-abcb58befc18">Apple Ecosystem (AirPrint, AirPlay);</li><li data-uuid="1ea8b73c-604b-47a3-8780-7cf7f9667b20">Smart Home Devices (Thread, IoT);</li><li data-uuid="f78dea1f-a735-42c8-b977-dfc0b841f3bc">Chromecast and Media Streaming;</li><li data-uuid="65a624e5-42cc-4d5b-9c78-7155a877369f">Avahi (Linux/Unix).</li></ul><p>To enable the mDNS repeater between interfaces, allowing devices connected to these interfaces to discover each other using mDNS, use the following command:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: routeros; gutter: false">/ip dns set mdns-repeat-ifaces=&lt;interface1&gt;,&lt;interface2&gt;</pre>
</div></div><div role="region" aria-label="Info" class="confluence-information-macro  confluence-information-macro-information" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-info-filled confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>mDNS repeater requires multicast-capable interfaces (e.g., Ethernet, VLAN, bridge). Tunnel interfaces such as WireGuard are not supported.</p></div></div><p><br/></p><p><br/></p><p><br/></p>
                    </div>

                                                            <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/37748767/78970944.png">Rootca.PNG</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on May 20, 2025 14:53</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
