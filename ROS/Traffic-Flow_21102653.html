<!DOCTYPE html>
<html>
    <head>
        <title>RouterOS : Traffic Flow</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">RouterOS</a></span>
                            </li>
                                                    <li>
                                <span><a href="RouterOS_328059.html">RouterOS</a></span>
                            </li>
                                                    <li>
                                <span><a href="119144606.html">Diagnostics, monitoring and troubleshooting</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            RouterOS : Traffic Flow
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> Normunds R.</span>, last updated by <span class='editor'> Unknown User (elvijsi)</span> on Apr 17, 2024
    
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><style type='text/css'>/*<![CDATA[*/
div.rbtoc1747742046655 {padding: 0px;}
div.rbtoc1747742046655 ul {margin-left: 0px;}
div.rbtoc1747742046655 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1747742046655'>
<ul class='toc-indentation'>
<li><a href='#TrafficFlow-Introduction'>Introduction</a></li>
<li><a href='#TrafficFlow-General'>General</a></li>
<li><a href='#TrafficFlow-Targets'>Targets</a></li>
<li><a href='#TrafficFlow-IPFIX'>IPFIX</a></li>
<li><a href='#TrafficFlow-Notes'>Notes</a></li>
<li><a href='#TrafficFlow-Examples'>Examples</a>
<ul class='toc-indentation'>
<li><a href='#TrafficFlow-Seemore'>See more</a></li>
</ul>
</li>
</ul>
</div></p><h1 id="TrafficFlow-Introduction">Introduction</h1><p>MikroTik Traffic-Flow is a system that provides statistical information about packets that pass through the router. Besides network monitoring and accounting, system administrators can identify various problems that may occur in the network. With help of Traffic-Flow, it is possible to analyze and optimize the overall network performance. As Traffic-Flow is compatible with Cisco NetFlow, it can be used with various utilities which are designed for Cisco's NetFlow.</p><p>Traffic Flow can process only that traffic which is processed by the router CPU, thus HW offloaded traffic will not be seen in Traffic Flow flows (for example, HW offloaded bridged traffic).</p><p>Traffic-Flow supports the following NetFlow formats:</p><ul class="bullets"><li><strong>version 1</strong> - <span style="color:var(--ds-text-accent-purple-bolder,#352c63);">This is the original format used by NetFlow. It provides basic information about IP packets flowing through a router but lacks support for advanced features such as different types of protocols and Type of Service (ToS).</span></li><li><strong>version 5</strong> - <span style="color:var(--ds-text-accent-purple-bolder,#352c63);">An enhancement over Version 1, this format supports additional features such as Type of Service (ToS), TCP flags, and autonomous system numbers. I</span>n addition to version 1, version 5 can include BGP AS and flow sequence number information. Currently, RouterOS does not include BGP AS numbers.</li><li><strong>version 9</strong> - <span style="color:var(--ds-text-accent-purple-bolder,#352c63);">This version introduces a template-based export format, which allows for extensibility and support for new record types beyond what previous versions could handle. It can export data based on a defined template and is capable of exporting both IPv4 and IPv6 flow information.</span></li><li><span style="color:var(--ds-text-accent-purple-bolder,#352c63);"><strong>IPFIX</strong> - Standardized by the IETF, this protocol is based on NetFlow Version 9. It expands the capabilities further, allowing for more customizable and flexible flow records. IPFIX supports new technologies that were not addressed by NetFlow, like multicast.</span></li></ul><h1 id="TrafficFlow-General"><span class="mw-headline">General</span></h1><p class="auto-cursor-target"><strong>Sub-menu:</strong> <code> /ip traffic-flow</code></p><p class="auto-cursor-target"><span style="font-weight: 400;letter-spacing: 0.0px;">This section lists the configuration properties of Traffic-Flow.</span></p><div class="table-wrap"><table class="wrapped relative-table confluenceTable" style="width: 99.7361%;"><colgroup><col style="width: 16.4535%;"/><col style="width: 83.5024%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>interfaces</strong> (<em>string | all</em>; Default: <strong>all</strong>)</td><td class="confluenceTd">Names of those interfaces will be used to gather statistics for traffic-flow. To specify more than one interface, separate them with a comma.</td></tr><tr><td class="confluenceTd"><strong>cache-entries</strong> (<em>128k | 16k | 1k | 256k | 2k | ... </em>; Default: <strong>4k</strong>)</td><td class="confluenceTd">Number of flows which can be in router's memory simultaneously.</td></tr><tr><td class="confluenceTd"><strong>active-flow-timeout</strong> (<em>time</em>; Default: <strong>30m</strong>)</td><td class="confluenceTd">Maximum life-time of a flow.</td></tr><tr><td class="confluenceTd"><strong>inactive-flow-timeout</strong> (<em>time</em>; Default: <strong>15s</strong>)</td><td class="confluenceTd">How long to keep the flow active, if it is idle. If a connection does not see any packet within this timeout, then traffic-flow will send a packet out as a new flow. If this timeout is too small it can create a significant amount of flows and overflow the buffer.</td></tr><tr><td class="confluenceTd"><strong>packet-sampling </strong>(<em>no | yes</em>; Default: <strong>no</strong>)</td><td class="confluenceTd">Enable or disable packet sampling feature.</td></tr><tr><td class="confluenceTd"><strong>sampling-interval </strong>(<em>integer</em>; Default: <strong>0</strong>)</td><td class="confluenceTd"><span style="color:var(--ds-text,#172b4d);">The number of packets that are consecutively sampled.</span></td></tr><tr><td class="confluenceTd"><strong>sampling-space </strong>(<em>integer</em>; Default: <strong>0</strong>)</td><td class="confluenceTd"><div class="content-wrapper"><p class="auto-cursor-target"><span style="color:var(--ds-text,#172b4d);">The number of packets that are consecutively omitted.</span></p></div></td></tr></tbody></table></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><p class="title conf-macro-render">info</p><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Packet sampling is available in RouterOS <strong>v7.</strong></p></div></div><p class="auto-cursor-target">In the following example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip/traffic-flow/set packet-sampling=yes sampling-interval=2222 sampling-space=1111</pre>
</div></div><p><span style="color:var(--ds-text,#172b4d);">2222 packet consecutive packets will be sampled and then 1111 will be omitted. Then the sampling cycle repeats in such a manner.</span></p><h1 id="TrafficFlow-Targets"><span class="mw-headline">Targets</span></h1><p><span class="mw-headline"><strong>Sub-menu:</strong> <code> /ip traffic-flow target</code></span></p><p>With Traffic-Flow targets we specify those hosts which will gather the Traffic-Flow information from the router.</p><div class="table-wrap"><table class="wrapped relative-table confluenceTable" style="width: 99.6041%;"><colgroup><col style="width: 16.1661%;"/><col style="width: 83.7898%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>src-address </strong><em>(IP ; Default: )</em></td><td class="confluenceTd">IP address used as source when sending Traffic-Flow statistics</td></tr><tr><td class="confluenceTd"><strong>dst- address</strong> (<em>IP</em>; Default: )</td><td class="confluenceTd">IP address of the host which receives Traffic-Flow statistic packets from the router.</td></tr><tr><td class="confluenceTd"><strong>Port </strong><em>(Port; Default:2055)</em></td><td class="confluenceTd">Port (UDP) of the host which receives Traffic-Flow statistic packets from the router.</td></tr><tr><td class="confluenceTd"><strong>v9-template-refresh</strong> (<em>integer</em>; Default: <strong>20</strong>)</td><td class="confluenceTd">Number of packets after which the template is sent to the receiving host (only for NetFlow version 9 and IPFIX)</td></tr><tr><td class="confluenceTd"><strong>v9-template-timeout</strong> (<em>time</em>; Default: )</td><td class="confluenceTd">After how long to send the template, if it has not been sent. (only for NetFlow version 9 and IPFIX)</td></tr><tr><td class="confluenceTd"><strong>version</strong> (<em>1 | 5 | 9 | IPFIX</em>; Default: )</td><td class="confluenceTd">Which version format of NetFlow to use</td></tr></tbody></table></div><h1 id="TrafficFlow-IPFIX"><span class="mw-headline">IPFIX</span></h1><p><span class="mw-headline"><strong>Sub-menu:</strong> <code> /ip traffic-flow ipfix</code></span></p><p>Allows to customize flow records</p><p><br/></p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th scope="col" class="confluenceTh">Property</th><th scope="col" class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><strong>bytes</strong></td><td class="confluenceTd">Total number of bytes processed in the flow.</td></tr><tr><td class="confluenceTd"><strong>ip-total-lenght</strong></td><td class="confluenceTd">Length of the IP packet in bytes.</td></tr><tr><td class="confluenceTd"><strong>src-address</strong></td><td class="confluenceTd">The source IP address of the flow.</td></tr><tr><td class="confluenceTd"><strong>dst-address</strong></td><td class="confluenceTd">The destination IP address of the flow.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">ipv6-flow-label</span></strong></td><td class="confluenceTd">Label field from an IPv6 header, used to classify flows.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">src-address-mask</span></strong></td><td class="confluenceTd">Network mask for the source address, useful in summarizing data.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">dst-address-mask</span></strong></td><td class="confluenceTd">Network mask for the destination address.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">is-multicast</span></strong></td><td class="confluenceTd">Indicates whether the flow is a multicast flow.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">src-mac-address</span></strong></td><td class="confluenceTd">Source MAC address.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">dst-mac-address</span></strong></td><td class="confluenceTd">Destination MAC address.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">last-forwarded</span></strong></td><td class="confluenceTd">Timestamp of the last packet forwarded in a flow.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">src-port</span></strong></td><td class="confluenceTd">Source port number.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">dst-port</span></strong></td><td class="confluenceTd">Destination port number.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">nat-dst-address</span></strong></td><td class="confluenceTd">Translated destination IP address by NAT.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">sys-init-time</span></strong></td><td class="confluenceTd">System initialization time, can be used for timing analysis.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">first-forwarded</span></strong></td><td class="confluenceTd">Timestamp of the first packet forwarded in a flow.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">nat-dst-port</span></strong></td><td class="confluenceTd">Translated destination port number by NAT.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">tcp-ack-num</span></strong></td><td class="confluenceTd">Acknowledgment number in a TCP connection.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">gateway</span></strong></td><td class="confluenceTd">IP address of the gateway through which the flow was routed.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">nat-events<br/></span></strong></td><td class="confluenceTd">Events related to Network Address Translation for the flow.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">tcp-flags<br/></span></strong></td><td class="confluenceTd">Flags from the TCP header (e.g., SYN, ACK).</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">icmp-code<br/></span></strong></td><td class="confluenceTd">ICMP code for error messaging and operational information.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">nat-src-address<br/></span></strong></td><td class="confluenceTd">Translated source IP address by NAT.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">icmp-type<br/></span></strong></td><td class="confluenceTd">Type of ICMP message, important for diagnostic messages.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">nat-src-port<br/></span></strong></td><td class="confluenceTd">Translated source port number by NAT.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">tcp-seq-num<br/></span></strong></td><td class="confluenceTd">Sequence number in a TCP connection.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">tcp-window-size<br/></span></strong></td><td class="confluenceTd">Window size in a TCP connection, indicating the scale of received data buffering.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">igmp-type<br/></span></strong></td><td class="confluenceTd">Type of Internet Group Management Protocol operation.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">out-interface<br/></span></strong></td><td class="confluenceTd">Interface through which packets of the flow are sent out.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">in-interface<br/></span></strong></td><td class="confluenceTd">Interface through which packets of the flow are received.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">packets</span></strong></td><td class="confluenceTd">Number of packets processed in the flow.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">ip-header-length<br/></span></strong></td><td class="confluenceTd">Length of the IP header.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">protocol</span></strong></td><td class="confluenceTd">Protocol number (e.g., TCP, UDP, ICMP).</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">tos</span></strong></td><td class="confluenceTd">Type of Service field in the IP header, indicating priority and handling of the packet.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">ttl</span></strong></td><td class="confluenceTd">Time To Live for the packet, decremented by each router to prevent infinite loops.</td></tr><tr><td class="confluenceTd"><strong><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">udp-length</span></strong></td><td class="confluenceTd">Length of the UDP payload.</td></tr></tbody></table></div><p><br/></p><h1 id="TrafficFlow-Notes"><span class="mw-headline">Notes</span></h1><p>By looking at the <a href="Packet-Flow-in-RouterOS_328227.html">packet flow diagram</a> you can see that traffic flow is at the end of the input, forward, and output chain stack. It means that traffic flow will count only traffic that reaches one of those chains.</p><p>For example, you set up a mirror port on a switch, connect the mirror port to a router, and set traffic flow to count mirrored packets. Unfortunately, such a setup will not work, because mirrored packets are dropped before they reach the input chain.</p><p>Other interfaces will appear in the report if traffic is passing through them and the monitoring interface.</p><h1 id="TrafficFlow-Examples"><span class="mw-headline">Examples</span></h1><p>This example shows how to configure Traffic-Flow on a router</p><p>Enable Traffic-Flow on the router:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] ip traffic-flow&gt; set enabled=yes
[admin@MikroTik] ip traffic-flow&gt; print
                enabled: yes
             interfaces: all
          cache-entries: 1k
    active-flow-timeout: 30m
  inactive-flow-timeout: 15s
[admin@MikroTik] ip traffic-flow&gt;</pre>
</div></div><p><br/></p><p>Specify the IP address and port of the host, which will receive Traffic-Flow packets:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] ip traffic-flow target&gt; add dst-address=192.168.0.2 port=2055 version=9
[admin@MikroTik] ip traffic-flow target&gt; print
Flags: X - disabled 
 #   SRC-ADDRESS       DST-ADDRESS        PORT     VERSION
 0   0.0.0.0           192.168.0.2        2055     9  
[admin@MikroTik] ip traffic-flow target&gt;</pre>
</div></div><p>Now the router starts to send packets with Traffic-Flow information.</p><p><br/></p><div role="region" aria-label="Info" class="confluence-information-macro  confluence-information-macro-information" ><p class="title conf-macro-render">Note</p><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-info-filled confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>To use ntop-ng with MikroTik you need to use Nprobe, which is paid software.</p></div></div><h2 id="TrafficFlow-Seemore"><span class="mw-headline">See more</span></h2><ul><li><a class="external-link" href="https://etutorials.org/Networking/network+management/Part+II+Implementations+on+the+Cisco+Devices/Chapter+7.+NetFlow/Fundamentals+of+NetFlow/" rel="nofollow">NetFlow Fundamentals</a></li><li><a class="external-link" href="https://github.com/ntop/ntopng/issues/1575" rel="nofollow">Traffic flow with Ntop on MikroTik</a></li></ul><p><br/></p><p><br/></p><p><br/></p>
                    </div>

                                                            <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/21102653/21102654.png">Traffic-flow-1.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/21102653/21102655.png">Traffic-flow-2.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/21102653/21102656.png">Traffic-flow-4.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on May 20, 2025 14:54</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
