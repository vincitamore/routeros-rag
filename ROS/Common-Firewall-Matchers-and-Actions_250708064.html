<!DOCTYPE html>
<html>
    <head>
        <title>RouterOS : Common Firewall Matchers and Actions</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">RouterOS</a></span>
                            </li>
                                                    <li>
                                <span><a href="RouterOS_328059.html">RouterOS</a></span>
                            </li>
                                                    <li>
                                <span><a href="Firewall-and-Quality-of-Service_119144601.html">Firewall and Quality of Service</a></span>
                            </li>
                                                    <li>
                                <span><a href="Firewall_250708066.html">Firewall</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            RouterOS : Common Firewall Matchers and Actions
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> Māris B.</span>, last updated by <span class='editor'> Matīss O.</span> on Jan 13, 2025
    
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><style type='text/css'>/*<![CDATA[*/
div.rbtoc1747742026567 {padding: 0px;}
div.rbtoc1747742026567 ul {margin-left: 0px;}
div.rbtoc1747742026567 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1747742026567'>
<ul class='toc-indentation'>
<li><a href='#CommonFirewallMatchersandActions-CommonActionsandAssociatedproperties'>Common Actions and Associated properties</a>
<ul class='toc-indentation'>
<li><a href='#CommonFirewallMatchersandActions-Stats'>Stats</a></li>
<li><a href='#CommonFirewallMatchersandActions-OtherUsefulCommands'>Other Useful Commands</a></li>
</ul>
</li>
<li><a href='#CommonFirewallMatchersandActions-Matchers'>Matchers</a>
<ul class='toc-indentation'>
<li><a href='#CommonFirewallMatchersandActions-StatelessProperties'>Stateless Properties</a></li>
<li><a href='#CommonFirewallMatchersandActions-StatefulProperties'>Stateful Properties</a></li>
</ul>
</li>
</ul>
</div></p><h1 id="CommonFirewallMatchersandActions-CommonActionsandAssociatedproperties"><span>Common Actions and Associated properties</span></h1><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup class=""><col class=""/><col class=""/></colgroup><tbody class=""><tr class=""><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr class=""><td class="confluenceTd"><strong>action</strong><span> </span>(<em>action name</em>; Default:<span> </span><strong>accept</strong>)</td><td class="confluenceTd">Action to take if a packet is matched by the rule:<ul class="bullets" title=""><li><span style="color:var(--ds-icon-success,#22A06B);">accept</span><span> </span>- accept the packet. A packet is not passed to the next firewall rule.</li><li><span style="color:var(--ds-icon-success,#22A06B);">add-dst-to-address-list</span><span> </span>- add destination address to<span> </span>address list<span> </span>specified by<span> </span><span style="color:var(--ds-icon-success,#22A06B);"><code>address-list</code></span><span> </span>parameter</li><li><span style="color:var(--ds-icon-success,#22A06B);">add-src-to-address-list </span>- add source address to<span> </span>address list<span> </span>specified by<span> </span><span style="color:var(--ds-icon-success,#22A06B);"><code>address-list</code></span><span> </span>parameter</li><li><span style="color:var(--ds-icon-success,#22A06B);">jump</span><span> </span>- jump to the user-defined chain specified by the value of<span> </span><span style="color:var(--ds-icon-success,#22A06B);"><code>jump-target</code></span><span> </span>parameter</li><li><span style="color:var(--ds-icon-success,#22A06B);">log</span><span> </span>- add a message to the system log containing the following data: in-interface, out-interface, src-mac, protocol, src-ip:port-&gt;dst-ip:port and length of the packet. After a packet is matched it is passed to the next rule in the list, similar as<span> </span><span style="color:var(--ds-icon-success,#22A06B);"><code>passthrough</code></span></li><li><span style="color:var(--ds-icon-success,#22A06B);">passthrough</span><span> </span>- if a packet is matched by the rule, increase counter and go to next rule (useful for statistics)</li><li><span style="color:var(--ds-icon-success,#22A06B);">return</span><span> </span>- passes control back to the chain from where the jump took place</li></ul></td></tr><tr class=""><td class="confluenceTd"><strong>address-list</strong><span> </span>(<em>name</em>; Default: )</td><td class="confluenceTd"><p><span>Name of the address list to be used. Applicable if action is </span><span style="color:var(--ds-text-accent-lime,#4C6B1F);">add-dst- to-address-list </span><span>or </span><span style="color:var(--ds-text-accent-lime,#4C6B1F);">add-src-to-address-list</span></p></td></tr><tr class=""><td class="confluenceTd"><strong>address-list-timeout</strong><span> </span>(<em>none-dynamic | none-static | time</em>; Default:<span> </span><strong>none-dynamic</strong>)</td><td class="confluenceTd">Time interval after which the address will be removed from the address list specified by<span> </span><span style="color:var(--ds-icon-success,#22A06B);"><code>address-list</code></span><span> </span>parameter. Used in conjunction with<span> </span><span style="color:var(--ds-icon-success,#22A06B);"><code>add-dst-to-address-list</code></span><span> </span>or<span> </span><span style="color:var(--ds-icon-success,#22A06B);"><code>add-src-to-address-list</code></span><span> </span>actions<br/><ul class="bullets"><li>Value of<span> </span><code><span style="color:var(--ds-icon-success,#22A06B);">none-dynamic</span></code><span> </span>(<code>00:00:00</code>) will leave the address in the address list till reboot</li><li>Value of<span style="color:var(--ds-icon-success,#22A06B);"> <code>none-static</code></span><span> </span>will leave the address in the address list forever and will be included in the configuration export/backup</li></ul></td></tr><tr class=""><td class="confluenceTd"><strong>jump-target</strong><span> </span>(<em>name</em>; Default: )</td><td class="confluenceTd">Name of the target chain to jump to. Applicable only if<span> </span><span style="color:var(--ds-icon-success,#22A06B);"><code>action=jump</code></span></td></tr><tr class=""><td class="confluenceTd"><strong>log </strong>(<em>yes | no; Default: </em><strong>no</strong>)</td><td class="confluenceTd"><span style="color:var(--ds-text,#172B4D);">Add a message to the system log containing the following data: in-interface, out-interface, src-mac, protocol, src-ip:port-&gt;dst-ip:port, and length of the packet. Allows to log packets even if action is not &quot;<strong>log</strong>&quot;, useful for debugging firewall.</span></td></tr><tr class=""><td class="confluenceTd"><strong>log-prefix</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">Adds specified text at the beginning of every log message. Applicable if<span> </span><code><span style="color:var(--ds-icon-success,#22A06B);"><em>action=log</em></span></code> or <code><span style="color:var(--ds-icon-success,#22A06B);"><em>log=yes</em></span></code> configured.</td></tr></tbody></table></div><h2 id="CommonFirewallMatchersandActions-Stats"><span class="mw-headline">Stats</span></h2><p>To view matching statistics by firewall rules, run <span style="color:var(--ds-background-accent-red-bolder,#C9372C);"><span style="color:var(--ds-icon-success,#22A06B);"><code>/ip firewall filter print stats</code></span> </span><span>command or </span><span style="color:var(--ds-background-accent-red-bolder,#C9372C);"><code><span style="color:var(--ds-icon-success,#22A06B);">/ipv6 firewall filter print stats</span></code> </span><span>for IPv6 firewall.</span></p><p><br/></p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 98.89841%;"><colgroup class=""><col class="" style="width: 32.487625%;"/><col class="" style="width: 67.45049%;"/></colgroup><tbody class=""><tr class=""><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr class=""><td class="confluenceTd"><strong>bytes</strong><span> </span>(<em>integer</em>)</td><td class="confluenceTd">The total amount of bytes matched by the rule</td></tr><tr class=""><td class="confluenceTd"><strong>packets</strong><span> </span>(<em>integer</em>)</td><td class="confluenceTd">The total amount of packets matched by the rule</td></tr></tbody></table></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false">[admin@MikroTik] &gt; ip firewall filter print stats 
Flags: X - disabled, I - invalid, D - dynamic 
 #    CHAIN                                                                                                                 ACTION                            BYTES         PACKETS
 0  D ;;; special dummy rule to show fasttrack counters
      forward                                                                                                               passthrough              50 507 925 242      50 048 246
 1    ;;; defconf: drop invalid
      forward                                                                                                               drop                            432 270           9 719
 2    ;;; defconf: drop invalid
      input                                                                                                                 drop                            125 943           2 434
 3    input                                                                                                                 accept                   20 090 211 549      20 009 864
 4    ;;; defconf: accept ICMP
      input                                                                                                                 accept                          634 926           7 648
 5    ;;; defconf: drop all not coming from LAN
      input                                                                                                                 drop                          4 288 079          83 428
 6    ;;; defconf: accept in ipsec policy
      forward                                                                                                               accept                                0               0
7    ;;; defconf: accept out ipsec policy
      forward                                                                                                               accept                                0               0
8    ;;; defconf: fasttrack
      forward                                                                                                               fasttrack-connection     28 505 528 775      31 504 682
9    ;;; defconf: accept established,related, untracked
      forward                                                                                                               accept                   28 505 528 775      31 504 682
10    ;;; defconf: drop all from WAN not DSTNATed
      forward                                                                                                               drop                                  0               0</pre>
</div></div><p><br/></p><p><span>Statistics parameters can be reset by following commands:</span></p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 98.9043%;"><colgroup class=""><col class="" style="width: 32.46%;"/><col class="" style="width: 67.4658%;"/></colgroup><tbody class=""><tr class=""><th class="confluenceTh">Command</th><th class="confluenceTh">Description</th></tr><tr class=""><td class="confluenceTd"><strong>reset-counters</strong><span> </span>(<em>id</em>)</td><td class="confluenceTd"><p><span>Reset statistics counters for specific firewall rule or list of rules.</span></p></td></tr><tr class=""><td class="confluenceTd"><strong>reset-counters-all</strong></td><td class="confluenceTd"><p><span>Reset statistics counters for all firewall rules in the table.</span></p></td></tr></tbody></table></div><h2 class="auto-cursor-target" id="CommonFirewallMatchersandActions-OtherUsefulCommands">Other Useful Commands</h2><p><span>By default print is equivalent to </span><span style="color:var(--ds-background-accent-red-bolder,#C9372C);"><span style="color:var(--ds-icon-success,#22A06B);"><code>print static</code></span> </span><span>and shows only static rules. </span></p><p><span>To print also dynamic rules use </span><span style="color:var(--ds-icon-success,#22A06B);"><code>print all</code></span><span>.</span></p><p><span>Or to print only dynamic rules use </span><span style="color:var(--ds-icon-success,#22A06B);"><code>print dynamic</code></span><span>.</span></p><h1 id="CommonFirewallMatchersandActions-Matchers"><span>Matchers</span></h1><p><span>Tables below shows all the properties that can be used as a matchers in the firewall rules.</span></p><p><span>Matchers are executed in a specific order. </span></p><p><span>For IPv4:</span></p><ul><li><span>Source MAC Address</span></li><li><span>In/Out interfaces</span></li><li><span>In/Out interface lists</span></li><li><span>IP Range</span></li><li><span>Address type</span></li><li><span>Address list</span></li><li><span>TTL</span></li><li><span>DSCP</span></li><li><span>Length</span></li><li><span>TLS</span></li><li><span>IPv4 Options</span></li><li><span>Dst Port</span></li><li><span>Src Port</span></li><li><span>Any Port</span></li><li><span>TCP Options</span></li><li><span>TCP MSS</span></li><li><span>ICMP Codes</span></li><li><span>Ingress Priority</span></li><li><span>Priority</span></li><li><span>Packet Mark</span></li><li><span>Realm (routing table)</span></li><li><span>Hotsopot</span></li><li><span>Connection Mark</span></li><li><span>Connection State</span></li><li><span>Connection NAT State</span></li><li><span>Connection Bytes</span></li><li><span>Connection Limit</span></li><li><span>Connection Rate</span></li><li><span>Ipsec Policy</span></li><li><span>Helper</span></li><li><span>String (content)</span></li><li><span>PSD</span></li><li><span>Layer7</span></li><li><span>Random</span></li><li><span>Nth</span></li><li><span>PCC</span></li><li><span>Limit</span></li><li><span>Dst Limit</span></li><li><span>Log</span></li></ul><p><span>For IPv6:</span></p><ul><li><span>Address type</span></li><li><span>Address list</span></li><li><span>Source MAC Address</span></li><li><span>In/Out interfaces</span></li><li><span>In/Out interface lists</span></li><li>Hop Limit</li><li><span>DSCP</span></li><li><span>Length</span></li><li><span>TLS</span></li><li><span>IPv6 Header</span></li><li><span>Dst Port</span></li><li><span>Src Port</span></li><li><span>Any Port</span></li><li><span>TCP Options</span></li><li><span>TCP MSS</span></li><li><span>ICMPv6 Codes</span></li><li><span>Ingress Priority</span></li><li><span>Priority</span></li><li><span>Packet Mark</span></li><li><span>Connection Mark</span></li><li><span>Connection State</span></li><li><span>Connection NAT State</span></li><li><span>Connection Bytes</span></li><li><span>Connection Limit</span></li><li><span>Connection Rate</span></li><li><span>Ipsec Policy</span></li><li><span>Helper</span></li><li><span>Match String (content)</span></li><li><span>Random</span></li><li><span>Nth</span></li><li><span>PCC</span></li><li><span>Limit</span></li><li><span>Dst Limit</span></li><li><span>Log</span></li></ul><p><span> </span></p><p><span>Properties are split in two parts:</span></p><ul><li><strong>stateless</strong> - <span>properties do not require connection tracking to function and can be used in stateless RAW firewall matching.</span></li><li><strong>stateful</strong> - properties either require connection tracking to function or is available only in stateful firewall config.</li></ul><h2 id="CommonFirewallMatchersandActions-StatelessProperties"><span>Stateless Properties</span></h2><p><br/></p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup class=""><col class=""/><col class=""/></colgroup><tbody class=""><tr class=""><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr class=""><td class="confluenceTd"><strong>chain</strong><span> </span>(<em>name</em>; Default: )</td><td class="confluenceTd">Specifies to which chain rule will be added. If the input does not match the name of an already defined chain, a new chain will be created</td></tr><tr class=""><td class="confluenceTd"><strong>comment</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">Descriptive comment for the rule</td></tr><tr class=""><td class="confluenceTd"><strong>content</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">Match packets that contain specified text</td></tr><tr class=""><td class="confluenceTd"><strong>dscp</strong><span> </span>(<em>integer: 0..63</em>; Default: )</td><td class="confluenceTd">Matches DSCP IP header field.</td></tr><tr class=""><td class="confluenceTd"><strong>dst-address</strong><span> </span>(<em>IP/netmask | IP range</em>; Default: )</td><td class="confluenceTd">Matches packets whose destination is equal to the specified IP or falls into the specified IP range.</td></tr><tr class=""><td class="confluenceTd"><strong>dst-address-list</strong><span> </span>(<em>name</em>; Default: )</td><td class="confluenceTd"><p>Matches the destination address of a packet against a user-defined<span> </span>address-list.</p><p>Supports only one list!</p></td></tr><tr class=""><td class="confluenceTd"><strong>dst-address-type</strong><span> </span>(<em>unicast | local | broadcast | multicast</em> )</td><td class="confluenceTd">Matches destination address type:<ul class="bullets"><li><code><span style="color:var(--ds-icon-success,#22A06B);">unicast</span></code><span> </span>- IP address used for point to point transmission</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">local</span></code><span> </span>- if dst-address is assigned to one of the router's interfaces</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">broadcast</span></code><span> </span>- packet is sent to all devices in a subnet</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">multicast</span></code><span> </span>- packet is forwarded to a defined group of devices</li></ul></td></tr><tr class=""><td class="confluenceTd"><strong>dst-limit</strong><span> </span>(<em>integer[/time],integer,dst-address | dst-port | src-address[/time]</em>; Default: )</td><td class="confluenceTd">Matches packets until a given rate is exceeded. Rate is defined as packets per time interval. As opposed to the<span> </span>limit<span> </span>matcher, every flow has its own limit. Flow is defined by a mode parameter. Parameters are written in the following format:<span> </span><code>rate[/time],burst,mode[/expire]</code>.<ul class="bullets"><li><strong>rate</strong><span> </span>- packet count per time interval per-flow to match</li><li><strong>time</strong><span> </span>- specifies the time interval in which the packet count rate per flow cannot be exceeded (optional, 1s will be used if not specified)</li><li><strong>burst</strong><span> </span>- initial number of packets per flow to match: this number gets recharged by one every<span> </span><code>time</code>/<code>rate</code>, up to this number</li><li><strong>mode</strong><span> </span>- this parameter specifies what unique fields define flow (src-address, dst-address, src-and-dst-address, dst-address-and-port, addresses-and-dst-port)</li><li><strong>expire</strong><span> </span>- specifies interval after which flow with no packets will be allowed to be deleted (optional)</li></ul></td></tr><tr class=""><td class="confluenceTd"><strong>dst-port</strong><span> </span>(<em>integer[-integer]: 0..65535</em>; Default: )</td><td class="confluenceTd">List of destination port numbers or port number ranges</td></tr><tr class=""><td class="confluenceTd"><strong>fragment</strong><span> </span>(<em>yes|no</em>; Default: )</td><td class="confluenceTd"><p>Matches fragmented packets. The first (starting) fragment does not count. If connection tracking is enabled there will be no fragments as the system automatically assembles every packet.</p><p><strong>IPv4</strong> only.</p></td></tr><tr><td style="text-align: left;" class="confluenceTd"><p><span><strong>header</strong> (<em>Type[:Mode]; Mode=contains|exact; Type=hop|dst|route|frag|ah|esp|none|proto</em></span><span>)</span></p></td><td style="text-align: left;" class="confluenceTd"><p>Matches IPv6 next-header.</p><p>Two types of header matching are possible controlled by &quot;mode&quot; parameter:</p><ul><li><strong>contains</strong> - soft matching, matches at least selected headers</li><li><strong>exact</strong> - matches exact set of selected headers</li></ul><p><strong>IPv6 </strong>only<strong>.</strong></p></td></tr><tr><td style="text-align: left;" class="confluenceTd"><p><strong>hop-limit </strong>(Mode:Value; Mode=equal | greater-than | less-than | not-equal; Value=0..255)</p></td><td style="text-align: left;" class="confluenceTd"><p>Matches hop limit field in the IPv6 header. </p><p><strong>IPv6 </strong>only.</p></td></tr><tr class=""><td class="confluenceTd"><strong>hotspot</strong><span> </span>(<em>auth | from-client | http | local-dst | to-client</em>; Default: )</td><td class="confluenceTd">Matches packets received from HotSpot clients against various HotSpot matchers.<ul class="bullets"><li><span style="color:var(--ds-icon-success,#22A06B);"><code>auth</code></span><span> </span>- matches authenticated HotSpot client packets</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">from-client</span></code><span> </span>- matches packets that are coming from the HotSpot client</li><li><span style="color:var(--ds-icon-success,#22A06B);"><code>http</code></span><span> </span>- matches HTTP requests sent to the HotSpot server</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">local-dst</span></code><span> </span>- matches packets that are destined to the HotSpot server</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">to-client</span></code><span> </span>- matches packets that are sent to the HotSpot client</li></ul><p><strong>IPv4</strong> Only.</p></td></tr><tr class=""><td class="confluenceTd"><strong>icmp-options</strong><span> </span>(<em>integer:integer</em>; Default: )</td><td class="confluenceTd">Matches ICMP type: code fields</td></tr><tr class=""><td class="confluenceTd"><strong>in-bridge-port</strong><span> </span>(<em>name</em>; Default: )</td><td class="confluenceTd">Actual interface the packet has entered the router if the incoming interface is a bridge. Works only if<span> </span><code><span style="color:var(--ds-icon-success,#22A06B);">use-ip-firewall</span></code><span> </span>is enabled in bridge settings.</td></tr><tr class=""><td class="confluenceTd"><strong>in-bridge-port-list</strong><span> </span>(<em>name</em>; Default: )</td><td class="confluenceTd">Set of interfaces defined in<span> </span>interface list. Works the same as<span> </span>in-bridge-port</td></tr><tr class=""><td class="confluenceTd"><strong>in-interface</strong><span> </span>(<em>name</em>; Default: )</td><td class="confluenceTd">Interface the packet has entered the router</td></tr><tr class=""><td class="confluenceTd"><strong>in-interface-list</strong><span> </span>(<em>name</em>; Default: )</td><td class="confluenceTd">Set of interfaces defined in<span> </span>interface list. Works the same as<span> </span>in-interface</td></tr><tr class=""><td class="confluenceTd"><strong>ingress-priority</strong><span> </span>(<em>integer: 0..63</em>; Default: )</td><td class="confluenceTd">Matches the priority of an ingress packet. Priority may be derived from VLAN, WMM, DSCP, or MPLS EXP bit.<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/WMM+and+VLAN+priority" rel="nofollow">read more</a></td></tr><tr class=""><td class="confluenceTd"><strong>ipsec-policy</strong><span> </span>(<em>in | out, ipsec | none</em>; Default: )</td><td class="confluenceTd">Matches the policy used by IPsec. Value is written in the following format:<span> </span><code><strong>direction, policy</strong></code>. The direction is Used to select whether to match the policy used for decapsulation or the policy that will be used for encapsulation.<ul><li><code><span style="color:var(--ds-icon-success,#22A06B);">in</span></code><span> </span>- valid in the PREROUTING, INPUT, and FORWARD chains</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">out</span></code><span> </span>- valid in the POSTROUTING, OUTPUT, and FORWARD chains</li></ul><ul><li><code><span style="color:var(--ds-icon-success,#22A06B);">ipsec</span></code><span> </span>- matches if the packet is subject to IPsec processing;</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">none</span></code><span> </span>- matches packets that are not subject to IPsec processing (for example, IPSec transport packet).</li></ul><p>For example, if a router receives an IPsec encapsulated Gre packet, then rule<span> </span><span style="color:var(--ds-icon-success,#22A06B);"><code>ipsec-policy=in,ipsec</code></span><span> </span>will match Gre packet, but a rule<span> </span><span style="color:var(--ds-icon-success,#22A06B);"><code>ipsec-policy=in,none</code></span><span> </span>will match the ESP packet.</p></td></tr><tr class=""><td class="confluenceTd"><strong>ipv4-options</strong><span> </span>(<em>any | loose-source-routing | no-record-route | no-router-alert | no-source-routing | no-timestamp | none | record-route | router-alert | strict-source-routing | timestamp</em>; Default: )</td><td class="confluenceTd">Matches IPv4 header options.<ul class="bullets"><li><code><span style="color:var(--ds-icon-success,#22A06B);">any</span></code><span> </span>- match packet with at least one of the ipv4 options</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">loose-source-routing</span></code><span> </span>- match packets with a loose source routing option. This option is used to route the internet datagram based on information supplied by the source</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">no-record-route</span></code><span> </span>- match packets with no record route option. This option is used to route the internet datagram based on information supplied by the source</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">no-router-alert </span></code>- match packets with no router alter option</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">no-source-routing</span></code><span> </span>- match packets with no source routing option</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">no-timestamp</span></code><span> </span>- match packets with no timestamp option</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">record-route</span></code><span> </span>- match packets with record route option</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">router-alert</span></code><span> </span>- match packets with router alter option</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">strict-source-routing</span></code><span> </span>- match packets with a strict source routing option</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">timestamp</span></code><span> </span>- match packets with a timestamp</li></ul><p><strong>IPv4</strong> only.</p></td></tr><tr class=""><td class="confluenceTd"><strong>limit</strong><span> </span>(<em>integer,time,integer</em>; Default: )</td><td class="confluenceTd">Matches packets up to a limited rate (packet rate or bit rate). A rule using this matcher will match until this limit is reached. Parameters are written in the following format:<span style="color:var(--ds-icon-success,#22A06B);"> <code>rate[/time],burst:mode</code></span>.<ul class="bullets"><li><strong>rate</strong><span> </span>- packet or bit count per time interval to match</li><li><strong>time</strong><span> </span>- specifies the time interval in which the packet or bit rate cannot be exceeded (optional, 1s will be used if not specified)</li><li><strong>burst</strong><span> </span>- initial number of packets or bits to match: this number gets recharged every 10ms so burst should be at least 1/100 of a rate per second</li><li><strong>mode</strong><span> </span>- packet or bit mode</li></ul></td></tr><tr class=""><td class="confluenceTd"><strong>nth</strong><span> </span>(<em>integer,integer</em>; Default: )</td><td class="confluenceTd">Matches every nth packet: <code><span style="color:var(--ds-icon-success,#22A06B);">nth=2,1 </span></code>rule will match every first packet of 2, hence, 50% of all the traffic that is matched by the rule</td></tr><tr class=""><td class="confluenceTd"><strong>out-bridge-port</strong><span> </span>(<em>name</em>; Default: )</td><td class="confluenceTd">Actual interface the packet leaves the router if the outgoing interface is a bridge. Works only if<span> </span><code><span style="color:var(--ds-icon-success,#22A06B);"><strong>use-ip-firewall</strong></span></code><span> </span>is enabled in bridge settings.</td></tr><tr class=""><td class="confluenceTd"><strong>out-bridge-port-list</strong><span> </span>(<em>name</em>; Default: )</td><td class="confluenceTd">Set of interfaces defined in<span> </span>interface list. Works the same as<span> </span>out-bridge-port</td></tr><tr class=""><td class="confluenceTd"><strong>out-interface</strong><span> </span>(; Default: )</td><td class="confluenceTd">Interface the packet is leaving the router</td></tr><tr class=""><td class="confluenceTd"><strong>out-interface-list</strong><span> </span>(<em>name</em>; Default: )</td><td class="confluenceTd">Set of interfaces defined in<span> </span>interface list. Works the same as<span> </span>out-interface</td></tr><tr class=""><td class="confluenceTd"><strong>packet-mark</strong><span> </span>(<em>no-mark | string</em>; Default: )</td><td class="confluenceTd">Matches packets marked via mangle facility with particular packet mark. If<span> </span><code><span style="color:var(--ds-icon-success,#22A06B);"><strong>no-mark</strong></span></code><span> </span>is set, the rule will match any unmarked packet. </td></tr><tr class=""><td class="confluenceTd"><strong>packet-size</strong><span> </span>(<em>integer[-integer]:0..65535</em>; Default: )</td><td class="confluenceTd">Matches packets of specified size or size range in bytes.</td></tr><tr class=""><td class="confluenceTd"><strong>per-connection-classifier</strong><span> </span>(<em>ValuesToHash:Denominator/Remainder</em>; Default: )</td><td class="confluenceTd"><p>PCC matcher ( or Per Stream Classifier) allows dividing traffic into equal streams with the ability to keep packets with a specific set of options in one particular stream.</p><p>Streams are hashed based on selected values to hash:</p><ul><li><span>both-addresses     </span></li><li><span>both-addresses-and-ports     </span></li><li><span>both-ports     </span></li><li><span>dst-address     </span></li><li><span>dst-address-and-port     </span></li><li><span>dst-port     </span></li><li><span>src-address     </span></li><li><span>src-address-and-port     </span></li><li><span>src-port </span></li></ul><p><span> </span><a href="https://help.mikrotik.com/docs/display/ROS/Per+connection+classifier" rel="nofollow">Read more &gt;&gt;</a></p></td></tr><tr class=""><td class="confluenceTd"><strong>port</strong><span> </span>(<em>integer[-integer]: 0..65535</em>; Default: )</td><td class="confluenceTd">Matches if any (source or destination) port matches the specified list of ports or port ranges. Applicable only if<span> </span><span style="color:var(--ds-icon-success,#22A06B);"><code>protocol</code> </span>is TCP or UDP</td></tr><tr class=""><td class="confluenceTd"><strong>priority</strong><span> </span>(<em>integer: 0..63</em>; Default:)</td><td class="confluenceTd">Matches the packet's priority after a new priority has been set. Priority may be derived from VLAN, WMM, DSCP, MPLS EXP bit, or from the priority that has been set using the<span> </span>set-priority<span> </span>action.<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/WMM+and+VLAN+priority" rel="nofollow">Read more</a></td></tr><tr class=""><td class="confluenceTd"><strong>protocol</strong><span> </span>(<em>name or protocol ID</em>; Default:<span> </span><strong>tcp</strong>)</td><td class="confluenceTd">Matches particular IP protocol specified by protocol name or number</td></tr><tr class=""><td class="confluenceTd"><strong>psd</strong><span> </span>(<em>integer,time,integer,integer</em>; Default: )</td><td class="confluenceTd">Attempts to detect TCP and UDP scans. Parameters are in the following format<span> </span><code><span style="color:var(--ds-icon-success,#22A06B);">WeightThreshold</span>, <span style="color:var(--ds-icon-success,#22A06B);">DelayThreshold</span>, <span style="color:var(--ds-icon-success,#22A06B);">LowPortWeight</span>, <span style="color:var(--ds-icon-success,#22A06B);">HighPortWeight</span></code><ul class="bullets"><li><strong>WeightThreshold</strong><span> </span>- total weight of the latest TCP/UDP packets with different destination ports coming from the same host to be treated as port scan sequence</li><li><strong>DelayThreshold</strong><span> </span>- delay for the packets with different destination ports coming from the same host to be treated as possible port scan subsequence</li><li><strong>LowPortWeight</strong><span> </span>- the weight of the packets with privileged (&lt;1024) destination port</li><li><strong>HighPortWeight</strong><span> </span>- the weight of the packet with a non-privileged destination port</li></ul><p><strong>IPv4</strong> only.</p></td></tr><tr class=""><td class="confluenceTd"><strong>random</strong><span> </span>(<em>integer: 1..99</em>; Default: )</td><td class="confluenceTd">Matches packets randomly with a given probability</td></tr><tr class=""><td class="confluenceTd"><strong>src-address</strong><span> </span>(<em>Ip/Netmask, Ip range</em>; Default: )</td><td class="confluenceTd">Matches packets whose source is equal to a specified IP or falls into a specified IP range</td></tr><tr class=""><td class="confluenceTd"><strong>src-address-list</strong><span> </span>(<em>name</em>; Default: )</td><td class="confluenceTd"><p>Matches the source address of a packet against a user-defined<span> </span>address list.</p><p>Supports only one list!</p></td></tr><tr class=""><td class="confluenceTd"><strong>src-address-type</strong><span> </span>(<em>unicast | local | broadcast | multicast | blackhole | prohibit | unreachable ;</em> Default: )</td><td class="confluenceTd"><p>mote{ta{tableMatches source address type:</p><ul class="bullets"><li>unicast<span> </span>- IP address used for point to point transmission</li><li>local<span> </span>- if an address is assigned to one of the router's interfaces</li><li>broadcast<span> </span>- packet is sent to all devices in the subnet</li><li>multicast<span> </span>- packet is forwarded to a defined group of devices</li></ul></td></tr><tr class=""><td class="confluenceTd"><strong>src-port</strong><span> </span>(<em>integer[-integer]: 0..65535</em>; Default: )</td><td class="confluenceTd">List of source ports and ranges of source ports. Applicable only if a protocol is TCP or UDP</td></tr><tr class=""><td class="confluenceTd"><strong>src-mac-address</strong><span> </span>(<em>MAC address</em>; Default: )</td><td class="confluenceTd">Matches the source MAC address of the packet</td></tr><tr class=""><td class="confluenceTd"><strong>tcp-flags</strong><span> </span>(<em>ack | cwr | ece | fin | psh | rst | syn | urg</em>; Default: )</td><td class="confluenceTd">Matches specified TCP flags<ul class="bullets"><li><code><span style="color:var(--ds-icon-success,#22A06B);">ack</span></code><span> </span>- acknowledging data</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">cwr</span></code><span> </span>- congestion window reduced</li><li><span style="color:var(--ds-icon-success,#22A06B);"><code>ece</code></span><span> </span>- ECN-echo flag (explicit congestion notification)</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">fin</span></code><span> </span>- close connection</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">psh</span></code><span> </span>- push function</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">rst</span></code><span> </span>- drop connection</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">syn</span></code><span> </span>- new connection</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">urg</span></code><span> </span>- urgent data</li></ul></td></tr><tr class=""><td class="confluenceTd"><strong>tcp-mss</strong><span> </span>(<em>integer[-integer]: 0..65535</em>; Default: )</td><td class="confluenceTd">Matches TCP MSS value of an IP packet</td></tr><tr class=""><td class="confluenceTd"><strong>time</strong><span> </span>(<em>time-time,sat | fri | thu | wed | tue | mon | sun</em>; Default: )</td><td class="confluenceTd">Allows to create a filter based on the packets' arrival time and date or, for locally generated packets, departure time and date</td></tr><tr class=""><td class="confluenceTd"><strong>tls-host</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">Allows matching HTTPS traffic based on TLS SNI hostname. Accepts<span> </span><a class="external-link" href="https://en.wikipedia.org/wiki/Glob_(programming)" rel="nofollow" style="text-decoration: none;">GLOB syntax</a><span> </span>for wildcard matching. Note that the matcher will not be able to match the hostname if the TLS handshake frame is fragmented into multiple TCP segments (packets).<br/><br/>Watch our <a class="external-link" href="https://youtu.be/T2CQyN-D4u4" rel="nofollow">video about this value</a>. </td></tr><tr class=""><td class="confluenceTd"><strong>ttl</strong><span> </span>(<em>integer: 0..255</em>; Default: )</td><td class="confluenceTd">Matches packets TTL value. <strong>IPv4</strong> Only.</td></tr></tbody></table></div><h2 id="CommonFirewallMatchersandActions-StatefulProperties"><span>Stateful Properties</span></h2><p><br/></p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup class=""><col class=""/><col class=""/></colgroup><tbody class=""><tr class=""><th class="confluenceTh">Property</th><th class="confluenceTh">Description</th></tr><tr class=""><td class="confluenceTd"><strong>connection-bytes</strong><span> </span>(<em>integer-integer</em>; Default: )</td><td class="confluenceTd"><p>Matches packets only if a given amount of bytes has been transferred through the particular connection.</p><p>0 - means infinity, for example<span> </span><span style="color:var(--ds-icon-success,#22A06B);"><code>connection-bytes=2000000-0</code></span><span> </span>means that the rule matches if more than 2MB has been transferred through the relevant connection</p></td></tr><tr class=""><td class="confluenceTd"><strong>connection-limit</strong><span> </span>(<em>integer,netmask</em>; Default: )</td><td class="confluenceTd">Matches connections per address or address block after a given value is reached. Should be used together with <code><span style="color:var(--ds-icon-success,#22A06B);">connection-state=new</span></code> and/or with <code><span style="color:var(--ds-icon-success,#22A06B);">tcp-flags=syn</span></code> because matcher is very resource-intensive</td></tr><tr class=""><td class="confluenceTd"><strong>connection-mark</strong><span> </span>(<em>no-mark | string</em>; Default: )</td><td class="confluenceTd">Matches packets marked via mangle facility with particular connection mark. If<span> </span><strong>no-mark</strong><span> </span>is set, the rule will match any unmarked connection</td></tr><tr class=""><td class="confluenceTd"><strong>connection-nat-state</strong><span> </span>(<em>srcnat | dstnat</em>; Default: )</td><td class="confluenceTd">Can match connections that are srcnatted, distracted, or both. Note that <code><span style="color:var(--ds-icon-success,#22A06B);">connection-state=related</span></code> connections connection-nat-state is determined by the direction of the first packet. and if connection tracking needs to use dst-nat to deliver this connection to the same hosts as the main connection it will be in connection-nat-state=dstnat even if there are no dst-nat rules at all</td></tr><tr class=""><td class="confluenceTd"><strong>connection-rate</strong><span> </span>(<em>Integer 0..4294967295</em>; Default: )</td><td class="confluenceTd">Connection Rate is a firewall matcher that allows capturing traffic based on the present speed of the connection</td></tr><tr class=""><td class="confluenceTd"><strong>connection-state</strong><span> </span>(<em>established | invalid | new | related | untracked</em>; Default: )</td><td class="confluenceTd">Interprets the connection tracking analytics data for a particular packet:<ul class="bullets"><li><code><span style="color:var(--ds-icon-success,#22A06B);">established</span></code><span> </span>- a packet that belongs to an existing connection</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">invalid</span></code><span> </span>- a packet that does not have a determined state in connection tracking (usually - severe out-of-order packets, packets with wrong sequence/ack number, or in case of a resource over usage on the router), for this reason, an invalid packet will not participate in NAT (as only connection-state=new packets do), and will still contain original source IP address when routed. We strongly suggest dropping all <em>connection-state=invalid</em> packets in the firewall filter forward and input chains</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">new</span></code><span> </span>- the packet has started a new connection or is otherwise associated with a connection that has not seen packets in both directions.</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">related</span></code><span> </span>- a packet that is related to, but not parts of an existing connection, such as ICMP errors or a packet that begins an FTP data connection</li><li><code><span style="color:var(--ds-icon-success,#22A06B);">untracked </span></code>- packet that was set to bypass connection tracking in firewall<span> </span><a href="https://help.mikrotik.com/docs/display/ROS/RAW" rel="nofollow">RAW</a><span> </span>tables.</li></ul></td></tr><tr class=""><td class="confluenceTd"><strong>connection-type</strong><span> </span>(<em>ftp | h323 | irc | pptp | quake3 | sip | tftp</em>; Default: )</td><td class="confluenceTd">Matches packets from related connections based on information from their connection tracking helpers. A relevant connection helper must be enabled under<span> the: </span><code><span style="color:var(--ds-icon-success,#22A06B);">/ip firewall service-port</span></code></td></tr><tr><td class="confluenceTd"><strong>layer7-protocol</strong><span> </span>(<em>name</em>; Default: )</td><td class="confluenceTd">Layer7 filter name defined in<span> </span>layer7 protocol menu. <a href="https://help.mikrotik.com/docs/display/ROS/Layer7" rel="nofollow">Read more&gt;&gt;</a>.</td></tr><tr><td class="confluenceTd"><p><strong>p2p</strong><span> </span>()</p></td><td class="confluenceTd"><p>Matches some unencrypted P2P protocols. Deprecated in modern days since mostly everything is encrypted and requires deep packet inspection to identify.</p><p><strong>IPv4</strong> only.</p></td></tr><tr><td class="confluenceTd"><strong>realm</strong><span> </span>(<em>integer: 0..4294967295</em>; Default: )</td><td class="confluenceTd"><strong>IPv4</strong> only.</td></tr><tr><td class="confluenceTd"><strong>routing-mark</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd">Matches packets marked by mangle facility with particular routing mark</td></tr></tbody></table></div><p><br/></p><p><br/></p>
                    </div>

                                        
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on May 20, 2025 14:53</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
