<!DOCTYPE html>
<html>
    <head>
        <title>RouterOS : Packet Flow in RouterOS</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">RouterOS</a></span>
                            </li>
                                                    <li>
                                <span><a href="RouterOS_328059.html">RouterOS</a></span>
                            </li>
                                                    <li>
                                <span><a href="Firewall-and-Quality-of-Service_119144601.html">Firewall and Quality of Service</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            RouterOS : Packet Flow in RouterOS
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> Māris B.</span>, last updated by <span class='editor'> Gļebs K.</span> on Mar 24, 2025
    
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h1 id="PacketFlowinRouterOS-UnderstandingPacketFlow"><style type='text/css'>/*<![CDATA[*/
div.rbtoc1747742027003 {padding: 0px;}
div.rbtoc1747742027003 ul {margin-left: 0px;}
div.rbtoc1747742027003 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1747742027003'>
<ul class='toc-indentation'>
<li><a href='#PacketFlowinRouterOS-UnderstandingPacketFlow'>Understanding Packet Flow</a>
<ul class='toc-indentation'>
<li><a href='#PacketFlowinRouterOS-OverallPacketflowDiagram'>Overall Packetflow Diagram</a>
<ul class='toc-indentation'>
<li><a href='#PacketFlowinRouterOS-Chains'>Chains</a></li>
</ul>
</li>
<li><a href='#PacketFlowinRouterOS-FlowofRoutedPacket'>Flow of Routed Packet</a>
<ul class='toc-indentation'>
<li><a href='#PacketFlowinRouterOS-Forward'>Forward</a></li>
<li><a href='#PacketFlowinRouterOS-Input'>Input</a></li>
<li><a href='#PacketFlowinRouterOS-Output'>Output</a></li>
</ul>
</li>
<li><a href='#PacketFlowinRouterOS-FlowofBridgedPacket'>Flow of Bridged Packet</a>
<ul class='toc-indentation'>
<li><a href='#PacketFlowinRouterOS-'></a></li>
<li><a href='#PacketFlowinRouterOS-BridgeForward'>Bridge Forward</a></li>
<li><a href='#PacketFlowinRouterOS-BridgeInput'>Bridge Input</a></li>
<li><a href='#PacketFlowinRouterOS-BridgeOutput'>Bridge Output</a></li>
<li><a href='#PacketFlowinRouterOS-ForwardWithFirewallEnabled'>Forward With Firewall Enabled</a></li>
</ul>
</li>
<li><a href='#PacketFlowinRouterOS-FlowofHardwareOffloadedPacket'>Flow of Hardware Offloaded Packet</a>
<ul class='toc-indentation'>
<li><a href='#PacketFlowinRouterOS-SwitchForward'>Switch Forward</a></li>
<li><a href='#PacketFlowinRouterOS-SwitchtoCPUInput'>Switch to CPU Input</a></li>
<li><a href='#PacketFlowinRouterOS-CPUOutputtoSwitch'>CPU Output to Switch</a></li>
</ul>
</li>
<li><a href='#PacketFlowinRouterOS-FlowofMPLSPacket'>Flow of MPLS Packet</a>
<ul class='toc-indentation'>
<li><a href='#PacketFlowinRouterOS-PopLabel'>Pop Label</a></li>
<li><a href='#PacketFlowinRouterOS-SwitchLabel'>Switch Label</a></li>
<li><a href='#PacketFlowinRouterOS-PushLabel'>Push Label</a></li>
</ul>
</li>
<li><a href='#PacketFlowinRouterOS-MPLSIPVPN'>MPLS IP VPN</a></li>
<li><a href='#PacketFlowinRouterOS-LogicalInterfaces'>Logical Interfaces</a></li>
<li><a href='#PacketFlowinRouterOS-IPSecPolicies'>IPSec Policies</a></li>
</ul>
</li>
<li><a href='#PacketFlowinRouterOS-FastPath'>Fast Path</a>
<ul class='toc-indentation'>
<li><a href='#PacketFlowinRouterOS-HowFastPathWorks'>How Fast Path Works</a></li>
</ul>
</li>
<li><a href='#PacketFlowinRouterOS-FastTrack'>FastTrack</a>
<ul class='toc-indentation'>
<li><a href='#PacketFlowinRouterOS-Configurationexample:excludingspecifichost,frombeingFast-Tracked'>Configuration example: excluding specific host, from being Fast-Tracked</a></li>
<li><a href='#PacketFlowinRouterOS-Requirements'>Requirements</a></li>
</ul>
</li>
<li><a href='#PacketFlowinRouterOS-Packetflowforthevisuallyimpaired'>Packet flow for the visually impaired</a></li>
</ul>
</div><br/>Understanding Packet Flow</h1><p>More advanced firewall setups, or complicated tasks, such as traffic prioritization, routing policies, where it is necessary to utilize more than one RouterOS facility, require knowledge: How do these facilities work together? What happens when and why?</p><p>RouterOS packet flow diagram and flow examples will try to answer these questions.</p><p>It would be very complicated to represent what is going on with the packet in one diagram, therefore a packet flow diagram is divided into three parts:</p><ul><li>overall diagram;</li><li>detailed bridging, routing, and MPLS flow diagram;</li><li>a diagram that shows what facilities and in what order are included in prerouting, input, forward, output, and postrouting.</li></ul><h2 id="PacketFlowinRouterOS-OverallPacketflowDiagram"><span class="mw-headline">Overall Packetflow Diagram</span></h2><p>Let's look at the overall diagram. It looks complicated at first, but after we go through the diagram with examples it will become much clearer.</p><p><br/></p><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/328227/328235.svg" data-image-src="attachments/328227/328235.svg" data-unresolved-comment-count="0" data-linked-resource-id="328235" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="PacketFlowDiagram_v6_a.svg" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/svg+xml" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p><p>There are 4 boxes in the center of the diagram: Bridging, Routing, Mpls decisions, and local router processes. So for example, if the packet needs to be routed over the router, a packet will flow as illustrated in the image below. Without looking deeper into each facility, the packet enters the in-interface, the router determines that it is IP traffic and needs to be routed, the packet goes through all routing processes and exits the out-interface.</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/328227/328236.png" data-image-src="attachments/328227/328236.png" data-unresolved-comment-count="0" data-linked-resource-id="328236" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="01c_Routing_concept.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span><span>Let's take a look at another example that will illustrate what happens if the packet's destination is a router. For example, the in-interface receives ICMP (ping) packet, its destination is the router itself, so the packet will go for <em>local-in</em> processing. After the packet is processed ICMP (ping) reply is generated inside the router <em>(local-out</em> processing) and will be sent out over the out-interface.</span></p><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/328227/328440.png" data-image-src="attachments/328227/328440.png" data-unresolved-comment-count="0" data-linked-resource-id="328440" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="01d_Communication_with_router.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span>A simple explanation of each box before we go further with examples:</p><ul><li><strong>physical in-interface</strong> - the starting point of the packet received by the router;</li><li><strong>logical in-interface</strong> - the starting point of the decapsulated packet (from tunnels, IPsec, etc);</li><li><strong>local in</strong> - the last point of a packet destined to router itself;</li><li><strong>interface HTB (Hierarchical Token Bucket)</strong> - interface queue;</li><li><strong>physical out-interface</strong> - last point of the packet before it is actually sent out;</li><li><strong>logical out-interface</strong> - last point of the packet before encapsulation (to tunnels, IPsec, etc);</li><li><strong>local out</strong> - the starting point of a packet generated by the router;</li></ul><p><br/></p><p>Now it is time to take a deeper look at what is happening inside bridging, MPLS, and routing flows.</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" draggable="false" width="850" src="attachments/328227/306675730.png" data-image-src="attachments/328227/306675730.png" data-unresolved-comment-count="0" data-linked-resource-id="306675730" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-2025-3-24_9-59-25.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p><p>A simple explanation of each box before we go further with examples:</p><ul><li><strong>routing decision</strong> - go through routes in the routing table to find a match for the destination IP address of the packet. When a match is found - the packet will be processed further, in case of no match - the packet will be discarded.;</li><li><strong>mpls decision</strong> - what to do with the packet based on MPLS forwarding tables;</li><li><strong>bridging decision</strong> - bridge goes through the MAC address table to find a match for the destination MAC address of the packet. When a match is found - the packet will be processed further, in case of no match - multiple copies of the packet will be created and packets will be flooded (sent out via all bridge ports). A single packet copy will also reach a bridge input chain as the bridge interface itself is one of the many destinations. When using<span style="color:var(--ds-icon-success,#22a06b);"><code> vlan-filtering=yes</code></span>, packets that are not allowed due to the &quot;/interface bridge vlan&quot; table, will be dropped at this stage.</li><li><strong>use-ip-firewall</strong> - whether a '<em>use-ip-firewall'</em> option is enabled in bridge settings;</li><li><strong>ipsec-policy</strong> - whether a packet matches any of configured IPsec policies;</li></ul><h3 id="PacketFlowinRouterOS-Chains">Chains</h3><p>RouterOS consist of a few default chains. These chains allow you to filter packets at various points:</p><ul><li>The <strong>PREROUTING</strong> chain: Rules in this chain apply to packets as they just arrive on the network interface. This chain is present in the <em>nat</em>, <em>mangle</em> and <em>raw</em> tables.</li><li>The <strong>INPUT</strong> chain: Rules in this chain apply to packets just before they’re given to a local process. This chain is present in the <em>mangle</em> and <em>filter</em> tables.</li><li>The <strong>OUTPUT</strong> chain: The rules here apply to packets just after they’ve been produced by a process. This chain is present in the <em>raw</em>, <em>mangle</em>, nat, and <em>filter</em> tables.</li><li>The <strong>FORWARD</strong> chain: The rules here apply to any packets that are routed through the current host. This chain is only present in the <em>mangle</em> and <em>filter</em> tables.</li><li>The <strong>POSTROUTING</strong> chain: The rules in this chain apply to packets as they just leave the network interface. This chain is present in the <em>nat</em> and <em>mangle</em> tables.</li></ul><p>Each of the prerouting, input, forward, output, and postrouting blocks contains even more facilities, which are illustrated in the third part of the packet flow diagram:</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/328227/328442.png" data-image-src="attachments/328227/328442.png" data-unresolved-comment-count="0" data-linked-resource-id="328442" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Pfd.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p><p><br/></p><p>A simple explanation of each box before we go further with examples:</p><ul><li><strong>Hotspot-in</strong> - allows to capture traffic that otherwise would be discarded by connection tracking - this way our Hotspot feature is able to provide connectivity even if networks settings are an incomplete mess ;</li><li><strong>RAW Prerouting</strong> - RAW table prerouting chain;</li><li><strong>Connection tracking</strong> - packet is processed by connection tracking;</li><li><strong>Mangle Prerouting</strong> - Mangle prerouting chain;</li><li><strong>Mangle Input</strong> - Mangle input chain;</li><li><strong>Filter Input</strong> - Firewall filter input chain;</li><li><strong>HTB Global</strong> - Queue tree;</li><li><strong>Simple Queues</strong> - <span style="color:var(--ds-text,#172b4d);">is a feature that can be used to limit traffic for a particular target</span>;</li><li><strong>TTL</strong> - indicates an exact place where the Time To Live (TTL) of the routed packet is reduced by 1 if TTL becomes 0, a packet will be discarded;</li><li><strong>Mangle Forward</strong> - Mangle forward chain;</li><li><strong>Filter Forward</strong> - Filter forward chain;</li><li><strong>Accounting</strong> - Authentication, Authorization, and Accounting feature processing;</li><li><strong>RAW Output</strong> - RAW table output chain;</li><li><strong>Mangle Output</strong> - Mangle output chain;</li><li><strong>Filter Output</strong> - Firewall filter output chain;</li><li><strong>Routing Adjustment</strong> - this is a workaround that allows to set up policy routing in mangle chain output (routing-mark) ;</li><li><strong>Mangle Postrouting</strong> - Mangle postrouting chain;</li><li><strong>Src Nat</strong> - Network Address Translation srcnat chain;</li><li><strong>Dst Nat</strong> - Network Address Translation dstnat chain;</li><li><strong>Hotspot-out</strong> - undo all that was done by hotspot-in for the packets that are going back to the client;</li></ul><p><br/></p><h2 id="PacketFlowinRouterOS-FlowofRoutedPacket">Flow of Routed Packet</h2><h3 id="PacketFlowinRouterOS-Forward">Forward</h3><p>Now, let's take our first example where the packet gets routed over the router and look deeper through what facilities packet goes:</p><div class="sectionColumnWrapper"><div class="sectionMacro"><div class="sectionMacroRow"><div class="columnMacro" style="width:50%;min-width:50%;max-width:50%;"><p>We already learned that packet goes into the in-interface, the router determines that it is an IP packet and needs to be routed, and here starts the complicated process:</p><ol><li> The packet enters prerouting processing:<ol><li>check if there is a hotspot and modify the packet for hotspot use</li><li>process packet through RAW prerouting chain;</li><li>send the packet through connection tracking;</li><li>process packet through Mangle prerouting chain;</li><li> process packet through NATs dst-nat chain;</li></ol></li><li>Run packet through routing table to make routing decision;</li><li>The packet enters the forward process;<ol><li>check TTL value;</li><li>process packet through Mangle forward chain;</li><li>process packet through the Filter forward chain;</li><li>send the packet to accounting processes;<br/><br/></li></ol></li><li>A packet enters postrouting process;<ol><li>process packet through Mangle postrouting chain;</li><li>process packet through NATs src-nat chain;</li><li>if there is a hotspot undo any modifications made in hotspot-in;</li><li>process packet through queue tree (HTB Global);</li><li>process packet through simple queues;<br/><br/></li></ol></li><li>Check if there is IPsec and then process through IPsec policies;</li></ol></div><div class="columnMacro" style="width:50%;min-width:50%;max-width:50%;"><p><span class="confluence-embedded-file-wrapper image-left-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-left" draggable="false" width="750" src="attachments/328227/328443.png" data-image-src="attachments/328227/328443.png" data-unresolved-comment-count="0" data-linked-resource-id="328443" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="02a_routing_forward.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p><span class="confluence-embedded-file-wrapper image-left-wrapper"><img class="confluence-embedded-image image-left" draggable="false" src="attachments/328227/328444.png" data-image-src="attachments/328227/328444.png" data-unresolved-comment-count="0" data-linked-resource-id="328444" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="02a_routing_forward_chains.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span><p><br/></p></div></div></div></div><h3 id="PacketFlowinRouterOS-Input">Input</h3><p>We already learned that packet goes into the in-interface, the router determines that it is an IP packet and needs to be routed, and here starts the complicated process:</p><div class="sectionColumnWrapper"><div class="sectionMacro"><div class="sectionMacroRow"><div class="columnMacro" style="width:50%;min-width:50%;max-width:50%;"><ol><li><span>A very similar process happens when a packet's destination is a router (routing input): </span>Packet enters prerouting processing:<ol><li>- check if there is a hotspot and modify the packet for hotspot use;</li><li>- process packet through RAW prerouting chain;</li><li>- send a packet through connection tracking;</li><li>- process packet through Mangle prerouting chain;</li><li>- process packet through NATs dst-nat chain;<br/><br/></li></ol></li><li>Run packet through routing table to make routing decision;<br/><br/></li><li>A Packet enters the input process;<ol><li>- process packet through Mangle input chain;</li><li>- p<span style="color:var(--ds-text,#172b4d);">rocess packet through Filter input chain;</span></li><li>- process packet through queue tree (HTB Global);</li><li>- process packet through simple queues;<br/><br/></li></ol></li><li>Check if there is IPsec and then process through IPsec policies.</li></ol></div><div class="columnMacro" style="width:50%;min-width:50%;max-width:50%;"><p><span class="confluence-embedded-file-wrapper image-left-wrapper"><img class="confluence-embedded-image image-left" draggable="false" src="attachments/328227/328445.png" data-image-src="attachments/328227/328445.png" data-unresolved-comment-count="0" data-linked-resource-id="328445" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="02b_routing_input.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p><p><span class="confluence-embedded-file-wrapper image-left-wrapper"><img class="confluence-embedded-image image-left" draggable="false" src="attachments/328227/328446.png" data-image-src="attachments/328227/328446.png" data-unresolved-comment-count="0" data-linked-resource-id="328446" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="02b_routing_input_chains.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p></div></div></div></div><h3 id="PacketFlowinRouterOS-Output">Output</h3><p>Or when a packet is originated from the router (routing output):</p><div class="sectionColumnWrapper"><div class="sectionMacro"><div class="sectionMacroRow"><div class="columnMacro" style="width:50%;min-width:50%;max-width:50%;"><ol><li>The packet is originated from the router itself<ol><li>the packet goes through the routing table to make a routing decision<br/><br/></li></ol></li><li>A packet enters the output process<ol><li>process packet through the Bridge decision;</li><li>send the packet through connection tracking;</li><li>process packet through the Mangle output chain;</li><li>process packet through the Filter output chain;</li><li>send the packet to routing adjustment ( policy routing)<br/><br/></li></ol></li><li> The packet enters postrouting process; <ol><li>- process packet through Mangle postrouting chain;</li><li>- process packet through NATs src-nat chain;</li><li>- if there is a hotspot undo any modifications made in hotspot-in;</li><li>- process packet through queue tree (HTB Global);</li><li>- process packet through simple queues;<br/><br/></li></ol></li><li>Check if there is IPsec and then process through IPsec policies;</li></ol></div><div class="columnMacro" style="width:50%;min-width:50%;max-width:50%;"><p><span class="confluence-embedded-file-wrapper image-left-wrapper"><img class="confluence-embedded-image image-left" draggable="false" src="attachments/328227/328447.png" data-image-src="attachments/328227/328447.png" data-unresolved-comment-count="0" data-linked-resource-id="328447" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="02c_routing_output.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span><span class="confluence-embedded-file-wrapper image-left-wrapper"><img class="confluence-embedded-image image-left" draggable="false" src="attachments/328227/328448.png" data-image-src="attachments/328227/328448.png" data-unresolved-comment-count="0" data-linked-resource-id="328448" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="02c_routing_output_chains.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p></div></div></div></div><p><br/></p><p><br/></p><h2 id="PacketFlowinRouterOS-FlowofBridgedPacket">Flow of Bridged Packet</h2><p>Below is discussed a general bridging process in RouterOS. Most of the packets will always follow the same processing path, but in certain configurations (e.g. with enabled VLAN filtering, horizon, STP, DHCP, or IGMP snooping) some packets can be treated differently. Please visit the bridging manual for more specific information.</p><h3 id="PacketFlowinRouterOS-"><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/328227/328459.png" data-image-src="attachments/328227/328459.png" data-unresolved-comment-count="0" data-linked-resource-id="328459" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="01a_bridging_concept.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></h3><h3 id="PacketFlowinRouterOS-BridgeForward">Bridge Forward</h3><p>Bridge forward is a process that takes place when a packet is forwarded from one bridge port to another, essentially connecting multiple devices on the same network. After receiving a packet on the in-interface, the device determines that the in-interface is a bridge port, so it gets passed through the bridging process:</p><div class="sectionColumnWrapper"><div class="sectionMacro"><div class="sectionMacroRow"><div class="columnMacro" style="width:49%;min-width:49%;max-width:49%;"><ol><li>A packet goes through the bridge NAT dst-nat chain, where MAC destination and priority can be changed, apart from that, a packet can be simply accepted, dropped, or marked;</li><li>Checks whether the use-ip-firewall option is enabled in the bridge settings;</li><li>Run packet through the bridge host table to make a forwarding decision. A packet that ends up being flooded (e.g. broadcast, multicast, unknown unicast traffic), gets multiplied per bridge port and then processed further in the bridge forward chain. When using<span style="color:var(--ds-icon-success,#22a06b);"><code> vlan-filtering=yes</code></span>, packets that are not allowed due to the &quot;/interface bridge vlan&quot; table, will be dropped at this stage.</li><li>A packet goes through the bridge filter forward chain, where priority can be changed or the packet can be simply accepted, dropped, or marked;</li><li>Checks whether the use-ip-firewall option is enabled in the bridge settings;</li><li>A packet goes through the bridge NAT src-nat chain, where MAC source and priority can be changed, apart from that, a packet can be simply accepted, dropped, or marked;</li><li>Checks whether the use-ip-firewall option is enabled in the bridge settings;</li></ol></div><div class="columnMacro" style="width:49%;min-width:49%;max-width:49%;"><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" draggable="false" width="950" src="attachments/328227/306675724.png" data-image-src="attachments/328227/306675724.png" data-unresolved-comment-count="0" data-linked-resource-id="306675724" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-2025-3-24_9-44-22.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p><p><br/></p></div></div></div></div><div role="region" aria-label="Info" class="confluence-information-macro  confluence-information-macro-information" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-info-filled confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p><strong>For RouterOS v6:</strong><br/>When bridge <code><span style="color:var(--ds-icon-success,#22a06b);">vlan-filtering</span></code> is enabled, received untagged packets might get encapsulated into the VLAN header before the &quot;DST-NAT&quot; block, which means these packets can be filtered using the <code><span style="color:var(--ds-icon-success,#22a06b);">mac-protocol=vlan</span></code> and <span style="color:var(--ds-icon-success,#22a06b);"><code>vlan-encap</code></span> settings. Encapsulation can happen if the outgoing interface has <code><span style="color:var(--ds-icon-success,#22a06b);">frame-types</span></code> set to <code>admit-all</code> or <code>admit-only-untagged-and-priority-tagged</code>.</p><p>Tagged packets might get decapsulated on the &quot;BRIDGING DECISION&quot; block, which means these packets will no longer match the <code><span style="color:var(--ds-icon-success,#22a06b);">mac-protocol=vlan</span></code> and <span style="color:var(--ds-icon-success,#22a06b);"><code>vlan-encap</code></span> settings. Decapsulation can happen if the packet's VLAN ID matches the outgoing port's untagged VLAN membership.<br/><br/><strong>For RouterOS v7 and newer:</strong></p><p>When bridge <code><span style="color:var(--ds-icon-success,#22a06b);">vlan-filtering</span></code> is enabled, received untagged packets might get encapsulated into the VLAN header on the &quot;BRIDGING-DECISION&quot; block, which means these packets can be filtered using the <code><span style="color:var(--ds-icon-success,#22a06b);">mac-protocol=vlan</span></code> and <span style="color:var(--ds-icon-success,#22a06b);"><code>vlan-encap</code></span> settings.  Encapsulation can happen if the outgoing interface has <code><span style="color:var(--ds-icon-success,#22a06b);">frame-types</span></code> set to <code>admit-all</code> or <code>admit-only-untagged-and-priority-tagged</code>.</p><p>Tagged packets might get decapsulated on the &quot;BRIDGING DECISION&quot; block, which means these packets will no longer match the <code><span style="color:var(--ds-icon-success,#22a06b);">mac-protocol=vlan</span></code> and <span style="color:var(--ds-icon-success,#22a06b);"><code>vlan-encap</code></span> settings. Decapsulation can happen if the packet's VLAN ID matches the outgoing port's untagged VLAN membership.</p></div></div><h3 id="PacketFlowinRouterOS-BridgeInput">Bridge Input</h3><p>Bridge input is a process that takes place when a packet is destined for the bridge interface. Most commonly this happens when you need to reach some services that are running on the bridge interface (e.g. a DHCP server) or you need to route traffic to other networks. The very first steps are similar to the bridge forward process - after receiving a packet on the in-interface, the device determines that the in-interface is a bridge port, so it gets passed through the bridging process:</p><div class="sectionColumnWrapper"><div class="sectionMacro"><div class="sectionMacroRow"><div class="columnMacro" style="width:400px;min-width:400px;max-width:400px;"><ol><li>A packet goes through the bridge NAT dst-nat chain, where MAC destination and priority can be changed, apart from that, a packet can be simply accepted, dropped, or marked;</li><li>Checks whether the use-ip-firewall option is enabled in the bridge settings;</li><li>Run packet through the bridge host table to make a forwarding decision. A packet where the destination MAC address matches the bridge MAC address will be passed to the bridge input chain. A packet that ends up being flooded (e.g. broadcast, multicast, unknown unicast traffic), also reaches the bridge input chain as the bridge interface itself is one of the many destinations;</li><li>A packet goes through the bridge filter input chain, where priority can be changed or the packet can be simply accepted, dropped, or marked;</li></ol></div><div class="columnMacro" style="width:50%;min-width:50%;max-width:50%;"><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" draggable="false" width="950" src="attachments/328227/306675725.png" data-image-src="attachments/328227/306675725.png" data-unresolved-comment-count="0" data-linked-resource-id="306675725" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-2025-3-24_9-44-55.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p></div></div></div></div><h3 id="PacketFlowinRouterOS-BridgeOutput">Bridge Output</h3><p>Bridge output is a process that takes place when a packet should exit the device through one or multiple bridge ports. Most commonly this happens when a bridge interface itself tries to reach a device connected to a certain bridge port (e.g. when a DHCP server running on a bridge interface is responding to a DHCP client). After a packet is processed on other higher-level RouterOS processes and the device finally determines that the output interface is a bridge, the packet gets passed through the bridging process:</p><div class="sectionColumnWrapper"><div class="sectionMacro"><div class="sectionMacroRow"><div class="columnMacro" style="width:400px;min-width:400px;max-width:400px;"><ol><li>Run packet through the bridge host table to make a forwarding decision. A packet that ends up being flooded (e.g. broadcast, multicast, unknown unicast traffic), gets multiplied per bridge port and then processed further in the bridge output chain.</li><li>A packet goes through the bridge filter output chain, where priority can be changed or the packet can be simply accepted, dropped, or marked;</li><li>A packet goes through the bridge NAT src-nat chain, where MAC source and priority can be changed, apart from that, a packet can be simply accepted, dropped, or marked;</li><li>Checks whether the use-ip-firewall option is enabled in the bridge settings;</li></ol></div><div class="columnMacro" style="width:50%;min-width:50%;max-width:50%;"><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" draggable="false" width="950" src="attachments/328227/306675726.png" data-image-src="attachments/328227/306675726.png" data-unresolved-comment-count="0" data-linked-resource-id="306675726" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-2025-3-24_9-45-31.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p></div></div></div></div><h3 id="PacketFlowinRouterOS-ForwardWithFirewallEnabled">Forward With Firewall Enabled</h3><p>In certain network configurations, you might need to enable additional processing on routing chains for bridged traffic, for example, to use simple queues or an IP firewall. This can be done when the use-ip-firewall is enabled under the bridge settings. Note that additional processing will consume more CPU resources to handle these packets. All the steps were already discussed in previous points, below is a recap:</p><div class="sectionColumnWrapper"><div class="sectionMacro"><div class="sectionMacroRow"><div class="columnMacro" style="width:400px;min-width:400px;max-width:400px;"><ol><li>A packet goes through the bridge NAT dst-nat chain;</li><li>With the use-ip-firewall option enabled, the packet will be further processed in the prerouting chain;</li><li>A packet enters prerouting processing;</li><li>Run packet through the bridge host table to make forwarding decision;</li><li>A packet goes through the bridge filter forward chain;</li><li>With the use-ip-firewall option enabled, the packet will be further processed in the routing forward chain;</li><li>A packet enters routing forward processing;</li><li>A packet goes through the bridge NAT src-nat chain;</li><li>With the use-ip-firewall option enabled, the packet will be further processed in the postrouting chain;</li><li>A packet enters postrouting processing;</li></ol></div><div class="columnMacro" style="width:50%;min-width:50%;max-width:50%;"><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" draggable="false" width="950" src="attachments/328227/306675727.png" data-image-src="attachments/328227/306675727.png" data-unresolved-comment-count="0" data-linked-resource-id="306675727" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-2025-3-24_9-46-1.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" draggable="false" width="950" src="attachments/328227/328464.png" data-image-src="attachments/328227/328464.png" data-unresolved-comment-count="0" data-linked-resource-id="328464" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="04d_bridging_forward_with_use_ip_firewall_chains.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p></div></div></div></div><h2 id="PacketFlowinRouterOS-FlowofHardwareOffloadedPacket">Flow of Hardware Offloaded Packet</h2><p>On the previous topic, we solely discussed a software bridging that requires the main CPU processing to forward packets through the correct bridge port. Most of the MikroTik devices are equipped with dedicated switching hardware, the so-called switch chip or switch ASIC. This allows us to offload some of the bridging functions, like packet forwarding between bridge ports or packet filtering, to this specialized hardware chip without consuming any CPU resources. In RouterOS, we have named this function Bridge Hardware (HW) Offloading. Different MikroTik devices might have different switch chips and each chip has a different set of features available, so make sure to visit this article to get more details - <a href="https://help.mikrotik.com/docs/display/ROS/Bridging+and+Switching#BridgingandSwitching-BridgeHardwareOffloading" rel="nofollow">Bridge Hardware Offloading</a>.</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/328227/30474246.png" data-image-src="attachments/328227/30474246.png" data-unresolved-comment-count="0" data-linked-resource-id="30474246" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="Switch_packetFlow_example1.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Interface HTB will not work correctly when the out-interface is hardware offloaded and the bridge Fast Path is not active.</p></div></div><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image auto-cursor-target image-center" draggable="false" src="attachments/328227/30474248.png" data-image-src="attachments/328227/30474248.png" data-unresolved-comment-count="0" data-linked-resource-id="30474248" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Detailed_switch_flow_redArrows.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p><ul><li><strong>switching decision</strong> - widely depends on the switch model. This block controls all the switching-related tasks, like host learning, packet forwarding, filtering, VLAN tagging/untagging, etc. Certain switch configurations can alter the packet flow;</li><li><strong>switch-cpu port</strong> - a special purpose switch port for communication between the main CPU and other switch ports. Note that the switch-cpu port does not show up anywhere on RouterOS except for the switch menu, none of the software-related configurations (e.g. interface-list) can be applied to this port. Packets that reach the CPU are automatically associated with the physical in-interface.</li></ul><p>The hardware offloading, however, does not restrict a device to only hardware limited features, rather it is possible to take advantage of the hardware and software processing at the same time. This does require a profound understanding of how packets travel through the switch chip and when exactly they are passed to the main CPU.</p><div role="region" aria-label="Info" class="confluence-information-macro  confluence-information-macro-information" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-info-filled confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Switch features found in the &quot;/interface/ethernet/switch&quot; menu and its sub-menus, like ACL rules, mirroring, ingress/egress rate limiters, QoS, and L3HW (<span style="color:var(--ds-text,#333333);">except </span>inter-VLAN routing) may not rely on bridge hardware offloading. Therefore, they can <strong>potentially</strong> be applied to interfaces not configured within a hardware-offloaded bridge.</p></div></div><h3 id="PacketFlowinRouterOS-SwitchForward">Switch Forward</h3><p>We will further discuss a packet flow when bridge hardware offloading is enabled and a packet is forwarded between two switched ports on a single switch chip. This is the most common and also the simplest example:</p><div class="sectionColumnWrapper"><div class="sectionMacro"><div class="sectionMacroRow"><div class="columnMacro" style="width:50%;min-width:50%;max-width:50%;"><ol><li>The switch checks whether the in-interface is a hardware offloaded interface;</li><li>Run a packet through the switch host table to make a forwarding decision. If the switch finds a match for the destination MAC address, the packet is sent out through the physical interface. A packet that ends up being flooded (e.g. broadcast, multicast, unknown unicast traffic) gets multiplied and sent out to every hardware offloaded switch port.</li></ol></div><div class="columnMacro" style="width:50%;min-width:50%;max-width:50%;"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" draggable="false" src="attachments/328227/30474249.png" data-image-src="attachments/328227/30474249.png" data-unresolved-comment-count="0" data-linked-resource-id="30474249" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Detailed_switch_flow_redArrowsv1.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p></div></div></div></div><h3 id="PacketFlowinRouterOS-SwitchtoCPUInput">Switch to CPU Input</h3><p>This process takes place when a packet is received on a physical interface and it is destined to switch-cpu port for further software processing. There are two paths to the switch-cpu. One where hardware offloading and switching is not even used (e.g. a standalone interface for routing or a bridged interface but with deliberately disabled HW offloading), so the packet is simply passed further for software processing. Another path is taken when hardware offloading is active on the in-interface. This will cause the packet to pass through the switching decision and there are various reasons why the switch might forward the packet to the switch-cpu port:</p><ul><li>a packet's destination MAC address match with a local MAC address, e.g. when a packet is destined to a local bridge interface;</li><li>a packet might get flooded to all switch ports including the switch-cpu port, e.g. when broadcast, multicast, or unknown unicast traffic is received;</li><li>a switch might have learned that some hosts can only be reached through the CPU (switch-cpu port learning is discussed in the next section), e.g. when a bridge contains HW and non-HW offloaded interfaces, such as wireless, EoIP, and even Ethernet interfaces;</li><li>a packet is intentionally copied to the switch-cpu, e.g. for a packet inspection;</li><li>a packet is triggered by the switch configuration and should be processed in software, e.g. a DHCP or IGMP snooping.</li></ul><p>See the packet walkthrough when an in-interface is hardware offloaded:</p><div class="sectionColumnWrapper"><div class="sectionMacro"><div class="sectionMacroRow"><div class="columnMacro" style="width:50%;min-width:50%;max-width:50%;"><ol><li>The switch checks whether the in-interface is a hardware offloaded interface;</li><li>Run a packet through the switch host table to make a forwarding decision. In case any of the above-mentioned points are true, the packet gets forwarded to the switch-cpu port.</li><li>The packet exits through the switch-cpu port and it will be further processed by the RouterOS packet flow.</li></ol></div><div class="columnMacro" style="width:50%;min-width:50%;max-width:50%;"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" draggable="false" src="attachments/328227/30474250.png" data-image-src="attachments/328227/30474250.png" data-unresolved-comment-count="0" data-linked-resource-id="30474250" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Detailed_switch_flow_redArrowsv2.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p></div></div></div></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Any received packet that was flooded by the switch chip will not get flooded again by the software bridge to the same HW offloaded switch group. This prevents the formation of duplicate packets.</p></div></div><h3 id="PacketFlowinRouterOS-CPUOutputtoSwitch">CPU Output to Switch</h3><p>This process takes place when a packet exits the RouterOS software processing and is received on the switch-cpu port. Again, there are two paths the packet can take. One where hardware offloading and switching are not even used (e.g. a standalone interface for routing or a bridged interface but with deliberately disabled HW offloading), so the packet is simply sent out through the physical out-interface. Another path is taken when hardware offloading is active on the out-interface. This will cause the packet to pass through the switching decision. Just like any other switch port, the switch will learn the source MAC addresses from packets that are received on the switch-cpu port. This does come in handy when a bridge contains HW and non-HW offloaded interfaces, so the switch can learn which frames should be forwarded to the CPU. See the packet walkthrough when an out-interface is hardware offloaded:</p><div class="sectionColumnWrapper"><div class="sectionMacro"><div class="sectionMacroRow"><div class="columnMacro" style="width:50%;min-width:50%;max-width:50%;"><ol><li>A packet that exits the RouterOS software processing is received on the switch-cpu port;</li><li>The switch checks whether the out-interface is a hardware offloaded interface;</li><li>Run a packet through the switch host table to make a forwarding decision. If the switch finds a match for the destination MAC address, the packet is sent out through the physical interface. A packet that ends up being flooded (e.g. broadcast, multicast, unknown unicast traffic) gets multiplied and sent out to every hardware offloaded switch port.</li></ol></div><div class="columnMacro" style="width:50%;min-width:50%;max-width:50%;"><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" draggable="false" src="attachments/328227/30474251.png" data-image-src="attachments/328227/30474251.png" data-unresolved-comment-count="0" data-linked-resource-id="30474251" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Detailed_switch_flow_redArrowsv3.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p></div></div></div></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>A software bridge that sends a flooded packet through HW offloaded interfaces, will only send a single packet copy per HW offloaded switch group rather than per HW offloaded interface. The actual flooding will be done by the switch chip, this prevents the formation of duplicate packets.</p></div></div><h2 id="PacketFlowinRouterOS-FlowofMPLSPacket">Flow of MPLS Packet</h2><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/328227/328458.png" data-image-src="attachments/328227/328458.png" data-unresolved-comment-count="0" data-linked-resource-id="328458" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="01b_mpls_concept.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p><h3 id="PacketFlowinRouterOS-PopLabel">Pop Label</h3><div class="sectionColumnWrapper"><div class="sectionMacro"><div class="sectionMacroRow"><div class="columnMacro"><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/328227/328456.png" data-image-src="attachments/328227/328456.png" data-unresolved-comment-count="0" data-linked-resource-id="328456" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="03_mpls_input.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p><p><br/></p></div></div></div></div><h3 id="PacketFlowinRouterOS-SwitchLabel">Switch Label</h3><div class="sectionColumnWrapper"><div class="sectionMacro"><div class="sectionMacroRow"><div class="columnMacro"><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/328227/328455.png" data-image-src="attachments/328227/328455.png" data-unresolved-comment-count="0" data-linked-resource-id="328455" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="03_mpls_forward.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p><p><br/></p></div></div></div></div><h3 id="PacketFlowinRouterOS-PushLabel">Push Label</h3><div class="sectionColumnWrapper"><div class="sectionMacro"><div class="sectionMacroRow"><div class="columnMacro"><p><br/></p><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/328227/328457.png" data-image-src="attachments/328227/328457.png" data-unresolved-comment-count="0" data-linked-resource-id="328457" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="03_mpls_output.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p></div></div></div></div><h2 id="PacketFlowinRouterOS-MPLSIPVPN">MPLS IP VPN</h2><p>In VPNv4 setups packet arriving at PE router that needs to be forwarded to the CE router is not a typical &quot;forward&quot;. </p><p>If incoming label and destination is bound to the VRF Then after MPLS label is popped and:</p><ul><li>destination address is local to the router, then packet is moved to LOCAL_IN</li><li>destination address is in the CE network, then packet is moved to LOCAL_OUT</li></ul><div role="region" aria-label="Warning" class="confluence-information-macro  confluence-information-macro-warning" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Forwarded packets from MPLS cloud to the CE network will not show up in the forward.</p></div></div><p><br/></p><p>For example traffic from src:111.15.0.1 to dst:111.13.0.1</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false">[admin@CCR2004_2XS] /mpls/forwarding-table&gt; print 
Flags: L - LDP, P - VPN
Columns: LABEL, VRF, PREFIX, NEXTHOPS
#   LABEL  VRF      PREFIX         NEXTHOPS                                                                                                           
0 P    17  myVrf    111.13.0.0/24  
4 L    20  main     203.0.113.2    { label=impl-null; nh=111.11.0.1; interface=sfp-sfpplus1 }
[admin@CCR2004_2XS] /mpls/forwarding-table&gt;                                                           
...

[admin@CCR2004_2XS] /ip/route&gt; print detail 
Flags: D - dynamic; X - disabled, I - inactive, A - active; c - connect, s - static, r - rip, b - bgp, o - ospf, i - is-is, d - dhcp, v - vpn, m - modem, y - bgp-mpls-vpn; 
H - hw-offloaded; + - ecmp 

   DAc   dst-address=111.11.0.0/24 routing-table=main gateway=sfp-sfpplus1 immediate-gw=sfp-sfpplus1 distance=0 scope=10 suppress-hw-offload=no 
         local-address=111.11.0.2%sfp-sfpplus1 
   DAc   dst-address=203.0.113.1/32 routing-table=main gateway=lo immediate-gw=lo distance=0 scope=10 suppress-hw-offload=no local-address=203.0.113.1%lo 
   DAo   dst-address=203.0.113.2/32 routing-table=main gateway=111.11.0.1%sfp-sfpplus1 immediate-gw=111.11.0.1%sfp-sfpplus1 distance=110 scope=20 target-scope=10 
         suppress-hw-offload=no 
   DAc   dst-address=111.13.0.0/24 routing-table=myVrf gateway=sfp-sfpplus2@myVrf immediate-gw=sfp-sfpplus2 distance=0 scope=10 suppress-hw-offload=no 
         local-address=111.13.0.2%sfp-sfpplus2@myVrf 
   DAy   dst-address=111.15.0.0/24 routing-table=myVrf gateway=203.0.113.2 immediate-gw=111.11.0.1%sfp-sfpplus1 distance=200 scope=40 target-scope=30 suppress-hw-offload=no [admin@CCR2004_2XS] /ip/route&gt;              </pre>
</div></div><p>Packet will be seen in the output and postrouting chains, because now it is locally originated packet with source MAC address equal to vrfInterface:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false">08:10:55 firewall,info output: in:(unknown 0) out:sfp-sfpplus2, connection-state:established src-mac f2:b5:e9:17:18:3b, proto ICMP (type 8, code 0), 111.15.0.1-&gt;111.13.0.1, len 56
08:10:55 firewall,info postrouting: in:myVrf out:sfp-sfpplus2, connection-state:established src-mac f2:b5:e9:17:18:3b, proto ICMP (type 8, code 0), 111.15.0.1-&gt;111.13.0.1, len 56</pre>
</div></div><p>On the other hand, for packets routed in the direction CE→PE will be seen in the &quot;forward&quot; as any other routed IP traffic before being sent to the MPLS:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false"> 08:10:55 firewall,info prerouting: in:sfp-sfpplus2 out:(unknown 0), connection-state:established src-mac dc:2c:6e:46:f8:93, proto ICMP (type 0, code 0), 111.13.0.1-&gt;111.15.0.1, len 56
 08:10:55 firewall,info forward: in:sfp-sfpplus2 out:sfp-sfpplus1, connection-state:established src-mac dc:2c:6e:46:f8:93, proto ICMP (type 0, code 0), 111.13.0.1-&gt;111.15.0.1, len 56
 08:10:55 firewall,info postrouting: in:sfp-sfpplus2 out:sfp-sfpplus1, connection-state:established src-mac dc:2c:6e:46:f8:93, proto ICMP (type 0, code 0), 111.13.0.1-&gt;111.15.0.1, len 56
 </pre>
</div></div><p><br/></p><p>But there can be an exception. If destination IP of reply packet is local to the router and connection tracking is performing NAT translation then connection tracking will &quot;force&quot; packet to move through the firewall prerouting/forward/postrouting chains.</p><h2 id="PacketFlowinRouterOS-LogicalInterfaces">Logical Interfaces</h2><p>So far we looked at examples when in or out interfaces are actual physical interfaces (Ethernet, wireless), but how packets will flow if the router receives tunnel encapsulated packets?</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/328227/328454.png" data-image-src="attachments/328227/328454.png" data-unresolved-comment-count="0" data-linked-resource-id="328454" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="01e_encapsulate_decapsulate.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p><p>Let's assume that there is an IPIP packet coming into the router. Since it is a regular ipv4 packet it will be processed through all routing-related facilities ( until &quot;J&quot; in the diagram). Then the router will look if the packet needs to be decapsulated., in this case, it is an IPIP packet so &quot;yes&quot; send the packet to decapsulation. After that packet will go another loop through all the facilities but this time as a decapsulated IPv4 packet.</p><p>It is very important because the packet actually travels through the firewall twice, so if there is a strict firewall, then there should be &quot;accept&quot; rules for IPIP encapsulated packets as well as decapsulated IP packets.</p><div role="region" aria-label="Info" class="confluence-information-macro  confluence-information-macro-information" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-info-filled confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Packet encapsulation and decapsulation using a bridge with enabled <code><span style="color:var(--ds-icon-success,#22a06b);">vlan-filtering</span></code> do not relate to logical interfaces. See more details in the bridging section.</p></div></div><p><br/></p><h2 id="PacketFlowinRouterOS-IPSecPolicies"><span style="font-size: 20.0px;letter-spacing: -0.008em;">IPSec Policies</span></h2><p>Let's take a look at another tunnel type - IPSec. This type of VPN does not have logical interfaces but is processed in a similar manner.</p><div class="sectionColumnWrapper"><div class="sectionMacro"><div class="sectionMacroRow"><div class="columnMacro" style="width:400px;min-width:400px;max-width:400px;">Instead of logical interfaces packets are processed through IPSec policies. After routing decision (2) and input firewall processing (3), the router tries to match the source and destination to the IPsec policy. When policy matches the packet it is sent to decryption (5). After the decryption packet enters PREROUTING processing again (6) and starts another processing loop, but now with the decapsulated packet.</div><div class="columnMacro"><p><br/></p><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/328227/328452.png" data-image-src="attachments/328227/328452.png" data-unresolved-comment-count="0" data-linked-resource-id="328452" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="02d_ipsec_decryption.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p></div></div></div></div><p><br/></p><div class="sectionColumnWrapper"><div class="sectionMacro"><div class="sectionMacroRow"><div class="columnMacro" style="width:400px;min-width:400px;max-width:400px;">The same process is with encapsulation but in reverse order. The first IP packet gets processed through facilities, then matched against IPsec policies (5), encapsulated (6), and then sent to processing on the second loop (7-10).</div><div class="columnMacro"><p><br/></p><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/328227/328453.png" data-image-src="attachments/328227/328453.png" data-unresolved-comment-count="0" data-linked-resource-id="328453" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="02d_ipsec_encryption.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p></div></div></div></div><p><br/></p><h1 id="PacketFlowinRouterOS-FastPath">Fast Path</h1><p>From what we learned so far, it is quite obvious that such packet processing takes a lot of CPU resources. To fast things up FastPath was introduced in the first RouterOS v6. What it does is it skips processing in the Linux kernel, basically trading some RouterOS functionality for performance. For FastPath to work, interface driver support and specific configuration conditions are required.</p><h2 id="PacketFlowinRouterOS-HowFastPathWorks">How Fast Path Works</h2><p>FastPath is an interface driver extension, that allows a driver to talk directly to specific RouterOS facilities and skip all others.</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/328227/328451.svg" data-image-src="attachments/328227/328451.svg" data-unresolved-comment-count="0" data-linked-resource-id="328451" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="fastpath.svg" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/svg+xml" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p><p>The packet can be forwarded by a fast path handler only if at least the source interface supports a fast path. For complete fast-forwarding, destination interface support is also required.</p><p>Currently, RouterOS has the following FastPath handlers:</p><ul><li>IPv4</li><li>IPv4 FastTrack</li><li>Traffic Generator</li><li>MPLS</li><li>Bridge</li></ul><p><br/></p><p>IPv4 FastPath handler is used if the following conditions are met:</p><ul><li>firewall rules are not configured;</li><li>simple queue or queue trees with <em>parent=global</em> are not configured;</li><li>no mesh, metarouter interface configuration;</li><li>sniffer or torch is not running;</li><li>connection tracking is not active;</li><li>IP accounting is disabled;</li><li>VRFs are not configured (<code>/ip route vrf</code> is empty);</li><li>A hotspot is not used (<code>/ip hotspot</code> has no interfaces);</li><li>IPSec policies are not configured;</li><li><code>/tool mac-scan</code> is not actively used;</li><li><code>/tool ip-scan</code> is not actively used.</li></ul><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Packets will travel the FastPath way if FastTrack is used no matter if the above conditions are met.</p></div></div><p><br/></p><p>Traffic Generator automatically use FastPath if the interface supports this feature. </p><p><br/></p><p>Currently, MPLS fast-path applies to MPLS switched traffic (frames that enter router as MPLS and must leave router as MPLS) and VPLS endpoint that do VPLS encap/decap. Other MPLS ingress and egress will operate as before.</p><p><br/></p><p>A Bridge handler is used if the following conditions are met:</p><ul><li>there are no bridge Calea, filter, NAT rules;</li><li><em>use-ip-firewall</em> is disabled;</li><li>no mesh, MetaRouter interface configuration;</li><li>sniffer, torch, and traffic generator are not running;</li><li>bridge vlan-filtering<span> </span>is disabled (condition is removed since RouterOS 7.2 version);</li><li>bridge dhcp-snooping<span> </span>is disabled.</li></ul><p><br/></p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>FastPath on the vlan-filtering bridge does NOT support priority-tagged packets (packets with VLAN header but VLAN ID = 0). Those packets are redirected via a slow path.</p></div></div><p><br/></p><p>Interfaces that support FastPath:</p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 100.0%;"><colgroup><col style="width: 46.85063%;"/><col style="width: 53.089382%;"/></colgroup><tbody><tr><th class="confluenceTh">RouterBoard</th><th class="confluenceTh">Interfaces</th></tr><tr><td class="confluenceTd"><strong>RB6xx series</strong></td><td class="confluenceTd">ether1,2</td></tr><tr><td class="confluenceTd"><strong>RB800</strong></td><td class="confluenceTd">ether1,2</td></tr><tr><td class="confluenceTd"><strong>RB1100 series</strong></td><td class="confluenceTd">ether1-11</td></tr><tr><td rowspan="8" class="confluenceTd"><strong>All devices</strong><br/><strong><br/></strong></td><td class="confluenceTd">Ethernet interfaces</td></tr><tr><td class="confluenceTd">wireless interfaces</td></tr><tr><td class="confluenceTd">bridge interfaces</td></tr><tr><td class="confluenceTd">VLAN, VRRP interfaces</td></tr><tr><td class="confluenceTd">bonding interfaces (RX only)</td></tr><tr><td class="confluenceTd">PPPoE, L2TP interfaces</td></tr><tr><td class="confluenceTd">EoIP, GRE, IPIP, VXLAN interfaces.</td></tr><tr><td class="confluenceTd">VPLS (starting from v7.17)</td></tr></tbody></table></div><p>EoIP, Gre, IPIP, VXLAN and L2TP interfaces have per-interface setting <em>allow-fast-path.</em> Allowing a fast path on these interfaces has a side effect of bypassing firewall, connection tracking, simple queues, queue tree with parent=global, IP accounting, IPsec, hotspot universal client, vrf assignment for encapsulated packets that go through a fast-path. Also, packet fragments cannot be received in FastPath.</p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Whether FastPath is being used can be verified with <code>/interface print stats-detail</code></p></div></div><p>Only interface queue that guarantees FastPath is only-hardware-queue. If you need an interface queue other than hardware then the packet will not go fully FastPath, but there is not a big impact on performance, as &quot;interface queue&quot; is the last step in the packet flow.</p><p>The packet may go Half-FastPath by switching from FastPath to SlowPath, but not the other way around. So, for example, if the receiving interface has FastPath support, but the out interface does not, then the router will process the packet by FastPath handlers as far as it can and then proceed with SlowPath. If the receiving interface does not support FastPath but the out interface does, the packet will be processed by SlowPath all the way through the router.</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/328227/328450.png" data-image-src="attachments/328227/328450.png" data-unresolved-comment-count="0" data-linked-resource-id="328450" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="half-fastpath.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p><h1 id="PacketFlowinRouterOS-FastTrack">FastTrack</h1><p>Fasttrack can be decoded as Fast Path + Connection Tracking. It allows marking connections as &quot;fast-tracked&quot;, marking packets that belong to fast-tracked connection will be sent fast-path way. The connection table entry for such a connection now will have a fast-tracked flag.</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/328227/328449.png" data-image-src="attachments/328227/328449.png" data-unresolved-comment-count="0" data-linked-resource-id="328449" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="fasttrack.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p class="auto-cursor-target">FastTrack packets bypass firewall, connection tracking, simple queues, queue tree with parent=global, ip traffic-flow, IP accounting, IPSec, hotspot universal client, VRF assignment, so it is up to the administrator to make sure FastTrack does not interfere with other configuration!</p></div></div><p>To mark a connection as fast-tracked new action was implemented &quot;<em>fasttrack-connection&quot;</em> for firewall filter and mangle. Currently, only IPv4 TCP and UDP connections can be fast-tracked and to maintain connection tracking entries some random packets will still be sent to a slow path. This must be taken into consideration when designing firewalls with enabled &quot;fasttrack&quot;.</p><p>FastTrack handler also supports source and destination NAT, so special exceptions for NATed connections are not required.</p><div role="region" aria-label="Warning" class="confluence-information-macro  confluence-information-macro-warning" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon" ></span><div class="confluence-information-macro-body">Traffic that belongs to a fast-tracked connection travels in FastPath, which means that it will not be visible by other router L3 facilities (firewall, queues, IPsec, IP accounting, VRF assignment, etc). <span style="color:var(--ds-text,#333333);">Fasttrack lookups route before routing marks have been set, so it works only with the main routing table.</span></div></div><p>The easiest way to start using this feature on home routers is to enable &quot;fasttrack&quot; for all <em>established, related</em> connections:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: true">/ip firewall filter 
add chain=forward action=fasttrack-connection connection-state=established,related \
  comment=&quot;fasttrack established/related&quot;
add chain=forward action=accept connection-state=established,related \
  comment=&quot;accept established/related&quot;</pre>
</div></div><p>Notice that the first rule marks established/related connections as fast-tracked, the second rule is still required to accept packets belonging to those connections. The reason for this is that, as was mentioned earlier, some random packets from fast-tracked connections are still sent the slow pathway and only UDP and TCP are fast-tracked, but we still want to accept packets for other protocols.</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/328227/328467.png" data-image-src="attachments/328227/328467.png" data-unresolved-comment-count="0" data-linked-resource-id="328467" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="fasttrack1_example.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/328227/328468.png" data-image-src="attachments/328227/328468.png" data-unresolved-comment-count="0" data-linked-resource-id="328468" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="fasttrack1_example2.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328227" data-linked-resource-container-version="107" tabindex="0" alt=""></span></p><p>After adding the &quot;FastTrack&quot; rule special dummy rule appeared at the top of the list. This is not an actual rule, it is for visual information showing that some of the traffic is traveling FastPath and will not reach other firewall rules.</p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>FastTrack can process packets only in the main routing table so it is the system administrator duty to not FastTrack connections that are going through non-main routing table (thus connections that are processed with mangle action=mark-routing rules). Otherwise packets might be misrouted though the main routing table.</p></div></div><p>These rules appear as soon as there is at least one fast-tracked connection tracking entry and will disappear after the last fast-tracked connection times out in the connection table.</p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>The connection is FastTracked until a connection is closed, timed out or the router is rebooted.</p></div></div><h3 id="PacketFlowinRouterOS-Configurationexample:excludingspecifichost,frombeingFast-Tracked"><span class="mw-headline">Configuration example: excluding specific host, from being Fast-Tracked</span></h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/ip firewall filter
add action=accept chain=forward connection-state=established,related src-address=192.168.88.111
add action=accept chain=forward connection-state=established,related dst-address=192.168.88.111
add action=fasttrack-connection chain=forward connection-state=established,related hw-offload=no
add action=accept chain=forward connection-state=established,related</pre>
</div></div><p><span class="mw-headline">In this example, we exclude host 192.168.88.111, from being Fast-tracked, by first accepting it with the firewall rule, both for source and destination. The idea is - not allowing the traffic to reach the FastTrack action.</span></p><p><span class="mw-headline">Note: the &quot;exclusion&quot; rules, must be placed before fasttrack filters, order is important.</span></p><h3 id="PacketFlowinRouterOS-Requirements"><span class="mw-headline">Requirements</span></h3><p>IPv4 FastTrack is active if the following conditions are met:</p><ul><li>no<span> </span>mesh,<span> </span>metarouter<span> </span>interface configuration;</li><li>sniffer,<span> </span>torch,<span> </span>and<span> </span>traffic generator<span> </span>are not running;</li><li>&quot;/tool mac-scan&quot; is not actively used;</li><li>&quot;/tool ip-scan&quot; is not actively used;</li><li>FastPath and Route cache are enabled under IP/Settings (route cache condition does not apply to RouterOS v7 or newer);</li><li>bridge FastPath is enabled if a connection is going over the bridge interface;</li></ul><p><br/></p><h1 id="PacketFlowinRouterOS-Packetflowforthevisuallyimpaired">Packet flow for the visually impaired</h1><p>The following document in DOCX format describes the diagram in a way optimized for visually impaired people. The descriptions are by Apex CoVantage care of Benetech. They are not being updated.</p><ul><li><a class="external-link" href="https://box.mikrotik.com/f/673207754e4d40638fae/?dl=1" rel="nofollow">Packet flow, optimized document.</a></li></ul>
                    </div>

                                                            <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328235.svg">PacketFlowDiagram_v6_a.svg</a> (image/svg+xml)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328236.png">01c_Routing_concept.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328440.png">01d_Communication_with_router.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328441.svg">PacketFlowDiagram_v6_b.svg</a> (image/svg+xml)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328442.png">Pfd.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328443.png">02a_routing_forward.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328444.png">02a_routing_forward_chains.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328445.png">02b_routing_input.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328446.png">02b_routing_input_chains.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328447.png">02c_routing_output.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328448.png">02c_routing_output_chains.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328449.png">fasttrack.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328450.png">half-fastpath.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328451.svg">fastpath.svg</a> (image/svg+xml)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328452.png">02d_ipsec_decryption.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328453.png">02d_ipsec_encryption.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328454.png">01e_encapsulate_decapsulate.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328455.png">03_mpls_forward.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328456.png">03_mpls_input.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328457.png">03_mpls_output.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328458.png">01b_mpls_concept.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328459.png">01a_bridging_concept.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328460.png">04a_bridging_output.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328461.png">04b_bridging_input.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328462.png">04c_bridging_forward1.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328463.png">04d_bridging_forward_with_use_ip_firewall.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328464.png">04d_bridging_forward_with_use_ip_firewall_chains.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328467.png">fasttrack1_example.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/328468.png">fasttrack1_example2.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/30474243.svg">Switch_packetFlow_example1.svg</a> (image/svg+xml)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/30474244.svg">Detailed_switch_flow_redArrows.svg</a> (image/svg+xml)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/30474247.png">Switch_packetFlow_example1.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/30474246.png">Switch_packetFlow_example1.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/30474248.png">Detailed_switch_flow_redArrows.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/30474249.png">Detailed_switch_flow_redArrowsv1.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/30474250.png">Detailed_switch_flow_redArrowsv2.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/30474251.png">Detailed_switch_flow_redArrowsv3.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/306675714.png">image-2025-3-24_9-18-2.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/306675718.png">image-2025-3-24_9-19-50.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/306675719.png">image-2025-3-24_9-19-53.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/306675724.png">image-2025-3-24_9-44-22.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/306675725.png">image-2025-3-24_9-44-55.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/306675726.png">image-2025-3-24_9-45-31.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/306675727.png">image-2025-3-24_9-46-1.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328227/306675730.png">image-2025-3-24_9-59-25.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on May 20, 2025 14:53</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
