<!DOCTYPE html>
<html>
    <head>
        <title>RouterOS : Queues</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">RouterOS</a></span>
                            </li>
                                                    <li>
                                <span><a href="RouterOS_328059.html">RouterOS</a></span>
                            </li>
                                                    <li>
                                <span><a href="Firewall-and-Quality-of-Service_119144601.html">Firewall and Quality of Service</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            RouterOS : Queues
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> Normunds R.</span>, last updated by <span class='editor'> Mārtiņš S.</span> on May 09, 2025
    
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><style type='text/css'>/*<![CDATA[*/
div.rbtoc1747742027649 {padding: 0px;}
div.rbtoc1747742027649 ul {margin-left: 0px;}
div.rbtoc1747742027649 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1747742027649'>
<ul class='toc-indentation'>
<li><a href='#Queues-Overview'>Overview</a>
<ul class='toc-indentation'>
<li><a href='#Queues-Ratelimitationprinciples'>Rate limitation principles</a></li>
</ul>
</li>
<li><a href='#Queues-SimpleQueue'>Simple Queue</a>
<ul class='toc-indentation'>
<li><a href='#Queues-Configurationexample'>Configuration example</a></li>
</ul>
</li>
<li><a href='#Queues-QueueTree'>Queue Tree</a>
<ul class='toc-indentation'>
<li><a href='#Queues-Configurationexample.1'>Configuration example</a></li>
</ul>
</li>
<li><a href='#Queues-QueueTypes'>Queue Types</a>
<ul class='toc-indentation'>
<li><a href='#Queues-Kinds'>Kinds</a>
<ul class='toc-indentation'>
<li><a href='#Queues-FIFO'>FIFO</a></li>
<li><a href='#Queues-RED'>RED</a></li>
<li><a href='#Queues-SFQ'>SFQ</a></li>
<li><a href='#Queues-PCQ'>PCQ</a></li>
<li><a href='#Queues-CoDel'>CoDel</a></li>
<li><a href='#Queues-FQ-Codel'>FQ-Codel</a></li>
<li><a href='#Queues-CAKE'>CAKE</a></li>
</ul>
</li>
</ul>
</li>
<li><a href='#Queues-InterfaceQueue'>Interface Queue</a></li>
<li><a href='#Queues-QueueloadvisualizationinGUI'>Queue load visualization in GUI</a></li>
</ul>
</div></p><h1 id="Queues-Overview">Overview</h1><p>A queue is a collection of data packets collectively waiting to be transmitted by a network device using a pre-defined structure methodology. Queuing works almost on the same methodology used at banks or supermarkets, where the customer is treated according to its arrival.</p><p>Queues are used to:</p><ul><li>limit data rate for certain IP addresses, subnets, protocols, ports, etc.;</li><li>limit peer-to-peer traffic;</li><li>packet prioritization;</li><li>configure traffic bursts for traffic acceleration;</li><li>apply different time-based limits;</li><li>share available traffic among users equally, or depending on the load of the channel</li></ul><p>Queue implementation in MikroTik RouterOS is based on Hierarchical Token Bucket (HTB). HTB allows the creation of a hierarchical queue structure and determines relations between queues. These hierarchical structures can be attached at two different places, the <a href="Packet-Flow-in-RouterOS_328227.html">Packet Flow diagram</a> illustrates both <em>input</em> and <em>postrouting</em> chains.</p><p>There are two different ways how to configure queues in RouterOS:</p><ul><li><strong>/queue simple</strong> menu - designed to ease the configuration of simple, every day queuing tasks (such as single client upload/download limitation, p2p traffic limitation, etc.).</li><li><strong>/queue tree</strong> menu - for implementing advanced queuing tasks (such as global prioritization policy, and user group limitations). Requires marked packet flows from <a href="IP-Services_328229.html"> <strong>/ip firewall mangle</strong></a> facility.</li></ul><p>RouterOS provides a possibility to configure queue in 8 levels -  the first level is an interface queue from the &quot;/queue interface&quot; menu and the other 7 are lower-level queues that can be created in Queue Simple and/or Queue Tree.</p><h2 id="Queues-Ratelimitationprinciples"><span class="mw-headline">Rate limitation principles</span></h2><p><br/></p><p>Rate limiting is used to control the rate of traffic flow sent or received on a network interface. Traffic with rate that is less than or equal to the specified rate is sent, whereas traffic that exceeds the rate is dropped or delayed.</p><p>Rate limiting can be performed in two ways:</p><ol><li>discard all packets that exceed rate limit – <em><strong>rate-limiting (dropper or shaper)</strong></em> <em>(100% rate limiter when queue-size=0)</em></li><li>delay packets that exceed the specific rate limit in the queue and transmit them when it is possible – <em><strong>rate equalizing (scheduler) </strong></em>(100% rate equalizing when <em>queue-size=unlimited</em>)</li></ol><p>The next figure explains the difference between <em>rate limiting</em> and rate <em>equalizing</em>:</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/328088/58720270.png" data-image-src="attachments/328088/58720270.png" data-unresolved-comment-count="0" data-linked-resource-id="58720270" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="Image8001.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328088" data-linked-resource-container-version="26" tabindex="0" alt=""></span></p><p>As you can see in the first case all traffic exceeds a specific rate and is dropped. In another case, traffic exceeds a specific rate and is delayed in the queue and transmitted later when it is possible, but note that the packet can be delayed only until the queue is not full. If there is no more space in the queue buffer, packets are dropped.</p><p>For each queue we can define two rate limits:</p><ul class="bullets"><li><strong>CIR</strong> (Committed Information Rate) – (<strong>limit-at</strong> in RouterOS) worst-case scenario, the flow will get this amount of traffic rate regardless of other traffic flows. At any given time, the bandwidth should not fall below this committed rate.</li><li><strong>MIR</strong> (Maximum Information Rate) – (<strong>max-limit</strong> in RouterOS) best-case scenario, the maximum available data rate for flow, if there is free any part of the bandwidth.</li></ul><h1 id="Queues-SimpleQueue">Simple Queue</h1><p><br/></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/queue simple</pre>
</div></div><p>A simple queue is a plain way how to limit traffic for a particular target. Also, you can use simple queues to build advanced QoS applications. They have useful integrated features:</p><ul class="bullets"><li>peer-to-peer traffic queuing;</li><li>applying queue rules on chosen time intervals;</li><li>prioritization;</li><li>using multiple packet marks from <em>/ip firewall mangle</em></li><li>traffic shaping (scheduling) of bidirectional traffic (one limit for the total of upload + download)</li></ul><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Simple queues have a <u>strict order</u> - each packet must go through every queue until it reaches one queue which conditions fit packet parameters or until the end of the queues list is reached. For example, In the case of 1000 queues, a packet for the last queue will need to proceed through 999 queues before it will reach the destination. </p></div></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Simple queue target matches packets based on src and dst address. If src address matches target, then this is upload, if dst matches target, then this is download. However, if you have a connection where src and dst both match the target, then such packets will always be counted as download since both of them match dst (for each individual packet in both directions) which simply in RouterOS is the first thing compared to the target. Simple queue should be configured in a way that traffic can match only src or dst address, but not both of them at the same time.</p></div></div><h2 class="auto-cursor-target" id="Queues-Configurationexample"><span style="letter-spacing: -0.008em;font-size: 20.0px;">Configuration example</span></h2><p>In the following example, we have one SOHO device with two connected units PC and Server.</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/328088/3211274.jpg" data-image-src="attachments/328088/3211274.jpg" data-unresolved-comment-count="0" data-linked-resource-id="3211274" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Simple Queue.jpg" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="328088" data-linked-resource-container-version="26" tabindex="0" alt=""></span></p><p>We have a 15 Mbps connection available from ISP in this case. We want to be sure the server receives enough traffic, so we will configure a simple queue with a <em>limit-at</em> parameter to guarantee a server receives 5Mbps:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/queue simple
add limit-at=5M/5M max-limit=15M/15M name=queue1 target=192.168.88.251/32</pre>
</div></div><p>That is all. The server will get 5 Mbps of traffic rate regardless of other traffic flows. If you are using the default configuration, be sure the FastTrack rule is disabled for this particular traffic, otherwise, it will bypass Simple Queues and they will not work.</p><h1 id="Queues-QueueTree">Queue Tree</h1><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/queue tree</pre>
</div></div><p>The queue tree creates only a one-directional queue in one of the HTBs. It is also the only way how to add a queue on a separate interface. This way it is possible to ease mangle configuration - you don't need separate marks for download and upload - only the upload will get to the Public interface and only the download will get to a Private interface. The main difference from Simple Queues is that the <u>Queue tree is not ordered</u> - all traffic passes it together.</p><h2 class="auto-cursor-target" id="Queues-Configurationexample.1"><span>Configuration example</span></h2><p>In the following example, we will mark all the packets coming from preconfigured <em>in-interface-list=LAN</em> and will limit the traffic with a queue tree based on these packet marks.</p><p>Let`s create a firewall address-list:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] &gt; /ip firewall address-list
add address=www.youtube.com list=Youtube
[admin@MikroTik] &gt; ip firewall address-list print
Flags: X - disabled, D - dynamic 
 #   LIST                                                       ADDRESS                                                                        CREATION-TIME        TIMEOUT             
 0   Youtube                                                    www.youtube.com                                                                oct/17/2019 14:47:11
 1 D ;;; www.youtube.com
     Youtube                                                    216.58.211.14                                                                  oct/17/2019 14:47:11
 2 D ;;; www.youtube.com
     Youtube                                                    216.58.207.238                                                                 oct/17/2019 14:47:11
 3 D ;;; www.youtube.com
     Youtube                                                    216.58.207.206                                                                 oct/17/2019 14:47:11
 4 D ;;; www.youtube.com
     Youtube                                                    172.217.21.174                                                                 oct/17/2019 14:47:11
 5 D ;;; www.youtube.com
     Youtube                                                    216.58.211.142                                                                 oct/17/2019 14:47:11
 6 D ;;; www.youtube.com
     Youtube                                                    172.217.22.174                                                                 oct/17/2019 14:47:21
 7 D ;;; www.youtube.com
     Youtube                                                    172.217.21.142                                                                 oct/17/2019 14:52:21

</pre>
</div></div><p>Mark packets with firewall mangle facility:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] &gt; /ip firewall mangle
add action=mark-packet chain=forward dst-address-list=Youtube in-interface-list=LAN new-packet-mark=pmark-Youtube passthrough=yes</pre>
</div></div><p class="auto-cursor-target">Configure the queue tree based on previously marked packets:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] /queue tree
add max-limit=5M name=Limiting-Youtube packet-mark=pmark-Youtube parent=global</pre>
</div></div><p>Check Queue tree stats to be sure traffic is matched:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] &gt; queue tree print stats
Flags: X - disabled, I - invalid 
 0   name=&quot;Limiting-Youtube&quot; parent=global packet-mark=pmark-Youtube rate=0 packet-rate=0 queued-bytes=0 queued-packets=0 bytes=67887 packets=355 dropped=0 </pre>
</div></div><h1 id="Queues-QueueTypes">Queue Types</h1><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/queue type</pre>
</div></div><p>This sub-menu list by default created queue types and allows the addition of new user-specific ones.</p><p>By default, RouterOS creates the following pre-defined queue types:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] &gt; /queue type print
Flags: * - default 
 0 * name=&quot;default&quot; kind=pfifo pfifo-limit=50 

 1 * name=&quot;ethernet-default&quot; kind=pfifo pfifo-limit=50 

 2 * name=&quot;wireless-default&quot; kind=sfq sfq-perturb=5 sfq-allot=1514 

 3 * name=&quot;synchronous-default&quot; kind=red red-limit=60 red-min-threshold=10 red-max-threshold=50 red-burst=20 red-avg-packet=1000 

 4 * name=&quot;hotspot-default&quot; kind=sfq sfq-perturb=5 sfq-allot=1514 

 5 * name=&quot;pcq-upload-default&quot; kind=pcq pcq-rate=0 pcq-limit=50KiB pcq-classifier=src-address pcq-total-limit=2000KiB pcq-burst-rate=0 pcq-burst-threshold=0 pcq-burst-time=10s pcq-src-address-mask=32 
     pcq-dst-address-mask=32 pcq-src-address6-mask=128 pcq-dst-address6-mask=128 

 6 * name=&quot;pcq-download-default&quot; kind=pcq pcq-rate=0 pcq-limit=50KiB pcq-classifier=dst-address pcq-total-limit=2000KiB pcq-burst-rate=0 pcq-burst-threshold=0 pcq-burst-time=10s pcq-src-address-mask=32 
     pcq-dst-address-mask=32 pcq-src-address6-mask=128 pcq-dst-address6-mask=128 

 7 * name=&quot;only-hardware-queue&quot; kind=none 

 8 * name=&quot;multi-queue-ethernet-default&quot; kind=mq-pfifo mq-pfifo-limit=50 

 9 * name=&quot;default-small&quot; kind=pfifo pfifo-limit=10</pre>
</div></div><p><span style="color:var(--ds-text-accent-purple-bolder,#352C63);">All MikroTik products</span> have the default queue type &quot;<strong>only-hardware-queue&quot; </strong>with &quot;kind=none&quot;. &quot;only-hardware-queue&quot; leaves the interface with only hardware transmit descriptor ring buffer which acts as a queue in itself. Usually, at least 100 packets can be queued for transmit in the transmit descriptor ring buffer. Transmit descriptor ring buffer size and the number of packets that can be queued in it varies for different types of ethernet MACs. Having no software queue is especially beneficial on SMP systems because it removes the requirement to synchronize access to it from different CPUs/cores which is resource-intensive. Having the possibility to set <u>&quot;only-hardware-queue&quot; requires support in an ethernet driver</u> so it is available only for some ethernet interfaces mostly found on RouterBOARDs.</p><p>A<strong> &quot;multi-queue-ethernet-default&quot;</strong> can be beneficial on SMP systems with ethernet interfaces that have support for multiple transmit queues and have a Linux driver support for multiple transmit queues. By having one software queue for each hardware queue there might be less time spent on synchronizing access to them.</p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Improvement from only-hardware-queue and multi-queue-ethernet-default is present only when there is no &quot;/queue tree&quot; entry with a particular interface as a parent.</p></div></div><h2 id="Queues-Kinds">Kinds</h2><p>Queue kinds are packet processing algorithms. Kind describe which packet will be transmitted next in the line. RouterOS supports the following Queueing kinds:</p><ul><li>FIFO (BFIFO, PFIFO, MQ PFIFO)</li><li>RED</li><li>SFQ</li><li>PCQ</li></ul><h3 id="Queues-FIFO">FIFO</h3><p>These kinds are based on the FIFO algorithm (First-In-First-Out). The difference between <strong>PFIFO</strong> and <strong>BFIFO</strong> is that one is measured in packets and the other one in bytes. These queues use <strong>pfifo-limit</strong> and <strong>bfifo-limit</strong> parameters.</p><p>Every packet that cannot be enqueued (if the queue is full), is dropped. Large queue sizes can increase latency but utilize the channel better.</p><p><strong>MQ-PFIFO</strong> is <em>pfifo</em> with support for multiple transmit queues. This queue is beneficial on SMP systems with ethernet interfaces that have support for multiple transmit queues and have a Linux driver support for multiple transmit queues (mostly on x86 platforms). This kind uses the <strong>mq-pfifo-limit</strong> parameter.</p><h3 id="Queues-RED"><span class="mw-headline">RED</span></h3><p>Random Early Drop is a queuing mechanism that tries to avoid network congestion by controlling the <u>average queue size</u>. The average queue size is compared to two thresholds: a minimum (min<sub>th</sub>) and a maximum (max<sub>th</sub>) threshold. If the average queue size (avg<sub>q</sub>) is less than the minimum threshold, no packets are dropped. When the average queue size is greater than the maximum threshold, all incoming packets are dropped. But if the average queue size is between the minimum and maximum thresholds packets are randomly dropped with probability P<sub>d</sub> where probability is exact a function of the average queue size: P<sub>d</sub> = P<sub>max</sub>(avg<sub>q</sub> – min<sub>th</sub>)/ (max<sub>th</sub> - min<sub>th</sub>). If the average queue grows, the probability of dropping incoming packets grows too. P<sub>max</sub> - ratio, which can adjust the packet discarding probability abruptness, (the simplest case P<sub>max</sub> can be equal to one. The 8.2 diagram shows the packet drop probability in the RED algorithm.</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/328088/58720271.png" data-image-src="attachments/328088/58720271.png" data-unresolved-comment-count="0" data-linked-resource-id="58720271" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="Image8002.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328088" data-linked-resource-container-version="26" tabindex="0" alt=""></span></p><h3 id="Queues-SFQ"><br/>SFQ</h3><p>Stochastic Fairness Queuing (SFQ) is ensured by hashing and round-robin algorithms. SFQ is called &quot;Stochastic&quot; because it does not really allocate a queue for each flow, it has an algorithm that divides traffic over a limited number of queues (1024) using a hashing algorithm.</p><p>Traffic flow may be uniquely identified by 4 options (<em>src-address, dst-address, src-port,</em> and<em> dst-port</em>), so these parameters are used by the SFQ hashing algorithm to classify packets into one of 1024 possible sub-streams. Then round-robin algorithm will start to distribute available bandwidth to all sub-streams, on each round giving <strong>sfq-allot</strong> bytes of traffic. The whole SFQ queue can contain 128 packets and there are 1024 sub-streams available. The 8.3 diagram shows the SFQ operation:</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/328088/58720272.png" data-image-src="attachments/328088/58720272.png" data-unresolved-comment-count="0" data-linked-resource-id="58720272" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="Image8003.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328088" data-linked-resource-container-version="26" tabindex="0" alt=""></span></p><h3 id="Queues-PCQ"><span class="mw-headline">PCQ</span></h3><p>PCQ algorithm is very simple - at first, it uses selected classifiers to distinguish one sub-stream from another, then applies individual FIFO queue size and limitation on every sub-stream, then groups all sub-streams together and applies global queue size and limitation.</p><p>PCQ parameters:</p><ul><li><strong>pcq-classifier</strong> (dst-address | dst-port | src-address | src-port; default: &quot;&quot;) : selection of sub-stream identifiers</li><li><strong>pcq-rate</strong> (number): maximal available data rate of each sub-steam</li><li><strong>pcq-limit</strong> (number): queue size of single sub-stream (in KiB)</li><li><strong>pcq-total-limit</strong> (number): maximum amount of queued data in all sub-streams (in KiB)</li></ul><p> It is possible to assign a speed limitation to sub-streams with the <strong>pcq-rate</strong> option. If &quot;pcq-rate=0&quot; sub-streams will divide available traffic equally.</p><p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" draggable="false" src="attachments/328088/2031619.png" data-image-src="attachments/328088/2031619.png" data-unresolved-comment-count="0" data-linked-resource-id="2031619" data-linked-resource-version="3" data-linked-resource-type="attachment" data-linked-resource-default-alias="PCQ_Alg.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328088" data-linked-resource-container-version="26" tabindex="0" alt=""></span></p><p>For example, instead of having 100 queues with 1000kbps limitation for download, we can have one PCQ queue with 100 sub-streams</p><p>PCQ has burst implementation identical to Simple Queues and Queue Tree:</p><ul><li><strong>pcq-burst-rate</strong> (number): maximal upload/download data rate which can be reached while the burst for substream is allowed</li><li><strong>pcq-burst-threshold</strong> (number): this is the value of burst on/off switch</li><li><strong>pcq-burst-time</strong> (time): a period of time (in seconds) over which the average data rate is calculated. (This is NOT the time of the actual burst)</li></ul><p>PCQ also allows using different size IPv4 and IPv6 networks as sub-stream identifiers. Before it was locked to a single IP address. This is done mainly for IPv6 as customers from an ISP point of view will be represented by /64 network, but devices in customers network will be /128. PCQ can be used for both of these scenarios and more. PCQ parameters:</p><ul><li><strong>pcq-dst-address-mask</strong> (number): the size of the IPv4 network that will be used as a dst-address sub-stream identifier</li><li><strong>pcq-src-address-mask</strong> (number): the size of the IPv4 network that will be used as an src-address sub-stream identifier</li><li><strong>pcq-dst-address6-mask</strong> (number): the size of the IPV6 network that will be used as a dst-address sub-stream identifier</li><li><strong>pcq-src-address6-mask</strong> (number): the size of the IPV6 network that will be used as an src-address sub-stream identifier</li></ul><p><br/></p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>The following queue kinds CoDel, FQ-Codel, and CAKE available since RouterOS version 7.1beta3.</p></div></div><h3 id="Queues-CoDel">CoDel</h3><p>CoDel (Controlled-Delay Active Queue Management) algorithm uses the local minimum queue as a measure of the persistent queue, similarly, it uses a minimum delay parameter as a measure of the standing queue delay. Queue size is calculated using packet residence time in the queue.</p><p><strong>Properties</strong></p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 100.0%;"><colgroup><col style="width: 46.5018%;"/><col style="width: 53.4982%;"/></colgroup><tbody><tr><th style="text-align: center;" class="confluenceTh"><strong>Property</strong></th><th style="text-align: center;" class="confluenceTh"><strong>Description</strong></th></tr><tr><td class="confluenceTd"><strong>codel-ce-threshold </strong>(<em>default</em>: )</td><td class="confluenceTd"><p>Marks packets above a configured threshold with ECN.</p></td></tr><tr><td class="confluenceTd"><strong>codel-ecn</strong> (<em>default</em>: <strong>no</strong>)</td><td class="confluenceTd"><p>An option is used to mark packets instead of dropping them.</p></td></tr><tr><td class="confluenceTd"><strong>codel-interval </strong>(<em>default</em>: <strong>100ms</strong>)</td><td class="confluenceTd"><p>Interval should be set on the order of the worst-case RTT through the bottleneck giving endpoints sufficient time to react.</p></td></tr><tr><td class="confluenceTd"><strong>codel-limit</strong> (<em>default</em>: <strong>1000</strong>)</td><td class="confluenceTd">Queue limit, when the limit is reached, incoming packets are dropped.</td></tr><tr><td class="confluenceTd"><strong>codel-target</strong> (<em>default</em>: <strong>5ms</strong>)</td><td class="confluenceTd"><p>Represents an acceptable minimum persistent queue delay.</p></td></tr></tbody></table></div><h3 id="Queues-FQ-Codel">FQ-Codel</h3><p>CoDel - Fair Queuing (FQ) with Controlled Delay (CoDel) uses a <span>randomly determined</span> model to classify incoming packets into different flows and is used to provide a fair share of the bandwidth to all the flows using the queue. Each flow is managed using CoDel queuing discipline which internally uses a FIFO algorithm.</p><p><strong>Properties</strong></p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 100.0%;"><colgroup><col style="width: 46.5691%;"/><col style="width: 53.4309%;"/></colgroup><tbody><tr><th style="text-align: center;" class="confluenceTh"><strong>Property</strong></th><th style="text-align: center;" class="confluenceTh"><strong>Description</strong></th></tr><tr><td class="confluenceTd"><strong>fq-codel-ce-threshold </strong>(<em>default</em>: )</td><td class="confluenceTd">Marks packets above a configured threshold with ECN.</td></tr><tr><td class="confluenceTd"><strong>fq-codel-ecn</strong> (<em>default</em>: <strong>yes</strong>)</td><td class="confluenceTd">An option is used to mark packets instead of dropping them.</td></tr><tr><td class="confluenceTd"><strong>fq-codel-flows</strong> (default: <strong>1024</strong>)</td><td class="confluenceTd"><p>A number of flows into which the incoming packets are classified.</p></td></tr><tr><td class="confluenceTd"><strong>fq-codel-interval </strong>(<em>default</em>: <strong>100ms</strong>)</td><td class="confluenceTd">Interval should be set on the order of the worst-case RTT through the bottleneck giving endpoints sufficient time to react.</td></tr><tr><td class="confluenceTd"><strong>fq-codel-limit</strong> (<em>default</em>: <strong>10240</strong>)</td><td class="confluenceTd">Queue limit, when the limit is reached, incoming packets are dropped.</td></tr><tr><td class="confluenceTd"><strong>fq-codel-memlimit</strong> (default: <strong>32.0MiB</strong>)</td><td class="confluenceTd"><p>A total number of bytes that can be queued in this FQ-CoDel instance. Will be enforced from the <em>fq-codel-limit</em> parameter.</p></td></tr><tr><td class="confluenceTd"><strong>fq-codel-quantum</strong> (<em>default</em>: <strong>1514</strong>)</td><td class="confluenceTd"><p>A number of bytes used as 'deficit' in the fair queuing algorithm. Default (1514 bytes) corresponds to the Ethernet MTU plus the hardware header length of 14 bytes.</p></td></tr><tr><td class="confluenceTd"><strong>fq-codel-target</strong> (<em>default</em>: <strong>5ms</strong>)</td><td class="confluenceTd">Represents an acceptable minimum persistent queue delay.</td></tr></tbody></table></div><h3 id="Queues-CAKE">CAKE</h3><p>CAKE - Common Applications Kept Enhanced (CAKE) <span style="color:var(--ds-text,#333333);">implemented as a<span> </span></span><em>queue discipline</em><span style="color:var(--ds-text,#333333);"><span> </span>(qdisc) for the Linux kernel uses </span>COBALT (AQM algorithm combining Codel and BLUE) and a variant of DRR++ for flow isolation. In other words, <span style="color:var(--ds-text,#333333);">Cake’s fundamental design goal is<span> user-friendliness. </span></span>All settings are optional; the default settings are chosen to be practical in most common deployments. In most cases, the configuration requires only a bandwidth parameter to get useful results,</p><p><strong>Properties</strong></p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 100.0%;"><colgroup><col style="width: 46.7063%;"/><col style="width: 53.2937%;"/></colgroup><tbody><tr><th style="text-align: center;" class="confluenceTh"><strong>Property</strong></th><th style="text-align: center;" class="confluenceTh"><strong>Description</strong></th></tr><tr><td class="confluenceTd"><strong>cake-ack-filter</strong> <em>(default:</em> <strong>none</strong> )</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd"><strong>cake-atm</strong> <em>(default:</em> )</td><td class="confluenceTd"><p>Compensates for ATM cell framing, which is normally found on ADSL links.</p></td></tr><tr><td class="confluenceTd"><strong>cake-autorate-ingress</strong> <em>(yes/no, default:</em> )</td><td class="confluenceTd"><p>Automatic capacity estimation based on traffic arriving at this qdisc. This is most likely to be useful with cellular links, which tend to change quality randomly.  The Bandwidth Limit parameter can be used in conjunction to specify an initial estimate. The shaper will periodically be set to a bandwidth slightly below the estimated rate.  This estimator cannot estimate the bandwidth of links downstream of itself.</p></td></tr><tr><td class="confluenceTd"><strong>cake-bandwidth</strong> <em>(default:</em> )</td><td class="confluenceTd">Sets the shaper bandwidth.</td></tr><tr><td class="confluenceTd"><strong>cake-diffserv</strong> <em>(default:</em> <strong>diffserv3</strong>)</td><td class="confluenceTd"><p>CAKE can divide traffic into &quot;tins&quot; based on the Diffserv field:</p><ul><li><p style="margin-left: 8.0px;"><strong>diffserv4</strong> Provides a general-purpose Diffserv implementation with four tins: Bulk (CS1), 6.25% threshold, generally low priority. Best Effort (general), 100% threshold. Video (AF4x, AF3x, CS3, AF2x, CS2, TOS4, TOS1), 50% threshold. Voice (CS7, CS6, EF, VA, CS5, CS4), 25% threshold.</p></li><li><p style="margin-left: 8.0px;"><strong>diffserv3 </strong>(default) Provides a simple, general-purpose Diffserv implementation with three tins: Bulk (CS1), 6.25% threshold, generally low priority. Best Effort (general), 100% threshold. Voice (CS7, CS6, EF, VA, TOS4), 25% threshold, reduced Codel interval.</p></li></ul></td></tr><tr><td class="confluenceTd"><strong>cake-flowmode</strong> <em>(dsthost/dual-dsthost/dual-srchost/flowblind/flows/hosts/srchost/triple-isolate, default:</em> <strong>triple-isolate</strong>)</td><td class="confluenceTd"><ul><li><strong>flowblind</strong> - Disables flow isolation; all traffic passes through a single queue for each tin.</li><li><strong>srchost</strong> - Flows are defined only by source address. </li><li><strong>dsthost</strong> Flows are defined only by destination address. </li><li><strong>hosts</strong> - Flows are defined by source-destination host pairs. This is host isolation, rather than flow isolation.</li><li><strong>flows</strong> - Flows are defined by the entire 5-tuple of source address, a destination address, transport protocol, source port, and destination port. This is the type of flow isolation performed by SFQ and fq_codel.</li><li><strong>dual-srchost</strong> Flows are defined by the 5-tuple, and fairness is applied first over source addresses, then over individual flows. Good for use on egress traffic from a LAN to the internet, where it'll prevent any LAN host from monopolizing the uplink, regardless of the number of flows they use.</li><li><strong>dual-dsthost</strong> Flows are defined by the 5-tuple, and fairness is applied first over destination addresses, then over individual flows. Good for use on ingress traffic to a LAN from the internet, where it'll prevent any LAN host from monopolizing the downlink, regardless of the number of flows they use.</li><li><strong>triple-isolate </strong>- Flows are defined by the 5-tuple, and fairness is applied over source *and* destination addresses intelligently (ie. not merely by host-pairs), and also over individual flows.</li><li><strong>nat</strong> Instructs Cake to perform a NAT lookup before applying flow- isolation rules, to determine the true addresses and port numbers of the packet, to improve fairness between hosts &quot;inside&quot; the NAT. This has no practical effect in &quot;flowblind&quot; or &quot;flows&quot; modes, or if NAT is performed on a different host.</li><li><strong>nonat </strong>(default) The cake will not perform a NAT lookup. Flow isolation will be performed using the addresses and port numbers directly visible to the interface Cake is attached to.</li></ul></td></tr><tr><td class="confluenceTd"><strong>cake-memlimit</strong> <em>(default:</em> )</td><td class="confluenceTd"><p style="margin-left: 8.0px;">Limit the memory consumed by Cake to LIMIT bytes. By default, the limit is calculated based on the bandwidth and RTT settings.</p></td></tr><tr><td class="confluenceTd"><strong>cake-mpu</strong> <em>( -64 ... 256, default:</em> )</td><td class="confluenceTd"><p style="margin-left: 8.0px;">Rounds each packet (including overhead) up to a minimum length BYTES. </p></td></tr><tr><td class="confluenceTd"><strong>cake-nat</strong> <em>(default:</em> <strong>no)</strong></td><td class="confluenceTd"><p style="margin-left: 8.0px;">Instructs Cake to perform a NAT lookup before applying a flow-isolation rule.</p></td></tr><tr><td class="confluenceTd"><strong>cake-overhead</strong> <em>( -64 ... 256, default:</em> )</td><td class="confluenceTd"><p style="margin-left: 8.0px;">Adds BYTES to the size of each packet. BYTES may be negative.</p></td></tr><tr><td class="confluenceTd"><strong>cake-overhead-scheme</strong> <em>(default:</em> )</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd"><strong>cake-rtt</strong> <em>(default: </em><strong>100ms</strong> )</td><td class="confluenceTd"><p style="margin-left: 8.0px;">Manually specify an RTT. Default 100ms is suitable for most Internet traffic.</p></td></tr><tr><td class="confluenceTd"><strong>cake-rtt-scheme</strong> <em>(datacentre/internet/interplanetary/lan/metro/none/oceanic/regional/satellite, default:</em> )</td><td class="confluenceTd"><ul><li><strong>datacentre</strong> - For extremely high-performance 10GigE+ networks only. Equivalent to <strong>RTT 100us.</strong></li><li><strong>lan</strong> - For pure Ethernet (not Wi-Fi) networks, at home or in the office. Don't use this when shaping for an Internet access link. Equivalent to <strong>RTT 1ms.</strong></li><li><strong>metro</strong> - For traffic mostly within a single city. Equivalent to <strong>RTT</strong> <strong>10ms.</strong> <strong>regional</strong> For traffic mostly within a European-sized country. Equivalent to <strong>RTT 30ms.</strong></li><li><strong>internet </strong>(default) This is suitable for most Internet traffic. Equivalent to <strong>RTT 100ms.</strong></li><li><strong>oceanic</strong> - For Internet traffic with generally above-average latency, such as that suffered by Australasian residents. Equivalent to <strong>RTT 300ms.</strong></li><li><strong>satellite</strong> - For traffic via geostationary satellites. Equivalent to <strong>RTT</strong> <strong>1000ms.</strong></li><li><strong>interplanetary</strong> - So named because Jupiter is about 1 light-hour from Earth. Use this to (almost) completely disable AQM actions. Equivalent to <strong>RTT 3600s.</strong></li></ul></td></tr><tr><td class="confluenceTd"><strong>cake-wash</strong> <em>(default:</em> <strong>no</strong> )</td><td class="confluenceTd"><p style="margin-left: 8.0px;">Apply the wash option to clear all extra DiffServ (but not ECN bits), after priority queuing has taken place.</p></td></tr></tbody></table></div><h1 id="Queues-InterfaceQueue">Interface Queue</h1><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/queue interface</pre>
</div></div><p>Before sending data over an interface, it is processed by the queue. This sub-menu lists all available interfaces in RouterOS and allows to change queue type for a particular interface. The list is generated automatically.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">[admin@MikroTik] &gt; queue interface print
Columns: INTERFACE, QUEUE, ACTIVE-QUEUE
# INTERFACE QUEUE ACTIVE-QUEUE
0 ether1 only-hardware-queue only-hardware-queue
1 ether2 only-hardware-queue only-hardware-queue
2 ether3 only-hardware-queue only-hardware-queue
3 ether4 only-hardware-queue only-hardware-queue
4 ether5 only-hardware-queue only-hardware-queue
5 ether6 only-hardware-queue only-hardware-queue
6 ether7 only-hardware-queue only-hardware-queue
7 ether8 only-hardware-queue only-hardware-queue
8 ether9 only-hardware-queue only-hardware-queue
9 ether10 only-hardware-queue only-hardware-queue
10 sfp-sfpplus1 only-hardware-queue only-hardware-queue
11 wlan1 wireless-default wireless-default
12 wlan2 wireless-default wireless-default </pre>
</div></div><h1 id="Queues-QueueloadvisualizationinGUI">Queue load visualization in GUI</h1><p>In Winbox and Webfig, a green, yellow, or red icon visualizes each Simple and Tree queue usage based on max-limit.</p><div class="table-wrap"><table class="wrapped fixed-width confluenceTable" style="width: 643.0px;"><colgroup><col style="width: 51.0px;"/><col style="width: 591.0px;"/></colgroup><tbody><tr><td class="confluenceTd"><div class="content-wrapper"><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-thumbnail" draggable="false" height="22" src="attachments/328088/178585611.png" data-image-src="attachments/328088/178585611.png" data-unresolved-comment-count="0" data-linked-resource-id="178585611" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-2023-3-15_16-18-24.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328088" data-linked-resource-container-version="26" tabindex="0" alt=""></span></p></div></td><td class="confluenceTd">0% - 50% of max-limit used</td></tr><tr><td class="confluenceTd"><div class="content-wrapper"><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-thumbnail" draggable="false" height="23" src="attachments/328088/178585612.png" data-image-src="attachments/328088/178585612.png" data-unresolved-comment-count="0" data-linked-resource-id="178585612" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-2023-3-15_16-19-28.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328088" data-linked-resource-container-version="26" tabindex="0" alt=""></span></p></div></td><td class="confluenceTd">50%  - 75% of max-limit used </td></tr><tr><td class="confluenceTd"><div class="content-wrapper"><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-thumbnail" draggable="false" height="23" src="attachments/328088/178585613.png" data-image-src="attachments/328088/178585613.png" data-unresolved-comment-count="0" data-linked-resource-id="178585613" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-2023-3-15_16-20-52.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="328088" data-linked-resource-container-version="26" tabindex="0" alt=""></span></p></div></td><td class="confluenceTd">75% - 100% of max-limit used</td></tr></tbody></table></div><p><br/></p><p><br/></p>
                    </div>

                                                            <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328088/1409121.gif">Image8001.gif</a> (image/gif)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328088/2031617.gif">Image8002.gif</a> (image/gif)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328088/2031618.gif">Image8003.gif</a> (image/gif)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328088/58720273.png">PCQ_Alg.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328088/3211274.jpg">Simple Queue.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328088/58720279.png">Image8001.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328088/58720280.png">Image8002.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328088/58720281.png">Image8003.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328088/58720282.png">PCQ_Alg.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328088/58720270.png">Image8001.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328088/58720271.png">Image8002.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328088/58720272.png">Image8003.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328088/2031619.png">PCQ_Alg.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328088/178585611.png">image-2023-3-15_16-18-24.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328088/178585612.png">image-2023-3-15_16-19-28.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/328088/178585613.png">image-2023-3-15_16-20-52.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on May 20, 2025 14:53</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
