<!DOCTYPE html>
<html>
    <head>
        <title>RouterOS : Cloud Hosted Router, CHR</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">RouterOS</a></span>
                            </li>
                                                    <li>
                                <span><a href="RouterOS_328059.html">RouterOS</a></span>
                            </li>
                                                    <li>
                                <span><a href="Getting-started_328119.html">Getting started</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            RouterOS : Cloud Hosted Router, CHR
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> Normunds R.</span>, last updated by <span class='editor'> Serhii T.</span> on Apr 01, 2025
    
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><style type='text/css'>/*<![CDATA[*/
div.rbtoc1747742019837 {padding: 0px;}
div.rbtoc1747742019837 ul {margin-left: 0px;}
div.rbtoc1747742019837 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1747742019837'>
<ul class='toc-indentation'>
<li><a href='#CloudHostedRouter,CHR-SystemRequirements'>System Requirements</a>
<ul class='toc-indentation'>
<li><a href='#CloudHostedRouter,CHR-CHRhasbeentestedonthefollowingplatforms:'>CHR has been tested on the following platforms:</a></li>
<li><a href='#CloudHostedRouter,CHR-UsableNetworkandDiskinterfacesonvarioushypervisors:'>Usable Network and Disk interfaces on various hypervisors:</a></li>
<li><a href='#CloudHostedRouter,CHR-HowtoInstallavirtualRouterOSsystemwithCHRimages'>How to Install a virtual RouterOS system with CHR images</a></li>
</ul>
</li>
<li><a href='#CloudHostedRouter,CHR-CHRLicensing'>CHR Licensing</a>
<ul class='toc-indentation'>
<li><a href='#CloudHostedRouter,CHR-Paidlicenses'>Paid licenses</a></li>
<li><a href='#CloudHostedRouter,CHR-Freelicenses'>Free licenses</a></li>
<li><a href='#CloudHostedRouter,CHR-PrepaidKey'>Prepaid Key</a></li>
<li><a href='#CloudHostedRouter,CHR-HowtoPurchaseaPrepaidKeytoLicenseaCHR'>How to Purchase a Prepaid Key to License a CHR</a></li>
<li><a href='#CloudHostedRouter,CHR-GettingandUpgradingtheLicense'>Getting and Upgrading the License</a></li>
<li><a href='#CloudHostedRouter,CHR-InitialUpgradefromFreetoP1LicenseLevelorHigher'>Initial Upgrade from Free to P1 License Level or Higher</a>
<ul class='toc-indentation'>
<li><a href='#CloudHostedRouter,CHR-UpgradelicenselevelusingWinBox'>Upgrade license level using WinBox</a></li>
<li><a href='#CloudHostedRouter,CHR-Upgradelicenselevelusingthecommand-lineinterface'>Upgrade license level using the command-line interface</a></li>
</ul>
</li>
<li><a href='#CloudHostedRouter,CHR-Payment'>Payment</a></li>
<li><a href='#CloudHostedRouter,CHR-LicenseUpdate'>License Update</a></li>
<li><a href='#CloudHostedRouter,CHR-UpgradingtheLevelofPerpetualLicense'>Upgrading the Level of Perpetual License</a></li>
<li><a href='#CloudHostedRouter,CHR-LicenseTransfer'>License Transfer</a></li>
</ul>
</li>
<li><a href='#CloudHostedRouter,CHR-VirtualNetworkAdapters'>Virtual Network Adapters</a></li>
<li><a href='#CloudHostedRouter,CHR-Troubleshooting'>Troubleshooting</a>
<ul class='toc-indentation'>
<li><a href='#CloudHostedRouter,CHR-RunningonVMwareESXi'>Running on VMware ESXi</a>
<ul class='toc-indentation'>
<li><a href='#CloudHostedRouter,CHR-ChangingMTU'>Changing MTU</a></li>
<li><a href='#CloudHostedRouter,CHR-UsingbridgeonLinux'>Using bridge on Linux</a></li>
<li><a href='#CloudHostedRouter,CHR-Packetsnotpassingfromguests'>Packets not passing from guests</a></li>
<li><a href='#CloudHostedRouter,CHR-UsingVLANsonCHRinvariousHypervisors'>Using VLANs on CHR in various Hypervisors</a>
<ul class='toc-indentation'>
<li><a href='#CloudHostedRouter,CHR-ESXI'>ESXI</a></li>
<li><a href='#CloudHostedRouter,CHR-Hyper-V'>Hyper-V</a></li>
<li><a href='#CloudHostedRouter,CHR-bhyvehypervisor'>bhyve hypervisor</a></li>
<li><a href='#CloudHostedRouter,CHR-Linode'>Linode</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href='#CloudHostedRouter,CHR-Guesttools'>Guest tools</a>
<ul class='toc-indentation'>
<li><a href='#CloudHostedRouter,CHR-VMWare'>VMWare</a>
<ul class='toc-indentation'>
<li><a href='#CloudHostedRouter,CHR-Timesynchronization'>Time synchronization</a></li>
<li><a href='#CloudHostedRouter,CHR-Poweroperations'>Power operations</a></li>
<li><a href='#CloudHostedRouter,CHR-Quiescing/backup'>Quiescing/backup</a></li>
<li><a href='#CloudHostedRouter,CHR-Guestinfo'>Guest info</a></li>
<li><a href='#CloudHostedRouter,CHR-Provisioning'>Provisioning</a>
<ul class='toc-indentation'>
<li><a href='#CloudHostedRouter,CHR-Pythonexample'>Python example</a></li>
</ul>
</li>
</ul>
</li>
<li><a href='#CloudHostedRouter,CHR-KVM'>KVM</a></li>
</ul>
</li>
</ul>
</div></p><p>Cloud Hosted Router (CHR) is a RouterOS version intended for running as a virtual machine. It supports the x86 64-bit architecture and can be used on most of the popular hypervisors such as VMWare, Hyper-V, VirtualBox, KVM, and others. CHR has full RouterOS features enabled by default but has a different licensing model than other RouterOS versions.</p><h1 style="text-decoration: none;" id="CloudHostedRouter,CHR-SystemRequirements"><span class="mw-headline">System Requirements</span></h1><ul style="text-decoration: none;"><li>Package version: RouterOS v6.34 or newer</li><li>Host CPU: 64-bit with virtualization support</li><li>RAM: 256MB or more</li><li>Disk: 128MB or more</li><li data-uuid="bc3ebf33-bcec-4754-9abb-1d252e1adc2e">RouterOS version 6: The maximum supported CHR virtual hard drive size is 16GB</li><li data-uuid="162705ff-9c73-42a6-bac0-567dddaef859">RouterOS version 7: The maximum amount of RAM and disk space is limited by the Linux kernel 5.6.3 and depends on the specific hardware.</li></ul><p>The minimum required RAM depends on interface count and CPU count. You can get an approximate number by using the following formula:</p><ul><li><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">RouterOS v6 - RAM = 128 + [ 8 × (CPU_COUNT) × (INTERFACE_COUNT - 1) ]</span></li><li><span style="color:var(--ds-text-accent-purple-bolder,#352c63);">RouterOS v7 - RAM = 256 + [ 8 × (CPU_COUNT) × (INTERFACE_COUNT - 1) ]</span></li></ul><p><span style="color:var(--ds-text-accent-purple-bolder,#352c63);"><strong>Note:</strong> We recommend allocating at least 1024MiB of RAM for CHR instances.</span></p><h2 style="text-decoration: none;" id="CloudHostedRouter,CHR-CHRhasbeentestedonthefollowingplatforms:"><span class="mw-headline">CHR has been tested on the following platforms:</span></h2><ul style="text-decoration: none;"><li>VirtualBox 6 on Linux and OS X</li><li>VMWare Fusion 7 and 8 on OS X</li><li>VMWare ESXi 6.5 and higher</li><li>Qemu 2.4.0.1 on Linux and OS X</li><li>Hyper-V on Windows Server 2008r2, 2012 and Windows 10 <em>(Only Generation 1 Hyper-V virtual machine is supported at the moment)</em></li><li>Xen Server 7.1</li></ul><p><strong>Warning:</strong> Hypervisors that provide paravirtualization are not supported.</p><h2 style="text-decoration: none;" id="CloudHostedRouter,CHR-UsableNetworkandDiskinterfacesonvarioushypervisors:"><span class="mw-headline">Usable Network and Disk interfaces on various hypervisors:</span></h2><ul style="text-decoration: none;"><li>ESX:<ul><li>Network: vmxnet3, E1000</li><li>Disk: IDE, VMware paravirtual SCSI, LSI Logic SAS, LSI Logic Parallel</li></ul></li></ul><ul style="text-decoration: none;"><li>Hyper-V:<ul><li>Network: Network adapter, Legacy Network adapter</li><li>Disk: IDE, SCSI</li></ul></li></ul><ul style="text-decoration: none;"><li>Qemu/KVM:<ul><li>Network: Virtio, E1000, vmxnet3 (optional)</li><li>Disk: IDE, Sata, Virtio</li></ul></li></ul><ul style="text-decoration: none;"><li>VirtualBox<ul><li>Network: E1000, rtl8193</li><li>Disk: IDE, Sata, SCSI, SAS</li></ul></li></ul><p><strong>Note:</strong> SCSI controller Hyper-V and ESX are usable just for secondary disks, system image must be used with IDE controller!</p><p><strong>Warning:</strong> We do not recommend using the E1000 network interface if better synthetic interface options are available on a specific Hypervisor!</p><h2 style="text-decoration: none;" id="CloudHostedRouter,CHR-HowtoInstallavirtualRouterOSsystemwithCHRimages"><span class="mw-headline">How to Install a virtual RouterOS system with CHR images<br/></span></h2><p>We provide 4 different virtual disk images to choose from. Note that they are only disk images, and you can't simply run them.</p><ul style="text-decoration: none;"><li>RAW disk image (.img file)</li><li>VMWare disk image (.vmdk file)</li><li>Hyper-V disk image (.vhdx file)</li><li>VirtualBox disk image (.vdi file)</li></ul><p style="text-decoration: none;"><strong><span class="mw-headline">Steps to install CHR</span></strong></p><ol style="text-decoration: none;"><li><a class="external-link" href="https://www.mikrotik.com/download" rel="nofollow">Download</a> the virtual disk image for your hypervisor</li><li>Create a guest virtual machine</li><li>Use the previously downloaded image file as a virtual disk drive</li><li>Start the guest CHR virtual machine</li><li>Log in to your new CHR. The default user is 'admin', without a password</li></ol><p>Please note that running CHR systems can be cloned and copied, but the copy will be aware of the previous trial period, so you cannot extend your trial time by making a copy of your CHR. However, you are allowed to license both systems individually. To make a new trial system, you need to make a fresh installation and reconfigure RouterOS.</p><p style="text-decoration: none;"><strong><span class="mw-headline">Installing CHR guides<br/></span></strong></p><ul style="text-decoration: none;"><li><a class="external-link" href="https://wiki.mikrotik.com/Manual:CHR_VMWare_installation" rel="nofollow">VMWare</a> Fusion/Workstation, ESXi 6.5 and higher</li><li><a href="https://help.mikrotik.com/docs/display/ROS/CHR%3A+installing+on+VirtualBox" rel="nofollow">VirtualBox</a></li><li><a class="external-link" href="https://wiki.mikrotik.com/Manual:CHR_Hyper-V_installation" rel="nofollow">Hyper-V</a></li><li><a class="external-link" href="https://wiki.mikrotik.com/Manual:CHR_AWS_installation" rel="nofollow">Amazon Web Services (AWS)</a></li><li><a href="https://help.mikrotik.com/docs/display/ROS/CHR%3A+Hetzner+Cloud+Installation" rel="nofollow">Hetzner Cloud Installation</a></li><li><a class="external-link" href="https://wiki.mikrotik.com/Manual:CHR_Linode" rel="nofollow">Linode</a></li><li><a class="external-link" href="https://wiki.mikrotik.com/Manual:CHR_GCE" rel="nofollow">Google Compute Engine</a></li><li><a href="https://help.mikrotik.com/docs/display/ROS/CHR+ProxMox+installation" rel="nofollow">ProxMox</a></li><li><a href="https://help.mikrotik.com/docs/display/ROS/CHR+Vultr+installation" rel="nofollow">Vultr</a></li></ul><h1 style="text-decoration: none;" id="CloudHostedRouter,CHR-CHRLicensing"><span class="mw-headline">CHR Licensing</span></h1><p>The CHR (<span style="color:var(--ds-text,#172b4d);">Cloud Hosted Router</span>) has 4 license levels:</p><ul style="text-decoration: none;"><li><em><strong>free</strong></em></li><li><em><strong>p1</strong></em> <em>perpetual-1</em> ($45)</li><li><em><strong>p10</strong></em> <em>perpetual-10</em> ($95)</li><li><em><strong>p-unlimited</strong></em> <em>perpetual-unlimited</em> ($250)</li></ul><p>The 60-day free trial license is available for all paid license levels. To get the free trial license, you have to have an account on <a class="external-link" href="https://mikrotik.com/" rel="nofollow" style="text-decoration: none;">MikroTik.com</a> as all license management is done there.</p><p>Perpetual is a lifetime license (buy once, use forever). It is possible to transfer a perpetual license to another CHR instance. A running CHR instance will indicate the time when it has to access the account server to renew its license. If the CHR instance will not be able to renew the license it will behave as if the trial period has run out and will not allow an upgrade of RouterOS to a newer version.</p><p>After licensing a running trial system, you <strong>must</strong> manually run the <em>/system license renew</em> function from the CHR to make it active. Otherwise, the system will not know you have licensed it in your account. If you do not do this before the system deadline time, the trial will end and you will have to do a complete fresh CHR installation, request a new trial, and then license it with the license you had obtained.</p><div class="table-wrap"><table class="wrapped confluenceTable" style="text-decoration: none;margin-left: 13.7031px;"><colgroup><col/><col/><col/></colgroup><tbody><tr><th class="confluenceTh">License</th><th class="confluenceTh">Speed limit</th><th class="confluenceTh">Price</th></tr><tr><td class="confluenceTd">Free</td><td class="confluenceTd">1Mbit</td><td class="confluenceTd">FREE</td></tr><tr><td class="confluenceTd">P1</td><td class="confluenceTd">1Gbit</td><td class="confluenceTd">$45</td></tr><tr><td class="confluenceTd">P10</td><td class="confluenceTd">10Gbit</td><td class="confluenceTd">$95</td></tr><tr><td class="confluenceTd">P-Unlimited</td><td class="confluenceTd">Unlimited</td><td class="confluenceTd">$250</td></tr></tbody></table></div><h2 style="text-decoration: none;" id="CloudHostedRouter,CHR-Paidlicenses"><span class="mw-headline">Paid licenses</span></h2><p><strong><span class="mw-headline">p1</span></strong></p><p><em>p1</em> (perpetual-1) license level allows CHR to run indefinitely. It is limited to 1Gbps upload per interface. All the rest of the features provided by CHR are available without restrictions. It is possible to upgrade from P1 to P10 or P-Unlimited. Once the upgrade is purchased at the full price, the former license will become available for later use on your account.</p><p style="text-decoration: none;"><strong><span class="mw-headline">p10</span></strong></p><p><em>p10</em> (perpetual-10) license level allows CHR to run indefinitely. It is limited to 10Gbps upload per interface. All the rest of the features provided by CHR are available without restrictions. It is possible to upgrade from P10 to P-Unlimited. Once the upgrade is purchased at the full price, the former license will become available for later use on your account.</p><p style="text-decoration: none;"><strong><span class="mw-headline">p-unlimited</span></strong></p><p>The <em>p-unlimited</em> (perpetual-unlimited) license level allows CHR to run indefinitely. It is the highest-tier license and it has no enforced limitations.</p><h2 style="text-decoration: none;" id="CloudHostedRouter,CHR-Freelicenses"><span class="mw-headline">Free licenses</span></h2><p>There are several options to use and try CHR free of charge.</p><p style="text-decoration: none;"><strong><span class="mw-headline">free</span></strong></p><p>The <em>free</em> license level allows CHR to run indefinitely. It is limited to 1Mbps upload per interface. All the rest of the features provided by CHR are available without restrictions. To use this, all you have to do is download the disk image file from our download page and create a virtual guest.</p><p style="text-decoration: none;"><strong><span class="mw-headline">60-day trial</span></strong></p><p>In addition to the limited Free installation, you can also test the increased speed of P1/P10/PU licenses with a 60 trial.</p><p>You will have to have an account registered on <a class="external-link" href="https://mikrotik.com/" rel="nofollow">MikroTik.com</a>. Then you can request the desired license level for trial from your router that will assign your router ID to your account and enable the purchase of the license from your account. All the paid license equivalents are available for trial. A trial period is 60 days from the day of acquisition after this time passes, your license menu will start to show &quot;Limited upgrades&quot;, which means that RouterOS can no longer be upgraded.</p><p>If you plan to purchase the selected license, you should do it within 60 days of the trial end date. If your trial ends, and there are no purchases within 2 months after it ended, the device will no longer appear in your MikroTik account. You will have to make a new CHR installation to make a purchase within the required time frame.</p><p>To request a trial license, you must run the command &quot;<strong>/system license renew</strong>&quot; from the CHR device command line. You will be asked for the username and password of your <a class="external-link" href="https://mikrotik.com" rel="nofollow">mikrotik.com</a> account.</p><div role="region" aria-label="Info" class="confluence-information-macro  confluence-information-macro-information" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-info-filled confluence-information-macro-icon" ></span><div class="confluence-information-macro-body">If you plan to use multiple virtual systems of the same kind, it may be possible that the next machine has the same system ID as the original one. This can happen on certain cloud providers, such as Linode. To avoid this, after your first boot, run the command &quot;/system license generate-new-id&quot; <strong>before</strong> you request a trial license. Note that this feature must be used only while CHR is running on a free type of RouterOS license. If you have already obtained a paid or trial license, do not use the regenerate feature since you will not be able to update your current key anymore</div></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body">IP/Cloud requires a paid perpetual license for Cloud Hosted Router (CHR). </div></div><p style="text-align: left;">An expired CHR license means the CHR instance failed to renew its license before the &quot;deadline-at&quot; date by contacting the MikroTik server or that the 60-day trial period has ended. While the router continues operating at the same tier, software updates are disabled.</p><p style="text-align: left;">It is only possible to license an expired CHR instance using a Prepaid key.</p><h2 style="text-align: left;" id="CloudHostedRouter,CHR-PrepaidKey">Prepaid Key</h2><p style="text-align: left;">A Prepaid Key is a type of license key you can purchase in advance for MikroTik products, such as the CHR, or convert into a license key to apply to an x86 system's Software ID. It allows you to buy a license without immediately assigning it to a specific device. Once you have a Prepaid Key, you can use it to upgrade a CHR or later convert it into a license key by providing the device's Software ID.</p><h2 style="text-align: left;" id="CloudHostedRouter,CHR-HowtoPurchaseaPrepaidKeytoLicenseaCHR">How to Purchase a Prepaid Key to License a CHR</h2><ol style="text-align: left;"><li data-uuid="0e4f2c91-d16e-4b6d-ae09-30807ff371dc"><p>Go to<span> </span><a class="external-link" href="https://mikrotik.com/" rel="nofollow">mikrotik.com</a><span> </span>and log in to your account.</p></li><li data-uuid="d52d9459-b201-4a8a-b164-602976a1062d"><p><span>Access the &quot;Purchase a RouterOS License Key&quot; Section.</span></p></li><li data-uuid="975f1f7d-89fe-4f25-bfa6-99115ad4d4f7">Choose the desired license Key Level;</li><li data-uuid="34fb34a4-41c7-4f8c-a0d7-3ff3da0f60eb">Select Key Type.</li><li data-uuid="6c3a1129-cb4d-46aa-9770-09c866bdad05">Select the key type: &quot;Prepaid key&quot;;</li><li data-uuid="5996800b-971c-4513-a5d5-9775b44328c9"><p>Input the quantity of prepaid keys you wish to purchase;</p></li><li data-uuid="be3e150c-df29-4983-87a3-47f9f542f6be">Select Optional Key Features:<ul><li>Choose any additional features you might need for your key.</li></ul></li><li data-uuid="06c3067e-6a36-4d48-a20c-4915d8a3f4d2">Press the &quot;Place key in the cart&quot; button.</li><li data-uuid="10a01162-e6a5-44e6-9c5c-586a9a2b7efe">Click &quot;Proceed to checkout&quot; to complete your purchase.</li></ol><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" draggable="false" width="800" src="attachments/18350234/282132657.png" data-image-src="attachments/18350234/282132657.png" data-unresolved-comment-count="0" data-linked-resource-id="282132657" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="purchase-prepaid_01.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="18350234" data-linked-resource-container-version="79" tabindex="0" alt=""></span></p><p><strong>Review and Complete Your Purchase</strong></p><ul><li data-uuid="8079960d-701e-46cb-9c7b-794aa1f4768d">Review your order details.</li><li data-uuid="f4f6e128-0c36-4dcd-8b12-0886b0e9e624">Proceed with payment using <strong>Credit Card </strong>(CC) or <strong>PayPal</strong>.</li></ul><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" draggable="false" width="800" src="attachments/18350234/282132659.png" data-image-src="attachments/18350234/282132659.png" data-unresolved-comment-count="0" data-linked-resource-id="282132659" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="purchase-prepaid_02.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="18350234" data-linked-resource-container-version="79" tabindex="0" alt=""></span></p><p>Congratulations! You have successfully purchased a Prepaid Key.</p><h2 id="CloudHostedRouter,CHR-GettingandUpgradingtheLicense">Getting and Upgrading the License</h2><p>After the initial setup, a CHR instance will be assigned a free trial license. You can upgrade this license to a higher tier through your MikroTik account. All license management, including upgrades, is handled on the <a class="external-link" href="https://mikrotik.com/client" rel="nofollow">account server</a>.</p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Note that you can upgrade to any tier except for <em>p-unlimited</em>, which is already the highest tier.</p></div></div><h2 style="text-decoration: none;" id="CloudHostedRouter,CHR-InitialUpgradefromFreetoP1LicenseLevelorHigher">Initial Upgrade from Free to P1 License Level or Higher</h2><p>Initial upgrade from the <em>free</em> tier to anything higher than that incurs CHR instance registration on the <a class="external-link" href="https://mikrotik.com/client" rel="nofollow" style="text-decoration: none;">account server</a>.</p><p>To do that you have to enter your <a class="external-link" href="https://www.mikrotik.com/client/" rel="nofollow" style="text-decoration: none;">MikroTik.com</a> username and password and the desired license level you want to acquire.</p><p>To upgrade from the <em>free </em>tier to a higher license level, you need to register the CHR instance on the <a class="external-link" href="https://mikrotik.com/client" rel="nofollow" style="text-decoration: none;">account server</a>. Enter your <a class="external-link" href="https://mikrotik.com/client" rel="nofollow">MikroTik</a> username and password, then select the desired license level to complete the upgrade.</p><p>As a result, a CHR System ID will be assigned to your account on the account server, and a 60-day trial will be created for that System ID. There are two ways to obtain a license: using <a href="#CloudHostedRouter,CHR-UpgradelicenselevelusingWinBox">WinBox</a> or the RouterOS <a href="#CloudHostedRouter,CHR-Upgradelicenselevelusingthecommand-lineinterface">command-line interface</a>.</p><h3 id="CloudHostedRouter,CHR-UpgradelicenselevelusingWinBox">Upgrade license level using WinBox</h3><p><strong>(System -&gt; License menu):</strong></p><p><strong><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" draggable="false" height="160" src="attachments/18350234/261685401.png" data-image-src="attachments/18350234/261685401.png" data-unresolved-comment-count="0" data-linked-resource-id="261685401" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-2024-7-26_16-14-48.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="18350234" data-linked-resource-container-version="79" tabindex="0" alt=""></span></strong></p><p><strong><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" draggable="false" height="140" src="attachments/18350234/261685404.png" data-image-src="attachments/18350234/261685404.png" data-unresolved-comment-count="0" data-linked-resource-id="261685404" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-2024-7-26_16-19-54.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="18350234" data-linked-resource-container-version="79" tabindex="0" alt=""></span></strong></p><p><strong><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" draggable="false" height="160" src="attachments/18350234/261685403.png" data-image-src="attachments/18350234/261685403.png" data-unresolved-comment-count="0" data-linked-resource-id="261685403" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-2024-7-26_16-18-58.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="18350234" data-linked-resource-container-version="79" tabindex="0" alt=""></span></strong></p><h3 id="CloudHostedRouter,CHR-Upgradelicenselevelusingthecommand-lineinterface">Upgrade license level using the command-line interface</h3><pre style="margin-left: 20.0px;">[admin@MikroTik] &gt; /system license print 
  system-id: 6lR1ZP/utuJ
      level: free

[admin@MikroTik] &gt; /system/license/renew
account: mymikrotikcomaccount
password: *********************
level: p1<br/>  status: done
<br/>[admin@MikroTik] &gt; /system/license/print <br/>         system-id: 6lR1ZP/utuJ<br/>             level: p1<br/>  limited-upgrades: no<br/>   next-renewal-at: 2024-08-25 13:18:06<br/>       deadline-at: 2024-09-24 13:18:06
</pre><h2 id="CloudHostedRouter,CHR-Payment">Payment</h2><p>To acquire a higher-level trial, set up a new CHR instance, renew the license, and select the desired level.</p><p>To upgrade from a Trial license to a Paid one, go to the <a class="external-link" href="https://www.mikrotik.com/client" rel="nofollow">MikroTik account server</a> and choose &quot;All CHR keys&quot; in the &quot;CHR LICENCES&quot; section.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" draggable="false" width="900" src="attachments/18350234/263749681.png" data-image-src="attachments/18350234/263749681.png" data-unresolved-comment-count="0" data-linked-resource-id="263749681" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="payment01.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="18350234" data-linked-resource-container-version="79" tabindex="0" alt=""></span></p><p>The list of your CHR instances and their corresponding licenses will be displayed.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" draggable="false" width="800" src="attachments/18350234/263749691.png" data-image-src="attachments/18350234/263749691.png" data-unresolved-comment-count="0" data-linked-resource-id="263749691" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="license_upgrade04.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="18350234" data-linked-resource-container-version="79" tabindex="0" alt=""></span></p><p>To upgrade from a Trial to a Paid license, click &quot;Upgrade,&quot; select the desired license level (which can differ from the trial license level), and click &quot;Upgrade&quot; button.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" draggable="false" width="800" src="attachments/18350234/175439934.png" data-image-src="attachments/18350234/175439934.png" data-unresolved-comment-count="0" data-linked-resource-id="175439934" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="02.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="18350234" data-linked-resource-container-version="79" tabindex="0" alt=""></span></p><p>If there are <strong>Prepaid keys</strong> available, it is possible to use it for CHR - press &quot;<strong>Pay using Prepaid key</strong>&quot;. If there are no Prepaid keys or you do not want to use them, press &quot;Proceed to checkout&quot;.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" draggable="false" width="900" src="attachments/18350234/175439935.png" data-image-src="attachments/18350234/175439935.png" data-unresolved-comment-count="0" data-linked-resource-id="175439935" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="03.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="18350234" data-linked-resource-container-version="79" tabindex="0" alt=""></span></p><p>Choose the payment method: It is possible to pay using a credit card (CC) or PayPal.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" draggable="false" width="900" src="attachments/18350234/175439936.png" data-image-src="attachments/18350234/175439936.png" data-unresolved-comment-count="0" data-linked-resource-id="175439936" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="04.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="18350234" data-linked-resource-container-version="79" tabindex="0" alt=""></span></p><h2 style="text-decoration: none;" id="CloudHostedRouter,CHR-LicenseUpdate"><span class="mw-headline">License Update</span></h2><p><strong><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" draggable="false" height="160" src="attachments/18350234/261685403.png" data-image-src="attachments/18350234/261685403.png" data-unresolved-comment-count="0" data-linked-resource-id="261685403" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-2024-7-26_16-18-58.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="18350234" data-linked-resource-container-version="79" tabindex="0" alt=""></span></strong></p><p>In the System-License menu, the router will indicate &quot;<strong>next-renewal-at</strong>&quot; - the time when it will reattempt to contact the server located on <a class="external-link" href="https://licence.mikrotik.com" rel="nofollow">licence.mikrotik.com</a>.</p><p>Communication attempts will be performed once an hour after the date on &quot;<strong>next-renewal-at</strong>&quot; and will not cease until the server responds with an error.</p><p>If the &quot;<strong>deadline-at</strong>&quot; date is reached without successfully contacting the account server, the router will consider that the license has expired and will disallow further software updates. However, the router will continue to work with the same license tier as before.</p><p>After successful communication with the license server, the dates will be updated.</p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>If you want to upgrade a perpetual license to a higher level, please transfer the previous perpetual license to another CHR first. This will prevent the previous perpetual license from being lost during the upgrade process.</p></div></div><h2 style="text-decoration: none;" id="CloudHostedRouter,CHR-UpgradingtheLevelofPerpetualLicense">Upgrading the Level of Perpetual License</h2><p>It is possible to upgrade the Level of Perpetual License from P1 to P10 or P-Unlimited. Once the upgrade is purchased at the full price, the former license will become available for later use on your account.</p><p>It is also possible to upgrade the Level of Perpetual License from P10 to P-Unlimited. Once the upgrade is purchased at the full price, the former license will become available for later use on your account.</p><p>The P-Unlimited (perpetual-unlimited) license level allows CHR to run indefinitely. It is the highest-tier license and it has no enforced limitations.</p><p>To upgrade the license level, follow these steps:</p><ul><li>Go to the &quot;All CHR keys&quot; section on your <a class="external-link" href="http://mikrotik.com" rel="nofollow">mikrotik.com</a> account.</li><li>Choose the CHR instance you want to upgrade and press &quot;Upgrade&quot;.</li></ul><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" draggable="false" width="800" src="attachments/18350234/263749686.png" data-image-src="attachments/18350234/263749686.png" data-unresolved-comment-count="0" data-linked-resource-id="263749686" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="license_upgrade01.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="18350234" data-linked-resource-container-version="79" tabindex="0" alt=""></span></p><ul><li>Select the desired license level to upgrade to (P10 or P-Unlimited) and press &quot;Upgrade&quot;.</li></ul><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" draggable="false" width="800" src="attachments/18350234/263749688.png" data-image-src="attachments/18350234/263749688.png" data-unresolved-comment-count="0" data-linked-resource-id="263749688" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="license_upgrade03.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="18350234" data-linked-resource-container-version="79" tabindex="0" alt=""></span></p><ul><li><p><strong>Payment Options</strong>:</p><ul><li>If you have prepaid keys available, you can use them for the upgrade by pressing &quot;Pay using Prepaid key&quot;.</li><li>If you do not have prepaid keys or prefer not to use them, press &quot;Proceed to checkout&quot;.</li></ul></li><li><p><strong>Choose Payment Method</strong>:</p><ul><li>Choose your preferred payment method. You can pay using a credit card (CC) or PayPal.</li></ul></li></ul><p>After completing these steps, your CHR license will be upgraded to the selected level, and the previous license will be available for later use on your account.</p><h2 style="text-decoration: none;" id="CloudHostedRouter,CHR-LicenseTransfer"><span class="mw-headline">License Transfer</span></h2><p>CHR installations are tied directly to the account on our website. It is possible to transfer a perpetual license to another CHR instance registered under the same account. </p><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Licenses cannot be transferred to another account. The license transfer process requires that both the old and new CHR instances are registered under the same MikroTik account. If you need to use the CHR on a different account, a new license must be purchased for that account.</p></div></div><div role="region" aria-label="Warning" class="confluence-information-macro  confluence-information-macro-warning" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p><span style="color:var(--ds-text,#172b4d);">It is not possible to transfer the Perpetual license to an expired instance. You will be notified: &quot;</span><span style="color:var(--ds-text,#172b4d);"><em style="text-align: left;">This key is not eligible for transfer as there is no other valid CHR key that could be upgraded to the license level of this key.&quot;</em></span></p><p><span style="color:var(--ds-text,#172b4d);">You need to create a new CHR instance, then add it to your account. Once added, you will be able to transfer the existing license to the new CHR instance.</span></p></div></div><p>First, register the new machine under the same <a class="external-link" href="https://mikrotik.com/client/" rel="nofollow">MikroTik account</a> where the old CHR is registered using the <a href="#CloudHostedRouter,CHR-Upgradelicenselevelusingthecommand-lineinterface">CLI command</a> &quot;/system license renew&quot;.</p><p>Once both the old and new CHR machines are visible in the &quot;All CHR keys&quot; section of your account, use the &quot;Transfer&quot; button to transfer the license.</p><ul><li><span class="mw-headline">Press the &quot;Transfer&quot; button for the System ID you need to transfer.<br/></span></li></ul><p><span class="mw-headline"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" draggable="false" height="77" src="attachments/18350234/242909236.png" data-image-src="attachments/18350234/242909236.png" data-unresolved-comment-count="0" data-linked-resource-id="242909236" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="transfer_lic01.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="18350234" data-linked-resource-container-version="79" tabindex="0" alt=""></span></span></p><ul><li>Select the System ID you are transferring to from the list.</li></ul><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" draggable="false" height="250" src="attachments/18350234/261685378.png" data-image-src="attachments/18350234/261685378.png" data-unresolved-comment-count="0" data-linked-resource-id="261685378" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="chr_transfer02.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="18350234" data-linked-resource-container-version="79" tabindex="0" alt=""></span></p><ul><li>Press &quot;Transfer subscription&quot;.</li></ul><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" draggable="false" height="250" src="attachments/18350234/261685379.png" data-image-src="attachments/18350234/261685379.png" data-unresolved-comment-count="0" data-linked-resource-id="261685379" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="chr_transfer03.png" data-base-url="https://help.mikrotik.com/docs" data-linked-resource-content-type="image/png" data-linked-resource-container-id="18350234" data-linked-resource-container-version="79" tabindex="0" alt=""></span></p><h1 style="text-decoration: none;" id="CloudHostedRouter,CHR-VirtualNetworkAdapters"><span class="mw-headline">Virtual Network Adapters</span></h1><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Fast Path is supported in RouterOS v7 for &quot;vmxnet3&quot; and &quot;virtio-net&quot; adapters.</p></div></div><p style="text-decoration: none;"><span class="mw-headline">RouterOS v6 does not support Fast Path.<br/></span></p><h1 style="text-decoration: none;" id="CloudHostedRouter,CHR-Troubleshooting"><span class="mw-headline">Troubleshooting</span></h1><h2 style="text-decoration: none;" id="CloudHostedRouter,CHR-RunningonVMwareESXi"><span class="mw-headline">Running on VMware ESXi</span></h2><h3 style="text-decoration: none;" id="CloudHostedRouter,CHR-ChangingMTU"><span class="mw-headline">Changing MTU</span></h3><p>VMware ESXi supports MTU of up to 9000 bytes. To get the benefit of that, you have to adjust your ESXi installation to allow a higher MTU. Virtual Ethernet interface added <strong>after</strong> the MTU change will be properly allowed by the ESXi server to pass jumbo frames. Interfaces added prior to MTU change on the ESXi server will be barred by the ESXi server (it will still report the old MTU as the maximum possible size). If you have this, you have to re-add interfaces to the virtual guests.</p><p><strong>Example.</strong> There are 2 interfaces added to the ESXi guest, auto-detected MTU on the interfaces show MTU size as it was at the time when the interface was added:</p><pre style="margin-left: 20.0px;">[admin@chr-vm] &gt; interface ethernet print 
Flags: X - disabled, R - running, S - slave 
 #    NAME           MTU MAC-ADDRESS       ARP       
 0 R  ether1        9000 00:0C:29:35:37:5C enabled   
 1 R  ether2        1500 00:0C:29:35:37:66 enabled
</pre><h3 style="text-decoration: none;" id="CloudHostedRouter,CHR-UsingbridgeonLinux"><span class="mw-headline">Using bridge on Linux</span></h3><p>If Linux bridge supports IGMP snooping, and there are problems with IPv6 traffic it is required to disable that feature as it interacts with MLD packets (multicast) and is not passing them through.</p><pre style="margin-left: 20.0px;">echo -n 0 &gt; /sys/class/net/vmbr0/bridge/multicast_snooping
</pre><h3 style="text-decoration: none;" id="CloudHostedRouter,CHR-Packetsnotpassingfromguests"><span class="mw-headline">Packets not passing from guests</span></h3><p>The problem: after configuring a software interface (VLAN, EoIP, bridge, etc.) on the guest CHR it stops passing data to the outside world beyond the router.</p><p>The solution: check your VMS (Virtualization Management System) security settings, if other MAC addresses are allowed to pass and if packets with VLAN tags are allowed to pass through. Adjust the security settings according to your needs like allowing MAC spoofing or a certain MAC address range. For VLAN interfaces, it is usually possible to define allowed VLAN tags or VLAN tag range.</p><h3 style="text-decoration: none;" id="CloudHostedRouter,CHR-UsingVLANsonCHRinvariousHypervisors"><span class="mw-headline">Using VLANs on CHR in various Hypervisors</span></h3><p>In some hypervisors, before VLAN can be used on VMs, they need to first be configured on the hypervisor itself.</p><h4 style="text-decoration: none;" id="CloudHostedRouter,CHR-ESXI"><span class="mw-headline">ESXI</span></h4><p>Enable Promiscuous mode in a port group or virtual switch that you will use for a specific VM.</p><p><em><strong>ESX documentation:</strong></em></p><ul style="text-decoration: none;"><li><a class="external-link" href="https://kb.vmware.com/kb/1004099" rel="nofollow" style="text-decoration: none;">https://kb.vmware.com/kb/1004099</a></li></ul><h4 style="text-decoration: none;" id="CloudHostedRouter,CHR-Hyper-V"><span class="mw-headline">Hyper-V</span></h4><p><em><strong>Hyper-V documentation:</strong></em></p><ul style="text-decoration: none;"><li><a class="external-link" href="https://technet.microsoft.com/en-us/library/cc816585(v=ws.10).aspx#Anchor_2" rel="nofollow" style="text-decoration: none;">https://technet.microsoft.com/en-us/library/cc816585(v=ws.10).aspx#Anchor_2</a></li></ul><h4 style="text-decoration: none;" id="CloudHostedRouter,CHR-bhyvehypervisor"><span class="mw-headline">bhyve hypervisor</span></h4><p>It won't be possible to run CHR on this hypervisor. CHR cannot be run as a para-virtualized platform.</p><h4 style="text-decoration: none;" id="CloudHostedRouter,CHR-Linode"><span class="mw-headline">Linode</span></h4><p>When creating multiple Linodes with the same disk size, new Linodes will have the same systemID. This will cause issues to get a Trial/Paid license. To avoid this, run the command <code>/system license generate-new-id</code> after the first boot and before you request a trial or paid license. This will make sure the ID is unique.</p><p><br/></p><p><em><strong>Some useful articles:</strong></em></p><p>Specific VLAN is untagged by NIC interface:</p><ul style="text-decoration: none;"><li><a class="external-link" href="https://blogs.msdn.microsoft.com/adamfazio/2008/11/14/understanding-hyper-v-vlans/" rel="nofollow" style="text-decoration: none;">https://blogs.msdn.microsoft.com/adamfazio/2008/11/14/understanding-hyper-v-vlans/</a></li><li><a class="external-link" href="https://www.aidanfinn.com/?p=10164" rel="nofollow" style="text-decoration: none;">https://www.aidanfinn.com/?p=10164</a></li></ul><p>Allow passing other VLANs:</p><ul style="text-decoration: none;"><li><a class="external-link" href="https://social.technet.microsoft.com/Forums/windows/en-US/79d36d5b-c794-4502-8ed4-b7a4183b1891/vlan-tags-and-hyperv-switches?forum=winserverhyperv" rel="nofollow" style="text-decoration: none;">https://social.technet.microsoft.com/Forums/windows/en-US/79d36d5b-c794-4502-8ed4-b7a4183b1891/vlan-tags-and-hyperv-switches?forum=winserverhyperv</a></li></ul><h1 style="text-decoration: none;" id="CloudHostedRouter,CHR-Guesttools"><span class="mw-headline">Guest tools</span></h1><h2 style="text-decoration: none;" id="CloudHostedRouter,CHR-VMWare"><span class="mw-headline">VMWare</span></h2><h3 style="text-decoration: none;" id="CloudHostedRouter,CHR-Timesynchronization"><span class="mw-headline">Time synchronization</span></h3><p>Must be enabled from GUI ('Synchronize guest time with host'). Backward synchronization is disabled by default - if the guest is ahead of the host by more than ~5 seconds, synchronization is not performed</p><h3 style="text-decoration: none;" id="CloudHostedRouter,CHR-Poweroperations"><span class="mw-headline">Power operations</span></h3><ul style="text-decoration: none;"><li><em>poweron</em> and <em>resume</em> scripts are executed (if present and enabled) after power on and resume operations respectively.</li><li><em>poweroff</em> and <em>suspend</em> scripts are executed before power off and suspend operations respectively.</li><li>If scripts take longer than 30 seconds or contain errors, the operation fails</li><li>In case of failure, retrying the same operation will ignore any errors and complete it successfully</li><li>Failed script output is saved to a file (e. g. 'poweroff-script.log', 'resume-script.log' etc)</li><li>Scripts can be enabled/disabled from hypervisor GUI ('run VMware Tools Scripts') or by enabling/disabling scripts from the console</li></ul><h3 style="text-decoration: none;" id="CloudHostedRouter,CHR-Quiescing/backup"><span class="mw-headline">Quiescing/backup</span></h3><p>Guest filesystem quiescing is performed only if requested.</p><ul style="text-decoration: none;"><li><em>freeze</em> script is executed before freezing the filesystem</li><li><em>freeze-fail</em> script is executed if the hypervisor failed to prepare for a snapshot or if <em>freeze</em> script failed</li><li><em>thaw</em> script is executed after the snapshot has been taken</li><li>Script run time is limited to 60 seconds</li><li><em>freeze</em> script timeouts and errors result in the backup operation being aborted</li><li>FAT32 disks are not quiesced</li><li>Failed script output is saved to a file (e. g. 'freeze-script.log', 'freeze-fail-script.log', 'thaw-script.log')</li></ul><h3 style="text-decoration: none;" id="CloudHostedRouter,CHR-Guestinfo"><span class="mw-headline">Guest info</span></h3><p>Networking, disk, and OS info are reported to the hypervisor every 30 seconds (GuestStats (memory) are disabled by default, and can be enabled by setting 'guestinfo.disable-perfmon = &quot;FALSE&quot;' in VM config).</p><ul style="text-decoration: none;"><li>The order, in which network interfaces are reported, can be controlled by setting 'guestinfo.exclude-nics', 'guestinfo.primary-nics' and 'guestinfo.low-priority-nics' options. Standard <a class="external-link" href="https://www.tldp.org/LDP/GNU-Linux-Tools-Summary/html/x11655.htm" rel="nofollow" style="text-decoration: none;">wildcard</a> patterns can be used.</li></ul><h3 style="text-decoration: none;" id="CloudHostedRouter,CHR-Provisioning"><span class="mw-headline">Provisioning</span></h3><p> You can use the <a class="external-link" href="https://www.vmware.com/support/developer/converter-sdk/conv55_apireference/vim.vm.guest.ProcessManager.html" rel="nofollow" style="text-decoration: none;">ProcessManager</a> from Vim API to execute scripts. Python bindings are <a class="external-link" href="https://github.com/vmware/pyvmomi" rel="nofollow" style="text-decoration: none;">available</a></p><ul style="text-decoration: none;"><li>Main data structure: <a class="external-link" href="https://www.vmware.com/support/developer/converter-sdk/conv55_apireference/vim.vm.guest.ProcessManager.ProgramSpec.html" rel="nofollow" style="text-decoration: none;">GuestProgramSpec</a><ul><li>The <em>workingDirectory</em> and <em>envVariables</em> members are ignored</li><li><em>programPath</em> must be set to either 'inline' or 'import'</li><li>If <em>programPath</em> is '<strong>inline'</strong>, <em>arguments</em> are interpreted as script text</li><li>If <em>programPath</em> is '<strong>import'</strong>, <em>arguments</em> are interpreted as file path</li></ul></li></ul><p>After using <em>GuestProgramSpec</em> together with an instance of <a class="external-link" href="https://www.vmware.com/support/developer/converter-sdk/conv55_apireference/vim.vm.guest.GuestAuthentication.html" rel="nofollow" style="text-decoration: none;">GuestAuthentication</a> as arguments to <a class="external-link" href="https://www.vmware.com/support/developer/converter-sdk/conv55_apireference/vim.vm.guest.ProcessManager.html#startProgram" rel="nofollow" style="text-decoration: none;">StartProgramInGuest</a> unique <em>JobID</em> is obtained.</p><p>Script progress can be tracked by using the <a class="external-link" href="https://www.vmware.com/support/developer/converter-sdk/conv55_apireference/vim.vm.guest.ProcessManager.html#listProcesses" rel="nofollow" style="text-decoration: none;">ListProcessesInGuest</a> command. <em>ListProcessesInGuest</em> accepts an array of job id's; passing an empty array will report on all jobs started from the API</p><ul style="text-decoration: none;"><li><em>ListProcessesInGuest</em> returns an array of <a class="external-link" href="https://www.vmware.com/support/developer/converter-sdk/conv55_apireference/vim.vm.guest.ProcessManager.ProcessInfo.html" rel="nofollow" style="text-decoration: none;">GuestProcessInfo</a> instances:<ul><li><em>pid</em> field is set to <em>JobID</em></li><li><em>endTime</em> is only set after completion</li><li><em>exitCode</em> is set to 0 on success and -1 on error</li><li><em>name</em> is set to 'inline' or 'import' (same as <em>programPath</em> in <em>GuestProgramSpec</em>)</li></ul></li></ul><p>Information about completed jobs is kept around for ~1 minute, or until <em>ListProcessesInGuest</em> (with the corresponding <em>JobID</em>) is called. If the script fails, a file named 'vix_job_$JobID$ .txt' containing the script output is created. Script run time is limited to 120 seconds and script output is not saved on timeout,</p><ul style="text-decoration: none;"><li>The <a class="external-link" href="https://www.vmware.com/pdf/vix160_vmrun_command.pdf" rel="nofollow" style="text-decoration: none;">vmrun</a> command <em>runScriptInGuest</em> can also be used</li><li>The <a class="external-link" href="https://code.vmware.com/doc/preview?id=5975#/doc/Overview.html" rel="nofollow" style="text-decoration: none;">PowerCLI</a> cmdlet <a class="external-link" href="https://code.vmware.com/doc/preview?id=5975#/doc/Invoke-VMScript.html" rel="nofollow" style="text-decoration: none;">Invoke-VMScript</a> is not supported</li><li>Host/guest file transfer is not supported</li></ul><h5 style="text-decoration: none;" id="CloudHostedRouter,CHR-Pythonexample"><span class="mw-headline">Python example</span></h5><pre style="margin-left: 20.0px;">#!/usr/bin/env python
# -*- coding: utf-8 -*-

import sys,time
from pyVim import connect
from pyVmomi import vmodl,vim


def runInline(content,vm,creds,source):
    ''' Execute script source on vm '''
    if isinstance(source, list):
        source = '\n'.join(source)
    ps = vim.vm.guest.ProcessManager.ProgramSpec(
                programPath = 'console',
                arguments = source
        )
    return content.guestOperationsManager.processManager.StartProgramInGuest(vm,creds,ps)

def runFromFile(content,vm,creds,fileName):
    ''' Execute script file located on CHR '''
    ps = vim.vm.guest.ProcessManager.ProgramSpec(
                programPath = 'import',
                arguments = fileName
    )
    return content.guestOperationsManager.processManager.StartProgramInGuest(vm,creds,ps)


def findDatastore(content,name):
    sessionManager = content.sessionManager

    dcenterObjView = content.viewManager.CreateContainerView(content.rootFolder, [vim.Datacenter], True)

    datacenter = None
    datastore = None
    for dc in dcenterObjView.view:
        dstoreObjView = content.viewManager.CreateContainerView(dc, [vim.Datastore], True)
        for ds in dstoreObjView:
            if ds.info.name == name:
                datacenter = dc
                datastore = ds
                break
        dstoreObjView.Destroy()

    dcenterObjView.Destroy()

    return datacenter,datastore

def _FAILURE(s,*a):
    print(s.format(*a))
    sys.exit(-1)

#------------------------------------------------------------------------------#

if __name__ == '__main__':
    host = sys.argv[1] # ip or something
    user = 'root'
    pwd = 'MikroTik'
    vmName = 'chr-test'
    dataStoreName = 'datastore1'



    service = connect.SmartConnectNoSSL(host=host,user=user,pwd=pwd)
    if not service:
        _FAILURE(&quot;Could not connect to the specified host using specified username and password&quot;)

    content = service.RetrieveContent()


    #---------------------------------------------------------------------------
    # Find datacenter and datastore


    datacenter,datastore = findDatastore(content,dataStoreName)

    if not datacenter or not datastore:
        connect.Disconnect(service)
        _FAILURE('Could not find datastore \'{}\'',dataStorename)


    #---------------------------------------------------------------------------
    # Locate vm


    vmxPath = '[{0}] {1}/{1}.vmx'.format(dataStoreName, vmName)
    vm = content.searchIndex.FindByDatastorePath(datacenter, vmxPath)

    if not vm:
        connect.Disconnect(service)
        _FAILURE(&quot;Could not locate vm&quot;)


    #---------------------------------------------------------------------------
    # Setup credentials from user name and pasword

    creds = vim.vm.guest.NamePasswordAuthentication(username = 'admin', password = '')


    #---------------------------------------------------------------------------
    # Run script

    pm = content.guestOperationsManager.processManager

    try:
        # Run script
        src = [':ip address add address=192.168.0.1/24 interface=ether1;']
        jobID = runInline(content, vm, creds, src)

        # Or run file (from FTP root)
        # jobID = runFromFile(content,vm,creds, 'scripts/provision.rsc')


        #---------------------------------------------------------------------------
        # Wait for job to finish

        pm = content.guestOperationsManager.processManager
        jobInfo = pm.ListProcessesInGuest(vm, creds, [jobID])[0]
        while jobInfo.endTime is None:
            time.sleep(1.0)
            jobInfo = pm.ListProcessesInGuest(vm, creds, [jobID])[0]

        if jobInfo.exitCode != 0:
            _FAILURE('Script failed!')
    except:
        raise
    else:
        connect.Disconnect(service)

</pre><h2 style="text-decoration: none;" id="CloudHostedRouter,CHR-KVM"><span class="mw-headline">KVM</span></h2><p>QEMU guest agent is available. Supported agent commands can be retrieved by using the guest-info command. Host-guest file transfer can be performed by using guest-file-* commands. Guest networking information can be retrieved by using the guest-network-get-interfaces command.</p><ul style="text-decoration: none;"><li>Scripts can be executed by using the guest-exec command together with the GuestExec data structure:<ul><li>If the <em>path</em> member is provided, the corresponding file is executed</li><li>If the <em>path</em> member is not set and <em>input-data</em> member is provided, <em>input-data</em> value is used as script input</li><li>If <em>capture-output</em> is set, script output is reported back</li><li><em>args</em> and <em>env</em> members are not used</li></ul></li></ul><ul style="text-decoration: none;"><li>Script job progress can be monitored with guest-exec-status command. The GuestExecStatus data structure is populated as follows:<ul><li>On success, <em>exitcode</em> member is set to 0</li><li>If the script timed out <em>exitcode</em> is set to 1</li><li>If the script contained errors <em>exitcode</em> is set to -1</li><li><em>signal</em> member is not set</li><li>The <em>err-data</em> member is not used</li><li>If <em>capture-output</em> was true, Base64 encoded script output is stored in <em>out-data</em></li></ul></li><li>An additional agent channel ('chr.provision_channel') is also available</li></ul>
                    </div>

                                                            <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/34897970.png">CHR_Licence_01.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/34897971.png">CHR_Licence_02-2.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/34897972.png">CHR_keys_04.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/34897973.png">1800px-CHR_keys_03.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/34897974.png">CHR_keys_02a.PNG</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/34897975.png">CHR_keys_01.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/34897976.png">CHR_Licence_02.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/34897977.png">CHR_Licence_01-2.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/175439926.png">image-2023-3-1_14-4-16.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/175439927.png">image-2023-3-1_14-8-0.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/175439931.png">image-2023-3-1_14-20-24.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/175439932.png">image-2023-3-1_14-22-5.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/175439933.png">01.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/175439934.png">02.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/175439935.png">03.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/175439936.png">04.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/242909237.png">transfer_lic01.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/242909236.png">transfer_lic01.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/261685381.png">chr_transfer02.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/261685383.png">chr_transfer03.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/261685378.png">chr_transfer02.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/261685379.png">chr_transfer03.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/261685399.png">image-2024-7-26_16-13-49.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/261685401.png">image-2024-7-26_16-14-48.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/261685402.png">image-2024-7-26_16-16-26.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/261685403.png">image-2024-7-26_16-18-58.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/261685404.png">image-2024-7-26_16-19-54.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/263749682.png">payment01.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/263749681.png">payment01.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/263749686.png">license_upgrade01.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/263749687.png">license_upgrade02.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/263749688.png">license_upgrade03.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/263749691.png">license_upgrade04.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/282132657.png">purchase-prepaid_01.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/18350234/282132659.png">purchase-prepaid_02.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on May 20, 2025 14:53</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
