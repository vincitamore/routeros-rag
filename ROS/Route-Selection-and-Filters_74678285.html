<!DOCTYPE html>
<html>
    <head>
        <title>RouterOS : Route Selection and Filters</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">RouterOS</a></span>
                            </li>
                                                    <li>
                                <span><a href="RouterOS_328059.html">RouterOS</a></span>
                            </li>
                                                    <li>
                                <span><a href="Routing_328222.html">Routing</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            RouterOS : Route Selection and Filters
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> Māris B.</span>, last updated on May 20, 2025
    
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><span class="mw-headline"><style type='text/css'>/*<![CDATA[*/
div.rbtoc1747742032107 {padding: 0px;}
div.rbtoc1747742032107 ul {margin-left: 0px;}
div.rbtoc1747742032107 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1747742032107'>
<ul class='toc-indentation'>
<li><a href='#RouteSelectionandFilters-RouteFiltering'>Route Filtering</a>
<ul class='toc-indentation'>
<li><a href='#RouteSelectionandFilters-FilterSyntax'>Filter Syntax</a>
<ul class='toc-indentation'>
<li><a href='#RouteSelectionandFilters-OnlyReadableProperties'>Only Readable Properties</a></li>
<li><a href='#RouteSelectionandFilters-WriteableProperties'>Writeable Properties</a></li>
<li><a href='#RouteSelectionandFilters-Commands'>Commands</a></li>
<li><a href='#RouteSelectionandFilters-Operators'>Operators</a>
<ul class='toc-indentation'>
<li><a href='#RouteSelectionandFilters-MatcherOperators'>Matcher Operators</a></li>
<li><a href='#RouteSelectionandFilters-NumPropOperators'>Num Prop Operators</a></li>
<li><a href='#RouteSelectionandFilters-PrefixOperators'>Prefix Operators</a></li>
<li><a href='#RouteSelectionandFilters-BGPCommunityOperators'>BGP Community Operators</a></li>
<li><a href='#RouteSelectionandFilters-StringOperators'>String Operators</a></li>
</ul>
</li>
</ul>
</li>
<li><a href='#RouteSelectionandFilters-DeletingBGPCommunities'>Deleting BGP Communities</a></li>
<li><a href='#RouteSelectionandFilters-AS-PATHRegexpMatching'>AS-PATH Regexp Matching</a>
<ul class='toc-indentation'>
<li><a href='#RouteSelectionandFilters-RegexTestingTool'>Regex Testing Tool</a></li>
<li><a href='#RouteSelectionandFilters-SupportedOperators'>Supported Operators</a></li>
</ul>
</li>
<li><a href='#RouteSelectionandFilters-CommunityandNumLists'>Community and Num Lists</a></li>
</ul>
</li>
<li><a href='#RouteSelectionandFilters-RouteSelection'>Route Selection</a></li>
<li><a href='#RouteSelectionandFilters-RoutingFilterWizard'>Routing Filter Wizard</a></li>
<li><a href='#RouteSelectionandFilters-PropertyReference'>Property Reference</a>
<ul class='toc-indentation'>
<li><a href='#RouteSelectionandFilters-/routing/filter/chain'>/routing/filter/chain</a></li>
</ul>
</li>
</ul>
</div></span></p><h1 id="RouteSelectionandFilters-RouteFiltering"><span class="mw-headline">Route Filtering</span></h1><h2 id="RouteSelectionandFilters-FilterSyntax"><span class="mw-headline">Filter Syntax</span></h2><p>The routing filter rule implements script-like syntax. The example below is a quick demonstration of a routing filter that matches prefixes with a prefix length greater than 24 from subnet 192.168.1.0/24 and increments the default distance by 1. If there is no match then subtract the default distance by one.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/routing filter rule 
  add chain=myChain \
  rule=&quot;if (dst in 192.168.1.0/24 &amp;&amp; dst-len&gt;24) {set distance +1; accept} else {set distance -1; accept}&quot;</pre>
</div></div><p><br/>Filter rule may consist of multiple matchers and actions:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false">if ( [matchers] ) { [actions] } else { [actions] }</pre>
</div></div><p class="auto-cursor-target"><br/>There are two types of properties:</p><ul><li class="auto-cursor-target">only readable - ones that value is only readable and cannot be rewritten, these properties can be used only by matchers</li><li class="auto-cursor-target">readable/writable - ones that value is readable and writeable, used by filter actions, and also can be used by matchers</li></ul><p>Readable properties can be matched by other readable properties (for numeric properties only) or constant values using boolean operators. </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false">[matchers]:
[prop readable] [bool operator] [prop readable]

[actions]:
[action] [prop writeable] [value]</pre>
</div></div><p>The boolean operator is not used if there is only one possible operation.</p><p>Example without boolean operator:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false">if ( protocol connected ) { accept }</pre>
</div></div><p class="auto-cursor-target">Example with boolean operator:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false">if ( bgp-med &lt; 30 ) { accept }</pre>
</div></div><p class="auto-cursor-target">With readable flag properties, matcher is used without specified boolean operator and without value</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false">if ( ospf-dn ) { reject }</pre>
</div></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p><span style="text-decoration: none;color:var(--ds-text,#333333);">Be aware that the default action of the routing filter chain is &quot;reject&quot;</span></p></div></div><h3 class="auto-cursor-target" id="RouteSelectionandFilters-OnlyReadableProperties">Only Readable Properties</h3><p><br/></p><div class="table-wrap"><table class="wrapped relative-table confluenceTable" style="width: 55.39873%;"><colgroup><col style="width: 28.188776%;"/><col style="width: 15.051021%;"/><col style="width: 56.760204%;"/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Type</th><th class="confluenceTh">Description</th></tr><tr><td class="highlight-#fffae6 confluenceTd" colspan="3" data-highlight-colour="#fffae6" title="Background colour : Light yellow 35%"><em title=""><strong>Numeric properties</strong></em></td></tr><tr><td class="confluenceTd">dst-len</td><td class="confluenceTd"><br/></td><td class="confluenceTd">Destination prefix length</td></tr><tr><td class="confluenceTd">bgp-path-len</td><td class="confluenceTd"><br/></td><td class="confluenceTd">The current length of the BGP AS-PATH</td></tr><tr><td class="confluenceTd">bgp-input-local-as</td><td class="confluenceTd"><br/></td><td class="confluenceTd">AS number of the local peer to which the prefix was sent</td></tr><tr><td class="confluenceTd">bgp-input-remote-as</td><td class="confluenceTd"><br/></td><td class="confluenceTd">AS number of the remote peer from which the prefix was received</td></tr><tr><td class="confluenceTd">bgp-output-local-as</td><td class="confluenceTd"><br/></td><td class="confluenceTd">AS number of the peer that will advertise the prefix</td></tr><tr><td class="confluenceTd">bgp-output-remote-as</td><td class="confluenceTd"><br/></td><td class="confluenceTd">AS number of the peer to which the prefix will be advertised</td></tr><tr><td class="confluenceTd">ospf-metric</td><td class="confluenceTd"><br/></td><td class="confluenceTd">Current OSPF metric</td></tr><tr><td class="confluenceTd">ospf-tag</td><td class="confluenceTd"><br/></td><td class="confluenceTd">Current OSPF tag</td></tr><tr><td class="confluenceTd">rip-metric</td><td class="confluenceTd"><br/></td><td class="confluenceTd">Current RIP metric</td></tr><tr><td class="confluenceTd">rip-tag</td><td class="confluenceTd"><br/></td><td class="confluenceTd">Current RIP tag</td></tr><tr><td class="highlight-#fffae6 confluenceTd" colspan="3" data-highlight-colour="#fffae6" title="Background colour : Light yellow 35%"><em title=""><strong>Flag properties</strong></em></td></tr><tr><td class="confluenceTd">active</td><td class="confluenceTd"><br/></td><td class="confluenceTd">indicates whether the route is active</td></tr><tr><td class="confluenceTd">bgp-atomic-aggregate</td><td class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd">bgp-communities-empty</td><td class="confluenceTd"><br/></td><td class="confluenceTd">indicates if the BGP Communities attribute is empty</td></tr><tr><td class="confluenceTd">bgp-ext-communities-empty</td><td class="confluenceTd"><br/></td><td class="confluenceTd">indicates if the BGP Extended Communities attribute is empty</td></tr><tr><td class="confluenceTd">bgp-large-communities-empty</td><td class="confluenceTd"><br/></td><td class="confluenceTd">indicates if the BGP Large Communities attribute is empty</td></tr><tr><td class="confluenceTd">bgp-network</td><td class="confluenceTd"><br/></td><td class="confluenceTd">Indicates if the prefix is originated from BGP networks</td></tr><tr><td class="confluenceTd">ospf-dn</td><td class="confluenceTd"><br/></td><td class="confluenceTd">Indicates if the OSPF route has DN bit set.</td></tr><tr><td class="highlight-#fffae6 confluenceTd" colspan="3" data-highlight-colour="#fffae6" title="Background colour : Light yellow 35%"><em><strong>Prefix properties</strong></em></td></tr><tr><td class="confluenceTd">dst</td><td class="confluenceTd"><br/></td><td class="confluenceTd">Destination</td></tr><tr><td class="confluenceTd">ospf-fwd</td><td class="confluenceTd"><br/></td><td class="confluenceTd">Current OSPF forwarding address</td></tr><tr><td class="confluenceTd">bgp-input-local-addr</td><td class="confluenceTd"><br/></td><td class="confluenceTd">The IP address of the local peer to which the prefix was sent</td></tr><tr><td class="confluenceTd">bgp-input-remote-addr</td><td class="confluenceTd"><br/></td><td class="confluenceTd">The IP address of the remote peer from which the prefix was received</td></tr><tr><td class="confluenceTd">bgp-output-local-addr</td><td class="confluenceTd"><br/></td><td class="confluenceTd">The IP address of the peer that will advertise the prefix</td></tr><tr><td class="confluenceTd">bgp-output-remote-addr</td><td class="confluenceTd"><br/></td><td class="confluenceTd">The IP address of the peer to which the prefix will be advertised</td></tr><tr><td class="highlight-#fffae6 confluenceTd" colspan="3" data-highlight-colour="#fffae6" title="Background colour : Light yellow 35%"><span style="color:var(--ds-text,#333333);" title="">Other Properties</span></td></tr><tr><td class="confluenceTd">afi</td><td class="confluenceTd"><code>ipv4 | ipv6 | l2vpn | l2vpn-cisco | vpnv4 | vpnv6</code></td><td class="confluenceTd">The address family of the route.</td></tr><tr><td class="confluenceTd">bgp-as-path</td><td class="confluenceTd">numeric_regexp</td><td class="confluenceTd">AS path matching, <a href="#RouteSelectionandFilters-AS-PATHRegexpMatching">read more&gt;&gt;</a></td></tr><tr><td class="confluenceTd">bgp-as-path-slow-legacy</td><td class="confluenceTd">string_regexp</td><td class="confluenceTd"><strong>Deprecated</strong>. Extremely slow old-style AS path matching. This parameter should be used only as a temporary matcher while migrating from an old ROS v6 config. <a href="#RouteSelectionandFilters-AS-PATHRegexpMatching">Read more&gt;&gt;</a></td></tr><tr><td class="confluenceTd">chain</td><td class="confluenceTd">chain_name</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd">ospf-type</td><td class="confluenceTd"><code>ext1 | ext2 | inter | intra | nssa1 | nssa2</code></td><td class="confluenceTd"><p>Type of the OSPF route:</p><ul><li>ext1 - external (Type 5 LSA) with type1 metric</li><li>ext2 - external (Type 5 LSA) with type2 metric</li><li>inter - inter-area-route (Type 3 LSA)</li><li>intra - intra-area-route (Type 4 LSA)</li><li>nssa1 - Type 7 LSA with type1 metric</li><li>nssa2 - Type 7 LSA with type1 metric</li></ul></td></tr><tr><td class="confluenceTd">protocol</td><td class="confluenceTd">bgp | connected | dhcp | fantasy | modem | ospf | rip | static | vpn</td><td class="confluenceTd">Protocol type from which the route was imported.</td></tr><tr><td class="confluenceTd">rpki</td><td class="confluenceTd">invalid | unknown | valid | unverified</td><td class="confluenceTd">RPKI validation status of the prefix</td></tr><tr><td class="confluenceTd">rtab</td><td class="confluenceTd">routing_table_name</td><td class="confluenceTd">Name of the routing table the route was imported from</td></tr><tr><td class="confluenceTd">vrf</td><td class="confluenceTd">vrf_name</td><td class="confluenceTd">Name of the VRF the route was imported from</td></tr></tbody></table></div><h3 class="auto-cursor-target" id="RouteSelectionandFilters-WriteableProperties">Writeable Properties</h3><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/><col/></colgroup><tbody><tr><th class="confluenceTh">Property</th><th class="confluenceTh">Type</th><th class="confluenceTh">Description</th></tr><tr><td class="highlight-#fffae6 confluenceTd" colspan="3" data-highlight-colour="#fffae6" title="Background colour : Light yellow 35%"><strong title=""><em>Numeric properties</em></strong></td></tr><tr><td class="confluenceTd">distance</td><td class="confluenceTd"><br/></td><td class="confluenceTd">route distance</td></tr><tr><td class="confluenceTd">scope</td><td class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd">scope-target</td><td class="confluenceTd"><br/></td><td class="confluenceTd">target scope</td></tr><tr><td class="confluenceTd">bgp-weight</td><td class="confluenceTd"><br/></td><td class="confluenceTd">BGP WEIGHT attribute</td></tr><tr><td class="confluenceTd">bgp-med</td><td class="confluenceTd"><br/></td><td class="confluenceTd">BGP MED attribute is local to the router. It is also used in the output of iBGP peers.</td></tr><tr><td class="confluenceTd">bgp-out-med</td><td class="confluenceTd"><br/></td><td class="confluenceTd">BGP MED attribute to be sent to a remote peer. Should be used in the output chain of eBGP peers.</td></tr><tr><td class="confluenceTd">bgp-local-pref</td><td class="confluenceTd"><br/></td><td class="confluenceTd">BGP LOCALPREF attribute</td></tr><tr><td class="confluenceTd">bgp-igp-metric</td><td class="confluenceTd"><br/></td><td class="confluenceTd">BGP IGP METRIC</td></tr><tr><td class="confluenceTd">bgp-path-peer-prepend</td><td class="confluenceTd"><br/></td><td class="confluenceTd"><p>Prepend last received remote peers ASN. If the prefix is originated from the router, then this parameter will not do anything on the router's output, because ASN does not exist yet.</p><p><br/></p><p>If used as a matcher in BGP input, it is possible to filter prefixes exceeding a certain number of prepends. For example, if a remote peer prepends its ASN 5 times, but we want to allow max 4 times prepended ASN, then we can use: &quot;<code>if (<span style="color:var(--ds-icon-success,#22a06b);">bgp-path-peer-prepend</span> &gt; 4) {reject}</code>&quot;</p><p><br/></p><p>This parameter also overrides any prepends received from the remote peer, for example, if the remote peer prepended it's AS 3 times, we can remove this prepend by setting &quot;<span style="color:var(--ds-icon-success,#22a06b);"><code>bgp-path-peer-prepend</code></span> 1&quot; in BGP input</p></td></tr><tr><td class="confluenceTd">bgp-path-prepend</td><td class="confluenceTd"><br/></td><td class="confluenceTd">Prepend routers ASN, should be used in BGP output.</td></tr><tr><td class="confluenceTd">ospf-ext-metric</td><td class="confluenceTd"><br/></td><td class="confluenceTd">OSPF External route metric</td></tr><tr><td class="confluenceTd">ospf-ext-tag</td><td class="confluenceTd"><br/></td><td class="confluenceTd">OSPF external route tag</td></tr><tr><td class="confluenceTd">rip-ext-metric</td><td class="confluenceTd"><br/></td><td class="confluenceTd">RIP External route metric</td></tr><tr><td class="confluenceTd">rip-ext-tag</td><td class="confluenceTd"><br/></td><td class="confluenceTd">RIP External route tag</td></tr><tr><td class="highlight-#fffae6 confluenceTd" colspan="3" data-highlight-colour="#fffae6" title="Background colour : Light yellow 35%"><em><strong>Flag properties</strong></em></td></tr><tr><td class="confluenceTd">ospf-ext-dn</td><td class="confluenceTd"><br/></td><td class="confluenceTd">DN bit for external OSPF routes</td></tr><tr><td class="confluenceTd">blackhole</td><td class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd">suppress-hw-offload</td><td class="confluenceTd"><br/></td><td class="confluenceTd">Whether to <a href="https://help.mikrotik.com/docs/display/ROS/L3+Hardware+Offloading#L3HardwareOffloading-SuppressingHWOffload" rel="nofollow">suppress L3 HW offloading</a></td></tr><tr><td class="confluenceTd">use-te-nexthop</td><td class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr><tr><td class="highlight-#fffae6 confluenceTd" colspan="3" data-highlight-colour="#fffae6" title="Background colour : Light yellow 35%"><em><strong>Other properties</strong></em></td></tr><tr><td class="confluenceTd">gw</td><td class="confluenceTd">ipv4/6 address</td><td class="confluenceTd"><p>IPv4/IPv6 address or interface name. In the case of BGP output, a gateway can be adjusted in the following setups:</p><ul><li>is BGP reflector</li><li>nexthop-choice is set to propagate</li><li>is not eBGP and nexthop-choice=force-self is not set.</li></ul></td></tr><tr><td class="confluenceTd">gw-interface</td><td class="confluenceTd">interface_name</td><td class="confluenceTd">Interface part of the gateway. Should be used if it is required to attach a specific interface for next-hop, like (1.2.3.4%ether1)</td></tr><tr><td class="confluenceTd">gw-check</td><td class="confluenceTd"><span style="color:var(--ds-icon-success,#22a06b);"><code><em>none|arp|icmp|bfd|bfd-mh</em></code></span></td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd">pref-src</td><td class="confluenceTd">ipv4/6 address</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd">bgp-origin</td><td class="confluenceTd"><span style="color:var(--ds-icon-success,#22a06b);"><code><em>igp|egp|incomplete</em></code></span></td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd">ospf-ext-fwd</td><td class="confluenceTd">ipv4/6 address</td><td class="confluenceTd">Forwarding address of External OSPF route</td></tr><tr><td class="confluenceTd">ospf-ext-type</td><td class="confluenceTd"><span style="color:var(--ds-icon-success,#22a06b);"><code><em>type1|type2</em></code></span></td><td class="confluenceTd">OSPF External route type</td></tr><tr><td class="confluenceTd">comment</td><td class="confluenceTd">string</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd">bgp-communities</td><td class="confluenceTd">inline_community_set | community_list_name</td><td class="confluenceTd">BGP Communities attribute is defined in RFC 1997. Each community is 32-bit in size.</td></tr><tr><td class="confluenceTd">bgp-ext-communities</td><td class="confluenceTd">inline_ext_community_set | ext_community_list_name</td><td class="confluenceTd">BGP Extended Communities attribute is defined in RFC 4360. RouterOS parses site-of-origin (prefixed with soo:) and route-target (prefixed with rt:) extended communities. For example, &quot;set bgp-ext-communities rt:1111:2.3.4.5;&quot;. It is possible to set/match RAW extended communities value in 64-bit hex, for example, &quot;set bgp-ext-community 0x.........;&quot;</td></tr><tr><td class="confluenceTd">bgp-large-communities</td><td class="confluenceTd">inline_large_community_set | large_community_list_name</td><td class="confluenceTd">BGP Large Communities attribute is defined in RFC 8092. Suitable for use with all ASNs including 32-bit ASNs. Each community is 12-bytes in length and consists of 3 parts: &quot;global_admin:locap_part_1:local_part_2&quot;.</td></tr></tbody></table></div><h3 class="auto-cursor-target" id="RouteSelectionandFilters-Commands">Commands</h3><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/><col/></colgroup><tbody><tr><th class="confluenceTh">Command</th><th colspan="1" class="confluenceTh">Params</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd">accept</td><td colspan="1" class="confluenceTd"><br/></td><td class="confluenceTd">accept matched prefix</td></tr><tr><td class="confluenceTd">reject</td><td colspan="1" class="confluenceTd"><br/></td><td class="confluenceTd">reject matched prefix, the prefix will be stored in the memory as &quot;filtered&quot; and will not be the candidate to be selected as the best path.</td></tr><tr><td colspan="1" class="confluenceTd">return</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">return to the parent chain</td></tr><tr><td colspan="1" class="confluenceTd">jump</td><td colspan="1" class="confluenceTd"><code><em>jump chain_name</em></code></td><td colspan="1" class="confluenceTd">jump to a specified chain</td></tr><tr><td colspan="1" class="confluenceTd">unset</td><td colspan="1" class="confluenceTd"><code><em>unset prop_name</em></code></td><td colspan="1" class="confluenceTd">used to unset the value of the following properties:<br/><span style="color:var(--ds-icon-success,#22a06b);"><code>pref-src|bgp-med|bgp-out-med|bgp-local-pref</code></span></td></tr><tr><td colspan="1" class="confluenceTd">append</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">append at the end of the list or string. Following property values can be appended: <span style="color:var(--ds-icon-success,#22a06b);"><code>bgp-communities, bgp-ext-communities, bgp-large-communities, comment</code></span></td></tr><tr><td colspan="1" class="confluenceTd">filter</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">Inverse of the delete action (Delete everything except the specified values). Values of the following properties can be filtered: <span style="color:var(--ds-icon-success,#22a06b);"><code>bgp-communities, bgp-ext-communities, bgp-large-communities</code></span></td></tr><tr><td colspan="1" class="confluenceTd">delete</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">Delete the value of the specified property. Values of the following properties can be deleted: <span style="color:var(--ds-icon-success,#22a06b);"><code>bgp-communities, bgp-ext-communities, bgp-large-communities</code></span></td></tr><tr><td colspan="1" class="confluenceTd">set</td><td colspan="1" class="confluenceTd"><code><em>set prop_writeable value</em></code></td><td colspan="1" class="confluenceTd">The command is used to set a new value to writeable properties. Value can be set from other readable properties of matching types. For numeric properties, it is possible to prefix the value with +/- which will increment or decrement the current property value by a given amount. For example, &quot;<code>set <span style="color:var(--ds-icon-success,#22a06b);">bgp-local-ref</span> +1</code>&quot; will increment current LOCAL_PREF by one, or extract value from other readable num property, &quot;<code>set <span style="color:var(--ds-icon-success,#22a06b);">distance</span> +<span style="color:var(--ds-icon-success,#22a06b);">ospf-ext-metric</span></code>&quot;</td></tr><tr><td colspan="1" class="confluenceTd">rpki-verify</td><td colspan="1" class="confluenceTd"><em><code>rpki-verify rpki_group_name</code></em></td><td colspan="1" class="confluenceTd">Enable RPKI verification in the current chain from the specified RPKI group.</td></tr></tbody></table></div><h3 class="auto-cursor-target" id="RouteSelectionandFilters-Operators">Operators</h3><h4 class="auto-cursor-target" id="RouteSelectionandFilters-MatcherOperators">Matcher Operators</h4><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/><col/></colgroup><tbody><tr><th class="confluenceTh">Operator</th><th class="confluenceTh">Description</th><th colspan="1" class="confluenceTh">Example</th></tr><tr><td class="confluenceTd">&amp;&amp;</td><td class="confluenceTd">Logical AND operator</td><td colspan="1" class="confluenceTd"><code>if (dst in 192.168.0.0/16 &amp;&amp; dst-len in 16-32) {reject;}</code></td></tr><tr><td colspan="1" class="confluenceTd">||</td><td colspan="1" class="confluenceTd">Logical OR operator</td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">not</td><td colspan="1" class="confluenceTd">Logical NOT operator</td><td colspan="1" class="confluenceTd"><code>if ( not bgp-network) {reject; }</code></td></tr></tbody></table></div><h4 class="auto-cursor-target" id="RouteSelectionandFilters-NumPropOperators">Num Prop Operators</h4><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th class="confluenceTh">Operator</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd">in</td><td class="confluenceTd">return true if the value is in provided numeric range. Numeric range can be written in following formats: {int..int}, {int-int}</td></tr><tr><td colspan="1" class="confluenceTd">==</td><td colspan="1" class="confluenceTd">return true if numeric values are equal</td></tr><tr><td colspan="1" class="confluenceTd">!=</td><td colspan="1" class="confluenceTd">return true if numeric values are not equal</td></tr><tr><td colspan="1" class="confluenceTd">&gt;</td><td colspan="1" class="confluenceTd">return true if the left numeric value is greater than the right numeric value</td></tr><tr><td colspan="1" class="confluenceTd">&lt;</td><td colspan="1" class="confluenceTd">return true if the left numeric value is less than the right numeric value</td></tr><tr><td colspan="1" class="confluenceTd">&gt;=</td><td colspan="1" class="confluenceTd">return true if the left numeric value is greater than or equal to the right numeric value</td></tr><tr><td colspan="1" class="confluenceTd">&lt;=</td><td colspan="1" class="confluenceTd">return true if the left numeric value is less than or equal to the right numeric value</td></tr></tbody></table></div><h4 class="auto-cursor-target" id="RouteSelectionandFilters-PrefixOperators">Prefix Operators</h4><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th class="confluenceTh">Operator</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd">in</td><td class="confluenceTd">Return true if the prefix is the subnet of the provided network. If an operator is used to match prefixes from the address list (e.g &quot;<span style="color:var(--ds-text-accent-blue,#0055cc);"><code>dst in list_name</code></span>&quot;), then it will match only the exact prefix.</td></tr><tr><td colspan="1" class="confluenceTd">!=</td><td colspan="1" class="confluenceTd">Return true if the prefix is not equal to the provided value</td></tr><tr><td colspan="1" class="confluenceTd">==</td><td colspan="1" class="confluenceTd">Return true if the prefix is equal to the provided value</td></tr></tbody></table></div><div role="region" aria-label="Warning" class="confluence-information-macro  confluence-information-macro-warning" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Address lists by design are matching host address which menas that it will match also  /32 prefix that belongs to any range from the address list. Workaround to exclude /32  prefixes from being advertised is to use dst-len &quot;<span style="color:var(--ds-text-accent-blue,#0055cc);"><code>if (dst in list_name &amp;&amp; dst-len &lt; 32) {}</code></span>&quot;</p></div></div><h4 class="auto-cursor-target" id="RouteSelectionandFilters-BGPCommunityOperators">BGP Community Operators</h4><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/><col/></colgroup><tbody><tr><th class="confluenceTh">Operator</th><th class="confluenceTh">Description</th><th colspan="1" class="confluenceTh">Example</th></tr><tr><td class="confluenceTd">equal</td><td class="confluenceTd">return true if provided communities are equal to the routes property value</td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd">equal-list</td><td class="confluenceTd">return true if communities from provided community-list are equal to the route's property value</td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">any</td><td colspan="1" class="confluenceTd">returns true if the route's property value contains at least one of provided communities</td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">any-list</td><td colspan="1" class="confluenceTd">returns true if the route's property value contains at least one community from the provided list</td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">includes</td><td colspan="1" class="confluenceTd">returns true if the route's property value includes specified communities</td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">includes-list</td><td colspan="1" class="confluenceTd">returns true if the route's property value includes all communities from the specified communities-list</td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">subset</td><td colspan="1" class="confluenceTd">returns true if route community subset matches communities from the list</td><td colspan="1" class="confluenceTd"><p>1:1,3:3 will match 1:1,2:2,3:3</p></td></tr><tr><td colspan="1" class="confluenceTd">subset-list</td><td colspan="1" class="confluenceTd">the same as &quot;subset&quot;, but matches communities form the community list.</td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">any-regexp</td><td colspan="1" class="confluenceTd">the same as &quot;any&quot;, but matched by regexp</td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">subset-regexp</td><td colspan="1" class="confluenceTd">the same as &quot;subset&quot;, but matched by regexp</td><td colspan="1" class="confluenceTd"><br/></td></tr></tbody></table></div><h4 class="auto-cursor-target" id="RouteSelectionandFilters-StringOperators">String Operators</h4><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th class="confluenceTh">Operator</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd">find</td><td class="confluenceTd">Check if provided substring is part of the property value</td></tr><tr><td colspan="1" class="confluenceTd">regexp</td><td colspan="1" class="confluenceTd">Match string regexp of the property value</td></tr></tbody></table></div><h2 class="auto-cursor-target" id="RouteSelectionandFilters-DeletingBGPCommunities">Deleting BGP Communities</h2><p>Routing filters allow to clear BGP communities by using &quot;delete&quot; command. Delete command accepts several parameters based on the type of the community type:</p><ul><li><strong>communities</strong>: <ul><li>&quot;<span style="color:var(--ds-text-accent-green-bolder,#164b35);">wk</span>&quot; - will match and remove well known communities</li><li>&quot;<span style="color:var(--ds-text-accent-green-bolder,#164b35);">other</span>&quot; - will match and remove other communities that are not well known </li><li>&quot;<span style="color:var(--ds-text-accent-green-bolder,#164b35);">regexp</span>&quot; - regexp pattern to match communities that should be deleted</li><li>&quot;&lt;community-list name&gt;&quot; - deletes communities from specified community-list</li></ul></li><li><strong>ext-communities</strong>:<ul><li>&quot;<span style="color:var(--ds-text-accent-green-bolder,#164b35);">rt</span>&quot; - will match and remove <strong>RouteTarget</strong></li><li>&quot;<span style="color:var(--ds-text-accent-green-bolder,#164b35);">soo</span>&quot; - will match and remove <strong>Site-of-Origin</strong></li><li>&quot;<span style="color:var(--ds-text-accent-green-bolder,#164b35);">other</span>&quot; - will match and remove other ext communities that are not RT or SSO </li><li>&quot;<span style="color:var(--ds-text-accent-green-bolder,#164b35);">regexp</span>&quot; - regexp pattern to match ext communities that should be deleted</li><li>&quot;&lt;community-ext-list name&gt;&quot; - deletes communities from specified community-ext-list</li></ul></li><li><strong>large-communities</strong>:<ul><li>&quot;<span style="color:var(--ds-text-accent-green-bolder,#164b35);">all</span>&quot; - removes everything</li><li>&quot;<span style="color:var(--ds-text-accent-green-bolder,#164b35);">regexp</span>&quot; - regexp pattern to match large communities that should be deleted</li><li>&quot;&lt;community-large-list name&gt;&quot; - deletes large communities from specified community-large-list</li></ul></li></ul><p><br/></p><p>It is possible to specify multiple community types, for example delete all SSOs, other type of ext communities and specific RTs from the community-ext list:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/routing/filter/community-ext-list
add list=myRTList communities=&quot;rt:1.1.1.1:222&quot;
/routing/filter/rule
add chain=myChain rule=&quot;delete bgp-ext-communities sso,other,myRTList;&quot;</pre>
</div></div><p><br/></p><h2 class="auto-cursor-target" id="RouteSelectionandFilters-AS-PATHRegexpMatching">AS-PATH Regexp Matching</h2><p class="auto-cursor-target">AS Path is the sequence of autonomous system numbers (ASNs), for example AS Path 123 456 789 would indicate, that route originated from AS with the number 789, and to reach the destination, the packet would need to travel through two autonomous systems: 456 and 789. To apply specific routing policies administrator might want to match specific AS numbers or set of numbers in the AS Path (for example, reject prefixes that travel through AS 456), which can be achieved using regular expression (regexp).</p><p class="auto-cursor-target">There are two common ways how to operate with AS Path data:</p><ul><li class="auto-cursor-target">convert whole AS path to string and let regexp operate on the string (ROS v6 or Cisco style)</li><li class="auto-cursor-target">let regexp operate on each entry in the AS path as a number (ROS v7, Juniper style)</li></ul><p>Basically, the first method is performing the match per character, the second method is performing the match per whole AS number. As you would imagine the latter method is much faster and less resource-intensive than the string matching approach.</p><p>This change would require administrators to implement new Regex strategies. Old Regex patterns from RouterOS v6 cannot be directly copied/pasted as they will result either in syntax errors or unexpected results.</p><p>Let us take a very basic AS Path filter rule.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/routing/filter/rule
add chain=myChain rule=&quot;if (bgp-as-path .1234.) {accept}&quot;</pre>
</div></div><p>In ROS v7 this Regex pattern will match ASN 1234 anywhere in the middle of the AS-path, the same pattern in ROS v6 would match any AS path that contains ASN consisting of at least 6 characters and contains a string of &quot;1234&quot;.  Obviously, if we directly copy/paste the Regex pattern from one implementation to another it will lead to unexpected/dangerous results. An equivalent pattern in ROS v6 would look something like this: &quot;._1234_.&quot;.</p><p>Let's take another example from ROS v6, say we have a pattern &quot;1234[5-9]&quot; what it does is it matches 12345 to 12349 anywhere in the string, which means that valid matches are AS-path &quot;12345 3434&quot;, &quot;11 9123467 22&quot; and so on. If you enter the same pattern in ROS v7 it will match AS path containing exact ASN 1234 followed by ASN in a range from 5 to 9 (matching AS-paths would be &quot;1234 7 111&quot;, &quot;111 1234 5 222&quot; etc., it will not match &quot;12345 3434&quot;).</p><div role="region" aria-label="Warning" class="confluence-information-macro  confluence-information-macro-warning" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Do not copy Regex patterns directly from ROS v6 or Cisco configurations, they are not directly compatible. It can lead to unexpected or even dangerous configurations in some scenarios.</p></div></div><div role="region" aria-label="Warning" class="confluence-information-macro  confluence-information-macro-warning" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>AS-Path parameter must exist for regexp matcher to be applied. This means that it is not possible to match non-existent (empty) AS-Path with regular expression, aka &quot;^$&quot;. <span style="color:var(--ds-background-accent-green-bolder,#1f845a);"><code>bgp-path-len</code></span> should be used instead.</p></div></div><p><br/></p><h3 id="RouteSelectionandFilters-RegexTestingTool">Regex Testing Tool</h3><p>RouterOS now has a built-in regex checking tool to simplify the hard life of the administrators. This tool supports also num-list so now exact regex can be tested against any as-path before applying it to the routing filters.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/routing/filter/num-list add list=test range=100-1500

/routing/filter/test-as-path-regexp regexp=&quot;[[:test:]]5678\$&quot; as-path=&quot;1234,5678&quot;</pre>
</div></div><p><br/></p><p><br/></p><h3 class="auto-cursor-target" id="RouteSelectionandFilters-SupportedOperators">Supported Operators</h3><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 101.552574%;"><colgroup><col style="width: 5.7678943%;"/><col style="width: 35.510773%;"/><col style="width: 11.257818%;"/><col style="width: 38.151493%;"/><col style="width: 9.24253%;"/></colgroup><tbody><tr><th scope="col" class="confluenceTh">Operator</th><th scope="col" class="confluenceTh">Description</th><th scope="col" class="confluenceTh">Example</th><th scope="col" class="confluenceTh">Example Explained</th><th scope="col" class="confluenceTh">Example Matches</th></tr><tr><td class="confluenceTd">^</td><td class="confluenceTd">Represents the beginning of the path</td><td class="confluenceTd">^1234 </td><td class="confluenceTd">will match AS-path starting with ASN 1234</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd">$</td><td class="confluenceTd">Represents the end of the path</td><td class="confluenceTd">1234$</td><td class="confluenceTd">will match AS-path of origin ASN 1234</td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd">*</td><td class="confluenceTd">Zero or more occurrences of the  listed ASN</td><td class="confluenceTd">^1234*$</td><td class="confluenceTd">will match Null as-path or as-path where ASN 1234 may or may not appear multiple times</td><td class="confluenceTd"><p><strong>Match:</strong></p><p>1234</p><p>1234 1234 1234</p><p>Null path</p><p><strong>No Match:</strong></p><p>1234 5678</p></td></tr><tr><td class="confluenceTd">+</td><td class="confluenceTd">One or more occurrences of the listed ASN</td><td class="confluenceTd">1234+</td><td class="confluenceTd">will match AS-path where ASN 1234 appears at least once</td><td class="confluenceTd"><p><strong>Match:</strong></p><p>1234</p><p>3 1234 6</p><p><strong>No match:</strong></p><p>12345 678</p></td></tr><tr><td class="confluenceTd">?</td><td class="confluenceTd">Zero or one occurrence of the listed ASN</td><td class="confluenceTd">^1234? 5678</td><td class="confluenceTd">will match AS-path that may or may not start with ASN 1234 appearing once.</td><td class="confluenceTd"><p><strong>Match</strong>:</p><p>5678</p><p>1234 5678</p><p><strong>No match:</strong></p><p>1234 1234 5678</p><p>12345 5678</p></td></tr><tr><td class="confluenceTd">.</td><td class="confluenceTd">One occurrence of any ASN</td><td class="confluenceTd">^.$ </td><td class="confluenceTd">will match any AS-path with the length of one.</td><td class="confluenceTd"><p><strong>Match:</strong></p><p>12345</p><p>45678</p><p><strong>No match:</strong></p><p>1234 5678</p></td></tr><tr><td class="confluenceTd">|</td><td class="confluenceTd">Match one of two ASNs on each side</td><td class="confluenceTd">^(1234|5678) </td><td class="confluenceTd">will match AS-path starting with ASN 1234 or 5678</td><td class="confluenceTd"><p><strong>Match</strong>:</p><p>1234</p><p>5678</p><p>1234 5678</p><p><strong>No Match:</strong></p><p>91011</p></td></tr><tr><td class="confluenceTd"><p>[ ]</p><p>[^ ]</p></td><td class="confluenceTd"><p>Represents the set of AS numbers where one AS number from the list must match.</p><p>Use ^ after opening the bracket to negate the set.</p><p>It is also possible to reference the pre-defined num-lists from <a href="#RouteSelectionandFilters-/routing/filter/num-list">num-list</a> with [[:numset_name:]] </p></td><td class="confluenceTd"><p>^[1234 5678 1-100]</p><p><br/></p></td><td class="confluenceTd">will match the AS-path that starts with 1234 or 5678 or from the range of 1 to 100</td><td class="confluenceTd"><p><strong>Match:</strong></p><p>1234</p><p>99</p><p>5678</p><p><strong>No Match:</strong></p><p>101</p></td></tr><tr><td class="confluenceTd"><p>()</p></td><td class="confluenceTd">Group of regexp terms to match</td><td class="confluenceTd">^(1234$|5678)</td><td class="confluenceTd">will match AS-path that starts and ends with 1234 or AS-path that starts with 5678</td><td class="confluenceTd"><p><strong>Match:</strong></p><p>1234</p><p>5678 9999</p><p><strong>No Match:</strong></p><p>1234 5678</p></td></tr></tbody></table></div><div role="region" aria-label="Note" class="confluence-information-macro  confluence-information-macro-note" ><span role="presentation" class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon" ></span><div class="confluence-information-macro-body"><p>Repetition ranges {} are not supported.</p></div></div><h2 class="auto-cursor-target" id="RouteSelectionandFilters-CommunityandNumLists">Community and Num Lists</h2><p>A list of commonly used numbers can be configured from the <span style="color:var(--ds-icon-accent-blue,#1d7afc);"><code>/routing/filter/num-list</code></span> menu. These lists of numbers can be used in the filter rules to simplify the filter setup process.</p><p class="auto-cursor-target">In a similar manner, you are allowed to define also community, extended community, and large community lists. <span style="text-decoration: none;color:var(--ds-text,#172b4d);">Community sets can be used for matching, appending, and setting.</span></p><p class="auto-cursor-target"><span style="text-decoration: none;color:var(--ds-text,#172b4d);">For example match communities from the list and clear the attribute:<br/></span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/routing/filter/community-list
add communities=111:222 list=myCommunityList

/routing/filter/rule
add chain=myChain rule=&quot;if (bgp-communities equal-list myCommunityList) {delete bgp-communities wk,other; accept;}&quot;</pre>
</div></div><p><br/></p><p class="auto-cursor-target"><span style="text-decoration: none;color:var(--ds-text,#172b4d);"><br/><br/></span></p><p><span style="text-decoration: none;color:var(--ds-text,#172b4d);"><span style="color:var(--ds-icon-accent-blue,#1d7afc);"><code>/routing/filter/community-list</code></span></span></p><div class="table-wrap"><table class="wrapped confluenceTable" style="margin-left: 14.4318px;"><colgroup><col/><col/><col/></colgroup><tbody><tr><th class="highlight-#deebff confluenceTh" colspan="2" data-highlight-colour="#deebff">Property</th><th class="highlight-#deebff confluenceTh" data-highlight-colour="#deebff">Description</th></tr><tr><td colspan="2" class="confluenceTd"><strong>comment</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd"><br/></td></tr><tr><td class="highlight-#f4f5f7 confluenceTd" colspan="2" data-highlight-colour="#f4f5f7"><strong title="">communities</strong><span title=""> </span>(<em title="">list of communities</em>; Default:<span title=""> </span>)</td><td class="highlight-#f4f5f7 confluenceTd" data-highlight-colour="#f4f5f7"><p>List of communities expressed either as <strong>well-known </strong>name or in the following format: &quot;<strong>as</strong><strong>:number&quot;</strong>, where each section can be integer [0..65535].</p><p>Accepted well known names:</p><p><span style="color:var(--ds-icon-success,#22a06b);">accept-own     graceful-shutdown  no-advertise         no-llgr         route-filter-6      </span><br/><span style="color:var(--ds-icon-success,#22a06b);">accept-own-nh  internet           no-export            no-peer         route-filter-xlate-4</span><br/><span style="color:var(--ds-icon-success,#22a06b);">blackhole      llgr-stale         local-as  route-filter-4  route-filter-xlate-6</span></p></td></tr><tr><td colspan="2" class="confluenceTd"><strong title="">disabled</strong><span title=""> </span>(yes<em title=""> | no</em>)</td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td class="highlight-grey confluenceTd" colspan="2" data-highlight-colour="grey"><strong title="">name</strong><span title=""> </span>(<em title="">integer [string</em>; Default: )</td><td class="highlight-grey confluenceTd" data-highlight-colour="grey">Reference name.</td></tr><tr><td colspan="2" class="confluenceTd"><strong title="">regexp</strong><span title=""> </span>(string)</td><td colspan="1" class="confluenceTd">Regexp matcher to match communities. The community set with only the regexp parameter cannot be used to append communities.</td></tr></tbody></table></div><p><span style="color:var(--ds-icon-accent-blue,#1d7afc);"><code>/routing/filter/community-ext-list</code></span></p><div class="table-wrap"><table class="wrapped confluenceTable" style="margin-left: 14.4318px;"><colgroup><col/><col/><col/></colgroup><tbody><tr><th class="highlight-#deebff confluenceTh" colspan="2" data-highlight-colour="#deebff">Property</th><th class="highlight-#deebff confluenceTh" data-highlight-colour="#deebff">Description</th></tr><tr><td colspan="2" class="confluenceTd"><strong>comment</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd"><br/></td></tr><tr><td class="highlight-#f4f5f7 confluenceTd" colspan="2" data-highlight-colour="#f4f5f7"><strong title="">communities</strong><span title=""> </span>(<em title="">list of ext communities</em>; Default:<span title=""> </span>)</td><td class="highlight-#f4f5f7 confluenceTd" data-highlight-colour="#f4f5f7"><p>List of extended communities expressed as <strong>raw</strong> integer value or in the typed format: &quot;<strong>type:value</strong>&quot;, where type can be:</p><ul><li><strong>rt</strong> - route-target</li><li><strong>soo</strong> -  site of origin</li></ul><p>Value depends on the type, for more info on RT and SoO values ask google.</p></td></tr><tr><td colspan="2" class="confluenceTd"><strong title="">disabled</strong><span title=""> </span>(yes<em title=""> | no</em>)</td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td class="highlight-grey confluenceTd" colspan="2" data-highlight-colour="grey"><strong title="">name</strong><span title=""> </span>(<em title="">integer [string</em>; Default: )</td><td class="highlight-grey confluenceTd" data-highlight-colour="grey">Reference name.</td></tr><tr><td colspan="2" class="confluenceTd"><strong title="">regexp</strong><span title=""> </span>(string)</td><td colspan="1" class="confluenceTd">Regexp matcher to match communities. The community set with only the regexp parameter cannot be used to append communities.</td></tr></tbody></table></div><p><span style="color:var(--ds-icon-accent-blue,#1d7afc);"><code>/routing/filter/community-large-list</code></span></p><div class="table-wrap"><table class="wrapped confluenceTable" style="margin-left: 14.4318px;"><colgroup><col/><col/><col/></colgroup><tbody><tr><th class="highlight-#deebff confluenceTh" colspan="2" data-highlight-colour="#deebff">Property</th><th class="highlight-#deebff confluenceTh" data-highlight-colour="#deebff">Description</th></tr><tr><td colspan="2" class="confluenceTd"><strong>comment</strong><span> </span>(<em>string</em>; Default: )</td><td class="confluenceTd"><br/></td></tr><tr><td class="highlight-#f4f5f7 confluenceTd" colspan="2" data-highlight-colour="#f4f5f7"><strong title="">communities</strong><span title=""> </span>(<em title="">list of large communities</em>; Default:<span title=""> </span>)</td><td class="highlight-#f4f5f7 confluenceTd" data-highlight-colour="#f4f5f7"><p>List of large communities expressed in following format: &quot;<strong>admin:value1:value2</strong>&quot;, where each section can be integer [0..4294967295].</p></td></tr><tr><td colspan="2" class="confluenceTd"><strong title="">disabled</strong><span title=""> </span>(yes<em title=""> | no</em>)</td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td class="highlight-grey confluenceTd" colspan="2" data-highlight-colour="grey"><strong title="">name</strong><span title=""> </span>(<em title="">integer [string</em>; Default: )</td><td class="highlight-grey confluenceTd" data-highlight-colour="grey">Reference name.</td></tr><tr><td colspan="2" class="confluenceTd"><strong title="">regexp</strong><span title=""> </span>(string)</td><td colspan="1" class="confluenceTd">Regexp matcher to match communities. The community set with only the regexp parameter cannot be used to append communities.</td></tr></tbody></table></div><p><br/></p><h1 id="RouteSelectionandFilters-RouteSelection"><span class="mw-headline">Route Selection</span></h1><p><span class="mw-headline">Route selection rules allow controlling how output routes are selected from available candidate routes. By default, (if no selection rules are set) output always picks the best route.</span></p><p><span class="mw-headline">For example, if we look at the routing table below, we can see that there are 2 candidate routes and one best route. By default when BGP selects which route to send out, it will pick the active route.</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false">[admin@4] /routing/route&gt; print where dst-address=1.0.0.0/24
Flags: A - ACTIVE; b, y - COPY
Columns: DST-ADDRESS, GATEWAY, AFI, DISTANCE, SCOPE, TARGET-SCOPE, IMMEDIATE-GW
   DST-ADDRESS  GATEWAY         AFI  DISTANCE  SCOPE  TARGET-SCOPE  IMMEDIATE-GW         
 b 1.0.0.0/24   10.155.101.217  ip4        19     40            30  10.155.109.254%ether1
Ab 1.0.0.0/24   10.155.101.232  ip4        20     40            30  10.155.109.254%ether1
 b 1.0.0.0/24   10.155.101.231  ip4        20     40            30  10.155.109.254%ether1</pre>
</div></div><p>But there might be cases where you would want preference for other routes, not the active ones, and here come in-play selection rules.</p><p>Selection rules in RouterOS are configured from <span style="color:var(--ds-text-accent-blue,#0055cc);"><code>/routing/filter/select-rule</code></span> menu.</p><p>Select rules can also call routing filters where routes get selected based on filter rules. For example, to mimic default output selection we can set up the following rule sets:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ros; gutter: false">/routing filter rule 
add chain=get_active rule=&quot;if (active) {accept}&quot;

/routing filter select-rule
add chain=my_select_chain do-where=get_active</pre>
</div></div><p><br/></p><h1 id="RouteSelectionandFilters-RoutingFilterWizard"><span class="mw-headline">Routing Filter Wizard</span></h1><p><span class="mw-headline"><strong>Cmd</strong>: <span style="text-decoration: none;color:var(--ds-text,#172b4d);"><span style="color:var(--ds-icon-accent-blue,#1d7afc);"><code>/routing/filter/filter-wizard</code></span></span></span></p><p><span class="mw-headline">Due to incresed complexity of writing filters in script like manner, v7.20 introduces new routing filter wizard that allows to generate filter rules with ROSv6-like syntax.<br/>Quick demonstration:</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: routeros; gutter: false">[admin@CCR2004_2XS_111] /routing/filter&gt; filter-wizard &lt;tab&gt;
action        dst                   ospf-type         scope-target      set-gw-check                use-te-nexthop   
afi           dst-len               protocol          set-bgp-...       set-scope                   
bgp-...       gateway               routing-table     set-blackhole     set-scope-target            
blackhole     jump-target-chain     rpki              set-comment       set-suppress-hw-offload     
chain         match-chain           rpki-verify       set-distance      set-use-te-nexthop          
distance      ospf-metric           scope             set-gateway       suppress-hw-offload   

[admin@CCR2004_2XS_111] /routing/filter&gt; filter-wizard action=accept chain=vpn-in afi=vpnv4 set-bgp-ext-communities=rt:2:2
  result: Filter rule &#39;if (afi vpnv4) { set bgp-ext-communities rt:2:2; accept; }&#39; added

[admin@CCR2004_2XS_111] /routing/filter&gt; /routing/filter/rule/print 
Flags: X - disabled, I - inactive 
 0   ;;; added by filter-wizard
     chain=vpn-in rule=&quot;if (afi vpnv4) { set bgp-ext-communities rt:2:2; accept; }&quot; </pre>
</div></div><p><span class="mw-headline">Filter wizard adds rules at the end of the list and will have a comment &quot;</span>added by filter-wizard<span class="mw-headline">&quot;.  <br/></span></p><p><span class="mw-headline">Returned errors when trying to add filter with unacceptable values will be printed in CLI and logged in system log with &quot;route,error&quot; topics. <br/></span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: routeros; gutter: false">[admin@CCR2004_2XS_111] /routing/filter&gt; filter-wizard action=accept chain=vpn-in afi=vpnv4 match-chain=vpn-in 
  result: Error adding &#39;if (chain vpn-in &amp;&amp; afi vpnv4) { accept; }&#39;match with &#39;vpn-in&#39; creates chain loop (6)

[admin@CCR2004_2XS_111] /routing/filter&gt; /log/print 
 2025-05-19 13:05:15 route,error Error adding &#39;if (chain vpn-in &amp;&amp; afi vpnv4) { accept; }&#39;match with &#39;vpn-in&#39; creates chain loop (6)

</pre>
</div></div><p><br/></p><p><br/></p><h1 id="RouteSelectionandFilters-PropertyReference"><span class="mw-headline">Property Reference</span></h1><h2 id="RouteSelectionandFilters-/routing/filter/chain"><span style="color:var(--ds-icon-accent-blue,#1d7afc);"><code>/routing/filter/chain</code></span></h2><p><span style="text-decoration: none;color:var(--ds-text,#172b4d);">Dynamic list of filter rule chains that can be referenced in BGP/OSPF configuration.</span></p><p><span style="text-decoration: none;color:var(--ds-text,#172b4d);"><strong>Read-only properties:</strong></span></p><div class="table-wrap"><table class="wrapped confluenceTable" style="margin-left: 14.4318px;"><colgroup><col/><col/><col/></colgroup><tbody><tr><th class="highlight-#deebff confluenceTh" colspan="2" data-highlight-colour="#deebff">Property</th><th class="highlight-#deebff confluenceTh" data-highlight-colour="#deebff">Description</th></tr><tr><td colspan="2" class="confluenceTd"><strong>dynamic</strong><span> </span>(<em>yes | no</em>)</td><td class="confluenceTd"><br/></td></tr><tr><td class="highlight-#f4f5f7 confluenceTd" colspan="2" data-highlight-colour="#f4f5f7"><strong title="">inactive</strong><span title=""> </span>(yes<em title=""> | no</em>)</td><td class="highlight-#f4f5f7 confluenceTd" data-highlight-colour="#f4f5f7"><br/></td></tr><tr><td colspan="2" class="confluenceTd"><strong title="">name</strong><span title=""> </span>(<em title="">string</em>)</td><td class="confluenceTd"><br/></td></tr></tbody></table></div><p><span style="font-family: SFMono-Medium , &quot;SF Mono&quot; , &quot;Segoe UI Mono&quot; , &quot;Roboto Mono&quot; , &quot;Ubuntu Mono&quot; , Menlo , Courier , monospace;font-size: 20.0px;letter-spacing: -0.008em;color:var(--ds-icon-accent-blue,#1d7afc);">/routing/filter/select-chain</span></p><p><span style="text-decoration: none;color:var(--ds-text,#172b4d);">Dynamic list of filter select chains that can be referenced in BGP/OSPF configuration.</span></p><p><span style="text-decoration: none;color:var(--ds-text,#172b4d);"><strong>Read-only properties:</strong></span></p><div class="table-wrap"><table class="wrapped confluenceTable" style="margin-left: 14.4318px;"><colgroup><col/><col/><col/></colgroup><tbody><tr><th class="highlight-#deebff confluenceTh" colspan="2" data-highlight-colour="#deebff">Property</th><th class="highlight-#deebff confluenceTh" data-highlight-colour="#deebff">Description</th></tr><tr><td colspan="2" class="confluenceTd"><strong>dynamic</strong><span> </span>(<em>yes | no</em>)</td><td class="confluenceTd"><br/></td></tr><tr><td class="highlight-#f4f5f7 confluenceTd" colspan="2" data-highlight-colour="#f4f5f7"><strong title="">inactive</strong><span title=""> </span>(yes<em title=""> | no</em>)</td><td class="highlight-#f4f5f7 confluenceTd" data-highlight-colour="#f4f5f7"><br/></td></tr><tr><td colspan="2" class="confluenceTd"><strong title="">name</strong><span title=""> </span>(<em title="">string</em>)</td><td class="confluenceTd"><br/></td></tr></tbody></table></div>
                    </div>

                                        
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on May 20, 2025 14:53</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
